<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="4">
  <HTTPTask id="642" hostname="vk.com" path="/al_im.php" url="https://vk.com/al_im.php" ip="95.213.11.181" port="443" connectionId="12" origin="Primary" frame="1" startDateTime="2017-11-15T11:23:08.082+03:00" startTime="295641187" endTime="295641484">
    <HTTPRequest method="POST">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dmsuY29t</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MjQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Origin" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly92ay5jb20=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Requested-With" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>WE1MSHR0cFJlcXVlc3Q=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYyLjAuMzIwMi42MiBTYWZhcmkvNTM3LjM2</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>YXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVk</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Ki8q</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly92ay5jb20v</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cnUtUlUscnU7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjc=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cmVtaXhsYW5nPTA7IHJlbWl4c3RpZD00MjM5NjMzNjhfYzJiNzJkZDgwZWNmZjYxZjU2OyByZW1peGZsYXNoPTAuMC4wOyByZW1peHNjcmVlbl9kZXB0aD0yNDsgcmVtaXhkdD0wOyByZW1peHNpZD02MzU1ZDg0MzBiZWNkNTFmM2QzMjUwNzc2M2M2YmFjYjc1MDRhM2FlNmJlOWM3NzJmODkzOA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>UE9TVCAvYWxfaW0ucGhwIEhUVFAvMS4xDQpIb3N0OiB2ay5jb20NCkNvbm5lY3Rpb246IGtlZXAtYWxpdmUNCkNvbnRlbnQtTGVuZ3RoOiAyNA0KT3JpZ2luOiBodHRwczovL3ZrLmNvbQ0KWC1SZXF1ZXN0ZWQtV2l0aDogWE1MSHR0cFJlcXVlc3QNClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS82Mi4wLjMyMDIuNjIgU2FmYXJpLzUzNy4zNg0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQNCkFjY2VwdDogKi8qDQpSZWZlcmVyOiBodHRwczovL3ZrLmNvbS8NCkFjY2VwdC1FbmNvZGluZzogZ3ppcCwgZGVmbGF0ZSwgYnINCkFjY2VwdC1MYW5ndWFnZTogcnUtUlUscnU7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjcNCkNvb2tpZTogcmVtaXhsYW5nPTA7IHJlbWl4c3RpZD00MjM5NjMzNjhfYzJiNzJkZDgwZWNmZjYxZjU2OyByZW1peGZsYXNoPTAuMC4wOyByZW1peHNjcmVlbl9kZXB0aD0yNDsgcmVtaXhkdD0wOyByZW1peHNpZD02MzU1ZDg0MzBiZWNkNTFmM2QzMjUwNzc2M2M2YmFjYjc1MDRhM2FlNmJlOWM3NzJmODkzOA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="remixlang" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixstid" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NDIzOTYzMzY4X2MyYjcyZGQ4MGVjZmY2MWY1Ng==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixflash" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MC4wLjA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixscreen_depth" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MjQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixdt" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixsid" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NjM1NWQ4NDMwYmVjZDUxZjNkMzI1MDc3NjNjNmJhY2I3NTA0YTNhZTZiZTljNzcyZjg5Mzg=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>YWN0PWFfZ2V0X2NvbW1zX2tleSZhbD0x</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>50</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bmdpbng=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>V2VkLCAxNSBOb3YgMjAxNyAwODoyMTowMiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9wbGFpbjsgY2hhcnNldD13aW5kb3dzLTEyNTE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>NTA=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Powered-By" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>UEhQLzMuMTQwOTI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Pragma" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bm8tY2FjaGU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-control" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bm8tc3RvcmU=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Encoding" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Strict-Transport-Security" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4LWFnZT0w</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Frontend" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZnJvbnQyMTMwMDY=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Access-Control-Expose-Headers" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>WC1Gcm9udGVuZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Adguard-Filtered" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWRHdWFyZCBmb3IgV2luZG93czsgdmVyc2lvbj02LjIuNDMzLjIxNjc=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54DQpEYXRlOiBXZWQsIDE1IE5vdiAyMDE3IDA4OjIxOjAyIEdNVA0KQ29udGVudC1UeXBlOiB0ZXh0L3BsYWluOyBjaGFyc2V0PXdpbmRvd3MtMTI1MQ0KQ29udGVudC1MZW5ndGg6IDUwDQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpYLVBvd2VyZWQtQnk6IFBIUC8zLjE0MDkyDQpQcmFnbWE6IG5vLWNhY2hlDQpDYWNoZS1jb250cm9sOiBuby1zdG9yZQ0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eTogbWF4LWFnZT0wDQpYLUZyb250ZW5kOiBmcm9udDIxMzAwNg0KQWNjZXNzLUNvbnRyb2wtRXhwb3NlLUhlYWRlcnM6IFgtRnJvbnRlbmQNClgtQWRndWFyZC1GaWx0ZXJlZDogQWRHdWFyZCBmb3IgV2luZG93czsgdmVyc2lvbj02LjIuNDMzLjIxNjcNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MzQ1NTAzNTYzNDEyNTwhPjwhPjA8IT42ODY4PCE+MDwhPmVtcHR5</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="295641406" offset="0" length="426" />
        <PacketInfo time="295641484" offset="426" length="50" />
      </TcpPackets>
    </HTTPResponse>
    <HTTPTask id="696" hostname="vk.com" path="/js/al/emoji.js?3160351728" url="https://vk.com/js/al/emoji.js?3160351728" ip="95.213.11.181" port="443" connectionId="1" origin="HTML" frame="1" startDateTime="2017-11-15T11:23:08.176+03:00" startTime="295642015" endTime="295642093">
      <QueryString>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>MzE2MDM1MTcyOA==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </QueryString>
      <HTTPSplittedQueryStrings>
        <HTTPHeaderEntity name="" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MzE2MDM1MTcyOA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
      </HTTPSplittedQueryStrings>
      <HTTPRequest method="GET">
        <HTTPHeaders>
          <HTTPHeaderEntity name="Host" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dmsuY29t</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="User-Agent" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYyLjAuMzIwMi42MiBTYWZhcmkvNTM3LjM2</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ki8q</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referer" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aHR0cHM6Ly92ay5jb20v</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Encoding" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Language" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cnUtUlUscnU7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cookie" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cmVtaXhsYW5nPTA7IHJlbWl4c3RpZD00MjM5NjMzNjhfYzJiNzJkZDgwZWNmZjYxZjU2OyByZW1peGZsYXNoPTAuMC4wOyByZW1peHNjcmVlbl9kZXB0aD0yNDsgcmVtaXhkdD0wOyByZW1peHNpZD02MzU1ZDg0MzBiZWNkNTFmM2QzMjUwNzc2M2M2YmFjYjc1MDRhM2FlNmJlOWM3NzJmODkzOA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>R0VUIC9qcy9hbC9lbW9qaS5qcz8zMTYwMzUxNzI4IEhUVFAvMS4xDQpIb3N0OiB2ay5jb20NCkNvbm5lY3Rpb246IGtlZXAtYWxpdmUNClVzZXItQWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS82Mi4wLjMyMDIuNjIgU2FmYXJpLzUzNy4zNg0KQWNjZXB0OiAqLyoNClJlZmVyZXI6IGh0dHBzOi8vdmsuY29tLw0KQWNjZXB0LUVuY29kaW5nOiBnemlwLCBkZWZsYXRlLCBicg0KQWNjZXB0LUxhbmd1YWdlOiBydS1SVSxydTtxPTAuOSxlbi1VUztxPTAuOCxlbjtxPTAuNw0KQ29va2llOiByZW1peGxhbmc9MDsgcmVtaXhzdGlkPTQyMzk2MzM2OF9jMmI3MmRkODBlY2ZmNjFmNTY7IHJlbWl4Zmxhc2g9MC4wLjA7IHJlbWl4c2NyZWVuX2RlcHRoPTI0OyByZW1peGR0PTA7IHJlbWl4c2lkPTYzNTVkODQzMGJlY2Q1MWYzZDMyNTA3NzYzYzZiYWNiNzUwNGEzYWU2YmU5Yzc3MmY4OTM4DQoNCg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
          <HTTPCookies>
            <HTTPHeaderEntity name="remixlang" index="0">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixstid" index="1">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NDIzOTYzMzY4X2MyYjcyZGQ4MGVjZmY2MWY1Ng==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixflash" index="2">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MC4wLjA=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixscreen_depth" index="3">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MjQ=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixdt" index="4">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixsid" index="5">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NjM1NWQ4NDMwYmVjZDUxZjNkMzI1MDc3NjNjNmJhY2I3NTA0YTNhZTZiZTljNzcyZjg5Mzg=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
          </HTTPCookies>
        </HTTPHeaders>
      </HTTPRequest>
      <HTTPResponse>
        <contentLenght>0</contentLenght>
        <HTTPHeaders>
          <HTTPHeaderEntity name="Server" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bmdpbng=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Date" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>V2VkLCAxNSBOb3YgMjAxNyAwODoyMTowMiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Type" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>YXBwbGljYXRpb24veC1qYXZhc2NyaXB0</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Last-Modified" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>VGh1LCAwOSBOb3YgMjAxNyAxNDowNjowMCBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Transfer-Encoding" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Y2h1bmtlZA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ETag" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Vy8iNWEwNDYwYzgtMWQyY2Ei</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Expires" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>U3VuLCAxOSBOb3YgMjAxNyAwODoyMTowMiBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cache-Control" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0zNDU2MDA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frontend" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZnJvbnQyMTMwMDc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Expose-Headers" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>WC1Gcm9udGVuZA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Encoding" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Adguard-Filtered" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>QWRHdWFyZCBmb3IgV2luZG93czsgdmVyc2lvbj02LjIuNDMzLjIxNjc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54DQpEYXRlOiBXZWQsIDE1IE5vdiAyMDE3IDA4OjIxOjAyIEdNVA0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi94LWphdmFzY3JpcHQNCkxhc3QtTW9kaWZpZWQ6IFRodSwgMDkgTm92IDIwMTcgMTQ6MDY6MDAgR01UDQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KRVRhZzogVy8iNWEwNDYwYzgtMWQyY2EiDQpFeHBpcmVzOiBTdW4sIDE5IE5vdiAyMDE3IDA4OjIxOjAyIEdNVA0KQ2FjaGUtQ29udHJvbDogbWF4LWFnZT0zNDU2MDANClgtRnJvbnRlbmQ6IGZyb250MjEzMDA3DQpBY2Nlc3MtQ29udHJvbC1FeHBvc2UtSGVhZGVyczogWC1Gcm9udGVuZA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KWC1BZGd1YXJkLUZpbHRlcmVkOiBBZEd1YXJkIGZvciBXaW5kb3dzOyB2ZXJzaW9uPTYuMi40MzMuMjE2Nw0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
        <HTTPBody>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aWYgKCF3aW5kb3cuRW1vamkpIHsKdmFyIEVtb2ppID0gewoKRU1PSklfU1BSSVRFU19OVU06IDMsCgpvcHRzOiB7fSwKbGFzdDogMCwKc2hvd25JZDogZmFsc2UsCmhhc05ld1N0aWNrZXJzOiBmYWxzZSwKcHJldmVudE1vdXNlT3ZlcjogZmFsc2UsCgp0dFNoaWZ0OiA0NSwKCnN0aWNrZXJzOiB7fSwKClRBQl9FTU9KSTogMCwKVEFCX1JFQ0VOVF9TVElDS0VSUzogLTEsCgpDTElDS19ERUxBWTogNTAwLApTT1JURURfRU1PSklfQ0FURUdPUklFUzogWy0xLCAxLCAzLCA4LCAyLCA0LCA1LCA2LCA3LCA5XSwKQ0FDSEVEX0hFSUdIVF9QUk9QOiAnX2Vtb2ppSGVpZ2h0JywKQ0FDSEVEX1dJRFRIX1BST1A6ICdfZW1vamlXaWR0aCcsCkJPVFRPTV9SRVNUX0ZPUl9BRERfRU1PSklfQ0FURUdPUlk6IDE1MCwKU0hPV19UVF9USU1FT1VUOiAxMDAsCkhJREVfVFRfVElNRU9VVDogMzAwLApTSE9XTl9UVF9DTFM6ICdlbW9qaV90dF9zaG93bicsCgppbml0OiBmdW5jdGlvbih0eHQsIG9wdHMpIHsKICB2YXIgb3B0SWQgPSBFbW9qaS5sYXN0OwogIG9wdHMudHh0ID0gdHh0OwogIG9wdHMuaWQgPSBvcHRJZDsKICBvcHRzLmZpZWxkV3JhcCA9IGdwZUJ5Q2xhc3MoJ19lbW9qaV9maWVsZF93cmFwJywgdHh0KTsKICBvcHRzLmVtb2ppV3JhcCA9IGRvbUJ5Q2xhc3Mob3B0cy5maWVsZFdyYXAsICdfZW1vamlfd3JhcCcpOwogIG9wdHMuZW1vamlCdG4gPSBkb21CeUNsYXNzKG9wdHMuZW1vamlXcmFwLCAnX2Vtb2ppX2J0bicpOwogIG9wdHMuZW1vamlXcmFwICYmIGRhdGEob3B0cy5lbW9qaVdyYXAsICdvcHRJZCcsIG9wdElkKTsKICB0eHQuZW1vamlJZCA9IG9wdElkOwogIG9wdHMubGFzdExvYWRlZEVtb2ppQ2F0ZWdvcmllc0lkeGVzID0ge307CiAgaWYgKG9wdHMuZm9yY2VUeHQpIHsKICAgIG9wdHMuZWRpdGFibGUgPSAwOwogICAgLy8gcGxhY2Vob2xkZXJTZXR1cCh0eHQpOwogICAgcGxhY2Vob2xkZXJJbml0KHR4dCk7CiAgfSBlbHNlIHsKICAgIG9wdHMuZWRpdGFibGUgPSAxOwogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgLy8gcGxhY2Vob2xkZXJTZXR1cCh0eHQsIHtlZGl0YWJsZTogMSwgZWRpdGFibGVGb2N1czogRW1vamkuZWRpdGFibGVGb2N1c30pOwogICAgICBwbGFjZWhvbGRlckluaXQodHh0LCB7ZWRpdGFibGU6IDEsIGVkaXRhYmxlRm9jdXM6IEVtb2ppLmVkaXRhYmxlRm9jdXMsIGdsb2JhbDogb3B0cy5nbG9iYWx9KTsKICAgICAgaWYgKG9wdHMuc2hvdWxkRm9jdXMpIHsKICAgICAgICBFbW9qaS5lZGl0YWJsZUZvY3VzKHR4dCwgZmFsc2UsIHRydWUpOwogICAgICB9CiAgICB9LCAwKTsKICAgIGlmIChicm93c2VyLm1vemlsbGEpIHsKICAgICAgdHJ5IHsKICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgiZW5hYmxlT2JqZWN0UmVzaXppbmciLCBmYWxzZSwgZmFsc2UpOwogICAgICAgIGN1ci5kZXN0cm95LnB1c2goZnVuY3Rpb24oKSB7CiAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgiZW5hYmxlT2JqZWN0UmVzaXppbmciLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2goZSkgewogICAgICB9CgogICAgfQoKICAgIGFkZEV2ZW50KHdpbmRvdywgJ21vdXNlbW92ZScsIEVtb2ppLnByZXZlbnRNb3VzZU92ZXJIYW5kbGUpOwoKICAgIGFkZEV2ZW50KHR4dCwgYnJvd3Nlci5vcGVyYSAmJiAhYnJvd3Nlci5jaHJvbWUgPyAnY2xpY2snIDogJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LnRhZ05hbWUgPT0gJ0lNRycpIHsKICAgICAgICBpZiAoRW1vamkuZ2V0Q29kZShlLnRhcmdldCkpIHsKICAgICAgICAgIEVtb2ppLmVkaXRhYmxlRm9jdXModHh0LCBlLnRhcmdldCwgZS5vZmZzZXRYID4gOCk7CiAgICAgICAgICByZXR1cm4gY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChFbW9qaS5zaG93bikgewogICAgICAgIEVtb2ppLnR0Q2xpY2sob3B0SWQsIGdlQnlDbGFzczEoJ2Vtb2ppX3NtaWxlJywgb3B0cy5jb250cm9sc0NvbnQpLCB0cnVlKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG9wdHMubm9MaW5lQnJlYWtzKSB7CiAgICAgIGFkZEV2ZW50KHR4dCwgJ2JsdXInLCBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKCF0eHQudGV4dENvbnRlbnQgJiYgIXR4dC5pbm5lclRleHQpIHsKICAgICAgICAgIGVhY2goZ2VCeVRhZygnYnInLCB0eHQpLCBmdW5jdGlvbihrLCBicikgewogICAgICAgICAgICByZShicik7CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgYWRkRXZlbnQodHh0LCAna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBwYXN0ZScsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGUuY2FuY2VsZWQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKGUudHlwZSA9PSAna2V5ZG93bicpIHsKICAgICAgICB2YXIgbm9FbnRlciA9IG9wdHMuY3RybFNlbmQgPyBvcHRzLmN0cmxTZW5kKCkgOiBvcHRzLm5vRW50ZXJTZW5kOwogICAgICAgIGlmIChlLmtleUNvZGUgPT0gS0VZLlJFVFVSTiB8fCBlLmtleUNvZGUgPT0gMTApIHsKICAgICAgICAgIGlmIChvcHRzLmZvcmNlRW50ZXJTZW5kICYmIG9wdHMub25TZW5kKSB7CiAgICAgICAgICAgIG9wdHMub25TZW5kKCk7CiAgICAgICAgICAgIHJldHVybiBjYW5jZWxFdmVudChlKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBjdHJsU3VibSA9IChjdXIuY3RybF9zdWJtaXQgJiYgIW9wdHMubm9DdHJsU2VuZCk7CiAgICAgICAgICBpZiAoKGN0cmxTdWJtIHx8IG5vRW50ZXIpICYmIChlLmN0cmxLZXkgfHwgYnJvd3Nlci5tYWMgJiYgZS5tZXRhS2V5KSB8fAogICAgICAgICAgICAgICFjdHJsU3VibSAmJiAhZS5zaGlmdEtleSAmJiAhKGUuY3RybEtleSB8fCBicm93c2VyLm1hYyAmJiBlLm1ldGFLZXkpKSB7CiAgICAgICAgICAgIHZhciBjb21wb3NlciA9IGRhdGEodHh0LCAnY29tcG9zZXInKTsKICAgICAgICAgICAgaWYgKCFFbW9qaS5lbW9qaUVudGVyKG9wdElkLCBlKSB8fCAhRW1vamkuc3RpY2tlckhpbnRNb3ZlKGUpIHx8IGNvbXBvc2VyICYmIGNvbXBvc2VyLndkZCAmJiBpc1Zpc2libGUoY29tcG9zZXIud2RkLmxpc3RXcmFwKSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIW5vRW50ZXIgfHwgKGUuY3RybEtleSB8fCBicm93c2VyLm1hYyAmJiBlLm1ldGFLZXkpKSB7CiAgICAgICAgICAgICAgRW1vamkudHRDbGljayhvcHRJZCwgZ2VCeUNsYXNzMSgnZW1vamlfc21pbGUnLCBvcHRzLmNvbnRyb2xzQ29udCksIHRydWUpOwogICAgICAgICAgICAgIG9wdHMub25TZW5kICYmIG9wdHMub25TZW5kKCk7CiAgICAgICAgICAgICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0cy5ub0xpbmVCcmVha3MpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZS5jdHJsS2V5ICYmIGUua2V5Q29kZSA9PSBLRVkuUkVUVVJOKSB7CiAgICAgICAgICB2YXIgdmFsID0gdGhpcy52YWx1ZTsKICAgICAgICAgIGlmIChvcHRzLmVkaXRhYmxlKSB7CiAgICAgICAgICAgIEVtb2ppLmluc2VydEhUTUwoJzxkaXY+PGJyLz48L2Rpdj4nKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5zZWxlY3Rpb25TdGFydCA9PSAibnVtYmVyIiAmJiB0eXBlb2YgdGhpcy5zZWxlY3Rpb25FbmQgPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0OwogICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWwuc2xpY2UoMCwgc3RhcnQpICsgIlxuIiArIHZhbC5zbGljZSh0aGlzLnNlbGVjdGlvbkVuZCk7CiAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydCA9IHRoaXMuc2VsZWN0aW9uRW5kID0gc3RhcnQgKyAxOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbiAmJiBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UpIHsKICAgICAgICAgICAgICB0aGlzLmZvY3VzKCk7CiAgICAgICAgICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgICAgcmFuZ2UudGV4dCA9ICJcclxuIjsKICAgICAgICAgICAgICByYW5nZS5jb2xsYXBzZShmYWxzZSk7CiAgICAgICAgICAgICAgaWYgKGJyb3dzZXIub3BlcmEgJiYgIWJyb3dzZXIuY2hyb21lKSB7CiAgICAgICAgICAgICAgICByYW5nZS5tb3ZlRW5kKCdjaGFyYWN0ZXInLCAwKTsKICAgICAgICAgICAgICAgIHJhbmdlLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJhbmdlLnNlbGVjdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR4dC5hdXRvc2l6ZS51cGRhdGUoKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdHh0LmF1dG9zaXplLnVwZGF0ZSgpOwogICAgICAgICAgICB9LCAwKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGUua2V5Q29kZSA9PSBLRVkuVEFCICYmICEoZS5jdHJsS2V5IHx8IGJyb3dzZXIubWFjICYmIGUubWV0YUtleSkpIHsKICAgICAgICAgIHZhciBzdENvbnQgPSBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50cycsIGRvbVBOKG9wdHMudHh0KSk7CiAgICAgICAgICBpZiAoc3RDb250ICYmIGlzVmlzaWJsZShzdENvbnQpKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9IGdlQnlDbGFzczEoJ292ZXInLCBzdENvbnQpOwogICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgICAgICBFbW9qaS5zdGlja2VySGludEtleU91dChvcHRJZCwgc2VsZWN0ZWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIEVtb2ppLnN0aWNrZXJIaW50S2V5T3ZlcihvcHRJZCwgZ2VCeUNsYXNzMSgnZW1vamlfc3RpY2tlcl9pdGVtJywgc3RDb250KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghRW1vamkuc2hvd24pIHsKICAgICAgICAgICAgICByZXR1cm4gY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChFbW9qaS5zaG93bikgewogICAgICAgICAgICBFbW9qaS5lZGl0YWJsZUZvY3VzKHR4dCwgZmFsc2UsIHRydWUsIHZvaWQoMCksIHRydWUpOwogICAgICAgICAgICBFbW9qaS50dENsaWNrKG9wdElkLCBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIG9wdHMuY29udHJvbHNDb250KSwgdHJ1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBFbW9qaS50dENsaWNrKG9wdElkLCBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIG9wdHMuY29udHJvbHNDb250KSwgZmFsc2UsIHRydWUsIHZvaWQoMCksIHRydWUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogICAgICAgIH0KICAgICAgICBpZiAoZS5rZXlDb2RlID09IEtFWS5FU0MpIHsKICAgICAgICAgIHZhciBzdENvbnQgPSBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50cycsIGRvbVBOKG9wdHMudHh0KSksIG5lZWRDYW5jZWwgPSBmYWxzZTsKICAgICAgICAgIGlmIChzdENvbnQgJiYgaXNWaXNpYmxlKHN0Q29udCkpIHsKICAgICAgICAgICAgRW1vamkuc3RpY2tlckhpbnRLZXlPdXQob3B0SWQsIGdlQnlDbGFzczEoJ2Vtb2ppX3N0aWNrZXJfaXRlbScsIHN0Q29udCkpOwogICAgICAgICAgICBFbW9qaS5zdGlja2Vyc0hpbnRzSGlkZShzdENvbnQsIG9wdHMsIDEwMCk7CiAgICAgICAgICAgIG5lZWRDYW5jZWwgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKEVtb2ppLnNob3duKSB7CiAgICAgICAgICAgIEVtb2ppLmVkaXRhYmxlRm9jdXModHh0LCBmYWxzZSwgdHJ1ZSwgdm9pZCgwKSwgdHJ1ZSk7CiAgICAgICAgICAgIEVtb2ppLnR0Q2xpY2sob3B0SWQsIGdlQnlDbGFzczEoJ2Vtb2ppX3NtaWxlJywgb3B0cy5jb250cm9sc0NvbnQpLCB0cnVlKTsKICAgICAgICAgICAgbmVlZENhbmNlbCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobmVlZENhbmNlbCkgewogICAgICAgICAgICByZXR1cm4gY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0cy5vbkVzYykgewogICAgICAgICAgICByZXR1cm4gb3B0cy5vbkVzYyhlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChlLnR5cGUgPT0gJ3Bhc3RlJykgewogICAgICAgIEVtb2ppLm9uRWRpdGFibGVQYXN0ZSh0eHQsIG9wdHMsIG9wdElkLCBlKTsKICAgICAgICBpZiAob3B0cy5jaGVja0VkaXRhYmxlKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KG9wdHMuY2hlY2tFZGl0YWJsZS5wYmluZChvcHRJZCwgdHh0KSwgMCk7CiAgICAgICAgfQogICAgICAgIEVtb2ppLmNoZWNrU3RpY2tlcnNLZXl3b3JkcyhvcHRJZCwgb3B0cyk7CiAgICAgIH0gZWxzZSBpZiAoZS50eXBlID09ICdrZXl1cCcpIHsKICAgICAgICBpZiAob3B0cy5ub0xpbmVCcmVha3MgJiYgIXR4dC50ZXh0Q29udGVudCAmJiAhdHh0LmlubmVyVGV4dCkgewogICAgICAgICAgZWFjaChnZUJ5VGFnKCdicicsIHR4dCksIGZ1bmN0aW9uKGssIGJyKSB7CiAgICAgICAgICAgIHJlKGJyKTsKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGlmIChvcHRzLmNoZWNrRWRpdGFibGUpIHsKICAgICAgICAgIG9wdHMuY2hlY2tFZGl0YWJsZShvcHRJZCwgdHh0KTsKICAgICAgICB9CiAgICAgICAgRW1vamkuY2hlY2tTdGlja2Vyc0tleXdvcmRzKG9wdElkLCBvcHRzKTsKICAgICAgfSBlbHNlIGlmIChlLnR5cGUgPT0gJ2tleWRvd24nKSB7CiAgICAgICAgaWYgKG9wdHMuY2hlY2tFZGl0YWJsZSkgewogICAgICAgICAgc2V0VGltZW91dChvcHRzLmNoZWNrRWRpdGFibGUucGJpbmQob3B0SWQsIHR4dCksIDApOwogICAgICAgIH0KICAgICAgICBFbW9qaS5jaGVja1N0aWNrZXJzS2V5d29yZHMob3B0SWQsIG9wdHMpOwogICAgICB9CgogICAgICBpZiAob3B0cy5vbktleUFjdGlvbikgewogICAgICAgIG9wdHMub25LZXlBY3Rpb24oZSk7CiAgICAgIH0KCiAgICAgIGlmIChjdXIub25SZXBseUZvcm1TaXplVXBkYXRlKSB7CiAgICAgICAgY3VyLm9uUmVwbHlGb3JtU2l6ZVVwZGF0ZShlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9KTsKICB9CgogIHdpbmRvdy5Ob3RpZmllciAmJiBOb3RpZmllci5hZGRSZWN2Q2xiaygnZW1vamknLCAwLCBFbW9qaS5sY1JlY3YsIHRydWUpOwogIEVtb2ppLmluaXRTdGlja2Vyc0tleXdvcmRzKCk7CiAgRW1vamkuY2hlY2tOZXdTdGlja2VycyhvcHRzKTsKCiAgRW1vamkub3B0c1tFbW9qaS5sYXN0XSA9IG9wdHM7CiAgcmV0dXJuIEVtb2ppLmxhc3QrKzsKfSwKCnByZXZlbnRNb3VzZU92ZXJIYW5kbGU6IGZ1bmN0aW9uKCkgewogIEVtb2ppLnByZXZlbnRNb3VzZU92ZXIgPSBmYWxzZTsKfSwKCmxjUmVjdjogZnVuY3Rpb24oZGF0YSkgewogIHN3aXRjaChkYXRhLmFjdCkgewogICAgY2FzZSAndXBkYXRlVGFicyc6CiAgICAgIEVtb2ppLnVwZGF0ZVRhYnMoZGF0YS5uZXdTdGlja2VycywgZGF0YS5rZXl3b3Jkcyk7CiAgICAgIGJyZWFrOwogIH0KfSwKCmNvcnJlY3RDYXJldDogZnVuY3Rpb24odHh0KSB7CiAgdmFyIGJvdHRvbSA9IGdldENhcmV0Qm91bmRpbmdSZWN0KHR4dCkuYm90dG9tOwogIGlmIChib3R0b20gPCAwIHx8IGJvdHRvbSA+IHR4dC5vZmZzZXRIZWlnaHQpIHsKICAgIHR4dC5zY3JvbGxUb3AgKz0gYm90dG9tIC0gdHh0Lm9mZnNldEhlaWdodDsKICB9Cn0sCgppbnNlcnRXaXRoQnI6IGZ1bmN0aW9uIChyYW5nZSwgdGV4dCkgewogIGlmICh0ZXh0KSB7CiAgICB2YXIgY2xlYW5UZXh0ID0gdGV4dC5yZXBsYWNlKC9cbi9nLCAnPGJyLz4nKTsKICAgIHZhciBkaXYgPSBjZSgnZGl2JywgeyBpbm5lckhUTUw6IGNsZWFuVGV4dCB9KTsKICAgIEVtb2ppLmNsZWFuQ29udChkaXYpOwogICAgRW1vamkuaW5zZXJ0SFRNTChkaXYuaW5uZXJIVE1MKTsKICB9Cn0sCgppbnNlcnRXaXRob3V0Tkw6IGZ1bmN0aW9uIChyYW5nZSwgdGV4dCkgewogIGlmICh0ZXh0KSB7CiAgICB2YXIgY2xlYW5UZXh0ID0gdGV4dC5yZXBsYWNlKC9cbi9nLCAnJyk7CiAgICB2YXIgZGl2ID0gY2UoJ2RpdicsIHsgaW5uZXJIVE1MOiBjbGVhblRleHQgfSk7CiAgICBFbW9qaS5jbGVhbkNvbnQoZGl2KTsKICAgIEVtb2ppLmluc2VydEhUTUwoZGl2LmlubmVySFRNTCk7CiAgfQp9LAoKZm9jdXNUcmljazogZnVuY3Rpb24gKHR4dCwgaW5zZXJ0LCBmaW5hbGl6ZSwgcmFuZ2UsIGNvbnQpIHsKICBpZiAoIWNvbnQpIHsKICAgIGNvbnQgPSB0eHQ7CiAgfQogIHZhciB0ZXh0YXJlYSA9IGNlKCdURVhUQVJFQScsIHtjbGFzc05hbWU6ICdlbW9qaV90bXBfdGV4dGFyZWEnfSk7CiAgdHh0LnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwogIHRleHRhcmVhLmZvY3VzKCk7CiAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgIHZhciBzY3JvbGwgPSBjb250LnNjcm9sbFRvcDsKICAgIHJlKHRleHRhcmVhKTsKICAgIHR4dC5mb2N1cygpOwogICAgY29udC5zY3JvbGxUb3AgPSBzY3JvbGw7CiAgICBFbW9qaS5zZXRSYW5nZShyYW5nZSk7CiAgICBpbnNlcnQoY2xlYW4odmFsKHRleHRhcmVhKSkpOwogICAgZmluYWxpemUodHh0KTsKICB9LCAwKTsKfSwKCmZpbmFsaXplSW5zZXJ0OiBmdW5jdGlvbih0eHQpIHsKICBFbW9qaS5jbGVhbkNvbnQodHh0KTsKICBzZXRUaW1lb3V0KEVtb2ppLmNvcnJlY3RDYXJldC5wYmluZCh0eHQpLCAxMCk7Cn0sCgpnZXRDbGlwYm9hcmQ6IGZ1bmN0aW9uKGUpIHsKICBpZiAoZS5jbGlwYm9hcmREYXRhKSB7CiAgICByZXR1cm4gY2xlYW4oZS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKSk7CiAgfSBlbHNlIGlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSkgewogICAgcmV0dXJuIGNsZWFuKHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoIlRleHQiKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0sCgpwcm9jZXNzSW1hZ2VQYXN0ZTogZnVuY3Rpb24oZSwgdHh0LCBvcHRzLCBvbkRvbmUpIHsKICBpZiAoZS5jbGlwYm9hcmREYXRhICE9IG51bGwpIHsKICAgIHZhciBjbGlwYm9hcmREYXRhID0gZS5jbGlwYm9hcmREYXRhOwoKICAgIGZ1bmN0aW9uIF9vbkltYWdlQmxvYlJlYWR5KGJsb2IpIHsKICAgICAgdmFyIGFkZE1lZGlhLCBjb21wb3NlcjsKCiAgICAgIGJsb2IubmFtZSA9IGJsb2IuZmlsZW5hbWUgPSAndXBsb2FkXycgKyBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgKyAnXycgKyBpcmFuZCgwLCAxMDApICsgICcucG5nJzsKCiAgICAgIGlmIChoYXNDbGFzcyh0eHQsICdfaW1fdGV4dCcpKSB7CiAgICAgICAgaWYgKG9wdHMudXBsb2FkQWN0aW9ucykgewogICAgICAgICAgb3B0cy51cGxvYWRBY3Rpb25zLnBhc3RlKFsgYmxvYiBdKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHh0LmlkID09ICdwb3N0X2ZpZWxkJykgeyAvLyBmaWVsZCBmb3IgcG9zdCBzdWJtaXQKICAgICAgICBhZGRNZWRpYSA9IGN1ci53YWxsQWRkTWVkaWE7CiAgICAgIH0gZWxzZSB7IC8vIHJlcGxpZXMgaW5wdXRzCiAgICAgICAgY29tcG9zZXIgPSBkYXRhKHR4dCwgJ2NvbXBvc2VyJyk7CiAgICAgICAgYWRkTWVkaWEgPSBjb21wb3NlciAmJiBjb21wb3Nlci5hZGRNZWRpYTsKICAgICAgfQoKICAgICAgaWYgKCFhZGRNZWRpYSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGlzRnVuY3Rpb24ob3B0cy5pbml0VXBsb2FkRm9ySW1hZ2VQYXN0ZUNhbGxiYWNrKSkgewogICAgICAgIG9wdHMuaW5pdFVwbG9hZEZvckltYWdlUGFzdGVDYWxsYmFjayh0eHQsIGFkZE1lZGlhLCBibG9iKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9jaGVja0ltYWdlc0VscyhjYikgewogICAgICB2YXIgdGltZXNwYW4gPSBNYXRoLmZsb29yKDEwMDAgKiBNYXRoLnJhbmRvbSgpKTsKCiAgICAgIHZhciBpbWdzID0gZ2VCeVRhZygnaW1nJywgdHh0KTsKICAgICAgZm9yICh2YXIgaiA9IDAsIGxlbiA9IGltZ3MubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICB2YXIgaW1nID0gaW1nc1tqXTsKICAgICAgICBpbWdbJ19iZWZvcmVfcGFzdGVfJyArIHRpbWVzcGFuXSA9IHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBpbWdzID0gZ2VCeVRhZygnaW1nJywgdHh0KTsKICAgICAgICB2YXIgcGFzdGVkSW1hZ2UgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgayA9IDAsIGxlbjEgPSBpbWdzLmxlbmd0aDsgayA8IGxlbjE7IGsrKykgewogICAgICAgICAgdmFyIGltZyA9IGltZ3Nba107CiAgICAgICAgICBpZiAoIWltZ1snX2JlZm9yZV9wYXN0ZV8nICsgdGltZXNwYW5dKSB7CiAgICAgICAgICAgIGNiKGltZy5zcmMpOwogICAgICAgICAgICByZShpbWcpOwogICAgICAgICAgICBwYXN0ZWRJbWFnZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIXBhc3RlZEltYWdlKSB7CiAgICAgICAgICBvbkRvbmUoKTsKICAgICAgICB9CiAgICAgIH0sIDEpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9oYW5kbGVJbWFnZShzcmMpIHsKICAgICAgaWYgKHNyYy5tYXRjaCgvXndlYmtpdFwtZmFrZVwtdXJsXDpcL1wvLykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBsb2FkZXIgPSBuZXcgSW1hZ2UoKTsKICAgICAgbG9hZGVyLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7CiAgICAgIGxvYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgY2FudmFzLndpZHRoID0gbG9hZGVyLndpZHRoOwogICAgICAgIGNhbnZhcy5oZWlnaHQgPSBsb2FkZXIuaGVpZ2h0OwogICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguZHJhd0ltYWdlKGxvYWRlciwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKCiAgICAgICAgY2FudmFzLnRvQmxvYihmdW5jdGlvbihibG9iKSB7CiAgICAgICAgICBfb25JbWFnZUJsb2JSZWFkeShibG9iKTsKICAgICAgICB9LCAnaW1hZ2UvcG5nJyk7CgogICAgICAgIG9uRG9uZSh0cnVlKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBsb2FkZXIuc3JjID0gc3JjOwogICAgfQoKICAgIGlmIChjbGlwYm9hcmREYXRhLml0ZW1zKSB7IC8vIGJlc3Qgd2F5CiAgICAgIHZhciBpbWFnZVBhc3RlID0gZmFsc2U7CgogICAgICBmb3IgKHZhciBqID0gMCwgbGVuID0gY2xpcGJvYXJkRGF0YS5pdGVtcy5sZW5ndGg7IGogPCBsZW47IGorKykgewogICAgICAgIHZhciBpdGVtID0gY2xpcGJvYXJkRGF0YS5pdGVtc1tqXTsKCiAgICAgICAgaWYgKGl0ZW0udHlwZS5tYXRjaCgvXmltYWdlXC8vKSkgewogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuIF9oYW5kbGVJbWFnZShldmVudC50YXJnZXQucmVzdWx0KTsKICAgICAgICAgIH07CiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpdGVtLmdldEFzRmlsZSgpKTsKCiAgICAgICAgICBpbWFnZVBhc3RlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gJ3RleHQvcGxhaW4nKSB7CiAgICAgICAgICByZXR1cm4gb25Eb25lKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaW1hZ2VQYXN0ZTsKCiAgICB9IGVsc2UgeyAvLyBubyBpbWFnZXMgb3IgRkYKICAgICAgaWYgKC0xICE9PSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGNsaXBib2FyZERhdGEudHlwZXMsICd0ZXh0L3BsYWluJykpIHsKICAgICAgICByZXR1cm4gb25Eb25lKCk7CiAgICAgIH0KCiAgICAgIF9jaGVja0ltYWdlc0VscyhmdW5jdGlvbihzcmMpIHsKICAgICAgICByZXR1cm4gX2hhbmRsZUltYWdlKHNyYyk7CiAgICAgIH0pOwogICAgfQoKICB9IGVsc2UgewogICAgb25Eb25lKCk7CiAgfQp9LAoKb25FZGl0YWJsZVBhc3RlOiBmdW5jdGlvbih0eHQsIG9wdHMsIG9wdElkLCBlLCBvbmx5Rm9jdXMpIHsKICB2YXIgcmFuZ2UgPSBmYWxzZTsKCiAgaWYgKHR4dC5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScpID09PSAndHJ1ZScpIHsKICAgIHJhbmdlID0gRW1vamkuZ2V0UmFuZ2UoKTsKICB9CgogIHZhciB0ZXh0ID0gdGhpcy5nZXRDbGlwYm9hcmQoZSk7CiAgdmFyIHRleHRSYW5nZUFuZE5vRm9jdXMgPSB0ZXh0ICYmIHJhbmdlICYmICFvbmx5Rm9jdXM7CgogIGlmIChlLmNsaXBib2FyZERhdGEgJiYgaW5BcnJheSgndGV4dC9odG1sJywgZS5jbGlwYm9hcmREYXRhLnR5cGVzKSAmJiBpbkFycmF5KCdGaWxlcycsIGUuY2xpcGJvYXJkRGF0YS50eXBlcykpIHsKICAgIGNhbmNlbEV2ZW50KGUpOwogIH0KCiAgdmFyIGlzSW1hZ2VQYXN0ZSA9IHRoaXMucHJvY2Vzc0ltYWdlUGFzdGUoZSwgdHh0LCBvcHRzLCAoZnVuY3Rpb24oaXNJbWFnZVBhc3RlKSB7CiAgICBpZiAoaXNJbWFnZVBhc3RlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodGV4dFJhbmdlQW5kTm9Gb2N1cykgewogICAgICBvcHRzLm5vTGluZUJyZWFrcyA/IHRoaXMuaW5zZXJ0V2l0aG91dE5MKHJhbmdlLCB0ZXh0KSA6IHRoaXMuaW5zZXJ0V2l0aEJyKHJhbmdlLCB0ZXh0KTsKICAgICAgc2V0VGltZW91dCh0aGlzLmZpbmFsaXplSW5zZXJ0LmJpbmQodGhpcywgdHh0KSwgMCk7CiAgICB9IGVsc2UgaWYgKHJhbmdlKSB7CiAgICAgIHRoaXMuZm9jdXNUcmljayh0eHQsIG9wdHMubm9MaW5lQnJlYWtzID8gdGhpcy5pbnNlcnRXaXRob3V0TkwucGJpbmQocmFuZ2UpIDogdGhpcy5pbnNlcnRXaXRoQnIucGJpbmQocmFuZ2UpLCB0aGlzLmZpbmFsaXplSW5zZXJ0LmJpbmQodGhpcywgdHh0KSwgcmFuZ2UpOwogICAgfQogIH0pLmJpbmQodGhpcykpOwoKICBpZiAoaXNJbWFnZVBhc3RlIHx8IHRleHRSYW5nZUFuZE5vRm9jdXMpIHsKICAgIGNhbmNlbEV2ZW50KGUpOwogIH0KfSwKCmNsZWFuQ29udDogZnVuY3Rpb24oY29udCkgewogIHZhciBlbCA9IGNvbnQuZmlyc3RDaGlsZDsKICB3aGlsZSAoZWwpIHsKICAgIHZhciBuZXh0ID0gZWwubmV4dFNpYmxpbmc7CiAgICBzd2l0Y2ggKGVsLm5vZGVUeXBlKSB7CiAgICAgIGNhc2UgMToKICAgICAgICBpZiAoZWwuaWQgPT0gJ3RtcF9wYXN0ZV9jb250JykgYnJlYWs7CiAgICAgICAgaWYgKGVsLnRhZ05hbWUgPT0gJ0RJVicgfHwgZWwudGFnTmFtZSA9PSAnUCcgfHwgZWwudGFnTmFtZSA9PSAnU1BBTicpIHsKICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7CiAgICAgICAgICBlbC5jbGFzc05hbWUgPSAnJzsKICAgICAgICAgIGVsLmlkID0gJyc7CiAgICAgICAgICBFbW9qaS5jbGVhbkNvbnQoZWwpOwogICAgICAgIH0gZWxzZSBpZiAoZWwudGFnTmFtZSA9PSAnSU1HJykgewogICAgICAgICAgaWYgKCFFbW9qaS5nZXRDb2RlKGVsKSkgewogICAgICAgICAgICByZShlbCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChlbC50YWdOYW1lICE9ICdCUicgKXsKICAgICAgICAgIHZhciB0ZXh0ID0gRW1vamkuZWRpdGFibGVWYWwoZWwsIHtzYXZlRW1vamk6IHRydWV9KTsKICAgICAgICAgIHZhciBmID0gY2YoY2xlYW4odGV4dCkucmVwbGFjZSgvXG4vZywgJzxici8+JykpOwogICAgICAgICAgdmFyIGxhc3QgPSBmLmxhc3RDaGlsZDsKICAgICAgICAgIGVsLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGYsIGVsKTsKICAgICAgICAgIC8vaWYgKGxhc3QpIHsKICAgICAgICAgIC8vICBFbW9qaS5lZGl0YWJsZUZvY3VzKGNvbnQsIGxhc3QsIHRydWUpOwogICAgICAgICAgLy99CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM6CiAgICAgICAgdmFyIHN0ciA9IGNsZWFuKGVsLnRleHRDb250ZW50IHx8IGVsLmlubmVyVGV4dCk7CgogICAgICAgIGlmIChzdHIgJiYgc3RyLm1hdGNoKEVtb2ppLmVtb2ppUmVnRXgpKSB7IC8vIGVtb2ppIHBhc3RlZAogICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoRW1vamkuZW1vamlSZWdFeCwgRW1vamkuZW1vamlSZXBsYWNlKS8vLnJlcGxhY2UoL1x1RkUwRi9nLCAnJyk7CiAgICAgICAgICBlbC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChjZihzdHIpLCBlbCk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgfQogICAgZWwgPSBuZXh0OwogIH0KfSwKCmZvY3VzOiBmdW5jdGlvbihjb250LCBzaG91bGRTY3JvbGwpIHsKICBFbW9qaS5lZGl0YWJsZUZvY3VzKGNvbnQsIGZhbHNlLCB0cnVlKTsKICB2YXIgZWwgPSBjb250LnBhcmVudE5vZGU7CgogIGlmIChzaG91bGRTY3JvbGwpIHsKICAgIHZhciB5ID0gZ2V0WFkoZWwpWzFdOwogICAgdmFyIHNjID0gc2Nyb2xsR2V0WSgpOwogICAgdmFyIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCA/IHdpbmRvdy5pbm5lckhlaWdodCA6IChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA6IGJveExheWVyQkcub2Zmc2V0SGVpZ2h0KTsKICAgIHZhciBlbFNpemUgPSBnZXRTaXplKGVsKVsxXTsKICAgIGlmIChzYytoZWlnaHQgPCB5ICsgZWxTaXplKSB7CiAgICAgIHNjcm9sbFRvWSh5IC0gaGVpZ2h0ICsgZWxTaXplICsgNjAsIDEwMCk7CiAgICB9IGVsc2UgaWYgKHNjID4geSkgewogICAgICBzY3JvbGxUb1koeSAtIDYwLCAxMDApOwogICAgfQogIH0KfSwKCmRlc3Ryb3k6IGZ1bmN0aW9uKG9wdElkKSB7CiAgRW1vamkub3B0c1tvcHRJZF0udHh0LmJsdXIoKTsKICBpZiAoRW1vamkub3B0c1tvcHRJZF0uaW1hZ2VzTG9hZGVyKSB7CiAgICBFbW9qaS5vcHRzW29wdElkXS5pbWFnZXNMb2FkZXIuZGVzdHJveSgpOwogIH0KICBkZWxldGUgRW1vamkub3B0c1tvcHRJZF07Cn0sCgplZGl0YWJsZUZvY3VzOiBmdW5jdGlvbihlZGl0YWJsZSwgb2JqLCBhZnRlciwgbm9Db2xsYXBzZSwgbm9Gb3JjZSkgewogIGlmICghZWRpdGFibGUgfHwgKG5vRm9yY2UgJiYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gZWRpdGFibGUpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGVkaXRhYmxlID0gZ2UoZWRpdGFibGUpOwogIGVkaXRhYmxlLmZvY3VzKCk7CiAgaWYgKGVkaXRhYmxlLnBob25mb2N1cykgewogICAgZWRpdGFibGUucGhvbmZvY3VzKCk7CiAgfQogIGlmICh0eXBlb2Ygd2luZG93LmdldFNlbGVjdGlvbiAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlUmFuZ2UgIT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7CiAgICBpZiAoYnJvd3Nlci5vcGVyYSAmJiAhYnJvd3Nlci5jaHJvbWUgJiYgIWFmdGVyKSB7CiAgICAgIHNlbC5jb2xsYXBzZShvYmogfHwgZWRpdGFibGUsIDApOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsKICAgICAgaWYgKG9iaikgewogICAgICAgIHJhbmdlLnNlbGVjdE5vZGUob2JqKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByYW5nZS5zZWxlY3ROb2RlQ29udGVudHMoZWRpdGFibGUpOwogICAgICB9CgogICAgICBpZiAoYnJvd3Nlci5tb3ppbGxhICYmIGVkaXRhYmxlLmlubmVySFRNTCA9PT0gJzxicj4nKSB7CiAgICAgICAgZWRpdGFibGUuaW5uZXJIVE1MID0gJyc7IC8vIGZpeCBzdHJhbmdlIGZmIGJlaGF2aW91ciwgaW5zZXJ0aW5nIGVtcHR5IGJycyBpbiBjb250ZW50ZWlkdGFibGUKICAgICAgfQoKICAgICAgaWYgKCFub0NvbGxhcHNlKSB7CiAgICAgICAgcmFuZ2UuY29sbGFwc2UoIWFmdGVyKTsKICAgICAgfQogICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpOwogICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7CiAgICAgIHNlbC5hZGRSYW5nZShyYW5nZSk7CiAgICB9CiAgfSBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UgIT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciB0ZXh0UmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpOwogICAgdGV4dFJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KG9iaiB8fCBlZGl0YWJsZSk7CiAgICB0ZXh0UmFuZ2UuY29sbGFwc2UoIWFmdGVyKTsKICAgIHRleHRSYW5nZS5zZWxlY3QoKTsKICB9Cn0sCgpnZXRSYW5nZTogZnVuY3Rpb24oKSB7CiAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHsKICAgIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKICAgIGlmIChzZWwuZ2V0UmFuZ2VBdCAmJiBzZWwucmFuZ2VDb3VudCkgewogICAgICByZXR1cm4gc2VsLmdldFJhbmdlQXQoMCk7CiAgICB9CiAgfSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24gJiYgZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKSB7CiAgICByZXR1cm4gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CiAgfQogIHJldHVybiBudWxsOwp9LAoKc2V0UmFuZ2U6IGZ1bmN0aW9uKHJhbmdlKSB7CiAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHsKICAgIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKICAgIHNlbC5yZW1vdmVBbGxSYW5nZXMoKTsKICAgIHNlbC5hZGRSYW5nZShyYW5nZSk7CiAgfSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24gJiYgcmFuZ2Uuc2VsZWN0KSB7CiAgICByYW5nZS5zZWxlY3QoKTsKICB9Cn0sCgp2YWw6IGZ1bmN0aW9uKGNvbnQsIHZhbHVlKSB7CiAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBFbW9qaS5lZGl0YWJsZVZhbChjb250KTsKICB9IGVsc2UgewogICAgdmFsdWUgPSBFbW9qaS5lbW9qaVRvSFRNTCh2YWx1ZSwgdHJ1ZSk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoLyAkLywgJyZuYnNwOycpOwogICAgaWYgKGNvbnQuc2V0VmFsdWUpIHsKICAgICAgY29udC5zZXRWYWx1ZSh2YWx1ZSk7CiAgICAgIGNvbnQucGhvbmJsdXIgJiYgY29udC5waG9uYmx1cigpOwogICAgfSBlbHNlIHsKICAgICAgY29udC5pbm5lckhUTUwgPSB2YWx1ZTsKICAgIH0KICAgIEVtb2ppLnVwZGF0ZVN0aWNrZXJzSGludHMoKTsKICAgIHZhciBjb21wb3NlciA9IGRhdGEoY29udCwgJ2NvbXBvc2VyJyk7CiAgICBpZiAoY29tcG9zZXIgJiYgd2luZG93LkNvbXBvc2VyKSB7CiAgICAgIHNldFRpbWVvdXQoQ29tcG9zZXIudXBkYXRlQXV0b0NvbXBsZXRlLnBiaW5kKGNvbXBvc2VyKSk7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0sCgplZGl0YWJsZVZhbDogZnVuY3Rpb24oY29udCwgb3B0cykgewogIGlmICghY29udCkgcmV0dXJuICcnOwogIGlmIChjb250LnRhZ05hbWUgPT0gJ1RFWFRBUkVBJykgcmV0dXJuIHZhbChjb250KTsKICB2YXIgZWwgPSBjb250LmZpcnN0Q2hpbGQ7CiAgdmFyIHYgPSAnJzsKICB2YXIgY29udFRhZyA9IG5ldyBSZWdFeHAoJ14oRElWfFB8TEl8T0x8VFJ8VER8QkxPQ0tRVU9URSkkJyk7CiAgd2hpbGUgKGVsKSB7CiAgICBzd2l0Y2ggKGVsLm5vZGVUeXBlKSB7CiAgICAgIGNhc2UgMzoKICAgICAgICB2YXIgc3RyID0gZWwuZGF0YS5yZXBsYWNlKC9eXG58XG4kL2csICcgJykucmVwbGFjZSgvW1xuXHhhMF0vZywgJyAnKS5yZXBsYWNlKC9bIF0rL2csICcgJyk7CiAgICAgICAgdiArPSBzdHI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICB2YXIgc3RyID0gRW1vamkuZWRpdGFibGVWYWwoZWwpOwogICAgICAgIGlmIChlbC50YWdOYW1lICYmIGVsLnRhZ05hbWUubWF0Y2goY29udFRhZykgJiYgc3RyKSB7CiAgICAgICAgICBpZiAoc3RyLnN1YnN0cigtMSkgIT0gJ1xuJykgewogICAgICAgICAgICBzdHIgKz0gJ1xuJzsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcHJldiA9IGVsLnByZXZpb3VzU2libGluZzsKICAgICAgICAgIHdoaWxlIChwcmV2ICYmIHByZXYubm9kZVR5cGUgPT0gMyAmJiB0cmltKHByZXYubm9kZVZhbHVlKSA9PSAnJykgewogICAgICAgICAgICBwcmV2ID0gcHJldi5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocHJldiAmJiAhKHByZXYudGFnTmFtZSAmJiAocHJldi50YWdOYW1lLm1hdGNoKGNvbnRUYWcpIHx8IHByZXYudGFnTmFtZSA9PSAnQlInKSkpIHsKICAgICAgICAgICAgc3RyID0gJ1xuJyArIHN0cjsKICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIGlmIChlbC50YWdOYW1lID09ICdJTUcnKSB7CiAgICAgICAgICB2YXIgY29kZSA9IEVtb2ppLmdldENvZGUoZWwpOwogICAgICAgICAgaWYgKGNvZGUpIHsKICAgICAgICAgICAgaWYgKG9wdHMgJiYgb3B0cy5zYXZlRW1vamkpIHsKICAgICAgICAgICAgICBzdHIgKz0gRW1vamkuZ2V0RW1vamlIVE1MKGNvZGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0ciArPSBFbW9qaS5jb2RlVG9DaHIoY29kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGVsLnRhZ05hbWUgPT0gJ0JSJykgewogICAgICAgICAgc3RyICs9ICdcbic7CiAgICAgICAgfQogICAgICAgIHYgKz0gc3RyOwogICAgICAgIGJyZWFrOwogICAgfQogICAgZWwgPSBlbC5uZXh0U2libGluZzsKICB9CiAgcmV0dXJuIHY7Cn0sCgpjc3NFbW9qaTogewogICdEODNEREUwQSc6IFswLCAnOi0pJ10sICdEODNEREUwMyc6IFsxLCAnOi1EJ10sICdEODNEREUwOSc6IFsyLCAnOy0pJ10sICdEODNEREUwNic6IFszLCAneEQnXSwgJ0Q4M0RERTFDJzogWzQsICc7LVAnXSwgJ0Q4M0RERTBCJzogWzUsICc6LXAnXSwgJ0Q4M0RERTBEJzogWzYsICc4LSknXSwgJ0Q4M0RERTBFJzogWzcsICdCLSknXSwgJ0Q4M0RERTEyJzogWzgsICc6LSgnXSwgJ0Q4M0RERTBGJzogWzksICc7LV0nXSwgJ0Q4M0RERTE0JzogWzEwLCAnMygnXSwgJ0Q4M0RERTIyJzogWzExLCAnOlwnKCddLCAnRDgzRERFMkQnOiBbMTIsICc6XygnXSwgJ0Q4M0RERTI5JzogWzEzLCAnOigoJ10sICdEODNEREUyOCc6IFsxNCwgJzpvJ10sICdEODNEREUxMCc6IFsxNSwgJzp8J10sICdEODNEREUwQyc6IFsxNiwgJzMtKSddLCAnRDgzRERFMjAnOiBbMTcsICc+KCddLCAnRDgzRERFMjEnOiBbMTgsICc+KCgnXSwgJ0Q4M0RERTA3JzogWzE5LCAnTzopJ10sICdEODNEREUzMCc6IFsyMCwgJztvJ10sICdEODNEREUzMyc6IFsyMSwgJzh8J10sICdEODNEREUzMic6IFsyMiwgJzhvJ10sICdEODNEREUzNyc6IFsyMywgJzpYJ10sICdEODNEREUxQSc6IFsyNCwgJzotKiddLCAnRDgzRERFMDgnOiBbMjUsICd9OiknXSwgJzI3NjQnOiBbMjYgLCAnPDMnXSwgJ0Q4M0REQzREJzogWzI3LCAnOmxpa2U6J10sICdEODNEREM0RSc6IFsyOCwgJzpkaXNsaWtlOiddLCAnMjYxRCc6IFsyOSwgJzp1cDonXSwgJzI3MEMnOiBbMzAsICc6djonXSwgJ0Q4M0REQzRDJzogWzMxLCAnOm9rOiddCn0sCmltZ0Vtb2ppOiB7J0Q4M0RERTE1JzogMSwgJ0Q4M0RERTFGJzogMSwgJ0Q4M0RERTJFJzogMSwgJ0Q4M0RERTM0JzogMX0sCgpnZXRFbW9qaUhUTUw6IGZ1bmN0aW9uKGNvZGUsIHN5bWJvbCwgZW5hYmxlZCwgaXNfdGFiKSB7CgogIGlmIChjb2RlLm1hdGNoKEVtb2ppLmVtb2ppSm9pbmVyc1JlZ0V4KSkgewogICAgY29kZSA9IGNvZGUucmVwbGFjZSgnRkUwRicsICcnKSArICdGRTBGJzsKCiAgICBpZiAoIWluQXJyYXkoY29kZSwgRW1vamkuZW1vamlXaXRoSm9pbmVycykpIHsKICAgICAgdmFyIHNtaWxlcyA9IGNvZGUucmVwbGFjZSgnRkUwRicsICcnKS5zcGxpdChFbW9qaS5lbW9qaUpvaW5lcnNSZWdFeCk7CiAgICAgIHZhciBvdXQgPSAnJzsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNtaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICghc21pbGVzW2ldKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgb3V0ICs9IEVtb2ppLmdldEVtb2ppSFRNTChzbWlsZXNbaV0sIEVtb2ppLmNvZGVUb0NocihzbWlsZXNbaV0pLCBlbmFibGVkLCBpc190YWIpOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9IGVsc2UgIGlmIChzeW1ib2wpIHsKICAgICAgc3ltYm9sID0gc3ltYm9sLnJlcGxhY2UoL1x1RkUwRi9nLCAnJyk7CiAgICAgIHN5bWJvbCArPSBFbW9qaS5jb2RlVG9DaHIoJ0ZFMEYnKTsKICAgIH0KICB9CgogIHZhciBlZGl0YWJsZSA9IChicm93c2VyLm1zaWUgJiYgaW50dmFsKGJyb3dzZXIudmVyc2lvbikgPiA4KSA/ICcgY29udGVudGVkaXRhYmxlPSJmYWxzZSInIDogJyc7CiAgaWYgKEVtb2ppLmNzc0Vtb2ppW2NvZGVdICE9IHVuZGVmaW5lZCkgewogICAgdmFyIG51bSA9IC1FbW9qaS5jc3NFbW9qaVtjb2RlXVswXSAqIDE3OwogICAgcmV0dXJuICc8aW1nJytlZGl0YWJsZSsnIHNyYz0iL2ltYWdlcy9ibGFuay5naWYiIGVtb2ppPSInK2NvZGUrJyIgJysoc3ltYm9sID8gJ2FsdD0iJytzeW1ib2wrJyInIDogc3ltYm9sKSsnIGNsYXNzPSJlbW9qaV9jc3MiIHN0eWxlPSJiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwcHggJytudW0rJ3B4OyIgLz4nOwogIH0gZWxzZSB7CiAgICBpZiAoIUVtb2ppLmltZ0Vtb2ppW2NvZGVdICYmIHN5bWJvbCAmJiAhZW5hYmxlZCkgewogICAgICByZXR1cm4gc3ltYm9sOwogICAgfSBlbHNlIGlmIChpc190YWIpIHsKICAgICAgdmFyIGNvZGVfbG93ZXJfY2FzZSA9IGNvZGUudG9Mb3dlckNhc2UoKTsKICAgICAgdmFyIHNwcml0ZUlkID0gcGFyc2VJbnQoY29kZV9sb3dlcl9jYXNlLCAxNikgJSBFbW9qaS5FTU9KSV9TUFJJVEVTX05VTTsKICAgICAgcmV0dXJuICc8aSBjbGFzcz0iZW1vamkgZW1vamlfc3ByaXRlXycgKyBzcHJpdGVJZCArICcgZW1vamlfJyArIGNvZGVfbG93ZXJfY2FzZSArICciIGVtb2ppPSInICsgY29kZSArICciICcrKHN5bWJvbCA/ICdhbHQ9Iicrc3ltYm9sKyciJyA6ICcnKSsnPjwvaT4nOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICc8aW1nIGNsYXNzPSJlbW9qaSIgJysoc3ltYm9sID8gJ2FsdD0iJytzeW1ib2wrJyInIDogJycpKycgc3JjPSIvaW1hZ2VzL2Vtb2ppLycrY29kZSsod2luZG93LmRldmljZVBpeGVsUmF0aW8gPj0gMiA/ICdfMngnIDogJycpKycucG5nIiAvPic7CiAgICB9CiAgfQp9LAoKY29kZVRvQ2hyOiBmdW5jdGlvbihjb2RlKSB7CiAgdmFyIGxlbiA9IE1hdGgucm91bmQoY29kZS5sZW5ndGggLyA0KTsKICB2YXIgY2hyID0gJyc7CiAgdmFyIGkgPSAwOwogIHdoaWxlKGxlbi0tKSB7CiAgICBjaHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChjb2RlLnN1YnN0cihpLCA0KSwgMTYpKQogICAgaSArPSA0OwogIH0KICByZXR1cm4gY2hyOwp9LAoKY2hlY2tFZGl0YWJsZTogZnVuY3Rpb24ob3B0SWQsIG9iaiwgb3B0aW9ucykgewogIHZhciBzY0ggPSBvYmouc2Nyb2xsSGVpZ2h0OwogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgaWYgKCFvcHRzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmICghb3B0cy5zY1BhZGRpbmdzKSB7CiAgICBvcHRzLnNjUGFkZGluZ3MgPSBpbnR2YWwoZ2V0U3R5bGUob2JqLCAncGFkZGluZ1RvcCcpKSArIGludHZhbChnZXRTdHlsZShvYmosICdwYWRkaW5nQm90dG9tJykpOwogIH0KICBzY0ggLT0gb3B0cy5zY1BhZGRpbmdzOwogIHZhciBibCA9IG9wdHMudHQ7CiAgaWYgKHNjSCA+IG9wdGlvbnMuaGVpZ2h0ICsgKGJyb3dzZXIubW96aWxsYSAmJiBvcHRzLmlzQ2hhdCA/IDAgOiA1KSkgewogICAgaWYgKCFvcHRzLmlzU2l6ZWQpIHsKICAgICAgc2V0U3R5bGUob2JqLCB7aGVpZ2h0OiBvcHRpb25zLmhlaWdodCsncHgnLCBvdmVyZmxvd1k6ICdhdXRvJ30pOwogICAgICB2YXIgc20gPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIG9wdHMuY29udHJvbHNDb250KTsKICAgICAgdmFyIHB0ID0gZ2VCeUNsYXNzMSgnZW1vamlfc21pbGVfaWNvbl9wcm9tbycsIG9wdHMuY29udHJvbHNDb250KTsKICAgICAgdmFyIHBoID0gZ2UoJ2ltX3VwbG9hZCcpOwogICAgICB2YXIgZGlmZiA9IHNiV2lkdGgoKTsKICAgICAgc2V0U3R5bGUoc20sIHZrLnJ0bCA/IHtsZWZ0OiAxICsgZGlmZn0gOiB7cmlnaHQ6IDEgKyBkaWZmfSk7CiAgICAgIGlmIChwdCkgewogICAgICAgIHNldFN0eWxlKHB0LCB2ay5ydGwgPyB7bGVmdDogMiArIGRpZmZ9IDoge3JpZ2h0OiAyICsgZGlmZn0pOwogICAgICB9CiAgICAgIGlmIChwaCkgewogICAgICAgIHNldFN0eWxlKHBoLnBhcmVudE5vZGUsIHZrLnJ0bCA/IHtsZWZ0OiAxICsgZGlmZn0gOiB7cmlnaHQ6IDEgKyBkaWZmfSk7CiAgICAgIH0KICAgICAgaWYgKGJsKSBzZXRTdHlsZShibCwgdmsucnRsID8ge2xlZnQ6IChvcHRzLnR0RGlmZiB8fCAzMSkgKyBkaWZmfSA6IHtyaWdodDogKG9wdHMudHREaWZmIHx8IDMxKSArIGRpZmZ9KQogICAgICBvcHRzLmlzU2l6ZWQgPSB0cnVlOwogICAgfQogIH0gZWxzZSBpZiAob3B0cy5pc1NpemVkKSB7CiAgICBzZXRTdHlsZShvYmosIHtoZWlnaHQ6ICdhdXRvJywgb3ZlcmZsb3dZOiAnaGlkZGVuJ30pOwogICAgdmFyIHNtID0gZ2VCeUNsYXNzMSgnZW1vamlfc21pbGUnLCBvcHRzLmNvbnRyb2xzQ29udCk7CiAgICB2YXIgcHQgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZV9pY29uX3Byb21vJywgb3B0cy5jb250cm9sc0NvbnQpOwogICAgdmFyIHBoID0gZ2UoJ2ltX3VwbG9hZCcpOwogICAgc2V0U3R5bGUoc20sIHZrLnJ0bCA/IHtsZWZ0OiAxfSA6IHtyaWdodDogMX0pOwogICAgaWYgKHB0KSB7CiAgICAgIHNldFN0eWxlKHB0LCB2ay5ydGwgPyB7bGVmdDogMn0gOiB7cmlnaHQ6IDJ9KTsKICAgIH0KICAgIGlmIChwaCkgewogICAgICBzZXRTdHlsZShwaC5wYXJlbnROb2RlLCB2ay5ydGwgPyB7bGVmdDogMX06IHtyaWdodDogMX0pOwogICAgfQogICAgaWYgKGJsKSBzZXRTdHlsZShibCwgdmsucnRsID8ge2xlZnQ6IChvcHRzLnR0RGlmZiB8fCAzMSl9IDoge3JpZ2h0OiAob3B0cy50dERpZmYgfHwgMzEpfSkKICAgIG9wdHMuaXNTaXplZCA9IGZhbHNlOwogIH0KICBpZiAob3B0cy5vblJlc2l6ZSkgewogICAgb3B0cy5vblJlc2l6ZSgpOwogIH0KfSwKCnN0aWNrZXJzSGludHNTaG93OiBmdW5jdGlvbihlbCwgb3B0cywgZGVsYXkpIHsKICBpZiAoIWlzVmlzaWJsZShlbCkpIHsKICAgIGZhZGVJbihlbCwgZGVsYXkpOwogIH0KICBpZiAoIW9wdHMuc3RpY2tlckV2ZW50c0luaXRlZCkgewogICAgdmFyIGlubmVyID0gZWwgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHNfaW5uZXInLCBlbCk7CiAgICBvcHRzLm9uSGludHNXaGVlbCA9IEVtb2ppLm9uV2hlZWxTdGlja2Vyc0hpbnRzLnBiaW5kKGlubmVyKTsKICAgIGFkZEV2ZW50KGlubmVyLCAnRE9NTW91c2VTY3JvbGwgd2hlZWwnLCBvcHRzLm9uSGludHNXaGVlbCk7CiAgICBhZGRFdmVudChkb2N1bWVudCwgJ2tleWRvd24nLCBFbW9qaS5zdGlja2VySGludE1vdmUpOwogICAgb3B0cy5vbkhpbnRzTW91c2VEb3duID0gZnVuY3Rpb24oKSB7CiAgICAgIG9wdHMuaGludHNDbGlja2VkID0gdHJ1ZTsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBkZWxldGUgb3B0cy5oaW50c0NsaWNrZWQ7CiAgICAgIH0sIDApOwogICAgfQogICAgYWRkRXZlbnQoZWwsICdtb3VzZWRvd24nLCBvcHRzLm9uSGludHNNb3VzZURvd24pOwogICAgaWYgKG9wdHMudHh0KSB7CiAgICAgIGlmIChvcHRzLm9uVHh0Rm9jdXMpIHsKICAgICAgICByZW1vdmVFdmVudChvcHRzLnR4dCwgJ2ZvY3VzJywgb3B0cy5vblR4dEZvY3VzKTsKICAgICAgICBkZWxldGUgb3B0cy5vblR4dEZvY3VzOwogICAgICB9CiAgICAgIG9wdHMub25UeHRCbHVyID0gZnVuY3Rpb24oZXYpIHsKICAgICAgICBpZiAob3B0cy5oaW50c0NsaWNrZWQpIHsKICAgICAgICAgIGNhbmNlbEV2ZW50KGV2KTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBFbW9qaS5zdGlja2Vyc0hpbnRzSGlkZShlbCwgb3B0cywgZGVsYXkpOwogICAgICB9CiAgICAgIGFkZEV2ZW50KG9wdHMudHh0LCAnYmx1cicsIG9wdHMub25UeHRCbHVyKTsKICAgIH0KICAgIG9wdHMuc3RpY2tlckV2ZW50c0luaXRlZCA9IHRydWU7CiAgfQogIEVtb2ppLmNoZWNrU3RpY2tlcnNIaW50c1NpemUoZWwsIG9wdHMpOwp9LAoKc3RpY2tlcnNIaW50c0hpZGU6IGZ1bmN0aW9uKGVsLCBvcHRzLCBkZWxheSkgewogIGZhZGVPdXQoZWwsIGRlbGF5KTsKICByZW1vdmVFdmVudChkb2N1bWVudCwgJ2tleWRvd24nLCBFbW9qaS5zdGlja2VySGludE1vdmUpOwogIGlmIChvcHRzLm9uSGludHNNb3VzZURvd24pIHsKICAgIHJlbW92ZUV2ZW50KGVsLCAnbW91c2Vkb3duJywgRW1vamkub25IaW50c01vdXNlRG93bik7CiAgfQogIGlmIChvcHRzLm9uSGludHNXaGVlbCkgewogICAgdmFyIGlubmVyID0gZWwgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHNfaW5uZXInLCBlbCk7CiAgICByZW1vdmVFdmVudChpbm5lciwgJ0RPTU1vdXNlU2Nyb2xsIHdoZWVsJywgRW1vamkub25IaW50c1doZWVsKTsKICB9CiAgaWYgKG9wdHMudHh0KSB7CiAgICBpZiAob3B0cy5vblR4dEJsdXIpIHsKICAgICAgcmVtb3ZlRXZlbnQob3B0cy50eHQsICdibHVyJywgb3B0cy5vblR4dEJsdXIpOwogICAgICBkZWxldGUgb3B0cy5vblR4dEJsdXI7CiAgICB9CiAgICBvcHRzLm9uVHh0Rm9jdXMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHN0Q29udCA9IG9wdHMudHh0ICYmIGdlQnlDbGFzczEoJ19zdGlja2VyX2hpbnRzJywgZG9tUE4ob3B0cy50eHQpKTsKICAgICAgaWYgKHN0Q29udCAmJiAhaXNWaXNpYmxlKHN0Q29udCkpIHsKICAgICAgICBkZWxldGUgb3B0cy5zdGlja2VySGludHNTdHJpbmc7CiAgICAgICAgRW1vamkuY2hlY2tTdGlja2Vyc0tleXdvcmRzKG9wdHMuaWQsIG9wdHMsIGZhbHNlKTsKICAgICAgfQogICAgfQogICAgYWRkRXZlbnQob3B0cy50eHQsICdmb2N1cycsIG9wdHMub25UeHRGb2N1cyk7CiAgfQogIGRlbGV0ZSBvcHRzLnN0aWNrZXJFdmVudHNJbml0ZWQ7CiAgZGVsZXRlIEVtb2ppLnNob3duSGludElkOwp9LAoKc3RpY2tlckhpbnRPdmVyOiBmdW5jdGlvbihlbCkgewogIEVtb2ppLnN0aWNrZXJIaW50T3V0KGVsKTsKICBhZGRDbGFzcyhlbCwgJ292ZXInKTsKfSwKCnN0aWNrZXJIaW50T3V0OiBmdW5jdGlvbihlbCkgewogIGVhY2goZ2VCeUNsYXNzKCdvdmVyJywgZG9tUE4oZWwpKSwgZnVuY3Rpb24oKSB7CiAgICByZW1vdmVDbGFzcyh0aGlzLCAnb3ZlcicpOwogIH0pOwp9LAoKc3RpY2tlckhpbnRDbGljazogZnVuY3Rpb24ob3B0SWQsIHN0aWNrZXJJZCwgZWwpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdIHx8IHt9LAogICAgICB0ZXh0ID0gb3B0cy50eHQsCiAgICAgIHN0Q29udCA9IHRleHQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHMnLCBkb21QTih0ZXh0KSksCiAgICAgIHN0aWNrZXJfcmVmZXJyZXIgPSAnc3VnZ2VzdGlvbl8nICsgRW1vamkuZ2V0U3RpY2tlcnNIaW50c1F1ZXJ5KHRleHQpOwoKICBpZiAoc3RpY2tlcklkIDwgMCkgewogICAgRW1vamkucHJldmlld1N0aWNrZXIoZmFsc2UsIGVsLCB7c3RpY2tlcklkOiAtc3RpY2tlcklkLCBzdGlja2VyX3JlZmVycmVyOiBzdGlja2VyX3JlZmVycmVyfSk7CiAgfSBlbHNlIHsKICAgIHZhbCh0ZXh0LCAnJyk7CiAgICBFbW9qaS5zdGlja2VyQ2xpY2sob3B0SWQsIHN0aWNrZXJJZCwgMjU2LCBlbCwgc3RpY2tlcl9yZWZlcnJlcik7CiAgICBpZiAob3B0cy5jaGVja0VkaXRhYmxlKSB7CiAgICAgIG9wdHMuY2hlY2tFZGl0YWJsZShvcHRJZCwgdGV4dCk7CiAgICB9CiAgfQogIEVtb2ppLnN0aWNrZXJzSGludHNIaWRlKHN0Q29udCwgb3B0cywgMCk7CgogIHJldHVybiBmYWxzZTsKfSwKCnN0aWNrZXJIaW50S2V5T3ZlcjogZnVuY3Rpb24ob3B0SWQsIGVsKSB7CiAgRW1vamkuc3RpY2tlckhpbnRPdmVyKGVsKTsKICBFbW9qaS5zaG93bkhpbnRJZCA9IG9wdElkOwp9LAoKc3RpY2tlckhpbnRLZXlPdXQ6IGZ1bmN0aW9uKG9wdElkLCBlbCkgewogIEVtb2ppLnN0aWNrZXJIaW50T3V0KGVsKTsKICBkZWxldGUgRW1vamkuc2hvd25IaW50SWQ7Cn0sCgpzdGlja2VySGludE1vdmU6IGZ1bmN0aW9uKGUpIHsKICB2YXIgb3B0SWQgPSBFbW9qaS5zaG93bkhpbnRJZDsKICBpZiAob3B0SWQgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdLAogICAgICBzdENvbnQgPSBvcHRzICYmIGdlQnlDbGFzczEoJ19zdGlja2VyX2hpbnRzJywgZG9tUE4ob3B0cy50eHQpKTsKICBpZiAoc3RDb250ICYmIGlzVmlzaWJsZShzdENvbnQpKSB7CiAgICB2YXIgZWwgPSBnZUJ5Q2xhc3MxKCdvdmVyJywgc3RDb250KSB8fCBnZUJ5Q2xhc3MxKCdlbW9qaV9zdGlja2VyX2l0ZW0nLCBzdENvbnQpOwogICAgc3dpdGNoIChlLmtleUNvZGUpIHsKICAgICAgY2FzZSBLRVkuTEVGVDoKICAgICAgICBlbCA9IGRvbVBTKGVsKTsKICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgIEVtb2ppLnN0aWNrZXJIaW50T3ZlcihlbCk7CiAgICAgICAgICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTY3JvbGwoZWwpOwogICAgICAgIH0KICAgICAgICBjYW5jZWxFdmVudChlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgS0VZLlJJR0hUOgogICAgICAgIGVsID0gZG9tTlMoZWwpOwogICAgICAgIGlmIChlbCkgewogICAgICAgICAgRW1vamkuc3RpY2tlckhpbnRPdmVyKGVsKTsKICAgICAgICAgIEVtb2ppLmNoZWNrU3RpY2tlcnNIaW50c1Njcm9sbChlbCk7CiAgICAgICAgfQogICAgICAgIGNhbmNlbEV2ZW50KGUpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBLRVkuRU5URVI6CiAgICAgICAgZWwuY2xpY2soKTsKICAgICAgICBjYW5jZWxFdmVudChlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9LAoKY2hlY2tTdGlja2Vyc0hpbnRzU2l6ZTogZnVuY3Rpb24oZWwsIG9wdHMsIGFuaW1hdGVkKSB7CiAgaWYgKGFuaW1hdGVkKSB7CiAgICBhZGRDbGFzcyhlbCwgJ19tYXJnaW5fdHJhbnNpdGlvbicpOwogICAgcmVtb3ZlQ2xhc3NEZWxheWVkKGVsLCAnX21hcmdpbl90cmFuc2l0aW9uJyk7CiAgfQoKICBzZXRTdHlsZShlbCwge21hcmdpbkxlZnQ6IDB9KTsKICB2YXIgZ2FwID0gMTAsCiAgICAgIGhpbnRYWSA9IGdldFhZKGVsKSwKICAgICAgaGludFNpemUgPSBnZXRTaXplKGVsKSwKICAgICAgZW1vamlYWSA9IEVtb2ppLmdldEVtb2ppVHRYWShvcHRzLnR0KTsKCiAgaWYgKG9wdHMudHQgJiYgZW1vamlYWSAmJgogICAgICBlbW9qaVhZWzBdICYmIGhpbnRYWVswXSArIGhpbnRTaXplWzBdICsgZ2FwID4gZW1vamlYWVswXSAmJgogICAgICBoaW50WFlbMV0gKyBoaW50U2l6ZVsxXSA+IGVtb2ppWFlbMV0pIHsKICAgIHNldFN0eWxlKGVsLCB7bWFyZ2luTGVmdDogZW1vamlYWVswXSAtIGhpbnRYWVswXSAtIGhpbnRTaXplWzBdIC0gZ2FwfSk7CiAgfQoKICB3aGlsZSAoZ2V0WFkoZWwpWzBdIDwgMCAmJiBkb21GQyhlbCkpIHsKICAgIHJlKGRvbUZDKGVsKSk7CiAgfQogIGlmICghZG9tRkMoZWwpKSB7CiAgICBFbW9qaS5zdGlja2Vyc0hpbnRzSGlkZShlbCwgb3B0cywgMCk7CiAgfQp9LAoKZ2V0RW1vamlUdFhZOiBmdW5jdGlvbih0b29sdGlwKSB7CiAgdmFyIHJlc3VsdDsKCiAgaWYgKHRvb2x0aXAgJiYgaGFzQ2xhc3ModG9vbHRpcCwgRW1vamkuU0hPV05fVFRfQ0xTKSkgewogICAgcmVzdWx0ID0gZ2V0WFkodG9vbHRpcCk7CiAgfSBlbHNlIHsKICAgIHJlc3VsdCA9IFswLCAwXTsKICB9CgogIHJldHVybiByZXN1bHQ7Cn0sCgpnZXRTdGlja2Vyc0hpbnRzUXVlcnk6IGZ1bmN0aW9uKGVsKSB7CiAgdmFyIHN0ciA9IEVtb2ppLnZhbChlbCk7CiAgaWYgKHN0ci5sZW5ndGggPiAzMCkgewogICAgcmV0dXJuICcnOwogIH0KCiAgdmFyIGN1ciA9IHdpbmRvdy5jdXIud2FsbExheWVyID8gd2tjdXIgOiB3aW5kb3cuY3VyLAogICAgICByZXBseU5hbWUgPSBjdXIucmVwbHlfdG8gJiYgd2luZG93LldhbGwgJiYgV2FsbC5nZXRSZXBseU5hbWUoY3VyLnJlcGx5X3RvWzBdKTsKICBpZiAocmVwbHlOYW1lICYmIHJlcGx5TmFtZVsxXSkgewogICAgc3RyID0gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cCgnXignICsgZXNjYXBlUkUocmVwbHlOYW1lWzFdKSArICcpJyksICcnKTsKICB9CgogIGVhY2goRW1vamkuY3NzRW1vamksIGZ1bmN0aW9uKGNvZGUsIGRhdGEpIHsKICAgIHZhciByZSA9IG5ldyBSZWdFeHAoJyhcXHN8XikoJyArIGVzY2FwZVJFKGRhdGFbMV0pICsgKGRhdGFbMV1bZGF0YVsxXS5sZW5ndGggLSAxXSA9PSAnKScgPyAnKycgOiAnJykgKyAnKShbXFxzXFwuLF18JCknLCAnZycpOwogICAgc3RyID0gc3RyLnJlcGxhY2UocmUsIGZ1bmN0aW9uKG1hdGNoLCBwcmUsIHNtaWxlLCBzcGFjZSkgewogICAgICByZXR1cm4gKHByZSB8fCAnJykgKyBFbW9qaS5jb2RlVG9DaHIoY29kZSkrKHNwYWNlIHx8ICcnKTsKICAgIH0pOwogIH0pOwogIHN0ciA9IHN0ci5yZXBsYWNlKC9eW1xzXHVGRUZGXHhBMF0rfFtcLiFcP1xuXSskL2csICcnKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ7gnLCAn5ScpOwoKICByZXR1cm4gc3RyOwp9LAoKY2hlY2tTdGlja2Vyc0tleXdvcmRzOiBmdW5jdGlvbihvcHRJZCwgb3B0cywgZm9yY2UpIHsKICBpZiAob3B0cy5ub1N0aWNrZXJzIHx8ICF3aW5kb3cuc3RpY2tlcnNLZXl3b3JkcyB8fAogICAgIXdpbmRvdy5zdGlja2Vyc0tleXdvcmRzRGF0YSB8fCAhd2luZG93LnN0aWNrZXJzS2V5d29yZHNEYXRhLmxlbmd0aCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgdmFyIGRlbGF5ID0gZm9yY2UgPyAwIDogMTAwLAogICAgICB0ZXh0ID0gb3B0cy50eHQsCiAgICAgIHN0Q29udCA9IGdlQnlDbGFzczEoJ19zdGlja2VyX2hpbnRzJywgZG9tUE4odGV4dCkpLAogICAgICBzaG93SGludHMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBzdHIgPSBFbW9qaS5nZXRTdGlja2Vyc0hpbnRzUXVlcnkodGV4dCk7CiAgICBpZiAoIXN0Q29udCkgewogICAgICBzdENvbnQgPSBFbW9qaS5pbml0U3RpY2tlcnNIaW50cyh0ZXh0KTsKICAgICAgaWYgKCFzdENvbnQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdHIgPT0gb3B0cy5zdGlja2VySGludHNTdHJpbmcpIHJldHVybjsKICAgIGlmIChzdHIgJiYgc3RpY2tlcnNLZXl3b3Jkc1tzdHJdICYmIHN0aWNrZXJzS2V5d29yZHNbc3RyXS5sZW5ndGgpIHsKICAgICAgdmFyIHN0aWNrZXJzID0gRW1vamkuc29ydFN0aWNrZXJzSGludHModGV4dCwgc3RpY2tlcnNLZXl3b3Jkc1tzdHJdKSwKICAgICAgICAgIHN0aWNrZXJTaXplID0gKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID49IDIpID8gJzEyOCcgOiAnNjQnLCBodG1sID0gJyc7CiAgICAgIGVhY2goc3RpY2tlcnMsIGZ1bmN0aW9uKCkgewogICAgICAgIGh0bWwgKz0gcnMoRW1vamkuaGludHNTdGlja2VySXRlbSgpLCB7CiAgICAgICAgICBvcHRJZDogb3B0SWQsCiAgICAgICAgICBzZWxJZDogMCwKICAgICAgICAgIHN0aWNrZXJJZDogTWF0aC5hYnModGhpcyksCiAgICAgICAgICBjbGFzczogKHRoaXMgPCAwID8gJ3Byb21vJyA6ICcnKSwKICAgICAgICAgIG9uY2xpY2s6ICdFbW9qaS5zdGlja2VySGludENsaWNrKCcgKyBvcHRJZCArICcsICcgKyB0aGlzICsgJywgdGhpcyknLAogICAgICAgICAgc3RpY2tlclNpemU6IHN0aWNrZXJTaXplCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBFbW9qaS5zaG93U3RpY2tlcnNIaW50cyhzdENvbnQsIG9wdHMsIGh0bWwpOwogICAgfSBlbHNlIHsKICAgICAgRW1vamkuc3RpY2tlcnNIaW50c0hpZGUoc3RDb250LCBvcHRzLCBkZWxheSk7CiAgICB9CiAgICBvcHRzLnN0aWNrZXJIaW50c1N0cmluZyA9IHN0cjsKICB9CiAgaWYgKGZvcmNlKSB7CiAgICBzaG93SGludHMoKTsKICB9IGVsc2UgewogICAgY2xlYXJUaW1lb3V0KG9wdHMuc3RpY2tlckhpbnRUVCk7CiAgICBvcHRzLnN0aWNrZXJIaW50VFQgPSBzZXRUaW1lb3V0KHNob3dIaW50cywgc3RDb250ICYmIGlzVmlzaWJsZShzdENvbnQpID8gMCA6IDIwMCk7CiAgfQp9LAoKc2hvd1N0aWNrZXJzSGludHM6IGZ1bmN0aW9uKHN0Q29udCwgb3B0cywgaHRtbCkgewogIHZhciBpbm5lciA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50c19pbm5lcicsIHN0Q29udCk7CiAgaWYgKCFpbm5lciB8fCBvcHRzLm5vU3RpY2tlcnMpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHZhbChpbm5lciwgaHRtbCk7CiAgRW1vamkuc3RpY2tlcnNIaW50c1Nob3coc3RDb250LCBvcHRzLCAxMDApOwogIGlubmVyLnNjcm9sbExlZnQgPSAwOwogIEVtb2ppLmNoZWNrU3RpY2tlcnNIaW50c1Njcm9sbChzdENvbnQsIGlubmVyLnNjcm9sbExlZnQpOwp9LAoKY2hlY2tTdGlja2Vyc0hpbnRzU2Nyb2xsOiBmdW5jdGlvbihlbCwgbmV3TGVmdCkgewogIHZhciBzdENvbnQgPSBkb21DbG9zZXN0KCdfc3RpY2tlcl9oaW50cycsIGVsKSwKICAgICAgaW5uZXIgPSBzdENvbnQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHNfaW5uZXInLCBzdENvbnQpLAogICAgICBhcnJvd0xlZnQgPSBzdENvbnQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfbGVmdCcsIHN0Q29udCksCiAgICAgIGFycm93UmlnaHQgPSBzdENvbnQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfcmlnaHQnLCBzdENvbnQpOwogIGlmICghaW5uZXIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGlmIChoYXNDbGFzcyhlbCwgJ2Vtb2ppX3N0aWNrZXJfaXRlbScpKSB7CiAgICB2YXIgbWF4TGVmdCA9IGVsLm9mZnNldExlZnQgLSA4IC0gZ2V0U2l6ZShhcnJvd0xlZnQpWzBdLAogICAgICAgIG1pbkxlZnQgPSBlbC5vZmZzZXRMZWZ0ICsgZ2V0U2l6ZShlbClbMV0gKyAyICsgZ2V0U2l6ZShhcnJvd1JpZ2h0KVswXSAtIGlubmVyLmNsaWVudFdpZHRoOwogICAgaWYgKGlubmVyLnNjcm9sbExlZnQgPiBtYXhMZWZ0KSB7CiAgICAgIGlubmVyLnNjcm9sbExlZnQgPSBtYXhMZWZ0OwogICAgfQogICAgaWYgKGlubmVyLnNjcm9sbExlZnQgPCBtaW5MZWZ0KSB7CiAgICAgIGlubmVyLnNjcm9sbExlZnQgPSBtaW5MZWZ0OwogICAgfQogICAgbmV3TGVmdCA9IGlubmVyLnNjcm9sbExlZnQ7CiAgfQoKICB0b2dnbGUoYXJyb3dMZWZ0LCBuZXdMZWZ0ID4gMCk7CiAgdG9nZ2xlKGFycm93UmlnaHQsIG5ld0xlZnQgKyBpbm5lci5jbGllbnRXaWR0aCA8IGlubmVyLnNjcm9sbFdpZHRoKTsKfSwKCnNjcm9sbFN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGVsLCBkaXIsIGV2KSB7CiAgdmFyIHN0Q29udCA9IGRvbUNsb3Nlc3QoJ19zdGlja2VyX2hpbnRzJywgZWwpLAogICAgICBpbm5lciA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50c19pbm5lcicsIHN0Q29udCksCiAgICAgIGFycm93TGVmdCA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9sZWZ0Jywgc3RDb250KSwKICAgICAgYXJyb3dSaWdodCA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9yaWdodCcsIHN0Q29udCk7OwogIGlmICghaW5uZXIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHZhciBuZXdMZWZ0ID0gaW5uZXIuc2Nyb2xsTGVmdCArIGRpciAqIChpbm5lci5jbGllbnRXaWR0aCAtIDIgKiBnZXRTaXplKGVsKVswXSksCiAgICAgIGhpbnRzID0gZ2VCeUNsYXNzKCdlbW9qaV9zdGlja2VyX2l0ZW0nLCBpbm5lcik7CiAgZWFjaChoaW50cywgZnVuY3Rpb24oaSwgZWwpIHsKICAgIGlmIChkaXIgPiAwICYmIGVsLm9mZnNldExlZnQgLSA4IC0gZ2V0U2l6ZShhcnJvd0xlZnQpWzBdID4gbmV3TGVmdCkgewogICAgICBuZXdMZWZ0ID0gaGludHNbaSAtIDFdICYmIGhpbnRzW2kgLSAxXS5vZmZzZXRMZWZ0IC0gOCAtIGdldFNpemUoYXJyb3dMZWZ0KVswXSB8fCBuZXdMZWZ0OwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IGVsc2UgaWYgKGRpciA8IDAgJiYgZWwub2Zmc2V0TGVmdCArIGdldFNpemUoZWwpWzFdICsgMiArIGdldFNpemUoYXJyb3dSaWdodClbMF0gLSBpbm5lci5jbGllbnRXaWR0aCA+IG5ld0xlZnQpIHsKICAgICAgbmV3TGVmdCA9IGVsLm9mZnNldExlZnQgKyBnZXRTaXplKGVsKVsxXSArIDIgKyBnZXRTaXplKGFycm93UmlnaHQpWzBdIC0gaW5uZXIuY2xpZW50V2lkdGggfHwgbmV3TGVmdDsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0pOwogIG5ld0xlZnQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihpbm5lci5zY3JvbGxXaWR0aCAtIGlubmVyLmNsaWVudFdpZHRoLCBuZXdMZWZ0KSk7CiAgYW5pbWF0ZShpbm5lciwge3Njcm9sbExlZnQ6IG5ld0xlZnR9LCB7ZHVyYXRpb246IE1hdGguYWJzKGlubmVyLnNjcm9sbExlZnQgLSBuZXdMZWZ0KSArIDUwLCB0cmFuc2l0aW9uOiBGeC5UcmFuc2l0aW9ucy5lYXNlT3V0Q3ViaWN9KTsKICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTY3JvbGwoaW5uZXIsIG5ld0xlZnQpOwp9LAoKb25XaGVlbFN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGlubmVyLCBldikgewogIHZhciBkZWx0YTsKICBpZiAoZXYudHlwZSA9PSAnd2hlZWwnKSB7IC8vIGdlY2tvID49IDE3LCB3ZWJraXQKICAgIGRlbHRhID0gKE1hdGguYWJzKGV2LmRlbHRhWSkgPiBNYXRoLmFicyhldi5kZWx0YVgpKSA/IC1ldi5kZWx0YVkgOiAtZXYuZGVsdGFYOwogIH0gZWxzZSBpZiAoZXYud2hlZWxEZWx0YVkgIT09IHZvaWQoMCkpIHsgLy8gcHJlc3RvLCBvbGQgd2Via2l0CiAgICBkZWx0YSA9IGV2LndoZWVsRGVsdGFZOwogIH0gZWxzZSBpZiAoZXYud2hlZWxEZWx0YSAhPT0gdm9pZCgwKSkgeyAvLyBpZSA4IC0gMTEKICAgIGRlbHRhID0gZXYud2hlZWxEZWx0YTsKICB9IGVsc2UgaWYgKGV2LmRldGFpbCAmJiBldi5heGlzID09PSAyKSB7IC8vIGdlY2tvIDwgMTcKICAgIGRlbHRhID0gLWV2LmRldGFpbDsKICB9CiAgaWYgKE1hdGguYWJzKGRlbHRhKSA+PSAxMjApIHsKICAgIGRlbHRhID0gNzQgKiBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgZGVsdGEpKTsKICB9CiAgaW5uZXIuc2Nyb2xsTGVmdCAtPSBkZWx0YTsKICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTY3JvbGwoaW5uZXIsIGlubmVyLnNjcm9sbExlZnQpOwogIGNhbmNlbEV2ZW50KGV2KTsKfSwKCnNvcnRTdGlja2Vyc0hpbnRzOiBmdW5jdGlvbihlbCwgc3RpY2tlcnMpIHsKICB2YXIgcmVjZW50ID0gKEVtb2ppLnN0aWNrZXJzWy0xXSB8fCB7fSkuc3RpY2tlcnMgfHwgW10sCiAgICAgIHJlc3VsdCA9IFtdLCBhZGRlZCA9IHt9OwoKICBlYWNoKHJlY2VudCwgZnVuY3Rpb24oKSB7CiAgICBpZiAoaW5BcnJheSh0aGlzWzBdLCBzdGlja2VycykpIHsKICAgICAgcmVzdWx0LnB1c2godGhpc1swXSk7CiAgICAgIGFkZGVkW3RoaXNbMF1dID0gMTsKICAgIH0KICB9KTsKCiAgZWFjaChzdGlja2VycywgZnVuY3Rpb24oKSB7CiAgICBpZiAoIWFkZGVkW3RoaXNdKSB7CiAgICAgIHJlc3VsdC5wdXNoKHRoaXMpOwogICAgfQogIH0pOwoKICBpZiAoY3VyLnN0aWNrZXJzUHJvbW90ZVRlc3RHcm91cCkgewogICAgdmFyIHByb21vdGVDb3VudCA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc3RpY2tlcklkID0gcmVzdWx0W2ldOwoKICAgICAgaWYgKHN0aWNrZXJJZCA+IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgc3dpdGNoIChjdXIuc3RpY2tlcnNQcm9tb3RlVGVzdEdyb3VwKSB7CiAgICAgICAgY2FzZSAnc2Vjb25kX2xhc3QnOgogICAgICAgICAgaWYgKHByb21vdGVDb3VudCA9PT0gMCkgewogICAgICAgICAgICByZXN1bHQuc3BsaWNlKDEsIDAsIHJlc3VsdC5zcGxpY2UoaSwgMSkpCiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICd0aGlyZF9sYXN0JzoKICAgICAgICAgIGlmIChwcm9tb3RlQ291bnQgPT09IDApIHsKICAgICAgICAgICAgcmVzdWx0LnNwbGljZSgyLCAwLCByZXN1bHQuc3BsaWNlKGksIDEpKQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndGhpcmRfZm91cic6CiAgICAgICAgICBpZiAocHJvbW90ZUNvdW50ID09PSAwKSB7CiAgICAgICAgICAgIHJlc3VsdC5zcGxpY2UoMiwgMCwgcmVzdWx0LnNwbGljZShpLCAxKSkKICAgICAgICAgIH0gZWxzZSBpZiAocHJvbW90ZUNvdW50ID09PSAxKSB7CiAgICAgICAgICAgIHJlc3VsdC5zcGxpY2UoMywgMCwgcmVzdWx0LnNwbGljZShpLCAxKSkKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHByb21vdGVDb3VudCsrCiAgICB9CiAgfQoKICByZXR1cm4gcmVzdWx0Owp9LAoKaW5pdFN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGVsKSB7CiAgaWYgKCFlbCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIGRvbVBOKGVsKS5pbnNlcnRCZWZvcmUoc2UoJzxkaXYgY2xhc3M9Il9zdGlja2VyX2hpbnRzIHN0aWNrZXJfaGludHNfdHQiPjxkaXYgY2xhc3M9InN0aWNrZXJfaGludHNfYXJyb3cgc3RpY2tlcl9sZWZ0IF9zdGlja2VyX2xlZnQiIG9uY2xpY2s9IkVtb2ppLnNjcm9sbFN0aWNrZXJzSGludHModGhpcywgLTEsIGV2ZW50KSI+PC9kaXY+PGRpdiBjbGFzcz0iX3N0aWNrZXJfaGludHNfaW5uZXIgc3RpY2tlcl9oaW50c19pbm5lciI+PC9kaXY+PGRpdiBjbGFzcz0ic3RpY2tlcl9oaW50c19hcnJvdyBzdGlja2VyX3JpZ2h0IF9zdGlja2VyX3JpZ2h0IiBvbmNsaWNrPSJFbW9qaS5zY3JvbGxTdGlja2Vyc0hpbnRzKHRoaXMsIDEsIGV2ZW50KSI+PC9kaXY+PC9kaXY+JyksIGVsKTsKfSwKCnVwZGF0ZVN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGZvcmNlKSB7CiAgaWYgKEVtb2ppLm9wdHMpIHsKICAgIGVhY2goRW1vamkub3B0cywgZnVuY3Rpb24ob3B0SWQsIG9wdHMpIHsKICAgICAgaWYgKGZvcmNlKSB7CiAgICAgICAgZGVsZXRlIG9wdHMuc3RpY2tlckhpbnRzU3RyaW5nOwogICAgICB9CiAgICAgIEVtb2ppLmNoZWNrU3RpY2tlcnNLZXl3b3JkcyhvcHRJZCwgb3B0cywgdHJ1ZSk7CiAgICB9KTsKICB9Cn0sCgppbml0U3RpY2tlcnNLZXl3b3JkczogZnVuY3Rpb24oKSB7CiAgaWYgKCF3aW5kb3cuc3RpY2tlcnNLZXl3b3Jkc0RhdGEpIHsKICAgIHZhciBkYXRhID0gbHMuZ2V0KCdzdGlja2Vyc19rZXl3b3JkcycpOwogICAgaWYgKGRhdGEgJiYgZGF0YS50aW1lICYmIGRhdGEudGltZSA+IHZrTm93KCkgLSA4NjQwMDAwMCAqICgyICsgTWF0aC5yYW5kb20oKSkpIHsKICAgICAgd2luZG93LnN0aWNrZXJzS2V5d29yZHNEYXRhID0gZGF0YS5rZXl3b3JkczsKICAgIH0KICB9CiAgaWYgKHdpbmRvdy5zdGlja2Vyc0tleXdvcmRzRGF0YSkgewogICAgRW1vamkuc2V0U3RpY2tlcnNLZXl3b3Jkcyh3aW5kb3cuc3RpY2tlcnNLZXl3b3Jkc0RhdGEpOwogIH0KfSwKCmNhY2hlZFN0aWNrZXJzS2V5d29yZHNUaW1lOiBmdW5jdGlvbigpIHsKICB2YXIgZGF0YSA9IGxzLmdldCgnc3RpY2tlcnNfa2V5d29yZHMnKTsKICByZXR1cm4gZGF0YSAmJiBkYXRhLnRpbWUgPyBNYXRoLmZsb29yKGRhdGEudGltZSAvIDEwMDApIDogMDsKfSwKCnNldFN0aWNrZXJzS2V5d29yZHM6IGZ1bmN0aW9uKGtleXdvcmRzLCB1cGRhdGUpIHsKICBpZiAoIWtleXdvcmRzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB3aW5kb3cuc3RpY2tlcnNLZXl3b3JkcyA9IHt9OwoKICB2YXIgZWwgPSBjZSgnZGl2Jyk7CiAgdmFyIHNlcCA9ICdcbic7CiAgdmFyIGFjYyA9IFtdOwogIHZhciBzdHIgPSAnJzsKCiAga2V5d29yZHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICB2YXIgd29yZHMgPSBpdGVtLndvcmRzIHx8IFtdOwogICAgdmFyIHVzZXIgPSBpdGVtLnVzZXJfc3RpY2tlcnMgfHwgW107CiAgICB2YXIgcHJvbW8gPSBpdGVtLnByb21vdGVkX3N0aWNrZXJzIHx8IFtdOwogICAgdmFyIHJlcyA9IHVzZXIuY29uY2F0KHByb21vLm1hcChmdW5jdGlvbihpZCkgewogICAgICByZXR1cm4gLWlkOwogICAgfSkpOwoKICAgIHdvcmRzLmZvckVhY2goZnVuY3Rpb24od29yZCkgewogICAgICBzdHIgKz0gc2VwICsgd29yZDsKICAgICAgYWNjLnB1c2gocmVzKTsKICAgIH0pOwogIH0pOwoKICB2YWwoZWwsIHN0cik7CgogIHN0ciA9IGVsLnRleHRDb250ZW50IHx8IGVsLmlubmVyVGV4dDsKCiAgc3RyICYmIHN0ci5zbGljZShzZXAubGVuZ3RoKS5zcGxpdChzZXApLmZvckVhY2goZnVuY3Rpb24od29yZCwgaSkgewogICAgd2luZG93LnN0aWNrZXJzS2V5d29yZHNbd29yZF0gPSBhY2NbaV07CiAgfSk7CgogIGlmICghRW1vamkuc3RpY2tlcnNbLTFdKSB7CiAgICB2YXIgcmVjZW50ID0gbHMuZ2V0KCdyZWNlbnRfc3RpY2tlcnMnKTsKICAgIGlmIChyZWNlbnQpIHsKICAgICAgRW1vamkuc3RpY2tlcnNbLTFdID0gcmVjZW50OwogICAgfQogIH0KCiAgaWYgKHVwZGF0ZSkgewogICAgbHMuc2V0KCdzdGlja2Vyc19rZXl3b3JkcycsIHt0aW1lOiB2a05vdygpLCBrZXl3b3Jkczoga2V5d29yZHN9KTsKICAgIEVtb2ppLnVwZGF0ZVN0aWNrZXJzSGludHModHJ1ZSk7CiAgfQp9LAoKZW1vamlFbnRlcjogZnVuY3Rpb24ob3B0SWQsIGUpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdLAogICAgY3RybFNlbmQgPSAob3B0cy5jdHJsU2VuZCA/IG9wdHMuY3RybFNlbmQoKSA6IG9wdHMubm9FbnRlclNlbmQpIHx8IChjdXIuY3RybF9zdWJtaXQgJiYgIW9wdHMubm9DdHJsU2VuZCk7CiAgaWYgKAogICAgb3B0cy5lbW9qaUZvY3VzZWQgJiYKICAgIG9wdHMuZW1vamlPdmVyZWQgJiYKICAgIG9wdHMub3BlbmVkQnlUYWJLZXkgJiYKICAgIChjdHJsU2VuZCA/ICEoZS5jdHJsS2V5IHx8IGJyb3dzZXIubWFjICYmIGUubWV0YUtleSkgOiAhZS5zaGlmdEtleSkKICApIHsKICAgIGlmIChvcHRzLmN1clRhYiA9PT0gMCkgewogICAgICB2YXIgaW1nID0gZ2VCeVRhZzEoJ2ltZycsIG9wdHMuZW1vamlPdmVyZWQpIHx8IGdlQnlUYWcxKCdpJywgb3B0cy5lbW9qaU92ZXJlZCk7CiAgICAgIEVtb2ppLmFkZEVtb2ppKG9wdElkLCBFbW9qaS5nZXRDb2RlKGltZyksIG9wdHMuZW1vamlPdmVyZWQpOwogICAgfQogICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogIH0KICByZXR1cm4gdHJ1ZTsKfSwKCmluc2VydEhUTUw6IGZ1bmN0aW9uKGh0bWwpIHsKICBpZiAoYnJvd3Nlci5tc2llICYmIHBhcnNlSW50KGJyb3dzZXIudmVyc2lvbikgPCAxMikgewogICAgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewogICAgICB2YXIgciA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpOwogICAgICBpZiAoci5wYXN0ZUhUTUwpIHsKICAgICAgICByLnBhc3RlSFRNTChodG1sKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIHIgPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKS5nZXRSYW5nZUF0KDApOwogICAgICB2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgci5zdXJyb3VuZENvbnRlbnRzKG4pOwogICAgICBuLmlubmVySFRNTCA9IGh0bWw7CiAgICAgIHIuY29sbGFwc2UoZmFsc2UpOwogICAgfQogIH0gZWxzZSB7CiAgICBpZiAoaHRtbCkgewogICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0SFRNTCcsIGZhbHNlLCBodG1sKTsKICAgIH0KICB9Cn0sCgphZGRFbW9qaTogZnVuY3Rpb24ob3B0SWQsIGNvZGUsIG9iaikgewogIGlmIChvcHRJZCA9PT0gZmFsc2UgfHwgY29kZSA9PT0gZmFsc2UpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBpZiAodmtOb3coKSAtIG9wdHMudHRTaG93VCA8IEVtb2ppLkNMSUNLX0RFTEFZKSB7CiAgICByZXR1cm4KICB9CiAgaWYgKG9wdHMuZWRpdGFibGUpIHsKICAgIHZhciBpbWcgPSBFbW9qaS5nZXRFbW9qaUhUTUwoY29kZSwgRW1vamkuY29kZVRvQ2hyKGNvZGUpLCB0cnVlKTsKICAgIHZhciBlZGl0YWJsZSA9IG9wdHMudHh0OwogICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkgOiBmYWxzZTsKICAgIGlmIChzZWwgJiYgc2VsLnJhbmdlQ291bnQpIHsKICAgICAgciA9IHNlbC5nZXRSYW5nZUF0KDApOwogICAgICBpZiAoci5jb21tb25BbmNlc3RvckNvbnRhaW5lcikgewogICAgICAgIHZhciByQ29udCA9IHIuY29tbW9uQW5jZXN0b3JDb250YWluZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJDb250ID0gci5wYXJlbnRFbGVtZW50ID8gci5wYXJlbnRFbGVtZW50KCkgOiByLml0ZW0oMCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciByQ29udCA9IGZhbHNlOwogICAgfQogICAgZWwgPSByQ29udDsKICAgIHdoaWxlKGVsICYmIGVsICE9IGVkaXRhYmxlKSB7CiAgICAgIGVsID0gZWwucGFyZW50Tm9kZTsKICAgIH0KICAgIHZhciBlZExhc3QgPSAoZWRpdGFibGUubGFzdENoaWxkIHx8IHt9KTsKICAgIGlmIChicm93c2VyLm1vemlsbGEgJiYgZWRMYXN0LnRhZ05hbWUgPT0gJ0JSJyAmJiAhZWRMYXN0LnByZXZpb3VzU2libGluZykgewogICAgICByZShlZGl0YWJsZS5sYXN0Q2hpbGQpOwogICAgfQogICAgaWYgKCFlbCkgewogICAgICBFbW9qaS5lZGl0YWJsZUZvY3VzKGVkaXRhYmxlLCBmYWxzZSwgdHJ1ZSk7CiAgICB9CiAgICBFbW9qaS5pbnNlcnRIVE1MKGltZyk7CiAgICB2YXIgZW1vamllcyA9IGdlQnlDbGFzcygnZW1vamknLCBlZGl0YWJsZSk7CiAgICBlbW9qaWVzLnB1c2guYXBwbHkoZW1vamllcywgZ2VCeUNsYXNzKCdlbW9qaV9jc3MnLCBlZGl0YWJsZSkpOwogICAgZm9yIChpIGluIGVtb2ppZXMpIHsKICAgICAgdmFyIHByZXYgPSBlbW9qaWVzW2ldLnByZXZpb3VzU2libGluZzsKICAgICAgaWYgKHByZXYgJiYgcHJldi5ub2RlVHlwZSA9PSAzICYmIHByZXYudGV4dENvbnRlbnQgJiYgcHJldi50ZXh0Q29udGVudC5jaGFyQ29kZUF0KDApID09IDMyKSB7CiAgICAgICAgdmFyIHAgPSBwcmV2LnByZXZpb3VzU2libGluZzsKICAgICAgICBpZiAocCAmJiBwLm5vZGVUeXBlID09IDMgJiYgcC50ZXh0Q29udGVudCAmJiBwLnRleHRDb250ZW50LmNoYXJDb2RlQXQocC50ZXh0Q29udGVudC5sZW5ndGggLSAxKSA9PSAxNjApIHsKICAgICAgICAgIHJlKHByZXYpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGVkaXRhYmxlLmNoZWNrKSBlZGl0YWJsZS5jaGVjaygpOwogICAgc2V0VGltZW91dChFbW9qaS5jb3JyZWN0Q2FyZXQucGJpbmQoZWRpdGFibGUpLCA1KTsKICB9IGVsc2UgewogICAgdmFyIHRleHRBcmVhID0gb3B0cy50eHQ7CiAgICB2YXIgdmFsID0gdGV4dEFyZWEudmFsdWU7CiAgICBpZiAoYnJvd3Nlci5pcGhvbmUgfHwgYnJvd3Nlci5pcGFkKSB7CiAgICAgIHZhciB0ZXh0ID0gRW1vamkuY29kZVRvQ2hyKGNvZGUpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHRleHQgPSBFbW9qaS5jc3NFbW9qaVtjb2RlXVsxXSsnICc7CiAgICB9CiAgICB2YXIgZW5kSW5kZXgsIHJhbmdlOwogICAgaWYgKHRleHRBcmVhLnNlbGVjdGlvblN0YXJ0ICE9IHVuZGVmaW5lZCAmJiB0ZXh0QXJlYS5zZWxlY3Rpb25FbmQgIT0gdW5kZWZpbmVkKSB7CiAgICAgIGVuZEluZGV4ID0gdGV4dEFyZWEuc2VsZWN0aW9uRW5kOwogICAgICB0ZXh0QXJlYS52YWx1ZSA9IHZhbC5zbGljZSgwLCB0ZXh0QXJlYS5zZWxlY3Rpb25TdGFydCkgKyB0ZXh0ICsgdmFsLnNsaWNlKGVuZEluZGV4KTsKICAgICAgdGV4dEFyZWEuc2VsZWN0aW9uU3RhcnQgPSB0ZXh0QXJlYS5zZWxlY3Rpb25FbmQgPSBlbmRJbmRleCArIHRleHQubGVuZ3RoOwogICAgfSBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnQuc2VsZWN0aW9uICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZiBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdGV4dEFyZWEuZm9jdXMoKTsKICAgICAgcmFuZ2UgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKICAgICAgcmFuZ2UudGV4dCA9IHRleHQ7CiAgICAgIHJhbmdlLnNlbGVjdCgpOwogICAgfQogIH0KICBpZiAob3B0cy5jaGVja0VkaXRhYmxlKSB7CiAgICBvcHRzLmNoZWNrRWRpdGFibGUob3B0SWQsIG9wdHMudHh0KTsKICB9CiAgRW1vamkuY2hlY2tTdGlja2Vyc0tleXdvcmRzKG9wdElkLCBvcHRzKTsKICBpZiAob3B0cy5zYXZlRHJhZnQpIHsKICAgIG9wdHMuc2F2ZURyYWZ0KCk7CiAgfQogIEVtb2ppLmluY3JSZWNlbnRFbW9qaVJhdGUob3B0SWQsIGNvZGUpOwp9LAoKc2hvd1NoYWRvdzogZnVuY3Rpb24oKSB7CiAgcmV0dXJuICEoYnJvd3Nlci5tc2llICYmIGJyb3dzZXIudmVyc2lvbiA8IDEwKTsKfSwKCnNjcm9sbFRvZ2dsZUFycm93OiBmdW5jdGlvbihpc1Nob3csIHNpZGUsIG9wdHMsIG5vQW5pbSkgewogIHZhciBzID0gZ2VCeUNsYXNzMSgnZW1vamlfdGFic18nK3NpZGUrJ19zJywgb3B0cy50dCkKICBpZiAobm9BbmltKSB7CiAgICAoaXNTaG93ID8gc2hvdyA6IGhpZGUpKHMpOwogIH0gZWxzZSBpZiAoaXNTaG93KSB7CiAgICBmYWRlSW4ocywgMjAwKTsKICB9IGVsc2UgewogICAgZmFkZU91dChzLCAyMDApOwogIH0KICBvcHRzW3NpZGUrJ1Nob3duJ10gPSBpc1Nob3c7Cn0sCgpzY3JvbGxUYWJzOiBmdW5jdGlvbihvcHRJZCwgcmlnaHQpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGlmICghb3B0cykgewogICAgcmV0dXJuOwogIH0KICB2YXIgY29udCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnNfd3JhcCcsIG9wdHMudHQpOwogIHZhciBtYXhTY3JvbGwgPSBjb250LmZpcnN0Q2hpbGQuY2xpZW50V2lkdGggLSBjb250LmNsaWVudFdpZHRoOwogIGlmIChyaWdodCkgewogICAgdmFyIG1Qb3MgPSByaWdodCA9PSAyID8gY29udC5zY3JvbGxMZWZ0IDogY29udC5zY3JvbGxMZWZ0ICsgNSozNDsKICAgIGlmIChtUG9zID49IG1heFNjcm9sbCkgewogICAgICBtUG9zID0gbWF4U2Nyb2xsOwogICAgICB2YXIgcnMgPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzX3JfcycsIG9wdHMudHQpCiAgICAgIGZhZGVPdXQocnMsIDIwMCk7CiAgICAgIG9wdHMuclNob3duID0gZmFsc2U7CiAgICAgIEVtb2ppLnNjcm9sbFRvZ2dsZUFycm93KGZhbHNlLCAncicsIG9wdHMpOwogICAgfQogICAgaWYgKG1Qb3MgJiYgIW9wdHMubFNob3duKSB7CiAgICAgIEVtb2ppLnNjcm9sbFRvZ2dsZUFycm93KHRydWUsICdsJywgb3B0cyk7CiAgICB9CiAgfQogIGlmICghcmlnaHQgfHwgcmlnaHQgPT0gMikgewogICAgdmFyIG1Qb3MgPSByaWdodCA9PSAyID8gY29udC5zY3JvbGxMZWZ0IDogTWF0aC5tYXgoY29udC5zY3JvbGxMZWZ0IC0gNSozNCwgMCk7CiAgICBpZiAobVBvcyA8PSAwKSB7CiAgICAgIG1Qb3MgPSAwOwogICAgICBFbW9qaS5zY3JvbGxUb2dnbGVBcnJvdyhmYWxzZSwgJ2wnLCBvcHRzKTsKICAgIH0KICAgIGlmIChtUG9zIDwgbWF4U2Nyb2xsICYmICFvcHRzLnJTaG93bikgewogICAgICBFbW9qaS5zY3JvbGxUb2dnbGVBcnJvdyh0cnVlLCAncicsIG9wdHMpOwogICAgfQogIH0KICBpZiAocmlnaHQgPT0gMikgeyAvLyB1cGRhdGUgYXJyb3dzIG9ubHkKICAgIHJldHVybjsKICB9CiAgb3B0cy5zY3JvbGxMZWZ0ID0gbVBvczsKICBhbmltYXRlKGNvbnQsIHtzY3JvbGxMZWZ0OiBtUG9zfSwgMzAwKTsKfSwKCnNjcm9sbFRvVGFiOiBmdW5jdGlvbih0YWJJZCwgb3B0SWQpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdLCB0dCA9IG9wdHMudHQ7CiAgdmFyIGNvbnQgPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzX3dyYXAnLCB0dCk7CiAgdmFyIHRhYiA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYl8nICsgdGFiSWQsIHR0KTsKICBpZiAoIXRhYikgewogICAgcmV0dXJuOwogIH0KICB2YXIgdHdlZW4gPSBkYXRhKGNvbnQsICd0d2VlbicpOwogIGlmICh0d2VlbiAmJiB0d2Vlbi5pc1R3ZWVuaW5nICYmIHRhYklkID09IG9wdHMuY3VyVGFiKSB7CiAgICByZXR1cm47CiAgfQogIHZhciB0YWJXaWR0aCA9IGdldFNpemUodGFiKVswXTsKICB2YXIgdGFiUG9zID0gdGFiLm9mZnNldExlZnQsIGNvbnRXID0gZ2V0U2l6ZShjb250KVswXTsKICB2YXIgY2VudGVyUG9zID0gdGFiUG9zIC0gY29udFcgLyAyICsgMTA7CgogIGlmICh0YWJQb3MgKyB0YWJXaWR0aCA8IGNvbnQuc2Nyb2xsTGVmdCkgewogICAgY29udC5zY3JvbGxMZWZ0ID0gTWF0aC5tYXgodGFiUG9zLCBjb250LnNjcm9sbExlZnQgLSBjb250VyAvIDIpOwogIH0gZWxzZSBpZiAodGFiUG9zICsgdGFiV2lkdGggLSBjb250LnNjcm9sbExlZnQgPiBjb250VykgewogICAgY29udC5zY3JvbGxMZWZ0ID0gTWF0aC5taW4odGFiUG9zICsgdGFiV2lkdGggLSBjb250LnNjcm9sbExlZnQsIGNvbnQuc2Nyb2xsTGVmdCArIGNvbnRXIC8gMik7CiAgfQoKICBhbmltYXRlKGNvbnQsIHtzY3JvbGxMZWZ0OiBjZW50ZXJQb3N9LCAzMDAsIGZ1bmN0aW9uICgpIHsKICAgIEVtb2ppLnNjcm9sbFRhYnMob3B0SWQsIDIpOwogIH0pOwogIEVtb2ppLnNlbGVjdFRhYihvcHRJZCwgdGFiSWQsIHRhYik7Cn0sCgpzZWxlY3RUYWI6IGZ1bmN0aW9uIChvcHRJZCwgc2VsSWQsIG9iaikgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF0sIHR0ID0gb3B0cy50dDsKICB2YXIgdGFic0NvbnQgPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzJywgdHQpOwogIHZhciBzZWxFbCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYl9zZWwnLCB0YWJzQ29udCk7CgogIHJlbW92ZUNsYXNzKHNlbEVsLCAnZW1vamlfdGFiX3NlbCcpOwogIGFkZENsYXNzKG9iaiwgJ2Vtb2ppX3RhYl9zZWwnKTsKICBvcHRzLmN1clRhYiA9IHNlbElkOwogIGN1ci5zdGlja2Vyc1RhYiA9IHNlbElkOwogIGxzLnNldCgnc3RpY2tlcnNfdGFiJywgc2VsSWQpOwp9LAoKdGFic1doZWVsOiBmdW5jdGlvbihlLCBvcHRJZCkgewogIGNhbmNlbEV2ZW50KGUpOwoKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIHZhciBkZWx0YSA9IE1hdGguYWJzKGUuZGVsdGFZKSA+IE1hdGguYWJzKGUuZGVsdGFYKSA/IGUuZGVsdGFZIDogZS5kZWx0YVg7CiAgdmFyIGNvbnQgPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzX3dyYXAnLCBvcHRzLnR0KTsKCiAgdmFyIGN1clNjcm9sbCA9IGNvbnQuc2Nyb2xsTGVmdDsKICBjb250LnNjcm9sbExlZnQgKz0gZGVsdGE7CiAgaWYgKGN1clNjcm9sbCA9PSBjb250LnNjcm9sbExlZnQpIHsKICAgIHJldHVybjsKICB9CgogIEVtb2ppLnNjcm9sbFRhYnMob3B0SWQsIDIpOwp9LAoKc2hvdzogZnVuY3Rpb24ob2JqLCBldikgewogIHZhciBvcHRJZCA9IGRhdGEoZG9tUE4ob2JqKSwgJ29wdElkJyk7CiAgaWYgKGlzVW5kZWZpbmVkKG9wdElkKSkgcmV0dXJuOwogIEVtb2ppLnR0U2hvdyhvcHRJZCwgb2JqLCBldik7Cn0sCgpoaWRlOiBmdW5jdGlvbihvYmosIGV2LCBmb3JjZSkgewogIHZhciBvcHRJZCA9IGRhdGEoZG9tUE4ob2JqKSwgJ29wdElkJyk7CiAgaWYgKGlzVW5kZWZpbmVkKG9wdElkKSkgcmV0dXJuOwogIEVtb2ppLnR0SGlkZShvcHRJZCwgb2JqLCBldiwgZm9yY2UpOwp9LAoKdHRTaG93OiBmdW5jdGlvbihvcHRJZCwgb2JqLCBldikgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgY2xlYXJUaW1lb3V0KG9wdHMuY3R0KTsKICBjbGVhclRpbWVvdXQob3B0cy5zdHQpOwogIGlmIChvcHRzLnNjcm9sbGluZykgewogICAgb3B0cy5hZnRlclNjcm9sbEZuID0gZmFsc2U7CiAgfQogIGlmIChvcHRzLnR0U2hvd24pIHJldHVybjsKICBpZiAob2JqKSBvcHRzLm9iaiA9IG9iajsKICBlbHNlIG9iaiA9IG9wdHMub2JqOwoKICBvcHRzLnN0dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgRW1vamkudHRDbGljayhvcHRJZCwgb2JqLCBmYWxzZSwgdHJ1ZSwgZXYpOwogIH0sIEVtb2ppLlNIT1dfVFRfVElNRU9VVCk7Cgp9LAoKdHRIaWRlOiBmdW5jdGlvbihvcHRJZCwgb2JqLCBldiwgZm9yY2UpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGNsZWFyVGltZW91dChvcHRzLnN0dCk7CiAgaWYgKCFvcHRzLnR0U2hvd24pIHJldHVybjsKICBpZiAob3B0cy5zY3JvbGxpbmcpIHsKICAgIG9wdHMuYWZ0ZXJTY3JvbGxGbiA9IEVtb2ppLnR0SGlkZS5wYmluZChvcHRJZCwgb2JqLCBldiwgZm9yY2UpOwogICAgcmV0dXJuOwogIH0KICBvYmogPSBvYmogfHwgb3B0cy5vYmogfHwgZ2VCeUNsYXNzMSgnZW1vamlfc21pbGUnLCBvcHRzLmNvbnRyb2xzQ29udCk7CiAgdmFyIGhpZGVUVCA9IGZ1bmN0aW9uKCkgewogICAgRW1vamkudHRDbGljayhvcHRJZCwgb2JqLCB0cnVlLCBmYWxzZSwgZXYpOwogIH07CgogIGlmIChmb3JjZSkgewogICAgaGlkZVRUKCk7CiAgfSBlbHNlIHsKICAgIGNsZWFyVGltZW91dChvcHRzLmN0dCk7CiAgICBvcHRzLmN0dCA9IHNldFRpbWVvdXQoaGlkZVRULCBFbW9qaS5ISURFX1RUX1RJTUVPVVQpOwogIH0KfSwKCnR0Q2xpY2s6IGZ1bmN0aW9uKG9wdElkLCBvYmosIG5lZWRIaWRlLCBuZWVkU2hvdywgZXYsIHRhYktleSkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgaWYgKCFvcHRzKSB7CiAgICByZXR1cm47CiAgfQogIGlmICgobmVlZEhpZGUgJiYgIUVtb2ppLnNob3duKSB8fCAobmVlZFNob3cgJiYgRW1vamkuc2hvd24pKSB7CiAgICByZXR1cm47CiAgfQogIGlmICghb2JqKSB7CiAgICBvYmogPSBFbW9qaS5zaG93biB8fCBnZSgoY3VyLnBlZXIgPT0gLTMpID8gJ2ltd19zbWlsZScgOiAnaW1fc21pbGUnKTsKICAgIGlmICghb2JqKSByZXR1cm47CiAgfQogIGlmIChvYmoudHQgJiYgb2JqLnR0LmRlc3Ryb3kpIHsKICAgIG9iai50dC5kZXN0cm95KCk7CiAgfQogIGlmICghb3B0cy50dCAmJiBvcHRzLnNoYXJlZFRUICYmIG9wdHMuc2hhcmVkVFQuZW1vamlUVCkgewogICAgb3B0cy50dCA9IG9wdHMuc2hhcmVkVFQuZW1vamlUVDsKICAgIG9wdHMuZW1vamlTY3JvbGwgPSBvcHRzLnNoYXJlZFRULmVtb2ppU2Nyb2xsOwogICAgb3B0cy5hbGxFbW9qaUlkID0gb3B0cy5zaGFyZWRUVC5lbW9qaUFsbElkOwogIH0KICB2YXIgdHQgPSBvcHRzLnR0OwogIGlmICghdHQpIHsKICAgIHZhciBwcmV2VGFiID0gbHMuZ2V0KCdzdGlja2Vyc190YWInKTsKICAgIGlmICghcHJldlRhYikgewogICAgICBwcmV2VGFiID0gRW1vamkuVEFCX0VNT0pJOwogICAgfQogICAgb3B0cy5jdXJUYWIgPSBjdXIuc3RpY2tlcnNUYWIgPSBFbW9qaS5UQUJfRU1PSkk7CiAgICBpZiAocHJldlRhYiAhPSBFbW9qaS5UQUJfRU1PSkkgJiYgIW9wdHMubm9TdGlja2VycykgewogICAgICBFbW9qaS5zdGlja2Vyc1tFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTXSA9IGxzLmdldCgncmVjZW50X3N0aWNrZXJzJyk7CiAgICAgIG9wdHMuY3VyVGFiID0gY3VyLnN0aWNrZXJzVGFiID0gcHJldlRhYjsKICAgIH0KICAgIHZhciB0YWJzID0gJzxkaXYgY2xhc3M9ImVtb2ppX3RhYnNfbF9zIiBvbmNsaWNrPSJFbW9qaS5zY3JvbGxUYWJzKCcrb3B0SWQrJywgMCk7Ij48ZGl2IGNsYXNzPSJlbW9qaV9zcHJpdGUgZW1vamlfdGFic19sX3NjIj48L2Rpdj48ZGl2IGNsYXNzPSJlbW9qaV9zcHJpdGUgZW1vamlfdGFic19sX3NpIj48L2Rpdj48L2Rpdj48ZGl2IGNsYXNzPSJlbW9qaV90YWJzX3JfcyIgb25jbGljaz0iRW1vamkuc2Nyb2xsVGFicygnK29wdElkKycsIDEpOyI+PGRpdiBjbGFzcz0iZW1vamlfc3ByaXRlIGVtb2ppX3RhYnNfcl9zYyI+PC9kaXY+PGRpdiBjbGFzcz0iZW1vamlfc3ByaXRlIGVtb2ppX3RhYnNfcl9zaSI+PC9kaXY+PC9kaXY+JzsKICAgIHRhYnMgKz0gRW1vamkuZ2V0VGFic0NvZGUoW1swLCAxXV0sIG9wdElkKTsKICAgIHRhYnMgKz0gJzxzcGFuIGNsYXNzPSJlbW9qaV90YWJzX3dyYXAiPjxzcGFuIGlkPSJlbW9qaV90YWJzX2NvbnRfJytvcHRJZCsnIiBjbGFzcz0iZW1vamlfdGFic19jb250Ij4nOwogICAgaWYgKCFvcHRzLm5vU3RpY2tlcnMgJiYgd2luZG93LmVtb2ppU3RpY2tlcnMgIT09IGZhbHNlICYmIHdpbmRvdy5lbW9qaVN0aWNrZXJzICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGFicyArPSBFbW9qaS5nZXRUYWJzQ29kZSh3aW5kb3cuZW1vamlTdGlja2Vycywgb3B0SWQpOwogICAgfQogICAgdmFyIGNsYXNzQWRkciA9ICcnOwogICAgdmFyIHNob3BFdmVudHMgPSAnb25jbGljaz0iRW1vamkuc2hvd1N0aWNrZXJzU3RvcmUoJytvcHRJZCsnKTsiJzsKICAgIHZhciBzaG9wSGludCA9ICdzaG93VG9vbHRpcCh0aGlzLCB7dGV4dDogXCcnK2dldExhbmcoJ2dsb2JhbF9zdG9yZV9zdGlja2VycycpKydcJywgc2hpZnQ6IFs0LDYsNl0sIHNob3dkdDogMCwgYmxhY2s6IDF9KTsnOwogICAgaWYgKG9wdHMuclBvaW50ZXIpIHsKICAgICAgc2hvcEV2ZW50cyArPSAnIG9ubW91c2VvdmVyPSJhZGRDbGFzcyh0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLCBcJ2Vtb2ppX3Nob3Bfb3ZlclwnKTsnK3Nob3BIaW50KyciICBvbm1vdXNlb3V0PSJyZW1vdmVDbGFzcyh0aGlzLnBhcmVudE5vZGUucGFyZW50Tm9kZS5wYXJlbnROb2RlLCBcJ2Vtb2ppX3Nob3Bfb3ZlclwnKTsiJzsKICAgIH0gZWxzZSB7CiAgICAgIHNob3BFdmVudHMgKz0gJyBvbm1vdXNlb3Zlcj0iJytzaG9wSGludCsnIic7CiAgICB9CiAgICB0YWJzICs9ICc8L3NwYW4+PC9zcGFuPic7CiAgICBpZiAoIW9wdHMubm9TdGlja2VycykgewogICAgICB0YWJzICs9ICc8YSBjbGFzcz0iZmxfciBlbW9qaV9zaG9wIiAnK3Nob3BFdmVudHMrJz48ZGl2IGNsYXNzPSJlbW9qaV9zcHJpdGUgZW1vamlfc2hvcF9pY29uIj4nKyhFbW9qaS5oYXNOZXdTdGlja2VycyA/ICc8ZGl2IGNsYXNzPSJlbW9qaV9zaG9wX2ljb25fYmFkZ2UiPicrTWF0aC5hYnMoRW1vamkuaGFzTmV3U3RpY2tlcnMpKyc8L2Rpdj4nIDogJycpKyc8L2Rpdj48L2E+JzsKICAgIH0KICAgIGlmICghRW1vamkuc2hvd1NoYWRvdygpKSB7CiAgICAgIGNsYXNzQWRkciArPSAnIGVtb2ppX25vX29wYWNpdHknOwogICAgfQogICAgaWYgKG9wdHMubm9TdGlja2VycyB8fCBvcHRzLmhpZGVTdGlja2Vyc0luaXRpYWwpIHsKICAgICAgY2xhc3NBZGRyICs9ICcgZW1vamlfbm9fdGFicyc7CiAgICB9CiAgICB2YXIgdHQgPSBjZSgnZGl2JywgewogICAgICBpZDogJ2Vtb2ppX2Jsb2NrXycrb3B0SWQsCiAgICAgIGNsYXNzTmFtZTogJ2Vtb2ppX3R0X3dyYXAgdHRfZG93bicgKyBjbGFzc0FkZHIsCiAgICAgIGlubmVySFRNTDogJzxkaXYgY2xhc3M9ImVtb2ppX2Jsb2NrX2NvbnQiPjxkaXYgY2xhc3M9ImVtb2ppX2Jsb2NrX3JlbCI+PGRpdiBjbGFzcz0iZW1vamlfbGlzdF9jb250Ij48ZGl2IGNsYXNzPSJlbW9qaV9jYXRzX3RpdGxlX2hlbHBlciI+PC9kaXY+PGRpdiBjbGFzcz0iZW1vamlfbGlzdCI+PGRpdiBjbGFzcz0iZW1vamlfc2Nyb2xsIGVtb2ppX3Njcm9sbF9zbWlsZXMiPjwvZGl2PjxkaXYgY2xhc3M9ImVtb2ppX3Njcm9sbCBlbW9qaV9zY3JvbGxfc3RpY2tlcnMiPjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9ImVtb2ppX3RhYnMgY2xlYXJfZml4Ij4nK3RhYnMrJzwvZGl2PjwvZGl2PicsCiAgICAgIG9ubW91c2VvdmVyOiBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKCFoYXNDbGFzcyh0dCwgJ2Vtb2ppX2FuaW1hdGVkJykpIEVtb2ppLnR0U2hvdyhvcHRJZCwgZmFsc2UsIGUpOwogICAgICB9LAogICAgICBvbm1vdXNlb3V0OiBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKCFoYXNDbGFzcyh0dCwgJ2Vtb2ppX2FuaW1hdGVkJykpIEVtb2ppLnR0SGlkZShvcHRJZCwgZmFsc2UsIGUpOwogICAgICB9CiAgICB9KTsKICAgIG9wdHMudHQgPSB0dDsKICAgIEVtb2ppLnJlYXBwZW5kRW1vamkob3B0SWQsIHR0KTsKICAgIEVtb2ppLmVtb2ppT3ZlcihvcHRJZCwgZ2VCeUNsYXNzMSgnZW1vamlfc2Nyb2xsX3NtaWxlcycsIHR0KS5maXJzdENoaWxkKTsKCiAgICBlYWNoKFsnZW1vamlfdGFic19sX3MnLCAnZW1vamlfdGFic19yX3MnLCAnZW1vamlfdGFic193cmFwJ10sIGZ1bmN0aW9uKCkgewogICAgICBhZGRFdmVudChnZUJ5Q2xhc3MxKHRoaXMsIG9wdHMudHQpLCAnRE9NTW91c2VTY3JvbGwgd2hlZWwnLCBmdW5jdGlvbihlKSB7CiAgICAgICAgRW1vamkudGFic1doZWVsKGUsIG9wdElkKTsKICAgICAgfSk7CiAgICB9KTsKCiAgICBpZiAob3B0cy5zaGFyZWRUVCkgewogICAgICBvcHRzLnNoYXJlZFRULmVtb2ppVFQgPSB0dDsKICAgIH0KICAgIEVtb2ppLmNoZWNrRW1vamlTbGlkZXIob3B0cyk7CiAgfQogIGNsZWFyVGltZW91dChvcHRzLnR0RW1vamlIaWRlKTsKCiAgaWYgKEVtb2ppLnNob3duSWQgIT09IGZhbHNlICYmIEVtb2ppLnNob3duSWQgIT0gb3B0SWQpIHsKICAgIEVtb2ppLnR0Q2xpY2soRW1vamkuc2hvd25JZCwgZ2VCeUNsYXNzMSgnZW1vamlfc21pbGUnLCBFbW9qaS5vcHRzW0Vtb2ppLnNob3duSWRdLmNvbnRyb2xzQ29udCksIHRydWUpOwogIH0KICBFbW9qaS5wcmV2ZW50TW91c2VPdmVyID0gZmFsc2U7CgogIGlmICghb3B0cy5lbW9qaUV4cGFuZGVkKSB7CiAgICBFbW9qaS5lbW9qaUV4cGFuZChvcHRJZCwgdHQpOwogIH0KICBpZiAoRW1vamkuc2hvd24pIHsKICAgIEVtb2ppLmhpZGVUdCh0dCk7CiAgICB2YXIgc3RDb250ID0gZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHMnLCBkb21QTihvcHRzLnR4dCkpOwogICAgaWYgKHN0Q29udCAmJiBpc1Zpc2libGUoc3RDb250KSkgewogICAgICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTaXplKHN0Q29udCwgb3B0cywgdHJ1ZSk7CiAgICB9CiAgICBFbW9qaS5zaG93biA9IGZhbHNlOwogICAgRW1vamkuc2hvd25JZCA9IGZhbHNlOwogICAgb3B0cy50dFNob3duID0gZmFsc2U7CiAgICBvcHRzLmVtb2ppRm9jdXNlZCA9IGZhbHNlOwogICAgY3VyLm9uTW91c2VDbGljayA9IGZhbHNlOwogICAgcmVtb3ZlRXZlbnQoZG9jdW1lbnQsICdrZXlkb3duJywgRW1vamkuZW1vamlNb3ZlKTsKICAgIHJlbW92ZUNsYXNzKG9iaiwgJ2Vtb2ppX3NtaWxlX29uJyk7CiAgICBpZiAob3B0cy5vbkhpZGUpIHsKICAgICAgb3B0cy5vbkhpZGUoKTsKICAgIH0KICB9IGVsc2UgewogICAgb3B0cy5vcGVuZWRCeVRhYktleSA9ICEhdGFiS2V5OwogICAgRW1vamkuc2hvd1R0KHR0KTsKICAgIEVtb2ppLnJlcG9zaXRpb25FbW9qaShvcHRJZCwgb2JqLCB0dCk7CgogICAgdmFyIHN0Q29udCA9IGdlQnlDbGFzczEoJ19zdGlja2VyX2hpbnRzJywgZG9tUE4ob3B0cy50eHQpKTsKICAgIGlmIChzdENvbnQgJiYgaXNWaXNpYmxlKHN0Q29udCkpIHsKICAgICAgRW1vamkuY2hlY2tTdGlja2Vyc0hpbnRzU2l6ZShzdENvbnQsIG9wdHMsIHRydWUpOwogICAgfQogICAgRW1vamkuc2hvd25JZCA9IG9wdElkOwogICAgRW1vamkuc2hvd24gPSBvYmo7CiAgICBjdXIuZW1vamlMaXN0ID0gZ2VCeUNsYXNzMSgnZW1vamlfbGlzdCcsIHR0KTsKICAgIG9wdHMudHRTaG93biA9IHRydWU7CiAgICBvcHRzLnR0U2hvd1QgPSB2a05vdygpOwogICAgb3B0cy5lbW9qaUZvY3VzZWQgPSB0cnVlOwogICAgcmVtb3ZlRXZlbnQoZG9jdW1lbnQsICdrZXlkb3duJywgRW1vamkuZW1vamlNb3ZlKTsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgIGN1ci5vbk1vdXNlQ2xpY2sgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIGVsID0gZS50YXJnZXQ7CiAgICAgICAgd2hpbGUoZWwpIHsKICAgICAgICAgIGlmIChlbC5pZCA9PSAnaW1fdGV4dHMnIHx8IGhhc0NsYXNzKGVsLCAnZW1vamlfdHRfd3JhcCcpIHx8IGhhc0NsYXNzKGVsLCAnaW13X2Vtb2ppX3dyYXAnKSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBlbCA9IGVsLnBhcmVudE5vZGU7CiAgICAgICAgfQogICAgICAgIEVtb2ppLnR0Q2xpY2sob3B0SWQsIGZhbHNlLCB0cnVlKTsKICAgICAgfQogICAgICBhZGRFdmVudChkb2N1bWVudCwgJ2tleWRvd24nLCBFbW9qaS5lbW9qaU1vdmUpOwogICAgfSwgMCk7CiAgICBhZGRDbGFzcyhvYmosICdlbW9qaV9zbWlsZV9vbicpOwogICAgaWYgKG9wdHMuZW1vamlTY3JvbGwgJiYgb3B0cy5lbW9qaUV4cGFuZGVkKSB7CiAgICAgIG9wdHMuZW1vamlTY3JvbGwudXBkYXRlKCk7CiAgICAgIGlmIChicm93c2VyLm1zaWUgJiYgb3B0cy5jdXJUYWIgPT09IDAgJiYgb3B0cy5lbW9qaU92ZXJlZCkgewogICAgICAgIEVtb2ppLnNjcm9sbFRvTGlzdEVsKG9wdElkLCBvcHRzLmVtb2ppT3ZlcmVkKTsKICAgICAgfQogICAgfQogICAgRW1vamkudGFiU3dpdGNoKG9wdHMuY3VyVGFiLCBvcHRzLmN1clRhYiwgb3B0SWQpOwogICAgb3B0cy5vblJlY2VudEVtb2ppVXBkYXRlICYmIG9wdHMub25SZWNlbnRFbW9qaVVwZGF0ZSgpOwoKICAgIGlmIChvcHRzLm9uU2hvdykgewogICAgICBvcHRzLm9uU2hvdygpOwogICAgfQogIH0KICBlYWNoKGdlQnlDbGFzcygnZW1vamlfc21pbGVfaWNvbl9wcm9tbycpLCBmdW5jdGlvbihpLCBlbCkgewogICAgcmVtb3ZlRXZlbnQoZ2VCeUNsYXNzMSgnZW1vamlfc21pbGVfaWNvbicsIGVsLnBhcmVudE5vZGUpLCAnbW91c2VvdmVyJyk7CiAgICByZShlbCk7CiAgICBFbW9qaS5ub05ld1N0aWNrZXJzID0gdHJ1ZTsKICB9KTsKCiAgaWYgKG9wdHMubm9TdGlja2Vyc1N0b3JlKSB7CiAgICBhZGRDbGFzcyhnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzJywgJ2Vtb2ppX2Jsb2NrXycrb3B0SWQpLCAnZW1vamlfdGFic19ub19zdG9yZScpOwogIH0gZWxzZSB7CiAgICByZW1vdmVDbGFzcyhnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzJywgJ2Vtb2ppX2Jsb2NrXycrb3B0SWQpLCAnZW1vamlfdGFic19ub19zdG9yZScpOwogIH0KICByZXR1cm4gY2FuY2VsRXZlbnQoZXYpOwp9LApjdXJFbW9qaUtleXM6IHt9LApjdXJFbW9qaUNhdHM6IHsxOiBbJ0Q4M0RERTA0JywgJ0Q4M0RERTAxJywgJ0Q4M0RERTBBJywgJ0Q4M0RERTAzJywgJ0Q4M0VERDIzJywgJ0Q4M0RERTA2JywgJ0Q4M0RERTA5JywgJ0Q4M0RERTFDJywgJ0Q4M0RERTBCJywgJ0Q4M0VERDE3JywgJ0Q4M0RERTBEJywgJ0Q4M0RERTBFJywgJ0Q4M0RERTEyJywgJ0Q4M0RERTBGJywgJ0Q4M0RERTQyJywgJ0Q4M0RERTQzJywgJ0Q4M0RERTE0JywgJ0Q4M0RERTIyJywgJ0Q4M0RERTJEJywgJ0Q4M0RERTI5JywgJ0Q4M0RERTI4JywgJ0Q4M0RERTEwJywgJ0Q4M0RERTBDJywgJ0Q4M0VERDI0JywgJ0Q4M0RERTA3JywgJ0Q4M0RERTMwJywgJ0Q4M0VERDI3JywgJ0Q4M0RERTMyJywgJ0Q4M0VERDIyJywgJ0Q4M0RERTMzJywgJ0Q4M0RERTM3JywgJ0Q4M0RERTAyJywgJzI3NjQnLCAnRDgzRERDOEInLCAnRDgzRERFMUEnLCAnRDgzRERFMTUnLCAnRDgzRERFMkYnLCAnRDgzRERFMjYnLCAnRDgzRERFMzUnLCAnRDgzRERFNDQnLCAnRDgzRUREMTQnLCAnRDgzRERFMjAnLCAnRDgzRERFMjEnLCAnRDgzRERFMUQnLCAnRDgzRERFMzQnLCAnRDgzRERFMTgnLCAnRDgzRERFMTcnLCAnRDgzRERFMTknLCAnRDgzRERFMUYnLCAnRDgzRERFNDEnLCAnMjYzOScsICdEODNEREUyQycsICdEODNEREUzNicsICdEODNFREQxMCcsICdEODNEREUyQicsICcyNjNBJywgJ0Q4M0RERTAwJywgJ0Q4M0RERTI1JywgJ0Q4M0RERTFCJywgJ0Q4M0RERTE2JywgJ0Q4M0RERTI0JywgJ0Q4M0RERTIzJywgJ0Q4M0RERTI3JywgJ0Q4M0RERTExJywgJ0Q4M0RERTA1JywgJ0Q4M0RERTJFJywgJ0Q4M0RERTFFJywgJ0Q4M0RERTEzJywgJ0Q4M0RERTMxJywgJ0Q4M0VERDEzJywgJ0Q4M0VERDExJywgJ0Q4M0RERTJBJywgJ0Q4M0VERDEyJywgJ0Q4M0VERDE1JywgJ0Q4M0VERDI1JywgJ0Q4M0VERDIwJywgJ0Q4M0RERTA4JywgJ0Q4M0REQzdGJywgJ0Q4M0REQzdEJywgJ0Q4M0REQzdCJywgJ0Q4M0RERTM4JywgJ0Q4M0RERTM5JywgJ0Q4M0RERTNDJywgJ0Q4M0RERTNEJywgJ0Q4M0RERTNFJywgJ0Q4M0RERTNGJywgJ0Q4M0RERTNCJywgJ0Q4M0RERTQwJywgJ0Q4M0RERTNBJywgJ0Q4M0RERTQ4JywgJ0Q4M0RERTQ5JywgJ0Q4M0RERTRBJywgJ0Q4M0REQ0E5JywgJ0Q4M0REQzgwJywgJ0Q4M0REQzc5JywgJ0Q4M0REQzdBJ10sIDI6IFsnRDgzQ0RGMzEnLCAnRDgzQ0RGMzInLCAnRDgzQ0RGMzMnLCAnRDgzQ0RGMzQnLCAnRDgzQ0RGMzcnLCAnRDgzQ0RGMzgnLCAnRDgzQ0RGNDUnLCAnRDgzQ0RGNDYnLCAnRDgzQ0RGNDcnLCAnRDgzQ0RGNDgnLCAnRDgzQ0RGNDknLCAnRDgzQ0RGNEEnLCAnRDgzQ0RGNEInLCAnRDgzQ0RGNEMnLCAnRDgzQ0RGNEQnLCAnRDgzQ0RGNEUnLCAnRDgzQ0RGNEYnLCAnRDgzQ0RGNTAnLCAnRDgzQ0RGNTEnLCAnRDgzRERDMDAnLCAnRDgzRERDMDEnLCAnRDgzRERDMDInLCAnRDgzRERDMDMnLCAnRDgzRERDMDQnLCAnRDgzRERDMDUnLCAnRDgzRERDMDYnLCAnRDgzRERDMDcnLCAnRDgzRERDMDgnLCAnRDgzRERDMDknLCAnRDgzRERDMEEnLCAnRDgzRERDMEInLCAnRDgzRERDMEMnLCAnRDgzRERDMEQnLCAnRDgzRERDMEUnLCAnRDgzRERDMEYnLCAnRDgzRERDMTAnLCAnRDgzRERDMTEnLCAnRDgzRERDMTInLCAnRDgzRERDMTMnLCAnRDgzRERDMTQnLCAnRDgzRERDMTUnLCAnRDgzRERDMTYnLCAnRDgzRERDMTcnLCAnRDgzRERDMTgnLCAnRDgzRERDMTknLCAnRDgzRERDMUEnLCAnRDgzRERDMUInLCAnRDgzRERDMUMnLCAnRDgzRERDMUQnLCAnRDgzRERDMUUnLCAnRDgzRERDMUYnLCAnRDgzRERDMjAnLCAnRDgzRERDMjEnLCAnRDgzRERDMjInLCAnRDgzRERDMjMnLCAnRDgzRERDMjQnLCAnRDgzRERDMjUnLCAnRDgzRERDMjYnLCAnRDgzRERDMjcnLCAnRDgzRERDMjgnLCAnRDgzRERDMkEnLCAnRDgzRERDMkInLCAnRDgzRERDMkMnLCAnRDgzRERDMkQnLCAnRDgzRERDMkUnLCAnRDgzRERDMkYnLCAnRDgzRERDMzAnLCAnRDgzRERDMzInLCAnRDgzRERDMzMnLCAnRDgzRERDMzQnLCAnRDgzRERDMzUnLCAnRDgzRERDMzYnLCAnRDgzRERDMzcnLCAnRDgzRERDMzgnLCAnRDgzRERDMzknLCAnRDgzRERDM0EnLCAnRDgzRERDM0InLCAnRDgzRERDM0MnLCAnRDgzRERDM0QnLCAnRDgzRERDM0UnLCAnRDgzQ0RGMzAnLCAnRDgzQ0RGMzUnLCAnRDgzQ0RGMzknLCAnRDgzQ0RGM0EnLCAnRDgzQ0RGM0InLCAnRDgzQ0RGM0MnLCAnRDgzQ0RGM0QnLCAnRDgzQ0RGM0UnLCAnRDgzQ0RGM0YnLCAnRDgzQ0RGNDAnLCAnRDgzQ0RGNDEnLCAnRDgzQ0RGNDInLCAnRDgzQ0RGNDMnLCAnRDgzQ0RGNDQnLCAnRDgzRERDQTYnLCAnRDgzRERDQTcnLCAnRDgzRUREODknLCAnRDgzRUREOEQnLCAnRDgzRUREOEYnLCAnRDgzRUREOEInLCAnRDgzRUREOEEnLCAnRDgzRUREODgnLCAnRDgzRUREODUnLCAnRDgzRUREODYnLCAnRDgzRUREODcnLCAnRDgzRUREOEUnLCAnRDgzRUREOTAnLCAnRDgzRUREOTEnLCAnRDgzRURENDAnLCAnRDgzRUREOEMnXSwgMzogWydEODNEREM0RCcsICdEODNEREM0RScsICcyNjFEJywgJzI3MEMnLCAnRDgzRERDNEMnLCAnRDgzREREOTVEODNDREZGQicsICdEODNFREQxOEQ4M0NERkZCJywgJ0Q4M0REQzRGJywgJ0Q4M0REQzRBJywgJ0Q4M0REQ0FBJywgJzI3MEInLCAnRDgzREREOTBEODNDREZGQicsICdEODNEREQ5NkQ4M0NERkZCJywgJ0Q4M0RERTRGJywgJ0Q4M0RERTRDJywgJzI3MEEnLCAnRDgzRERDNDYnLCAnRDgzRERDNDcnLCAnRDgzRERDNDgnLCAnRDgzRERDNDknLCAnRDgzRERDNEInLCAnRDgzRERDNTAnLCAnRDgzRUREMUVEODNDREZGQicsICdEODNFREQxRCcsICdEODNFREQxOUQ4M0NERkZCJywgJ0Q4M0VERDFCRDgzQ0RGRkInLCAnRDgzRUREMUNEODNDREZGQicsICdEODNEREM0MCcsICdEODNEREM0MicsICdEODNEREM0MycsICcyNzBERDgzQ0RGRkInLCAnRDgzRERDNDUnLCAnRDgzRERDNkInLCAnRDgzRERDNkMnLCAnRDgzRERDNkQnLCAnRDgzRERDOEYnLCAnRDgzRERDOTEnLCAnRDgzRERDNkYnLCAnRDgzRERDNkEnLCAnRDgzRERDNzAnLCAnRDgzRERDNjYnLCAnRDgzRERDNjcnLCAnRDgzRERDNjgnLCAnRDgzRERDNjknLCAnRDgzRERDNzEnLCAnRDgzRERDNkUnLCAnRDgzRERDNzInLCAnRDgzRERDNzMnLCAnRDgzRERDODInLCAnRDgzRERDNzQnLCAnRDgzRERDNzUnLCAnRDgzRERDNzYnLCAnRDgzRERDNzcnLCAnRDgzRERDNzgnLCAnRDgzRERDN0MnLCAnRDgzRERFNDcnLCAnRDgzRUREMzBEODNDREZGQicsICdEODNEREM4NScsICdEODNEREM4NCcsICdEODNEREM0NCcsICdEODNEREM4MycsICdEODNDREY4RScsICdEODNDREY4NScsICdEODNEREVCNicsICdEODNEREM3MTIwMEQyNjQwRkUwRicsICdEODNEREM2RTIwMEQyNjQwRkUwRicsICdEODNEREM3NzIwMEQyNjQwRkUwRicsICdEODNEREQ3NTIwMEQyNjQwRkUwRicsICdEODNEREU0NzIwMEQyNjQwRkUwRicsICdEODNEREU0QjIwMEQyNjQyRkUwRicsICdEODNEREU0QicsICdEODNEREM4MTIwMEQyNjQyRkUwRicsICdEODNEREM4MScsICdEODNEREU0NTIwMEQyNjQyRkUwRicsICdEODNEREU0NScsICdEODNEREU0NjIwMEQyNjQyRkUwRicsICdEODNEREU0NicsICdEODNEREU0RTIwMEQyNjQyRkUwRicsICdEODNEREU0RScsICdEODNEREM4NjIwMEQyNjQyRkUwRicsICdEODNEREM4NicsICdEODNEREM4NzIwMEQyNjQyRkUwRicsICdEODNEREM4NycsICdEODNFREQzN0Q4M0NERkZCMjAwRDI2NDJGRTBGJywgJ0Q4M0VERDM3RDgzQ0RGRkIyMDBEMjY0MEZFMEYnLCAnRDgzRUREMjZEODNDREZGQjIwMEQyNjQyRkUwRicsICdEODNFREQyNjIwMEQyNjQwRkUwRicsICdEODNEREU0RDIwMEQyNjQyRkUwRicsICdEODNEREVCNjIwMEQyNjQwRkUwRicsICdEODNFREQzM0Q4M0NERkZCJywgJ0Q4M0NERkMzMjAwRDI2NDBGRTBGJywgJ0Q4M0REQzZGMjAwRDI2NDJGRTBGJywgJ0Q4M0NERkNDMjAwRDI2NDBGRTBGJywgJ0Q4M0REQzMxJywgJ0Q4M0VERDIxJywgJ0Q4M0RERDdBJywgJ0Q4M0REQzczMjAwRDI2NDBGRTBGJywgJ0Q4M0REQzgyMjAwRDI2NDBGRTBGJywgJ0Q4M0VERDM1JywgJ0Q4M0VERDM0JywgJ0Q4M0VERDM5MjAwRDI2NDJGRTBGJywgJ0Q4M0VERDM5MjAwRDI2NDBGRTBGJywgJ0Q4M0REQzY4MjAwRDI2OTZGRTBGJywgJ0Q4M0REQzY5MjAwRDI2OTZGRTBGJywgJ0Q4M0REQzY4MjAwRDI3MDhGRTBGJywgJ0Q4M0REQzY5MjAwRDI3MDhGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERTkyRkUwRicsICdEODNEREM2OTIwMEREODNEREU5MkZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGQTRGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERkE0RkUwRicsICdEODNEREM2ODIwMEREODNDREY5M0ZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGOTNGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERkVCRkUwRicsICdEODNEREM2OTIwMEREODNDREZFQkZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGM0VGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERjNFRkUwRicsICdEODNEREM2ODIwMEREODNDREY3M0ZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGNzNGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERDI3RkUwRicsICdEODNEREM2OTIwMEREODNEREQyN0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGRURGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERkVERkUwRicsICdEODNEREM2ODIwMEREODNERENCQ0ZFMEYnLCAnRDgzRERDNjkyMDBERDgzRERDQkNGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERDJDRkUwRicsICdEODNEREM2OTIwMEREODNEREQyQ0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzRERDQkJGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0REQ0JCRkUwRicsICdEODNEREM2ODIwMEREODNDREZBOEZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGQThGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERTgwRkUwRicsICdEODNEREM2OTIwMEREODNEREU4MEZFMEYnLCAnRDgzRERDNjgyMDBEMjY5NUZFMEYnLCAnRDgzRERDNjkyMDBEMjY5NUZFMEYnXSwgNDogWydEODNDREY1MicsICdEODNDREY1MycsICdEODNDREY1NCcsICdEODNDREY1NScsICdEODNDREY1NicsICdEODNDREY1NycsICdEODNDREY1QScsICdEODNDREY1QicsICdEODNDREY1QycsICdEODNDREY1RCcsICdEODNDREY1RScsICdEODNDREY1RicsICdEODNDREY2MCcsICdEODNDREY2MScsICdEODNDREY2MicsICdEODNDREY2MycsICdEODNDREY2NCcsICdEODNDREY2NScsICdEODNDREY2NicsICdEODNDREY2NycsICdEODNDREY2OCcsICdEODNDREY2OScsICdEODNDREY2QScsICdEODNDREY2QicsICdEODNDREY2QycsICdEODNDREY2RCcsICdEODNDREY2RScsICdEODNDREY2RicsICdEODNDREY3MCcsICdEODNDREY3MScsICdEODNDREY3MicsICdEODNDREY3MycsICdEODNDREY3NCcsICdEODNDREY3NScsICdEODNDREY3NicsICdEODNDREY3NycsICdEODNDREY3OCcsICdEODNDREY3OScsICdEODNDREY3QScsICdEODNDREY3QicsICdEODNDREY3QycsICdEODNFREQ1OScsICdEODNFREQ1RCcsICdEODNFREQ1QycsICdEODNFREQ1OCcsICdEODNFREQ1NycsICdEODNFREQ1NicsICdEODNFREQ1MycsICdEODNFREQ1MCcsICdEODNFREQ0MicsICdEODNFREQ1MScsICdEODNFREQ0MycsICdEODNFREQ1NScsICdEODNFREQ1NCcsICdEODNFREQ1MicsICdEODNFREQ1RScsICdEODNFREQ1QScsICdEODNFREQ1QiddLCA1OiBbJzI2QkQnLCAnMjZCRScsICdEODNDREZBRicsICdEODNDREZCMScsICdEODNDREZCRCcsICdEODNDREZCRScsICdEODNDREZCRicsICdEODNDREZDMCcsICdEODNDREZDMScsICdEODNDREZDMicsICdEODNDREZDMycsICdEODNDREZDNCcsICdEODNDREZDNicsICdEODNDREZDNycsICdEODNDREZDOCcsICdEODNDREZDOScsICdEODNDREZDQScsICdEODNEREM1RicsICdEODNEREVBMycsICdEODNEREVCNCcsICdEODNEREVCNScsICcyNkYzJywgJzI2RUEnLCAnRDgzRUREM0REODNDREZGQjIwMEQyNjQyRkUwRicsICdEODNFREQzREQ4M0NERkZCMjAwRDI2NDBGRTBGJywgJ0Q4M0VERDNFRDgzQ0RGRkIyMDBEMjY0MkZFMEYnLCAnRDgzRUREM0MyMDBEMjY0MkZFMEYnLCAnRDgzRUREMzhEODNDREZGQjIwMEQyNjQyRkUwRicsICdEODNDREZDQjIwMEQyNjQwRkUwRicsICcyNkY5MjAwRDI2NDBGRTBGJywgJ0Q4M0NERkM0MjAwRDI2NDBGRTBGJywgJ0Q4M0NERkNBMjAwRDI2NDBGRTBGJywgJ0Q4M0RERUI1MjAwRDI2NDBGRTBGJywgJ0Q4M0RERUI0MjAwRDI2NDBGRTBGJywgJ0Q4M0VERDNBJywgJ0Q4M0RERUY0JywgJ0Q4M0RERUY2JywgJ0Q4M0VERDRBJywgJ0Q4M0VERDRCJywgJ0Q4M0VERDQ1JywgJ0Q4M0VERDQxJ10sIDY6IFsnRDgzRERFODUnLCAnRDgzRERFODYnLCAnRDgzRERFODcnLCAnRDgzRERFODgnLCAnRDgzRERFOEEnLCAnRDgzRERFOEMnLCAnRDgzRERFOEQnLCAnRDgzRERFOEUnLCAnRDgzRERFOEYnLCAnRDgzRERFOTAnLCAnRDgzRERFOTEnLCAnRDgzRERFOTInLCAnRDgzRERFOTMnLCAnRDgzRERFOTQnLCAnRDgzRERFOTUnLCAnRDgzRERFOTYnLCAnRDgzRERFOTcnLCAnRDgzRERFOTgnLCAnRDgzRERFOTknLCAnRDgzRERFOUEnLCAnRDgzRERFOUInLCAnRDgzRERFOUMnLCAnRDgzRERFOUQnLCAnRDgzRERFOUUnLCAnRDgzRERFOUYnLCAnRDgzRERFQTAnLCAnRDgzRERFQTEnLCAnRDgzRERFQTQnLCAnRDgzRERFQTcnLCAnRDgzRERFQTgnLCAnMjZGNScsICdEODNEREU4MCcsICdEODNEREU4MScsICdEODNEREU4MicsICdEODNEREU4MycsICdEODNEREU4NCcsICcyNkZEJywgJzI3MDgnLCAnRDgzRERFRjUnLCAnRDgzQ0RGREMnXSwgNzogWycyM0YwJywgJzIzRjMnLCAnMjYwRScsICcyNjE1JywgJzI2N0InLCAnMjZBMScsICcyNzAyJywgJzI3MDknLCAnMjcwRicsICcyNzEyJywgJ0Q4M0NEQzA0JywgJ0Q4M0NEQ0NGJywgJ0Q4M0NERjAyJywgJ0Q4M0NERjFGJywgJ0Q4M0NERjgwJywgJ0Q4M0NERjgxJywgJ0Q4M0NERjgyJywgJ0Q4M0NERjgzJywgJ0Q4M0NERjg0JywgJ0Q4M0NERjg4JywgJ0Q4M0NERjg5JywgJ0Q4M0NERjhBJywgJ0Q4M0NERjhCJywgJ0Q4M0NERjhDJywgJ0Q4M0NERjhEJywgJ0Q4M0NERjhGJywgJ0Q4M0NERjkwJywgJ0Q4M0NERjkyJywgJ0Q4M0NERjkzJywgJ0Q4M0NERkEzJywgJ0Q4M0NERkE0JywgJ0Q4M0NERkE3JywgJ0Q4M0NERkE4JywgJ0Q4M0NERkE5JywgJ0Q4M0NERkFBJywgJ0Q4M0NERkFCJywgJ0Q4M0NERkFDJywgJ0Q4M0NERkFEJywgJ0Q4M0NERkIwJywgJ0Q4M0NERkIyJywgJ0Q4M0NERkIzJywgJ0Q4M0NERkI0JywgJ0Q4M0NERkI3JywgJ0Q4M0NERkI4JywgJ0Q4M0NERkI5JywgJ0Q4M0NERkJBJywgJ0Q4M0NERkJCJywgJ0Q4M0REQzUxJywgJ0Q4M0REQzUyJywgJ0Q4M0REQzUzJywgJ0Q4M0REQzU0JywgJ0Q4M0REQzU1JywgJ0Q4M0REQzU2JywgJ0Q4M0REQzU3JywgJ0Q4M0REQzU4JywgJ0Q4M0REQzU5JywgJ0Q4M0REQzVBJywgJ0Q4M0REQzVCJywgJ0Q4M0REQzYwJywgJ0Q4M0REQzVDJywgJ0Q4M0REQzVEJywgJ0Q4M0REQzVFJywgJ0Q4M0REQzYxJywgJ0Q4M0REQzYyJywgJ0Q4M0REQzYzJywgJ0Q4M0REQzdFJywgJ0Q4M0REQzg4JywgJ0Q4M0REQzg5JywgJ0Q4M0REQzhBJywgJ0Q4M0REQzhDJywgJ0Q4M0REQzhEJywgJ0Q4M0REQzhFJywgJ0Q4M0REQzkwJywgJ0Q4M0REQzkyJywgJ0Q4M0REQ0ExJywgJ0Q4M0REQ0EzJywgJ0Q4M0REQ0E1JywgJ0Q4M0REQ0IwJywgJ0Q4M0REQ0IzJywgJ0Q4M0REQ0I0JywgJ0Q4M0REQ0I1JywgJ0Q4M0REQ0I2JywgJ0Q4M0REQ0I3JywgJ0Q4M0REQ0I4JywgJ0Q4M0REQ0JBJywgJ0Q4M0REQ0JCJywgJ0Q4M0REQ0JDJywgJ0Q4M0REQ0JEJywgJ0Q4M0REQ0JFJywgJ0Q4M0REQ0JGJywgJ0Q4M0REQ0M0JywgJ0Q4M0REQ0M1JywgJ0Q4M0REQ0M3JywgJ0Q4M0REQ0M4JywgJ0Q4M0REQ0M5JywgJ0Q4M0REQ0NBJywgJ0Q4M0REQ0NCJywgJ0Q4M0REQ0NDJywgJ0Q4M0REQ0NEJywgJ0Q4M0REQ0NFJywgJ0Q4M0REQ0QwJywgJ0Q4M0REQ0QxJywgJ0Q4M0REQ0QyJywgJ0Q4M0REQ0QzJywgJ0Q4M0REQ0Q0JywgJ0Q4M0REQ0Q1JywgJ0Q4M0REQ0Q2JywgJ0Q4M0REQ0Q3JywgJ0Q4M0REQ0Q4JywgJ0Q4M0REQ0Q5JywgJ0Q4M0REQ0RBJywgJ0Q4M0REQ0RDJywgJ0Q4M0REQ0REJywgJ0Q4M0REQ0RGJywgJ0Q4M0REQ0UwJywgJ0Q4M0REQ0UxJywgJ0Q4M0REQ0UyJywgJ0Q4M0REQ0U2JywgJ0Q4M0REQ0VEJywgJ0Q4M0REQ0VFJywgJ0Q4M0REQ0VGJywgJ0Q4M0REQ0YwJywgJ0Q4M0REQ0YxJywgJ0Q4M0REQ0Y3JywgJ0Q4M0REQ0Y5JywgJ0Q4M0REQ0ZBJywgJ0Q4M0REQ0ZCJywgJ0Q4M0REQ0ZDJywgJ0Q4M0RERDA2JywgJ0Q4M0RERDBFJywgJ0Q4M0RERDExJywgJ0Q4M0RERDE0JywgJ0Q4M0RERDE2JywgJ0Q4M0RERDI2JywgJ0Q4M0RERDI3JywgJ0Q4M0RERDI4JywgJ0Q4M0RERDI5JywgJ0Q4M0RERDJBJywgJ0Q4M0RERDJCJywgJ0Q4M0RERDJDJywgJ0Q4M0RERDJEJywgJ0Q4M0RERDJFJywgJ0Q4M0RERDMxJywgJ0Q4M0REREZGJywgJ0Q4M0RERUFBJywgJ0Q4M0RERUFDJywgJ0Q4M0RERUJEJywgJ0Q4M0RERUJGJywgJ0Q4M0RERUMwJywgJ0Q4M0VERDQ0JywgJ0Q4M0VERDQ3JywgJ0Q4M0VERDQ4JywgJ0Q4M0VERDQ5JywgJ0Q4M0RERUQyJ10sIDg6IFsnRDgzRERDOTMnLCAnRDgzRERDOTQnLCAnRDgzRERDOTUnLCAnRDgzRERDOTYnLCAnRDgzRERDOTcnLCAnRDgzRERDOTgnLCAnRDgzRERDOTknLCAnRDgzRERDOUEnLCAnRDgzRERDOUInLCAnRDgzRERDOUMnLCAnRDgzRERDOUQnLCAnRDgzRERDOUUnLCAnRDgzRERDOUYnLCAnRDgzRERDQUMnLCAnRDgzRERDQUQnLCAnRDgzREREMUUnLCAnMjZBMCcsICcyNkQ0JywgJ0Q4M0REQzI5JywgJ0Q4M0NERDk4JywgJ0Q4M0NERjFBJywgJ0Q4M0REREE0JywgJ0Q4M0REQ0E4JywgJ0Q4M0RERDI1JywgJzI2MDAnLCAnMjYwMScsICcyNkM0JywgJzI2QzUnLCAnMjcyOCcsICdEODNDREYwRCcsICdEODNDREYxQicsICdEODNDREYxRCcsICdEODNDREYxRScsICcyNjA0JywgJ0Q4M0NERjA4JywgJ0Q4M0NERjE2JywgJzI2OTUnXSwgOTogWydEODNDRERFOEQ4M0NEREYzJywgJ0Q4M0NEREU5RDgzQ0RERUEnLCAnRDgzQ0RERUFEODNDRERGOCcsICdEODNDRERFQkQ4M0NEREY3JywgJ0Q4M0NEREVDRDgzQ0RERTcnLCAnRDgzQ0RERUVEODNDRERGOScsICdEODNDRERFRkQ4M0NEREY1JywgJ0Q4M0NEREYwRDgzQ0RERjcnLCAnRDgzQ0RERjdEODNDRERGQScsICdEODNDRERGQUQ4M0NEREY4JywgJ0Q4M0NEREZBRDgzQ0RERTYnLCAnRDgzQ0RERjBEODNDRERGRicsICdEODNDRERFN0Q4M0NEREZFJywgJ0Q4M0NEREU2RDgzQ0RERkEnLCAnRDgzQ0RERTZEODNDRERGOScsICdEODNDRERFN0Q4M0NEREVBJywgJ0Q4M0NEREU3RDgzQ0RERjcnLCAnRDgzQ0RERkJEODNDRERGMycsICdEODNDRERFREQ4M0NEREYwJywgJ0Q4M0NEREU5RDgzQ0RERjAnLCAnRDgzQ0RERUVEODNDRERGMScsICdEODNDRERFRUQ4M0NEREYzJywgJ0Q4M0NEREVFRDgzQ0RERTknLCAnRDgzQ0RERUVEODNDRERFQScsICdEODNDRERFOEQ4M0NEREU2JywgJ0Q4M0NEREU4RDgzQ0RERjQnLCAnRDgzQ0RERjJEODNDRERGNCcsICdEODNDRERGMkQ4M0NEREZFJywgJ0Q4M0NEREYyRDgzQ0RERkQnLCAnRDgzQ0RERjNEODNDRERGMScsICdEODNDRERGM0Q4M0NEREZGJywgJ0Q4M0NEREYzRDgzQ0RERjQnLCAnRDgzQ0RERTZEODNDRERFQScsICdEODNDRERGNUQ4M0NEREYxJywgJ0Q4M0NEREY1RDgzQ0RERjknLCAnRDgzQ0RERjVEODNDRERGNycsICdEODNDRERGOEQ4M0NEREU2JywgJ0Q4M0NEREY4RDgzQ0RERUMnLCAnRDgzQ0RERjlEODNDRERGNycsICdEODNDRERGNUQ4M0NEREVEJywgJ0Q4M0NEREVCRDgzQ0RERUUnLCAnRDgzQ0RERThEODNDRERGMScsICdEODNDRERFOEQ4M0NEREVEJywgJ0Q4M0NEREY4RDgzQ0RERUEnLCAnRDgzQ0RERkZEODNDRERFNicsICdEODNDREZGMzIwMEREODNDREYwOEZFMEYnXX0sCmN1ckVtb2ppUmVjZW50OiB7fSwKZW1vamlXaXRoSm9pbmVyczogWyJEODNEREM3MTIwMEQyNjQwRkUwRiIsIkQ4M0REQzZFMjAwRDI2NDBGRTBGIiwiRDgzRERDNzcyMDBEMjY0MEZFMEYiLCJEODNEREQ3NTIwMEQyNjQwRkUwRiIsIkQ4M0RERTQ3MjAwRDI2NDBGRTBGIiwiRDgzRERDODEyMDBEMjY0MkZFMEYiLCJEODNEREU0NTIwMEQyNjQyRkUwRiIsIkQ4M0RERTQ2MjAwRDI2NDJGRTBGIiwiRDgzRERFNEUyMDBEMjY0MkZFMEYiLCJEODNEREU0RDIwMEQyNjQyRkUwRiIsIkQ4M0REQzg2MjAwRDI2NDJGRTBGIiwiRDgzRERDODcyMDBEMjY0MkZFMEYiLCJEODNEREVCNjIwMEQyNjQwRkUwRiIsIkQ4M0NERkMzMjAwRDI2NDBGRTBGIiwiRDgzQ0RGQ0IyMDBEMjY0MEZFMEYiLCIyNkY5MjAwRDI2NDBGRTBGIiwiRDgzQ0RGQzQyMDBEMjY0MEZFMEYiLCJEODNDREZDQTIwMEQyNjQwRkUwRiIsIkQ4M0RERUI1MjAwRDI2NDBGRTBGIiwiRDgzRERFQjQyMDBEMjY0MEZFMEYiLCJEODNEREM2RjIwMEQyNjQyRkUwRiIsIkQ4M0NERkNDMjAwRDI2NDBGRTBGIiwiRDgzRERFNEIyMDBEMjY0MkZFMEYiLCJEODNEREM3MzIwMEQyNjQwRkUwRiIsIkQ4M0REQzgyMjAwRDI2NDBGRTBGIiwiRDgzQ0RGRjMyMDBERDgzQ0RGMDhGRTBGIiwiRDgzRUREMjZEODNDREZGQjIwMEQyNjQyRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkIyMDBEMjY0MEZFMEYiLCJEODNFREQzN0Q4M0NERkZCMjAwRDI2NDJGRTBGIiwiRDgzRUREM0REODNDREZGQjIwMEQyNjQyRkUwRiIsIkQ4M0VERDNERDgzQ0RGRkIyMDBEMjY0MEZFMEYiLCJEODNFREQzRUQ4M0NERkZCMjAwRDI2NDJGRTBGIiwiRDgzRUREM0MyMDBEMjY0MkZFMEYiLCJEODNFREQzOEQ4M0NERkZCMjAwRDI2NDJGRTBGIiwiRDgzRUREMzcyMDBEMjY0MkZFMEYiLCJEODNFREQzN0Q4M0NERkZDMjAwRDI2NDJGRTBGIiwiRDgzRUREMzdEODNDREZGRDIwMEQyNjQyRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkUyMDBEMjY0MkZFMEYiLCJEODNFREQzN0Q4M0NERkZGMjAwRDI2NDJGRTBGIiwiRDgzRUREMjYyMDBEMjY0MkZFMEYiLCJEODNFREQyNkQ4M0NERkZDMjAwRDI2NDJGRTBGIiwiRDgzRUREMjZEODNDREZGRDIwMEQyNjQyRkUwRiIsIkQ4M0VERDI2RDgzQ0RGRkUyMDBEMjY0MkZFMEYiLCJEODNFREQyNkQ4M0NERkZGMjAwRDI2NDJGRTBGIiwiRDgzRUREMzcyMDBEMjY0MEZFMEYiLCJEODNFREQzN0Q4M0NERkZDMjAwRDI2NDBGRTBGIiwiRDgzRUREMzdEODNDREZGRDIwMEQyNjQwRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkUyMDBEMjY0MEZFMEYiLCJEODNFREQzN0Q4M0NERkZGMjAwRDI2NDBGRTBGIiwiRDgzRUREM0QyMDBEMjY0MkZFMEYiLCJEODNFREQzREQ4M0NERkZDMjAwRDI2NDJGRTBGIiwiRDgzRUREM0REODNDREZGRDIwMEQyNjQyRkUwRiIsIkQ4M0VERDNERDgzQ0RGRkUyMDBEMjY0MkZFMEYiLCJEODNFREQzREQ4M0NERkZGMjAwRDI2NDJGRTBGIiwiRDgzRUREM0QyMDBEMjY0MEZFMEYiLCJEODNFREQzREQ4M0NERkZDMjAwRDI2NDBGRTBGIiwiRDgzRUREM0REODNDREZGRDIwMEQyNjQwRkUwRiIsIkQ4M0VERDNERDgzQ0RGRkUyMDBEMjY0MEZFMEYiLCJEODNFREQzREQ4M0NERkZGMjAwRDI2NDBGRTBGIiwiRDgzRUREM0UyMDBEMjY0MkZFMEYiLCJEODNFREQzRUQ4M0NERkZDMjAwRDI2NDJGRTBGIiwiRDgzRUREM0VEODNDREZGRDIwMEQyNjQyRkUwRiIsIkQ4M0VERDNFRDgzQ0RGRkUyMDBEMjY0MkZFMEYiLCJEODNFREQzRUQ4M0NERkZGMjAwRDI2NDJGRTBGIiwiRDgzRUREMzgyMDBEMjY0MkZFMEYiLCJEODNFREQzOEQ4M0NERkZDMjAwRDI2NDJGRTBGIiwiRDgzRUREMzhEODNDREZGRDIwMEQyNjQyRkUwRiIsIkQ4M0VERDM4RDgzQ0RGRkUyMDBEMjY0MkZFMEYiLCJEODNFREQzOEQ4M0NERkZGMjAwRDI2NDJGRTBGIiwiRDgzRUREMTlEODNDREZGQiIsIkQ4M0VERDE5RDgzQ0RGRkMiLCJEODNFREQxOUQ4M0NERkZEIiwiRDgzRUREMTlEODNDREZGRSIsIkQ4M0VERDE5RDgzQ0RGRkYiLCJEODNFREQxQkQ4M0NERkZCIiwiRDgzRUREMUJEODNDREZGQyIsIkQ4M0VERDFCRDgzQ0RGRkQiLCJEODNFREQxQkQ4M0NERkZFIiwiRDgzRUREMUJEODNDREZGRiIsIkQ4M0VERDFDRDgzQ0RGRkIiLCJEODNFREQxQ0Q4M0NERkZDIiwiRDgzRUREMUNEODNDREZGRCIsIkQ4M0VERDFDRDgzQ0RGRkUiLCJEODNFREQxQ0Q4M0NERkZGIiwgJ0Q4M0VERDI2MjAwRDI2NDBGRTBGJywgJ0Q4M0VERDM5MjAwRDI2NDJGRTBGJywgJ0Q4M0VERDM5MjAwRDI2NDBGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERTkyRkUwRicsICdEODNEREM2OTIwMEREODNEREU5MkZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGQTRGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERkE0RkUwRicsICdEODNEREM2ODIwMEQyNjk1RkUwRicsICdEODNEREM2OTIwMEQyNjk1RkUwRicsICdEODNEREM2ODIwMEREODNDREY5M0ZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGOTNGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERkVCRkUwRicsICdEODNEREM2OTIwMEREODNDREZFQkZFMEYnLCAnRDgzRERDNjgyMDBEMjY5NkZFMEYnLCAnRDgzRERDNjkyMDBEMjY5NkZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGM0VGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERjNFRkUwRicsICdEODNEREM2ODIwMEREODNDREY3M0ZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGNzNGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERDI3RkUwRicsICdEODNEREM2OTIwMEREODNEREQyN0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGRURGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERkVERkUwRicsICdEODNEREM2ODIwMEREODNERENCQ0ZFMEYnLCAnRDgzRERDNjkyMDBERDgzRERDQkNGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERDJDRkUwRicsICdEODNEREM2OTIwMEREODNEREQyQ0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzRERDQkJGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0REQ0JCRkUwRicsICdEODNEREM2ODIwMEREODNDREZBOEZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGQThGRTBGJywgJ0Q4M0REQzY4MjAwRDI3MDhGRTBGJywgJ0Q4M0REQzY5MjAwRDI3MDhGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0RERTgwRkUwRicsICdEODNEREM2OTIwMEREODNEREU4MEZFMEYnXSwKZW1vamlMb2FkTW9yZTogZnVuY3Rpb24ob3B0SWQpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGlmIChvcHRzLmVtb2ppTW9yZVN0KSB7CiAgICByZXR1cm47CiAgfQogIG9wdHMuZW1vamlNb3JlU3QgPSAxOwoKICB2YXIgcGFyYW1zID0ge2FjdDogJ2dldF9lbW9qaV9saXN0J307CiAgaWYgKEVtb2ppLmhhc05ld1N0aWNrZXJzIDwgMCkgcGFyYW1zLm5ld19zaG93biA9IDE7CiAgYWpheC5wb3N0KCdhbF9pbS5waHAnLCBwYXJhbXMsIHsKICAgIG9uRG9uZTogZnVuY3Rpb24oc3RpY2tlcnMsIHJlY2VudF9lbW9qaSkgewogICAgICBFbW9qaS5zdGlja2VycyA9IHN0aWNrZXJzOwogICAgICBvcHRzLmVtb2ppTW9yZVN0ID0gMDsKCiAgICAgIGlmIChFbW9qaS5zdGlja2Vyc1stMV0pIHsKICAgICAgICBscy5zZXQoJ3JlY2VudF9zdGlja2VycycsIEVtb2ppLnN0aWNrZXJzWy0xXSk7CiAgICAgICAgRW1vamkudXBkYXRlUmVjZW50RW1vamkob3B0SWQpOwogICAgICB9CiAgICAgIG9wdHMuYWxsRW1vamlJZCA9IDA7CiAgICAgIGlmIChvcHRzLnNoYXJlZFRUKSB7CiAgICAgICAgb3B0cy5zaGFyZWRUVC5lbW9qaUFsbElkID0gMDsKICAgICAgfQoKICAgICAgaWYgKEVtb2ppLm9uU3RpY2tlcnNMb2FkKSB7CiAgICAgICAgb3B0cy5hZnRlckxvYWQgPSAxOwogICAgICB9CgogICAgICBpZiAoRW1vamkub25TdGlja2Vyc0xvYWQgJiYgd2luZG93LmVtb2ppU3RpY2tlcnMpIHsKICAgICAgICBFbW9qaS5vblN0aWNrZXJzTG9hZCgpOwogICAgICAgIEVtb2ppLm9uU3RpY2tlcnNMb2FkID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIHZhciBlbW9qaUxpc3QgPSBFbW9qaS5lbW9qaUdldFJlY2VudEZyb21TdG9yYWdlKCk7CiAgICAgIGlmICghZW1vamlMaXN0KSB7CiAgICAgICAgRW1vamkuZW1vamlPbGRSZWNlbnRQcmVwYXJlKHJlY2VudF9lbW9qaSwgb3B0SWQpOwogICAgICAgIEVtb2ppLnVwZGF0ZUVtb2ppQ29udChvcHRJZCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgRW1vamkuY3VyRW1vamlSZWNlbnQgPSBFbW9qaS5maWx0ZXJFbW9qaShlbW9qaUxpc3QpOwogICAgICB9CiAgICAgIEVtb2ppLnVwZGF0ZVJlY2VudEVtb2ppKG9wdElkKTsKICAgICAgb3B0cy5vblJlY2VudEVtb2ppVXBkYXRlICYmIG9wdHMub25SZWNlbnRFbW9qaVVwZGF0ZSgpOwogICAgfSwKICAgIG9uRmFpbDogZnVuY3Rpb24gKCkgewogICAgICBvcHRzLmVtb2ppTW9yZVN0ID0gMDsKICAgIH0KICB9KQoKICBpZiAoRW1vamkuY3VyRW1vamlSZWNlbnQpIHsKICAgIG9wdHMub25SZWNlbnRFbW9qaVVwZGF0ZSAmJiBvcHRzLm9uUmVjZW50RW1vamlVcGRhdGUoKTsKICB9Cn0sCgpmaWx0ZXJFbW9qaTogZnVuY3Rpb24gKGVtb2ppX2xpc3QpIHsKICB2YXIgbm9DaGVja2VkID0gT2JqZWN0LmtleXMoZW1vamlfbGlzdCk7CgogIGNoZWNraW5nOgogIGZvcih2YXIgaSBpbiBFbW9qaS5jdXJFbW9qaUNhdHMpIHsKICAgIGZvcih2YXIgaiBpbiBFbW9qaS5jdXJFbW9qaUNhdHNbaV0pIHsKICAgICAgdmFyIGNvZGUgPSBFbW9qaS5jdXJFbW9qaUNhdHNbaV1bal0sIHBvcyA9IG5vQ2hlY2tlZC5pbmRleE9mKGNvZGUpOwogICAgICBpZiAocG9zICE9IC0xKSB7CiAgICAgICAgbm9DaGVja2VkLnNwbGljZShwb3MsIDEpOwogICAgICAgIGlmIChub0NoZWNrZWQubGVuZ3RoID09IDApIHsKICAgICAgICAgIGJyZWFrIGNoZWNraW5nOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KCiAgdmFyIHJlc3VsdCA9IHt9OwogIGZvcih2YXIgaSBpbiBlbW9qaV9saXN0KSB7CiAgICBpZiAobm9DaGVja2VkLmluZGV4T2YoaSkgPT0gLTEpIHsKICAgICAgcmVzdWx0W2ldID0gZW1vamlfbGlzdFtpXTsKICAgIH0KICB9CgogIGlmIChub0NoZWNrZWQubGVuZ3RoID4gMCkgewogICAgRW1vamkuc2V0UmVjZW50RW1vamlMaXN0KHJlc3VsdCk7CiAgfQoKICByZXR1cm4gcmVzdWx0Owp9LAoKZW1vamlHZXRSZWNlbnRGcm9tU3RvcmFnZTogZnVuY3Rpb24gKCkgewogIHRyeSB7CiAgICByZXR1cm4gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnZW1vamlfcmVjZW50X2xpc3QnKSk7CiAgfSBjYXRjaChlKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9LAoKZW1vamlPbGRSZWNlbnRQcmVwYXJlOiBmdW5jdGlvbiAocmVjZW50X2Vtb2ppKSB7CiAgdmFyIGVtb2ppX2xpc3QgPSB7fTsKICBmb3IodmFyIGkgaW4gcmVjZW50X2Vtb2ppKSB7CiAgICB2YXIgaXRlbSA9IHJlY2VudF9lbW9qaVtpXTsKICAgIGlmIChpc1N0cmluZyhpdGVtKSkgewogICAgICB2YXIgcmF0ZSA9IDEsIGNvZGUgPSBpdGVtOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHJhdGUgPSBpdGVtLCBjb2RlID0gaTsKICAgIH0KICAgIGVtb2ppX2xpc3RbY29kZV0gPSByYXRlOwogIH0KICBFbW9qaS5zZXRSZWNlbnRFbW9qaUxpc3QoRW1vamkuZmlsdGVyRW1vamkoZW1vamlfbGlzdCkpOwp9LAoKZ2V0UmVjZW50RW1vamlTb3J0ZWQ6IGZ1bmN0aW9uICgpIHsKICB2YXIgcmVjZW50ID0gW107CiAgZm9yKHZhciBpIGluIEVtb2ppLmN1ckVtb2ppUmVjZW50KSB7CiAgICB2YXIgaXRlbSA9IEVtb2ppLmN1ckVtb2ppUmVjZW50W2ldOwogICAgcmVjZW50LnB1c2goW2ksIGl0ZW1dKTsKICB9CiAgcmVjZW50LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgIHJldHVybiBiWzFdIC0gYVsxXTsKICB9KTsKCiAgdmFyIHJlcyA9IFtdOwogIGZvcih2YXIgaSBpbiByZWNlbnQpIHsKICAgIHJlcy5wdXNoKHJlY2VudFtpXVswXSk7CiAgfQogIHJldHVybiByZXMuc2xpY2UoMCwgMjApOwp9LAoKaW5jclJlY2VudEVtb2ppUmF0ZTogZnVuY3Rpb24gKG9wdElkLCBjb2RlKSB7CiAgdmFyIHJhdGVJbnRlcnZhbCA9IDY7CiAgaWYgKCFFbW9qaS5lbW9qaVJlY2VudFJhdGVUaW1lKSB7CiAgICBFbW9qaS5lbW9qaVJlY2VudFJhdGVUaW1lID0gdmtOb3coKSAvIDEwMDAgLSByYXRlSW50ZXJ2YWw7CiAgfQogIHZhciB0aW1lRGlmZiA9IHZrTm93KCkgLyAxMDAwIC0gRW1vamkuZW1vamlSZWNlbnRSYXRlVGltZTsKCiAgaWYgKHRpbWVEaWZmID49IHJhdGVJbnRlcnZhbCkgewogICAgdmFyIHBvd2VyID0gTWF0aC5taW4oMTAwLCBNYXRoLmZsb29yKHRpbWVEaWZmIC8gcmF0ZUludGVydmFsKSk7CiAgICBmb3IodmFyIGkgaW4gRW1vamkuY3VyRW1vamlSZWNlbnQpIHsKICAgICAgaWYgKGkgPT0gY29kZSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIEVtb2ppLmN1ckVtb2ppUmVjZW50W2ldICo9IE1hdGgucG93KDAuOTk4MDc2LCBwb3dlcik7CiAgICB9CgogICAgRW1vamkuZW1vamlSZWNlbnRSYXRlVGltZSArPSByYXRlSW50ZXJ2YWwgKiBwb3dlcjsKICB9CiAgaWYgKCFFbW9qaS5jdXJFbW9qaVJlY2VudFtjb2RlXSkgewogICAgRW1vamkuY3VyRW1vamlSZWNlbnRbY29kZV0gPSAwOwogIH0KICBFbW9qaS5jdXJFbW9qaVJlY2VudFtjb2RlXSArPSAxOwoKICB2YXIgY29kZXMgPSBFbW9qaS5nZXRSZWNlbnRFbW9qaVNvcnRlZCgpOwogIEVtb2ppLmN1ckVtb2ppQ2F0c1stMV0gPSBjb2RlczsKCiAgaWYgKGNvZGVzLmxlbmd0aCA+PSAyMCAmJiBjb2Rlcy5pbmRleE9mKGNvZGUpID09IC0xKSB7CiAgICBjb2Rlcy5zcGxpY2UoLTEpOwogICAgY29kZXMucHVzaChjb2RlKTsKICB9CgogIHZhciByZXMgPSB7fTsKICBmb3IodmFyIGkgaW4gY29kZXMpIHsKICAgIHZhciBjb2RlID0gY29kZXNbaV07CiAgICByZXNbY29kZV0gPSBFbW9qaS5jdXJFbW9qaVJlY2VudFtjb2RlXTsKICB9CgogIEVtb2ppLnNldFJlY2VudEVtb2ppTGlzdChyZXMpOwogIHdpbmRvdy5Ob3RpZmllciAmJiBOb3RpZmllci5sY1NlbmQoJ3JlY2VudF9lbW9qaV9zZXQnLCByZXMpOwp9LAoKc2V0UmVjZW50RW1vamlMaXN0OiBmdW5jdGlvbiAobGlzdCkgewogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdlbW9qaV9yZWNlbnRfbGlzdCcsIEpTT04uc3RyaW5naWZ5KGxpc3QpKTsKICBFbW9qaS5jdXJFbW9qaVJlY2VudCA9IGxpc3Q7Cn0sCgp1cGRhdGVFbW9qaUNvbnQ6IGZ1bmN0aW9uIChvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CgogIGlmIChvcHRzLmN1clRhYiA9PSAwKSB7CiAgICB2YWwoZ2VCeUNsYXNzMSgnZW1vamlfc2Nyb2xsX3NtaWxlcycsIG9wdHMudHQpLCBFbW9qaS5nZXRJbml0RW1vamlDb250ZW50KG9wdElkKSk7CiAgICBFbW9qaS51cGRhdGVFbW9qaUNhdFRpdGxlKG9wdElkKTsKICB9Cn0sCgp0dEVtb2ppTGlzdDogZnVuY3Rpb24ob3B0SWQsIGNhdGVnb3J5SWRzKSB7CiAgdmFyIHJlcyA9ICcnOwoKICB2YXIgZW1vamlMaXN0ID0gRW1vamkuZW1vamlHZXRSZWNlbnRGcm9tU3RvcmFnZSgpOwogIGlmIChlbW9qaUxpc3QpIHsKICAgIEVtb2ppLnNldFJlY2VudEVtb2ppTGlzdChlbW9qaUxpc3QpOwogIH0KCiAgRW1vamkuY3VyRW1vamlDYXRzWy0xXSA9IEVtb2ppLmdldFJlY2VudEVtb2ppU29ydGVkKCk7CgogIHZhciBzb3J0ZWRDYXRzID0gY2F0ZWdvcnlJZHMgPyBjYXRlZ29yeUlkczogRW1vamkuU09SVEVEX0VNT0pJX0NBVEVHT1JJRVM7CgogIGZvcih2YXIgaSBpbiBzb3J0ZWRDYXRzKSB7CiAgICB2YXIgY2F0SWQgPSBzb3J0ZWRDYXRzW2ldOwogICAgcmVzICs9IEVtb2ppLmdldEVtb2ppQ2F0ZWdvcnlIdG1sKG9wdElkLCBjYXRJZCk7CiAgfQogIHJldHVybiByZXM7Cn0sCgpnZXRJbml0RW1vamlDb250ZW50OiBmdW5jdGlvbiAob3B0SWQpIHsKICBFbW9qaS5zZXRFbW9qaUxhc3RBZGRlZENhdGVnb3J5SWR4KG9wdElkLCAxKTsKICB2YXIgcmVjZW50QW5kRW1vdGlvbnMgPSBbLTEsIDFdOwogIHJldHVybiBFbW9qaS50dEVtb2ppTGlzdChvcHRJZCwgcmVjZW50QW5kRW1vdGlvbnMpOwp9LAoKZ2V0RW1vamlDYXRlZ29yeUh0bWw6IGZ1bmN0aW9uIChvcHRJZCwgY2F0ZWdvcnlJZCkgewogIHZhciBjYXRzID0gRW1vamkuY3VyRW1vamlDYXRzLCByZXMgPSAnJzsKICB2YXIgY2F0ID0gY2F0c1tjYXRlZ29yeUlkXTsKICBpZiAoIWNhdC5sZW5ndGgpIHsKICAgIHJldHVybiByZXM7CiAgfQoKICB2YXIgbG5nU3ViID0gY2F0ZWdvcnlJZCA9PSAtMSA/ICdyZWNlbnQnIDogY2F0ZWdvcnlJZDsKICB2YXIgY29udCA9ICc8ZGl2IGNsYXNzPSJlbW9qaV9jYXRfdGl0bGVfaGVscGVyIiBkYXRhLWlkPSInICsgY2F0ZWdvcnlJZCArICciIGlkPSJlbW9qaV9yZWNlbnRfbGlzdCcgKyBvcHRJZCArICdfJyArIGNhdGVnb3J5SWQgKyAnIj48ZGl2IGNsYXNzPSJlbW9qaV9jYXRfdGl0bGUiPicgKyBnZXRMYW5nKCdnbG9iYWxfZW1vamlfY2F0XycgKyBsbmdTdWIpICsgJzwvZGl2PjwvZGl2Pic7CiAgY29udCArPSBFbW9qaS5lbW9qaUdldENhdENvbnQob3B0SWQsIGNhdCk7CiAgcmVzICs9IGNvbnQ7CgogIHJldHVybiByZXM7Cn0sCgpnZXRFbW9qaUxhc3RBZGRlZENhdGVnb3J5SWR4OiBmdW5jdGlvbihvcHRJZCl7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICByZXR1cm4gb3B0cy5sYXN0TG9hZGVkRW1vamlDYXRlZ29yaWVzSWR4ZXNbb3B0SWRdOwp9LAoKc2V0RW1vamlMYXN0QWRkZWRDYXRlZ29yeUlkeDogZnVuY3Rpb24ob3B0SWQsIGlkeCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgb3B0cy5sYXN0TG9hZGVkRW1vamlDYXRlZ29yaWVzSWR4ZXNbb3B0SWRdID0gaWR4Owp9LAoKYWRkTmV4dEVtb2ppQ2F0ZWdvdHk6IGZ1bmN0aW9uIChvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF0sCiAgICB0dCA9IG9wdHMudHQsCiAgICBsYXN0TG9hZGVkQ2F0ZWdvcnlJZHggPSBFbW9qaS5nZXRFbW9qaUxhc3RBZGRlZENhdGVnb3J5SWR4KG9wdElkKTsKCiAgaWYgKG9wdHMuZW1vamlDYXRlZ29yeUFkZGluZyB8fCBvcHRzLmFsbEVtb2ppTG9hZGVkKSB7CiAgICByZXR1cm47CiAgfQoKICBvcHRzLmVtb2ppQ2F0ZWdvcnlBZGRpbmcgPSB0cnVlOwoKICBpZiAoIWxhc3RMb2FkZWRDYXRlZ29yeUlkeCkgewogICAgZGVidWdMb2coJ05vIGVtb2ppIGxhc3QgY2F0ZWdvcnkgaWR4Jyk7CiAgICByZXR1cm47CiAgfQogIHZhciBlbW9qaVdyYXAgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc21pbGVzJywgdHQpOwogIGxhc3RMb2FkZWRDYXRlZ29yeUlkeCsrOwogIGlmIChFbW9qaS5TT1JURURfRU1PSklfQ0FURUdPUklFUy5sZW5ndGggPiBsYXN0TG9hZGVkQ2F0ZWdvcnlJZHgpIHsKICAgIHZhciBjYXRlZ29yeUlkID0gRW1vamkuU09SVEVEX0VNT0pJX0NBVEVHT1JJRVNbbGFzdExvYWRlZENhdGVnb3J5SWR4XTsKICAgIGVtb2ppV3JhcC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZUVuZCcsIEVtb2ppLmdldEVtb2ppQ2F0ZWdvcnlIdG1sKG9wdElkLCBjYXRlZ29yeUlkKSk7CiAgICBFbW9qaS5zZXRFbW9qaUxhc3RBZGRlZENhdGVnb3J5SWR4KG9wdElkLCBsYXN0TG9hZGVkQ2F0ZWdvcnlJZHgpOwogICAgb3B0cy5lbW9qaVNjcm9sbC51cGRhdGUoKTsgLy8gbmVlZCBpZiByZXNpemUgc2Vuc29yIG5vdCB3YXMgaGFuZGxlZCByZXNpemUuCiAgfSBlbHNlIHsKICAgIG9wdHMuYWxsRW1vamlMb2FkZWQgPSB0cnVlOwogIH0KICBvcHRzLmVtb2ppQ2F0ZWdvcnlBZGRpbmcgPSBmYWxzZTsKfSwKCmhpZGVUdDogZnVuY3Rpb24gKHR0KSB7CiAgcmVtb3ZlQ2xhc3ModHQsIEVtb2ppLlNIT1dOX1RUX0NMUyk7Cn0sCgpzaG93VHQ6IGZ1bmN0aW9uKHR0KXsKICBhZGRDbGFzcyh0dCwgRW1vamkuU0hPV05fVFRfQ0xTKTsKfSwKCmVtb2ppR2V0Q2F0Q29udDogZnVuY3Rpb24gKG9wdElkLCBjYXQpIHsKICB2YXIgcmVzID0gJycsIHJvdyA9ICcnLCB0b3RhbCA9IGNhdC5sZW5ndGggLSAxOwogIGZvcih2YXIgaiA9IDA7IGogPD0gdG90YWw7IGorKykgewogICAgcm93ICs9IEVtb2ppLmVtb2ppV3JhcEl0ZW0ob3B0SWQsIGNhdFtqXSwgaik7CiAgICBpZiAoaiA+IDAgJiYgaiAlIDEwID09IDkgfHwgaiA+PSB0b3RhbCkgewogICAgICByZXMgKz0gJzxkaXYgY2xhc3M9ImVtb2ppX3NtaWxlc19yb3ciPicgKyByb3cgKyAnPC9kaXY+JzsKICAgICAgcm93ID0gJyc7CiAgICB9CiAgfQogIHJldHVybiByZXM7Cn0sCgp1cGRhdGVSZWNlbnRFbW9qaTogZnVuY3Rpb24gKG9wdElkKSB7CiAgdmFyIGVtb2ppTGlzdCA9IEVtb2ppLmdldFJlY2VudEVtb2ppU29ydGVkKCksCiAgICByZWNlbnRfZWxzID0gRW1vamkuZW1vamlHZXRDYXRDb250KG9wdElkLCBlbW9qaUxpc3QpOwoKICB2YXIgdGl0bGVFbCA9IGdlKCdlbW9qaV9yZWNlbnRfbGlzdCcgKyBvcHRJZCArICdfLTEnKTsKICBpZiAoIXRpdGxlRWwpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBlbCA9IHRpdGxlRWwubmV4dFNpYmxpbmc7CiAgd2hpbGUoZWwpIHsKICAgIGVsID0gZWwubmV4dFNpYmxpbmc7CiAgICBpZiAoaGFzQ2xhc3MoZWwucHJldmlvdXNTaWJsaW5nLCAnZW1vamlfc21pbGVzX3JvdycpKSB7CiAgICAgIHJlKGVsLnByZXZpb3VzU2libGluZyk7CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CgogIHZhciByb3dzICA9IGNlKCdkaXYnLCB7CiAgICBpbm5lckhUTUw6IHJlY2VudF9lbHMKICB9KSwgbmV4dFRpdGxlID0gdGl0bGVFbC5uZXh0U2libGluZywgcGFyZW50ID0gdGl0bGVFbC5wYXJlbnROb2RlOwogIHdoaWxlKGVsID0gcm93cy5maXJzdENoaWxkKSB7CiAgICBwYXJlbnQuaW5zZXJ0QmVmb3JlKGVsLCBuZXh0VGl0bGUpOwogIH0KfSwKCnVwZGF0ZVJlY2VudFN0aWNrZXJzOiBmdW5jdGlvbiAob3B0SWQpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGlmICghRW1vamkuc3RpY2tlcnNbLTFdIHx8ICFvcHRzIHx8ICFvcHRzLmVtb2ppRXhwYW5kZWQpIHsKICAgIHJldHVybjsKICB9CiAgdmFyIHJlY2VudFdyYXAgPSBnZSgnZW1vamlfcmVjZW50X3N0aWNrZXJzX2NvbnQnICsgb3B0SWQpOwogIGlmICghcmVjZW50V3JhcCkgewogICAgcmV0dXJuOwogIH0KICB2YWwocmVjZW50V3JhcCwgJycpOwoKICB2YXIgc3RpY2tlclNpemUgPSAod2luZG93LmRldmljZVBpeGVsUmF0aW8gPj0gMikgPyAnMTI4JyA6ICc2NCc7CiAgdmFyIHN0aWNrZXJzID0gRW1vamkuc3RpY2tlcnNbLTFdLnN0aWNrZXJzOwogIGZvcih2YXIgaSA9IDA7IGkgPCBzdGlja2Vycy5sZW5ndGg7IGkrKykgewogICAgdmFyIHN0aWNrZXJFbCA9IHNlKHJzKEVtb2ppLnN0aWNrZXJJdGVtKCksIHsKICAgICAgb3B0SWQ6IG9wdElkLAogICAgICBzZWxJZDogRW1vamkuVEFCX1JFQ0VOVF9TVElDS0VSUywKICAgICAgc3RpY2tlcklkOiBzdGlja2Vyc1tpXVswXSwKICAgICAgc2l6ZTogc3RpY2tlcnNbaV1bMV0sCiAgICAgIHN0aWNrZXJTaXplOiBzdGlja2VyU2l6ZQogICAgfSkpOwogICAgcmVjZW50V3JhcC5hcHBlbmRDaGlsZChzdGlja2VyRWwpOwogICAgdmFyIHRvcCA9IE1hdGguY2VpbCgoaSArMSkgLyA0KSAqIDY4OwogICAgb3B0cy5uZWVkTG9hZFN0aWNrZXJzLnVuc2hpZnQoW29wdElkICsgJ18nICsgRW1vamkuVEFCX1JFQ0VOVF9TVElDS0VSUyArICdfJyArIHN0aWNrZXJzW2ldWzBdLCB0b3BdKTsKICB9Cn0sCgp1cGRhdGVFbW9qaUNhdFRpdGxlOiBmdW5jdGlvbiAob3B0SWQpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwoKICBpZiAoIW9wdHMgfHwgIW9wdHMuZW1vamlTY3JvbGwpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBlbW9qaV9ibG9ja19lbCA9IGdlKCdlbW9qaV9ibG9ja18nICsgb3B0SWQpOwogIHZhciBlbHMgPSBnZUJ5Q2xhc3MoJ2Vtb2ppX2NhdF90aXRsZV9oZWxwZXInLCBlbW9qaV9ibG9ja19lbCk7CiAgdmFyIHN0ID0gb3B0cy5lbW9qaVNjcm9sbC5kYXRhLnNjcm9sbFRvcDsKICB2YXIgaGVscGVyID0gZ2VCeUNsYXNzMSgnZW1vamlfY2F0c190aXRsZV9oZWxwZXInLCBvcHRzLnR0KTsKICB2YXIgcm93SCwgY3VyUm93LCByb3dJOwogIGlmIChlbHMubGVuZ3RoKSB7CiAgICB2YXIgZmlyc3RUaXRsZSA9IGVsc1swXTsKICAgIHJvd0ggPSBFbW9qaS5nZXRTaXplQ2FjaGVkKGZpcnN0VGl0bGUpWzFdOwogIH0KCiAgZm9yKHZhciBpID0gZWxzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICBpZiAoc3QgPiBlbHNbaV0ub2Zmc2V0VG9wIC0gcm93SCkgewogICAgICBjdXJSb3cgPSBlbHNbaV07CiAgICAgIHJvd0kgPSBpOwogICAgICBicmVhazsKICAgIH0KICB9CgogIGlmICghY3VyUm93KSB7CiAgICByZXR1cm4gZGVidWdMb2coJ3RpdGxlIG5vdCBmb3VuZCcpOwogIH0KCiAgdmFyIGN1clJvd0lkID0gaW50dmFsKGF0dHIoY3VyUm93LCAnZGF0YS1pZCcpKTsKICBpZiAob3B0cy5jdXJFbW9qaUNhdElkICE9IGN1clJvd0lkKSB7CiAgICBvcHRzLmN1ckVtb2ppQ2F0SWQgPSBjdXJSb3dJZDsKCiAgICB2YXIgbmVlZF9yZXNldCA9IFtjdXJSb3ddOwoKICAgIHZhciBwcmV2Um93ID0gZWxzW3Jvd0kgLSAxXTsKICAgIGlmIChwcmV2Um93KSB7CiAgICAgIGFkZENsYXNzKHByZXZSb3csICdlbW9qaV9jYXRfdGl0bGVfZml4Jyk7CiAgICAgIHNldFN0eWxlKHByZXZSb3cuZmlyc3RDaGlsZCwgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGVZKCcgKyAoY3VyUm93Lm9mZnNldFRvcCAtIHByZXZSb3cub2Zmc2V0VG9wIC0gcm93SCkgKyAncHgpJyk7CiAgICB9CgogICAgdmFyIGVsID0gY3VyUm93Lm5leHRTaWJsaW5nOwogICAgd2hpbGUoZWwpIHsKICAgICAgaWYgKGhhc0NsYXNzKGVsLCAnZW1vamlfY2F0X3RpdGxlX2ZpeCcpKSB7CiAgICAgICAgbmVlZF9yZXNldC5wdXNoKGVsKTsKICAgICAgfQogICAgICBlbCA9IGVsLm5leHRTaWJsaW5nOwogICAgfQoKICAgIGZvcih2YXIgaSBpbiBuZWVkX3Jlc2V0KSB7CiAgICAgIHJlbW92ZUNsYXNzKG5lZWRfcmVzZXRbaV0sICdlbW9qaV9jYXRfdGl0bGVfZml4Jyk7CiAgICAgIHNldFN0eWxlKG5lZWRfcmVzZXRbaV0uZmlyc3RDaGlsZCwgJ3RyYW5zZm9ybScsICd0cmFuc2xhdGVZKDBweCknKTsKICAgIH0KCiAgICB2YWwoaGVscGVyLCAnJyk7CiAgICBvcHRzLmVtb2ppVGl0bGVIZWxwZXJJc1NldCA9IDA7CiAgfQoKICBpZiAoIW9wdHMuZW1vamlUaXRsZUhlbHBlcklzU2V0ICYmIHN0ID49IGN1clJvdy5vZmZzZXRUb3AgJiYgc3QgPiAwKSB7CiAgICB2YWwoaGVscGVyLCB2YWwoY3VyUm93KSk7CiAgICBvcHRzLmVtb2ppVGl0bGVIZWxwZXJJc1NldCA9IDE7CiAgfSBlbHNlIGlmIChvcHRzLmVtb2ppVGl0bGVIZWxwZXJJc1NldCAmJiAoc3QgPCBjdXJSb3cub2Zmc2V0VG9wIHx8IHN0ID09IDApKSB7CiAgICB2YWwoaGVscGVyLCAnJyk7CiAgICBvcHRzLmVtb2ppVGl0bGVIZWxwZXJJc1NldCA9IDA7CiAgfQp9LAoKZW1vamlXcmFwSXRlbTogZnVuY3Rpb24ob3B0SWQsIGNvZGUsIGkpIHsKICB2YXIgaW5mbyA9IEVtb2ppLmNzc0Vtb2ppW2NvZGVdOwogIGlmIChpbmZvKSB7CiAgICB2YXIgdGl0bGVTdHIgPSAnIHRpdGxlPSInK2luZm9bMV0rJyInOwogIH0gZWxzZSB7CiAgICB2YXIgdGl0bGVTdHIgPSAnJzsKICB9CiAgaWYgKGJyb3dzZXIubW9iaWxlKSB7CiAgICB2YXIgb3ZlckV2ZW50ID0gJyc7CiAgfSBlbHNlIHsKICAgIHZhciBvdmVyRXZlbnQgPSAnIG9ubW91c2VvdmVyPSJyZXR1cm4gRW1vamkuZW1vamlPdmVyKCcrb3B0SWQrJywgdGhpcywgdHJ1ZSk7Iic7CiAgfQogIHJldHVybiAnPGEgY2xhc3M9ImVtb2ppX3NtaWxlX2NvbnQgJysoKGNvZGUgIT0gJzI3NjQnICYmIGkgJiYgKGkgPCA1NCkpID8gJ2Vtb2ppX3NtaWxlX3NoYWRvdycgOiAnJykrJyIgJyt0aXRsZVN0cisnIG9ubW91c2Vkb3duPSJFbW9qaS5hZGRFbW9qaShFbW9qaS5zaG93bklkLCBcJycrY29kZSsnXCcsIHRoaXMpOyByZXR1cm4gY2FuY2VsRXZlbnQoZXZlbnQpOyIgb25jbGljaz0icmV0dXJuIGNhbmNlbEV2ZW50KGV2ZW50KTsiJytvdmVyRXZlbnQrJz48ZGl2IGNsYXNzPSJlbW9qaV9iZyI+PC9kaXY+PGRpdiBjbGFzcz0iZW1vamlfc2hhZG93Ij48L2Rpdj4nK0Vtb2ppLmdldEVtb2ppSFRNTChjb2RlLCBmYWxzZSwgZmFsc2UsIHRydWUpKyc8L2E+Jwp9LAoKcmVhcHBlbmRFbW9qaTogZnVuY3Rpb24ob3B0SWQsIHR0KSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBpZiAob3B0cyAmJiBvcHRzLnJjZUNvbnQpIHsKICAgIGlmICghb3B0cy5hZGRNZWRpYUJ0bikgewogICAgICBvcHRzLnNlbmRXcmFwLmFwcGVuZENoaWxkKG9wdHMucmNlQ29udCk7CiAgICB9IGVsc2UgewogICAgICBvcHRzLnNlbmRXcmFwLmluc2VydEJlZm9yZShvcHRzLnJjZUNvbnQsIG9wdHMuYWRkTWVkaWFCdG4pOwogICAgfQogIH0KICBpZiAoIXR0KSByZXR1cm47CiAgdmFyIGNvbnRyb2xzID0gb3B0cy5jb250cm9sc0NvbnQ7CiAgLy8gdmFyIGRpZmYgPSBvcHRzLmlzU2l6ZWQgPyBzYldpZHRoKCkgOiAwOwoKICBpZiAob3B0cy5lbW9qaVdyYXApIHsgLy8gbmV3IHdheQogICAgb3B0cy5lbW9qaVdyYXAuYXBwZW5kQ2hpbGQodHQpOwogIH0gZWxzZSB7CiAgICBvcHRzLm9iai5hcHBlbmRDaGlsZCh0dCk7CiAgfQogIC8vIGRpZmYgKz0gb3B0cy50dERpZmYgKyBFbW9qaS50dFNoaWZ0OwogIC8vIHNldFN0eWxlKHR0LCB2ay5ydGwgPyB7bGVmdDogZGlmZn0gOiB7cmlnaHQ6IGRpZmZ9KTsKICBjbGVhclRpbWVvdXQoY3VyLnR0RW1vamlIaWRlKTsKICBFbW9qaS5oaWRlVHQodHQpOwp9LAp0dENhbGNIZWlnaHQ6IGZ1bmN0aW9uKG9wdElkLCBvYmosIHR0KSB7CiAgd2luZG93LmhlYWRIID0gd2luZG93LmhlYWRIIHx8IGdlKCdwYWdlX2hlYWRlcicpICYmIEVtb2ppLmdldFNpemVDYWNoZWQoZ2UoJ3BhZ2VfaGVhZGVyJykpWzFdIHx8IDA7IC8vIGhlaWdodCBvZiBoZWFkZXIgZWwgbm90IGNoYW5nZWQKICB2YXIgd2ggPSAod2luZG93LnBhZ2VOb2RlICYmIHdpbmRvdy5icm93c2VyLm1vemlsbGEgPyBNYXRoLm1pbihnZXRTaXplKHBhZ2VOb2RlKVsxXSwgd2luZG93Lmxhc3RXaW5kb3dIZWlnaHQpIDogd2luZG93Lmxhc3RXaW5kb3dIZWlnaHQpIHx8IGdldFNjcm9sbCgpWzNdLAogICAgICBzY3JvbGxZID0gd2luZG93LnNjcm9sbEdldFkgPyBzY3JvbGxHZXRZKCkgOiBnZXRTY3JvbGwoKVsxXSwKICAgICAgb2JqWSA9IGdldFhZKG9iailbMV0sIG9iakggPSBFbW9qaS5nZXRTaXplQ2FjaGVkKG9iailbMV0sIC8vIGhlaWdodCBvZiBlbW9qaSBlbCBub3QgY2hhbmdlZAogICAgICBsaXN0ID0gZ2VCeUNsYXNzMSgnZW1vamlfbGlzdCcsIHR0KSwKICAgICAgc21pbGVIID0gRW1vamkub3B0c1tvcHRJZF0uZW1vamlTbWlsZUhlaWdoLAogICAgICBoZWFkU3BhY2UgPSBoZWFkSCwgcm93c0NudCA9IEVtb2ppLm9wdHNbb3B0SWRdLmVtb2ppUm93c0NvdW50LCBvZmZzZXRIID0gOSwgbGlzdFBhZGRpbmcgPSA4OwoKICBpZiAoIWlzQW5jZXN0b3Iob2JqLCBwYWdlTm9kZSkpIHsKICAgIGhlYWRTcGFjZSA9IDA7CiAgfQogIHNldFN0eWxlKGxpc3QsIHtoZWlnaHQ6IHJvd3NDbnQgKiBzbWlsZUggKyBsaXN0UGFkZGluZ30pOwoKICB2YXIgdXBFZGdlWSA9IHNjcm9sbFkgKyBoZWFkU3BhY2UsCiAgICBkb3duRWRnZVkgPSBzY3JvbGxZICsgd2gsCiAgICBlbCA9IG9iaiwKICAgIHR0SCA9IGdldFNpemUodHQpWzFdLAogICAgdG9VcCwKICAgIHVwU3BhY2UgPSAwLAogICAgZG93blNwYWNlID0gMCwKICAgIHNwYWNlID0gMDsKCiAgd2hpbGUgKGVsICE9PSBib2R5Tm9kZSAmJiAoZWwgPSBkb21DbG9zZXN0T3ZlcmZsb3dIaWRkZW4oZWwpKSkgewogICAgdmFyIHkgPSBnZXRYWShlbClbMV07CiAgICB1cEVkZ2VZID0gTWF0aC5tYXgodXBFZGdlWSwgeSk7CiAgICBkb3duRWRnZVkgPSBNYXRoLm1pbihkb3duRWRnZVksIHkgKyBnZXRTaXplKGVsKVsxXSk7CiAgfQoKICB1cFNwYWNlID0gb2JqWSAtIG9mZnNldEggLSB1cEVkZ2VZOwogIGRvd25TcGFjZSA9IGRvd25FZGdlWSAtIG9ialkgLSBvYmpIIC0gb2Zmc2V0SDsKCiAgaWYgKHVwU3BhY2UgPCB0dEggJiYgZG93blNwYWNlIDwgdHRIKSB7CiAgICB0b1VwID0gKHVwU3BhY2UgPj0gZG93blNwYWNlKTsKICB9IGVsc2UgewogICAgdG9VcCA9ICh1cFNwYWNlID49IHR0SCk7CiAgfQogIHNwYWNlID0gKHRvVXAgPyB1cFNwYWNlIDogZG93blNwYWNlKTsKICB3aGlsZSAoc3BhY2UgPCB0dEggJiYgcm93c0NudCA+IDMpIHsKICAgIHJvd3NDbnQtLTsKICAgIHR0SCAtPSBzbWlsZUg7CiAgfQogIEVtb2ppLm9wdHNbb3B0SWRdLmVtb2ppUm93c0NvdW50ID0gcm93c0NudDsKICBFbW9qaS5vcHRzW29wdElkXS5lbW9qaVNtaWxlSGVpZ2ggPSBzbWlsZUg7CiAgc2V0U3R5bGUobGlzdCwge2hlaWdodDogcm93c0NudCAqIHNtaWxlSCArIGxpc3RQYWRkaW5nfSk7CiAgdG9nZ2xlQ2xhc3ModHQsICd0dF9kb3duJywgdG9VcCk7CiAgdG9nZ2xlQ2xhc3ModHQsICd0dF91cCcsICF0b1VwKTsKfSwKcmVwb3NpdGlvbkVtb2ppOiBmdW5jdGlvbihvcHRJZCwgb2JqLCB0dCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF0sIGFycm93OwogIGlmICghb3B0cykgewogICAgcmV0dXJuOwogIH0KICBpZiAodHQucGFyZW50Tm9kZSAmJiBnZXRYWSAmJiBnZXRTdHlsZSAmJiBzZXRTdHlsZSAmJiBnZUJ5Q2xhc3MgJiYgKGFycm93ID0gZ2VCeUNsYXNzMSgiZW1vamlfcnBvaW50ZXIiLCB0dCkpKSB7CiAgICB2YXIgd2lkdGggPSBwYXJzZUludChnZXRTdHlsZSh0dCwgIndpZHRoIikpLAogICAgICAgIGFycm93TGVmdCA9IDI2NiwKICAgICAgICBhcnJvd0NlbnRlciA9IDcsCiAgICAgICAgbmVlZE9mZnNldCA9IDEwLAogICAgICAgIG5lZWRYID0gZ2V0WFkob2JqKVswXSwKICAgICAgICBvYmpXaWR0aCA9IHBhcnNlSW50KGdldFN0eWxlKG9iaiwgIndpZHRoIikpLAogICAgICAgIHBhcmVudExlZnQgPSBnZXRYWSh0dC5wYXJlbnROb2RlKVswXTsKCiAgICBpZiAobmVlZFggKyBvYmpXaWR0aCAvIDIgPCBhcnJvd0xlZnQgKyBhcnJvd0NlbnRlciArIG5lZWRPZmZzZXQpIHsKICAgICAgc2V0U3R5bGUodHQsICdsZWZ0JywgLXdpZHRoIC0gcGFyZW50TGVmdCk7CiAgICAgIHNldFN0eWxlKGFycm93LCAnbGVmdCcsIChuZWVkWCArIG9ialdpZHRoIC8gMiAtIG5lZWRPZmZzZXQgKiAyKSArICJweCIpOwogICAgfSBlbHNlIHsKICAgICAgc2V0U3R5bGUodHQsICdsZWZ0JywgJycpOwogICAgICBzZXRTdHlsZShhcnJvdywgJ2xlZnQnLCAnJyk7CiAgICB9CiAgfSBlbHNlIHsKICAgIHNldFN0eWxlKHR0LCAnbGVmdCcsICcnKTsKICB9CgogIHZhciBsaXN0ID0gZ2VCeUNsYXNzMSgnZW1vamlfbGlzdCcsIHR0KSwKICAgICAgZmlyc3RTbWlsZSA9IGdlQnlDbGFzczEoJ2Vtb2ppX3NtaWxlX2NvbnQnLCBsaXN0KTsKICBFbW9qaS5vcHRzW29wdElkXS5lbW9qaVNtaWxlSGVpZ2ggPSBmaXJzdFNtaWxlICYmIEVtb2ppLmdldFNpemVDYWNoZWQoZmlyc3RTbWlsZSlbMV0gfHwgMjY7CiAgRW1vamkub3B0c1tvcHRJZF0uZW1vamlSb3dzQ291bnQgPSA5OwogIEVtb2ppLnR0Q2FsY0hlaWdodChvcHRJZCwgb2JqLCB0dCk7Cn0sCmVtb2ppT3ZlcjogZnVuY3Rpb24ob3B0SWQsIG9iaiwgd2l0aE1vdXNlKSB7CiAgaWYgKGJyb3dzZXIubW9iaWxlIHx8IHdpdGhNb3VzZSAmJiBFbW9qaS5wcmV2ZW50TW91c2VPdmVyKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXQogIGFkZENsYXNzKG9iaiwgJ2Vtb2ppX292ZXInKTsKICBpZiAob3B0cy5lbW9qaU92ZXJlZCAmJiBvcHRzLmVtb2ppT3ZlcmVkICE9IG9iaikgewogICAgcmVtb3ZlQ2xhc3Mob3B0cy5lbW9qaU92ZXJlZCwgJ2Vtb2ppX292ZXInKTsKICB9CiAgb3B0cy5lbW9qaU92ZXJlZCA9IG9iajsKfSwKZW1vamlFeHBhbmQ6IGZ1bmN0aW9uKG9wdElkLCBibG9jaykgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgYWRkQ2xhc3MoYmxvY2ssICdlbW9qaV9leHBhbmRlZCcpOwogIEVtb2ppLmVtb2ppTG9hZE1vcmUob3B0SWQpOwoKICBpZiAob3B0cy5lbW9qaVNjcm9sbCkgewogICAgb3B0cy5lbW9qaVNjcm9sbC51cGRhdGUoKTsKICB9IGVsc2UgewogICAgb3B0cy5lbW9qaVNjcm9sbCA9IG5ldyB1aVNjcm9sbChnZUJ5Q2xhc3MxKCdlbW9qaV9saXN0JywgYmxvY2spLCB7CiAgICAgIHRoZW1lOiAnZGVmYXVsdCBlbW9qaSBub190cmFuc2l0aW9uJywKICAgICAgc2hhZG93czogdHJ1ZSwKICAgICAgZ2xvYmFsOiB0cnVlLAogICAgICBub0ZvcmNlUmVGbG93OiB0cnVlLAogICAgICBvbmRyYWdzdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgb3B0cy5zY3JvbGxpbmcgPSB0cnVlOwogICAgICB9LAogICAgICBvbmRyYWdzdG9wOiBmdW5jdGlvbigpIHsKICAgICAgICBvcHRzLnNjcm9sbGluZyA9IGZhbHNlOwogICAgICAgIGlzRnVuY3Rpb24ob3B0cy5hZnRlclNjcm9sbEZuKSAmJiBvcHRzLmFmdGVyU2Nyb2xsRm4oKTsKICAgICAgfSwKICAgICAgb25zY3JvbGxzdGFydDogZnVuY3Rpb24oKSB7CiAgICAgICAgd2luZG93LnRvb2x0aXBzICYmIHRvb2x0aXBzLmRlc3Ryb3lBbGwoKTsKICAgICAgICBvcHRzLnNjcm9sbFN0YXJ0ZWQgPSB0cnVlOwogICAgICB9LAogICAgICBvbnVwZGF0ZTogZnVuY3Rpb24oc2Nyb2xsKSB7CiAgICAgICAgaWYgKG9wdHMuY3VyVGFiID09IEVtb2ppLlRBQl9FTU9KSSkgewogICAgICAgICAgRW1vamkudXBkYXRlRW1vamlDYXRlZ29yaWVzKHNjcm9sbCwgb3B0cywgb3B0SWQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBFbW9qaS51cGRhdGVTaG93blN0aWNrZXJzKG9wdElkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0pOwogICAgb3B0cy5pbWFnZXNMb2FkZXIgPSBvcHRzLmltYWdlc0xvYWRlciB8fCBpbWFnZXNMb2FkZXIob3B0cy5lbW9qaVNjcm9sbC5zY3JvbGxlciwge3VzZV9pZnJhbWU6IHRydWUsIG5lZWRfbG9hZF9jbGFzczogJ2Vtb2ppX25lZWRfbG9hZCd9KTsKICAgIGlmIChvcHRzLnNoYXJlZFRUKSB7CiAgICAgIG9wdHMuc2hhcmVkVFQuZW1vamlTY3JvbGwgPSBvcHRzLmVtb2ppU2Nyb2xsOwogICAgfQogIH0KCiAgb3B0cy5lbW9qaUV4cGFuZGVkID0gdHJ1ZTsKfSwKCnVwZGF0ZUVtb2ppQ2F0ZWdvcmllczogZnVuY3Rpb24gKHNjcm9sbCwgb3B0cywgb3B0SWQpIHsKICBpZiAoKHNjcm9sbC5kYXRhLnNjcm9sbEJvdHRvbSAtIEVtb2ppLkJPVFRPTV9SRVNUX0ZPUl9BRERfRU1PSklfQ0FURUdPUlkpIDw9IDAgJiYgb3B0cy5zY3JvbGxTdGFydGVkKSB7CiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgRW1vamkuYWRkTmV4dEVtb2ppQ2F0ZWdvdHkob3B0SWQpOwogICAgICBFbW9qaS51cGRhdGVFbW9qaUNhdFRpdGxlKG9wdElkKTsKICAgIH0sIDApOwogIH0KICBFbW9qaS51cGRhdGVFbW9qaUNhdFRpdGxlKG9wdElkKTsKfSwKCnVwZGF0ZVNob3duU3RpY2tlcnM6IGZ1bmN0aW9uKG9wdElkLCBub0NoYW5nZVRhYikgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CgogIGlmICghb3B0cy5lbW9qaVNjcm9sbCB8fCAhb3B0cy5zdGlja2Vyc1NwbGl0ZXJzUG9zKSB7CiAgICByZXR1cm47CiAgfQoKICBpZiAoIW9wdHMubmVlZExvYWRTdGlja2VycykgewogICAgb3B0cy5uZWVkTG9hZFN0aWNrZXJzID0gW107CiAgfQoKICB2YXIgc3QgPSBvcHRzLmVtb2ppU2Nyb2xsLmRhdGEuc2Nyb2xsVG9wLCB2aCA9IG9wdHMuZW1vamlTY3JvbGwuZGF0YS52aWV3cG9ydEhlaWdodDsKICB2YXIgc3RhcnRQb3MgPSBzdCwgZW5kUG9zID0gc3QgKyB2aDsKICB2YXIgbmVlZExvYWQgPSBvcHRzLm5lZWRMb2FkU3RpY2tlcnM7CgogIGNsZWFyVGltZW91dChvcHRzLnByZWxvYWRTdGlja2Vyc1RpbWVyKTsKCiAgdmFyIG5lZWRfbG9hZCA9IFtdOwogIGZvciAodmFyIGkgPSAwOyBpIDwgbmVlZExvYWQubGVuZ3RoOyBpKyspIHsKICAgIHZhciBpdGVtID0gbmVlZExvYWRbaV07CgogICAgaWYgKGl0ZW1bMV0gKyA3MiA+PSBzdGFydFBvcyAmJiBpdGVtWzFdIDw9IGVuZFBvcykgewogICAgICB2YXIgZWwgPSBnZSgnZW1vamlfc3RpY2tlcl9pdGVtJyArIGl0ZW1bMF0pOwogICAgICBpZiAoIWVsKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdmFyIHNyYyA9IGF0dHIoZWwsICdkYXRhLXNyYycpOwogICAgICB2YWwoZWwsICc8aW1nIGNsYXNzPSJlbW9qaV9zdGlja2VyX2ltYWdlIiBzcmM9Ii9pbWFnZXMvYmxhbmsuZ2lmIiBkYXRhLXNyYz0iJyArIHNyYyArICciLz4nKTsKICAgICAgbmVlZF9sb2FkLnB1c2goW3NyYywgaXRlbVswXV0pOwogICAgfQogIH0KCiAgRW1vamkubG9hZFN0aWNrZXJzKG9wdElkLCBuZWVkX2xvYWQpOwoKICBpZiAoIW5lZWRfbG9hZC5sZW5ndGgpIHsKICAgIEVtb2ppLnByZWxvYWRTdGlja2VycyhvcHRJZCk7CiAgfQoKICBpZiAobm9DaGFuZ2VUYWIgfHwgb3B0cy5zY3JvbGxBbmltYXRpb24gfHwgRW1vamkub25TdGlja2Vyc0xvYWQpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBwYWNrSWQgPSAtMTsKICBmb3IodmFyIGkgPSAwOyBpIDwgb3B0cy5zdGlja2Vyc1NwbGl0ZXJzUG9zLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgaXRlbSA9IG9wdHMuc3RpY2tlcnNTcGxpdGVyc1Bvc1tpXTsKCiAgICBpZiAoaXRlbVsxXSAtIDMwIDwgc3QpIHsKICAgICAgcGFja0lkID0gaXRlbVswXTsKICAgIH0gZWxzZSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgaWYgKG9wdHMuY3VyVGFiICE9IHBhY2tJZCkgewogICAgRW1vamkuc2Nyb2xsVG9UYWIocGFja0lkLCBvcHRJZCk7CiAgfQp9LAoKbG9hZFN0aWNrZXJzOiBmdW5jdGlvbiAob3B0SWQsIG5lZWRfbG9hZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CgogIGlmICghbmVlZF9sb2FkLmxlbmd0aCkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIGxvYWRpbmcgPSB7fTsKICBmb3IodmFyIGkgPSAwOyBpIDwgbmVlZF9sb2FkLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgcmF3X2lkID0gbmVlZF9sb2FkW2ldWzBdICsgJzonICsgbmVlZF9sb2FkW2ldWzFdOwogICAgaWYgKG9wdHMuaW1hZ2VzTG9hZGluZ1tyYXdfaWRdKSB7CiAgICAgIGxvYWRpbmdbcmF3X2lkXSA9IG9wdHMuaW1hZ2VzTG9hZGluZ1tyYXdfaWRdOwogICAgICBkZWxldGUgb3B0cy5pbWFnZXNMb2FkaW5nW3Jhd19pZF07CiAgICAgIG5lZWRfbG9hZC5zcGxpY2UoaSwgMSk7CiAgICAgIGktLTsKICAgIH0KICB9CgogIGZvcih2YXIgaSBpbiBvcHRzLmltYWdlc0xvYWRpbmcpIHsKICAgIHZhciBpbWcgPSBvcHRzLmltYWdlc0xvYWRpbmdbaV07CiAgICBpZiAoIWltZykgewogICAgICByZXR1cm47CiAgICB9CiAgICBpbWcuc3JjID0gJyc7CiAgICAvL3ZhciBwYXJlbnQgPSBpbWcucGFyZW50Tm9kZTsKICAgIC8vdHJ5IHsgcGFyZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQocGFyZW50KTsgfSBjYXRjaChlKSB7IH0KICB9CiAgb3B0cy5pbWFnZXNMb2FkaW5nID0gbG9hZGluZzsKCiAgZm9yKHZhciBpIGluIG5lZWRfbG9hZCkgewogICAgdmFyIHJhd19pZCA9IG5lZWRfbG9hZFtpXVswXSArICc6JyArIG5lZWRfbG9hZFtpXVsxXTsKICAgIG9wdHMuaW1hZ2VzTG9hZGluZ1tyYXdfaWRdID0gb3B0cy5pbWFnZXNMb2FkZXIuaWxvYWRlci5hZGQobmVlZF9sb2FkW2ldWzBdLCBFbW9qaS5vblN0aWNrZXJMb2FkZWQsIG9wdElkICsgJzonICsgbmVlZF9sb2FkW2ldWzFdKTsKICB9Cn0sCgpwcmVsb2FkU3RpY2tlcnM6IGZ1bmN0aW9uIChvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CgoKICBpZiAob3B0cy5pbWFnZXNMb2FkaW5nICYmIE9iamVjdC5rZXlzKG9wdHMuaW1hZ2VzTG9hZGluZykubGVuZ3RoID4gMCkgewogICAgcmV0dXJuOwogIH0KCiAgY2xlYXJUaW1lb3V0KG9wdHMucHJlbG9hZFN0aWNrZXJzVGltZXIpOwogIG9wdHMucHJlbG9hZFN0aWNrZXJzVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgIHZhciBzdCA9IG9wdHMuZW1vamlTY3JvbGwuZGF0YS5zY3JvbGxUb3AsIHZoID0gb3B0cy5lbW9qaVNjcm9sbC5kYXRhLnZpZXdwb3J0SGVpZ2h0OwogICAgdmFyIGVuZFBvcyA9IHN0ICsgdmg7CgogICAgdmFyIGJlZm9yZSA9IHsKICAgICAgdG9wOiBzdCAtIHZoLAogICAgICBib3R0b206IHN0LAogICAgfSwgYWZ0ZXIgPSB7CiAgICAgIHRvcDogZW5kUG9zLAogICAgICBib3R0b206IGVuZFBvcyArIHZoLAogICAgfTsKCiAgICB2YXIgZWwgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc3RpY2tlcnMnLCBvcHRzLnR0KS5maXJzdENoaWxkLCBuZWVkTG9hZCA9IFtdOwogICAgd2hpbGUoZWwpIHsKICAgICAgaWYgKGhhc0NsYXNzKGVsLCAnZW1vamlfc3RpY2tlcl9pdGVtJykgJiYgIWhhc0NsYXNzKGVsLCAnX19sb2FkZWQnKSkgewogICAgICAgIHZhciB0b3AgPSBlbC5vZmZzZXRUb3A7CgogICAgICAgIGlmICh0b3AgPj0gYmVmb3JlLnRvcCAmJiB0b3AgPD0gYmVmb3JlLmJvdHRvbSB8fCB0b3AgPj0gYWZ0ZXIudG9wICYmIHRvcCA8PSBhZnRlci5ib3R0b20pIHsKICAgICAgICAgIHZhciBpZCA9IGVsLmlkLnJlcGxhY2UoJ2Vtb2ppX3N0aWNrZXJfaXRlbScsICcnKSwgc3JjID0gYXR0cihlbCwgJ2RhdGEtc3JjJyk7CiAgICAgICAgICB2YWwoZWwsICc8aW1nIGNsYXNzPSJlbW9qaV9zdGlja2VyX2ltYWdlIiBzcmM9Ii9pbWFnZXMvYmxhbmsuZ2lmIiBkYXRhLXNyYz0iJyArIHNyYyArICciLz4nKTsKICAgICAgICAgIG5lZWRMb2FkLnB1c2goW3NyYywgaWRdKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgZWwgPSBlbC5uZXh0U2libGluZzsKICAgIH0KCiAgICBFbW9qaS5sb2FkU3RpY2tlcnMob3B0SWQsIG5lZWRMb2FkKTsKCiAgfSwgNTApOwp9LAoKb25TdGlja2VyTG9hZGVkOiBmdW5jdGlvbiAoc3JjKSB7CiAgdmFyIGV4cCA9IFN0cmluZyh0aGlzKS5zcGxpdCgnOicpOwogIHZhciByYXdfaWQgPSBleHBbMV07CiAgdmFyIG9wdElkID0gaW50dmFsKGV4cFswXSk7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKCgogIHZhciBlbCA9IGdlKCdlbW9qaV9zdGlja2VyX2l0ZW0nICsgcmF3X2lkKTsKICBpZiAoIWVsKSB7CiAgICByZXR1cm47CiAgfQoKICB2YXIgaW1nID0gZ2VCeVRhZzEoJ2ltZycsIGVsKTsKICBpZiAoIWltZykgewogICAgcmV0dXJuOwogIH0KCiAgYWRkQ2xhc3MoZWwsICdfX2xvYWRlZCcpOwogIGF0dHIoaW1nLCAnc3JjJywgc3JjKTsKICBkZWxldGUgRW1vamkub3B0c1tvcHRJZF0uaW1hZ2VzTG9hZGluZ1tzcmMgKyAnOicgKyByYXdfaWRdOwoKICBmb3IodmFyIGkgPSAwOyBpIDwgb3B0cy5uZWVkTG9hZFN0aWNrZXJzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgaXRlbSA9IG9wdHMubmVlZExvYWRTdGlja2Vyc1tpXTsKICAgIGlmIChyYXdfaWQgPT0gaXRlbVswXSkgewogICAgICBvcHRzLm5lZWRMb2FkU3RpY2tlcnMuc3BsaWNlKGksIDEpOwogICAgICBicmVhazsKICAgIH0KICB9CgogIGlmICghT2JqZWN0LmtleXMoRW1vamkub3B0c1tvcHRJZF0uaW1hZ2VzTG9hZGluZykubGVuZ3RoKSB7CiAgICBFbW9qaS5wcmVsb2FkU3RpY2tlcnMob3B0SWQpOwogIH0KfSwKCmVtb2ppTW92ZTogZnVuY3Rpb24oZSkgewogIHZhciBvcHRJZCA9IEVtb2ppLnNob3duSWQ7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBpZiAoRW1vamkuc2hvd24gJiYgb3B0cyAmJiBvcHRzLmVtb2ppRm9jdXNlZCAmJiBvcHRzLm9wZW5lZEJ5VGFiS2V5KSB7CiAgICB2YXIgZWwgPSBudWxsOwoKICAgIGlmICghb3B0cy5lbW9qaU92ZXJlZCkgewogICAgICBlbCA9IEVtb2ppLmdldEZpcnN0RW1vamlFbChvcHRJZCk7CiAgICB9IGVsc2UgewogICAgICBzd2l0Y2ggKGUua2V5Q29kZSkgewogICAgICAgIGNhc2UgS0VZLkxFRlQ6CiAgICAgICAgICBlbCA9IEVtb2ppLmdldEVtb2ppRWwob3B0cy5lbW9qaU92ZXJlZCwgJ2xlZnQnKTsKICAgICAgICAgIGNhbmNlbEV2ZW50KGUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBLRVkuUklHSFQ6CiAgICAgICAgICBlbCA9IEVtb2ppLmdldEVtb2ppRWwob3B0cy5lbW9qaU92ZXJlZCwgJ3JpZ2h0Jyk7CiAgICAgICAgICBjYW5jZWxFdmVudChlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgS0VZLlVQOgogICAgICAgICAgZWwgPSBFbW9qaS5nZXRFbW9qaUVsKG9wdHMuZW1vamlPdmVyZWQsICd1cCcpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBLRVkuRE9XTjoKICAgICAgICAgIGVsID0gRW1vamkuZ2V0RW1vamlFbChvcHRzLmVtb2ppT3ZlcmVkLCAnZG93bicpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBLRVkuRU5URVI6CiAgICAgICAgICBpZiAoIUVtb2ppLmVtb2ppRW50ZXIob3B0SWQsIGUpKSB7CiAgICAgICAgICAgIGNhbmNlbEV2ZW50KGUpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgIH0KICAgIGlmIChlbCkgewogICAgICBFbW9qaS5wcmV2ZW50TW91c2VPdmVyID0gdHJ1ZTsKICAgICAgRW1vamkuZW1vamlPdmVyKG9wdElkLCBlbCk7CiAgICAgIEVtb2ppLnNjcm9sbFRvTGlzdEVsKG9wdElkLCBlbCk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CiAgcmV0dXJuIHRydWU7Cn0sCgpzY3JvbGxUb0xpc3RFbDogZnVuY3Rpb24ob3B0SWQsIGVsKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBpZiAoIW9wdHMgfHwgIW9wdHMuZW1vamlTY3JvbGwpIHsKICAgIHJldHVybjsKICB9CiAgdmFyIGNhdFRpdGxlSGVpZ2h0ID0gMzA7CiAgdmFyIG9mZnNldFRvcCA9IGVsLm9mZnNldFRvcDsKICB2YXIgbmV3U3QgPSBNYXRoLm1heChvZmZzZXRUb3AgKyBjYXRUaXRsZUhlaWdodCAtIG9wdHMuZW1vamlTY3JvbGwuZGF0YS52aWV3cG9ydEhlaWdodCwgTWF0aC5taW4ob3B0cy5lbW9qaVNjcm9sbC5kYXRhLnNjcm9sbFRvcCwgb2Zmc2V0VG9wIC0gY2F0VGl0bGVIZWlnaHQpKTsKICBpZiAob3B0cy5lbW9qaVNjcm9sbC5kYXRhLnNjcm9sbFRvcCAhPSBuZXdTdCkgewogICAgb3B0cy5lbW9qaVNjcm9sbC5zY3JvbGxUb3AobmV3U3QpOwogIH0KfSwKCmFuaW06IGZ1bmN0aW9uKGVsLCB0bykgewogIGNsZWFySW50ZXJ2YWwoY3VyLl9pbUFuaW0pOwogIHZhciBkdCA9IDMwMCwgZFN0ZXAgPSA0NSAvIChkdCAvIDEzKSwgb1N0ZXAgPSAxIC8gKGR0IC8gMTMpLCBzdGVwcyA9IE1hdGguZmxvb3IoZHQgLyAxMyksIGkgPSAwOwogIHZhciBlbDEgPSBkb21MQyhlbCksIGVsMiA9IGRvbUZDKGVsKTsKICB2YXIgZEZyb20xID0gdG8gPyAwIDogNDUsIGRUbzEgPSB0byA/IDQ1IDogMCwgb0Zyb20xID0gdG8gPyAxIDogMCwgb1RvMSA9IHRvID8gMCA6IDE7CiAgY3VyLl9pbUFuaW0gPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHsKICAgICsraTsKICAgIHZhciBkMSA9IChpID49IHN0ZXBzKSA/IGRUbzEgOiAoZEZyb20xICsgZFN0ZXAgKiBpICogKHRvID8gMSA6IC0xKSksIGQyID0gZDEgLSA0NTsKICAgIHZhciBvMSA9IChpID49IHN0ZXBzKSA/IG9UbzEgOiAob0Zyb20xICsgb1N0ZXAgKiBpICogKHRvID8gLTEgOiAxKSksIG8yID0gMSAtIG8xOwogICAgZWwxLnN0eWxlLldlYmtpdFRyYW5zZm9ybSA9IGVsMS5zdHlsZS5PVHJhbnNmb3JtID0gZWwxLnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoJyArIGQxICsgJ2RlZyknOwogICAgZWwyLnN0eWxlLldlYmtpdFRyYW5zZm9ybSA9IGVsMi5zdHlsZS5PVHJhbnNmb3JtID0gZWwyLnN0eWxlLnRyYW5zZm9ybSA9ICdyb3RhdGUoJyArIGQyICsgJ2RlZyknOwogICAgZWwxLnN0eWxlLm9wYWNpdHkgPSBvMTsKICAgIGVsMi5zdHlsZS5vcGFjaXR5ID0gbzI7CiAgICBpZiAoaSA+PSBzdGVwcykgewogICAgICBjbGVhckludGVydmFsKGN1ci5faW1BbmltKTsKICAgICAgKHRvID8gYWRkQ2xhc3MgOiByZW1vdmVDbGFzcykoZWwsICdlbW9qaV9zbWlsZV9vbicpOwogICAgICBlbDEuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gZWwxLnN0eWxlLk9UcmFuc2Zvcm0gPSBlbDEuc3R5bGUudHJhbnNmb3JtID0gZWwyLnN0eWxlLldlYmtpdFRyYW5zZm9ybSA9IGVsMi5zdHlsZS5PVHJhbnNmb3JtID0gZWwyLnN0eWxlLnRyYW5zZm9ybSA9IGVsMS5zdHlsZS5vcGFjaXR5ID0gZWwyLnN0eWxlLm9wYWNpdHkgPSAnJzsKICAgIH0KICB9LCAxMyk7Cn0sCgp0cGxTbWlsZTogZnVuY3Rpb24ocGxhY2Vob2xkZXIpIHsKICByZXR1cm4gJzxkaXYgY2xhc3M9ImVtb2ppX3NtaWxlX3dyYXAgX2Vtb2ppX3dyYXAiPlwKICA8ZGl2IGNsYXNzPSJlbW9qaV9zbWlsZSBfZW1vamlfYnRuIiB0aXRsZT0iJyArIHBsYWNlaG9sZGVyICsgJyIgb25tb3VzZW92ZXI9InJldHVybiBFbW9qaS5zaG93KHRoaXMsIGV2ZW50KTsiIG9ubW91c2VvdXQ9InJldHVybiBFbW9qaS5oaWRlKHRoaXMsIGV2ZW50KTsiIG9uY2xpY2s9InJldHVybiBjYW5jZWxFdmVudChldmVudCk7Ij5cCiAgICA8ZGl2IGNsYXNzPSJlbW9qaV9zbWlsZV9pY29uIj48L2Rpdj5cCiAgPC9kaXY+XAo8L2Rpdj4nOwp9LAoKZW1vamlUb0hUTUw6IGZ1bmN0aW9uKHN0ciwgcmVwbGFjZVN5bWJvbHMsIG5vQnIpIHsKICBpZiAoYnJvd3Nlci5pcGFkIHx8IGJyb3dzZXIuaXBob25lKSB7CiAgICByZXR1cm4gc3RyOwogIH0KICBzdHIgPSAoc3RyICsgJycpLnJlcGxhY2UoLyZuYnNwOy9nLCAnICcpLnJlcGxhY2UoLzxicj4vZywgIlxuIik7CiAgdmFyIHJlZ3MgPSB7CiAgICAnRDgzRERFMDcnOiAvKFxzfF4pKFswT85dOlwpKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMDknOiAvKFxzfF4pKDstXCkrKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMDYnOiAvKFxzfF4pKFtY1Xj1XS0/RCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTBFJzogLyhcc3xeKShCLVwpKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMEMnOiAvKFxzfF4pKDMtXCkpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUyMCc6IC8oXHN8XikoJmd0O1woKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMzAnOiAvKFxzfF4pKDtbb+5Pzl0pKFtcc1wuLF18JCkvZywKICAgICdEODNEREUzMyc6IC8oXHN8XikoOFx8KShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMzInOiAvKFxzfF4pKDgtP1tv7k/OXSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTBEJzogLyhcc3xeKSg4LVwpKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMzcnOiAvKFxzfF4pKDpbWNVdKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMjgnOiAvKFxzfF4pKDpbb+5Pzl0pKFtcc1wuLF18JCkvZywKICAgICcyNzY0JzogLyhcc3xeKSgmbHQ7MykoW1xzXC4sXXwkKS9nCiAgfTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgIGZvciAodmFyIGNvZGUgaW4gcmVncykgewogICAgICBzdHIgPSBzdHIucmVwbGFjZShyZWdzW2NvZGVdLCBmdW5jdGlvbihtYXRjaCwgcHJlLCBzbWlsZSwgc3BhY2UpIHsKICAgICAgICByZXR1cm4gKHByZSB8fCAnJykgKyBFbW9qaS5nZXRFbW9qaUhUTUwoY29kZSkrKHNwYWNlIHx8ICcnKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICB2YXIgcmVncyA9IHsKICAgICdEODNEREUwQSc6IC8oOi1cKSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTAzJzogLyg6LUQpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUxQyc6IC8oOy1bUNBdKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMEInOiAvKDotW3DwXSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTEyJzogLyg6LVwoKShbXHNcLixdfCQpL2csCiAgICAnMjYzQSc6IC8oOi0/XF0pKFtcc1wuLF18JCkvZywKICAgICdEODNEREUwRic6IC8oOy1cXSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTE0JzogLygzLT9cKCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTIyJzogLyg6JiMwMzk7XCgpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUyRCc6IC8oOl9cKCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTI5JzogLyg6XChcKCkoW1xzXC4sXXwkKS9nLAogICAgLy8nRDgzRERFMTUnOiAvKDpcXCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTEwJzogLyg6XHwpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUyMSc6IC8oJmd0O1woXCgpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUxQSc6IC8oOi1cKikoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTA4JzogLyhcfTpcKSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0REQzREJzogLyg6bGlrZTopKFtcc1wuLF18JCkvZywKICAgICdEODNEREM0RSc6IC8oOmRpc2xpa2U6KShbXHNcLixdfCQpL2csCiAgICAnMjYxRCc6IC8oOnVwOikoW1xzXC4sXXwkKS9nLAogICAgJzI3MEMnOiAvKDp2OikoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0REQzRDJzogLyg6b2s6fDru6jopKFtcc1wuLF18JCkvZwogIH07CiAgZm9yICh2YXIgY29kZSBpbiByZWdzKSB7CiAgICBzdHIgPSBzdHIucmVwbGFjZShyZWdzW2NvZGVdLCBmdW5jdGlvbihtYXRjaCwgc21pbGUsIHNwYWNlKSB7CiAgICAgIHJldHVybiBFbW9qaS5nZXRFbW9qaUhUTUwoY29kZSkrKHNwYWNlIHx8ICcnKTsKICAgIH0pOwogIH0KCiAgc3RyID0gc3RyLnJlcGxhY2UoL1xuL2csICc8YnI+Jyk7CgogIGlmIChyZXBsYWNlU3ltYm9scykgewogICAgc3RyID0gc3RyLnJlcGxhY2UoRW1vamkuZW1vamlSZWdFeCwgRW1vamkuZW1vamlSZXBsYWNlKTsKICB9CgogIHJldHVybiBzdHI7Cn0sCgplbW9qaVJlcGxhY2U6IGZ1bmN0aW9uKHN5bWJvbHN0cikgewogIHZhciBpID0gMDsKICB2YXIgYnVmZmVyID0gJyc7CiAgdmFyIGFsdEJ1ZmZlciA9ICcnOwogIHZhciBudW0gPSAnJzsKICB2YXIgc3ltYm9scyA9IFtdOwogIHZhciBjb2RlcyA9IFtdOwogIHZhciBjb2xsZWN0Q29kZXMgPSB0cnVlOwoKICBpZiAoc3ltYm9sc3RyLm1hdGNoKC9cdUZFMEZcdTIwRTMvZykpIHsKICAgIHN5bWJvbHN0ciA9IHN5bWJvbHN0ci5yZXBsYWNlKC9cdUZFMEYvZywgJycpOwogIH0KCiAgZG8gewogICAgdmFyIG51bSA9IHN5bWJvbHN0ci5jaGFyQ29kZUF0KGkrKyk7CgogICAgaWYgKCFudW0pIHsKICAgICAgY29sbGVjdENvZGVzID0gZmFsc2U7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIHZhciBjb2RlID0gbnVtLnRvU3RyaW5nKDE2KS50b1VwcGVyQ2FzZSgpOwogICAgdmFyIHN5bWJvbCA9IHN5bWJvbHN0ci5jaGFyQXQoaSAtIDEpOwoKICAgIGlmIChudW0gPT0gODQxOSkgewogICAgICB2YXIgbnVtUHJldlBvcyA9IGkgLSAyOwogICAgICB2YXIgbnVtUHJldkNoYXIgPSBzeW1ib2xzdHIuY2hhckF0KG51bVByZXZQb3MpOwoKICAgICAgY29kZXMucHVzaCgnMDAzJyArIG51bVByZXZDaGFyICsgJzIwRTMnKTsKICAgICAgc3ltYm9scy5wdXNoKG51bVByZXZDaGFyKTsKCiAgICAgIGJ1ZmZlciA9ICcnOwogICAgICBhbHRCdWZmZXIgPSAnJzsKICAgICAgY29udGludWU7CiAgICB9CgogICAgYnVmZmVyICs9IGNvZGU7CiAgICBhbHRCdWZmZXIgKz0gc3ltYm9sOwoKICAgIGlmICghc3ltYm9sLm1hdGNoKEVtb2ppLmVtb2ppQ2hhclNlcSkpIHsKICAgICAgY29kZXMucHVzaChidWZmZXIpOwogICAgICBzeW1ib2xzLnB1c2goYWx0QnVmZmVyKTsKICAgICAgYnVmZmVyID0gJyc7CiAgICAgIGFsdEJ1ZmZlciA9ICcnOwogICAgfQoKICB9IHdoaWxlIChjb2xsZWN0Q29kZXMpCgogIGlmIChidWZmZXIpIHsKICAgIGNvZGVzLnB1c2goYnVmZmVyKTsKICAgIHN5bWJvbHMucHVzaChhbHRCdWZmZXIpOwogIH0KCiAgdmFyIG91dCA9ICcnOwogIHZhciBqb2luZXIgPSBmYWxzZTsKICB2YXIgaXNGbGFnID0gZmFsc2U7CgogIGJ1ZmZlciA9ICcnOwogIGFsdEJ1ZmZlciA9ICcnOwoKICBmb3IgKHZhciBpIGluIGNvZGVzKSB7CiAgICB2YXIgY29kZSA9IGNvZGVzW2ldOwogICAgdmFyIHN5bWJvbCA9IHN5bWJvbHNbaV07CgogICAgaWYgKCFjb2RlIHx8IGNvZGUgPT0gJ0ZFMEYnKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChzeW1ib2wubWF0Y2goL1x1RDgzQ1tcdURGRkItXHVERkZGXS8pKSB7IC8vIGNvbG9ycwogICAgICBidWZmZXIgKz0gY29kZTsKICAgICAgYWx0QnVmZmVyICs9IHN5bWJvbDsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAoam9pbmVyKSB7CiAgICAgIGJ1ZmZlciArPSBjb2RlOwogICAgICBhbHRCdWZmZXIgKz0gc3ltYm9sOwogICAgICBqb2luZXIgPSBmYWxzZTsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpZiAoaW5BcnJheShjb2RlLCBFbW9qaS5lbW9qaUpvaW5lcnMpKSB7IC8vIGpvaW5lcnMKICAgICAgaWYgKGJ1ZmZlcikgewogICAgICAgIGpvaW5lciA9IHRydWU7CiAgICAgICAgYnVmZmVyICs9IGNvZGU7CiAgICAgICAgYWx0QnVmZmVyICs9IHN5bWJvbDsKICAgICAgfSBlbHNlIHsKICAgICAgICBvdXQgKz0gc3ltYm9sOwogICAgICB9CiAgICAgIGlzRmxhZyA9IGZhbHNlOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChzeW1ib2wubWF0Y2goL1x1RDgzQ1tcdURERTYtXHVEREZGXS8pKSB7IC8vIGZsYWdzCiAgICAgIGlmIChpc0ZsYWcpIHsKICAgICAgICBidWZmZXIgKz0gY29kZTsKICAgICAgICBhbHRCdWZmZXIgKz0gc3ltYm9sOwogICAgICAgIGlzRmxhZyA9IGZhbHNlOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlzRmxhZyA9IHRydWU7CiAgICB9IGVsc2UgaWYgKGlzRmxhZykgewogICAgICBpc0ZsYWcgPSBmYWxzZTsKICAgIH0KCiAgICBpZiAoYnVmZmVyKSB7CiAgICAgIG91dCArPSBFbW9qaS5nZXRFbW9qaUhUTUwoYnVmZmVyLCBhbHRCdWZmZXIsIHRydWUpOwogICAgfQogICAgYnVmZmVyID0gY29kZTsKICAgIGFsdEJ1ZmZlciA9IHN5bWJvbDsKICB9CgogIGlmIChidWZmZXIpIHsKICAgIG91dCArPSBFbW9qaS5nZXRFbW9qaUhUTUwoYnVmZmVyLCBhbHRCdWZmZXIsIHRydWUpOwogIH0KCiAgcmV0dXJuIG91dDsKfSwKCmVtb2ppQ2hhclNlcTogL1swLTlcdUQ4M0RcdUQ4M0NcdUQ4M0VdLywKCmVtb2ppUmVnRXg6IC8oKD86W1x1MjAzQ1x1MjA0OVx1MjEyMlx1MjMyOFx1MjYwMVx1MjYwRVx1MjYxZFx1MjYyNlx1MjYyQVx1MjYzOFx1MjYzOVx1MjYzYVx1MjY3Qlx1MjY3Rlx1MjcwMlx1MjcwOF18W1x1MjYwMFx1MjZDNFx1MjZCRVx1MjcwNVx1Mjc2NF18W1x1MjE5NC1cdTIxOTlcdTIxQUFcdTIxQTldfFtcdTIzMUEtXHUyMzFCXXxbXHUyM0U5LVx1MjNFRl18W1x1MjNGMC1cdTIzRjRdfFtcdTIzRjgtXHUyM0ZBXXxbXHUyNEMyXXxbXHUyNUFBLVx1MjVBQl18W1x1MjVCNlx1MjVDMF18W1x1MjVGQi1cdTI1RkVdfFtcdTI2MDItXHUyNjE4XXxbXHUyNjQ4LVx1MjY1M118W1x1MjY2MC1cdTI2NjhdfFtcdTI2QTAtXHUyNkZBXXxbXHUyNjkyLVx1MjY5Q118W1x1MjYyRS1cdTI2MkZdfFtcdTI2MjItXHUyNjIzXXxbXHUyNzA5LVx1Mjc2NF18W1x1Mjc5NS1cdTI3OTddfFtcdTI3QTFdfFtcdTI3QkZdfFtcdTI5MzQtXHUyOTM1XXxbXHUyQjA1LVx1MkIwN118W1x1MkIxQl18W1x1MkI1MFx1MkI1NV18W1x1MzAzRF18W1x1MzI5N1x1MzI5OV18W1x1RTAwMC1cdUY4RkZdfFtcdUQ4M0RcdUQ4M0NcdUQ4M0VdW1x1REMwMC1cdURGRkZdfFswLTldXHUyMEUzfFtcdTAwMjMtXHUwMDM5XHUyMDNDLVx1MjFBQVx1MUYzRjNdXHVGRTBGXHUyMEUzfFtcdTIwMENcdTIwMERcdTI2NDBcdTI2NDJcdUZFMEZdKSspL2csCgplbW9qaUpvaW5lcnM6IFsnMjY0MCcsICcyNjQyJywgJzIwMEQnLCAnMjAwQyddLAplbW9qaUpvaW5lcnNSZWdFeDogLzI2NDB8MjY0MnwyMDBEfDIwMEMvZywKZW1vamlGbGFnczogWydEODNDRERFOCcsICdEODNDRERGMycsICdEODNDRERFOScsICdEODNDRERFQScsICdEODNDRERFQScsICdEODNDRERGOCcsICdEODNDRERFQicsICdEODNDRERGNycsICdEODNDRERFQycsICdEODNDRERFNycsICdEODNDRERFRScsICdEODNDRERGOScsICdEODNDRERFRicsICdEODNDRERGNScsICdEODNDRERGMCcsICdEODNDRERGNycsICdEODNDRERGNycsICdEODNDRERGQScsICdEODNDRERGQScsICdEODNDRERGOCcsICdEODNDRERGQScsICdEODNDRERFNicsICdEODNDRERGMCcsICdEODNDRERGRicsICdEODNDRERFNycsICdEODNDRERGRScsICdEODNDRERFNicsICdEODNDRERGQScsICdEODNDRERFNicsICdEODNDRERGOScsICdEODNDRERFNycsICdEODNDRERFQScsICdEODNDRERFNycsICdEODNDRERGNycsICdEODNDRERGQicsICdEODNDRERGMycsICdEODNDRERFRCcsICdEODNDRERGMCcsICdEODNDRERFOScsICdEODNDRERGMCcsICdEODNDRERFRScsICdEODNDRERGMScsICdEODNDRERFRScsICdEODNDRERGMycsICdEODNDRERFRScsICdEODNDRERFOScsICdEODNDRERFRScsICdEODNDRERFQScsICdEODNDRERFOCcsICdEODNDRERFNicsICdEODNDRERFOCcsICdEODNDRERGNCcsICdEODNDRERGMicsICdEODNDRERGNCcsICdEODNDRERGMicsICdEODNDRERGRScsICdEODNDRERGMicsICdEODNDRERGRCcsICdEODNDRERGMycsICdEODNDRERGMScsICdEODNDRERGMycsICdEODNDRERGRicsICdEODNDRERGMycsICdEODNDRERGNCcsICdEODNDRERFNicsICdEODNDRERFQScsICdEODNDRERGNScsICdEODNDRERGMScsICdEODNDRERGNScsICdEODNDRERGOScsICdEODNDRERGNScsICdEODNDRERGNycsICdEODNDRERGOCcsICdEODNDRERFNicsICdEODNDRERGOCcsICdEODNDRERFQycsICdEODNDRERGOScsICdEODNDRERGNycsICdEODNDRERGNScsICdEODNDRERFRCcsICdEODNDRERFQicsICdEODNDRERFRScsICdEODNDRERFOCcsICdEODNDRERGMScsICdEODNDRERFOCcsICdEODNDRERFRCcsICdEODNDRERGOCcsICdEODNDRERFQScsICdEODNDRERGRicsICdEODNDRERFNicsICdEODNDREZGMycsICdEODNDREYwOCddLAoKZ2V0Q29kZTogZnVuY3Rpb24ob2JqKSB7CiAgdmFyIGNvZGUgPSBmYWxzZTsKICBpZiAob2JqLmNsYXNzTmFtZSA9PSAnZW1vamlfY3NzJykgewogICAgY29kZSA9IG9iai5nZXRBdHRyaWJ1dGUoJ2Vtb2ppJyk7CiAgfSBlbHNlIGlmIChvYmouY2xhc3NOYW1lLmluZGV4T2YoJ2Vtb2ppJykgIT0gLTEpIHsKICAgIHZhciBtID0gb2JqLnNyYyAmJiBvYmouc3JjLm1hdGNoKC9cLyhbYS16QS1aMC05XSspKF8yeCk/LnBuZy8pOwogICAgaWYgKG0pIHsKICAgICAgY29kZSA9IG1bMV07CiAgICB9IGVsc2UgewogICAgICBjb2RlID0gb2JqLmdldEF0dHJpYnV0ZSgnZW1vamknKTsKICAgIH0KICB9CiAgcmV0dXJuIGNvZGU7Cn0sCgpnZXRUYWJDb250OiBmdW5jdGlvbihvcHRJZCwgc2VsSWQpIHsKICB2YXIgc3RpY2tlclNpemUgPSAod2luZG93LmRldmljZVBpeGVsUmF0aW8gPj0gMikgPyAnMTI4JyA6ICc2NCc7CgogIHZhciBodG1sID0gJyc7CiAgaWYgKHNlbElkKSB7CiAgICB2YXIgcmVjZW50SHRtbCA9ICcnOwogICAgdmFyIGZvcmNlU3RpY2tlclBhY2sgPSBFbW9qaS5vcHRzW29wdElkXS5mb3JjZVN0aWNrZXJQYWNrOwogICAgZm9yKHZhciBqIGluIHdpbmRvdy5lbW9qaVN0aWNrZXJzKSB7CiAgICAgIHZhciBwYWNrSWQgPSB3aW5kb3cuZW1vamlTdGlja2Vyc1tqXVswXTsKICAgICAgdmFyIGlzQWN0aXZlID0gd2luZG93LmVtb2ppU3RpY2tlcnNbal1bMV07CiAgICAgIHZhciBpc1Byb21vdGVkID0gd2luZG93LmVtb2ppU3RpY2tlcnNbal1bM107CiAgICAgIHZhciBpc0ZvcmNlZCA9IHdpbmRvdy5lbW9qaVN0aWNrZXJzW2pdWzRdICYmIGZvcmNlU3RpY2tlclBhY2sgPT0gcGFja0lkOwogICAgICBpZiAoIWlzQWN0aXZlICYmICFpc0ZvcmNlZCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CgogICAgICB2YXIgcGFjayA9IEVtb2ppLnN0aWNrZXJzW3BhY2tJZF07CiAgICAgIGlmICghcGFjaykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHZhciBwYWNrSHRtbCA9ICc8ZGl2IGNsYXNzPSJjbGVhciBlbW9qaV9zdGlja2Vyc19zcGxpdGVyIiBpZD0iZW1vamlfdGFiX2NvbnRfJytwYWNrSWQrJ18nK29wdElkKyciPjwvZGl2Pic7CiAgICAgIGlmIChwYWNrSWQgPT0gRW1vamkuVEFCX1JFQ0VOVF9TVElDS0VSUykgewogICAgICAgIHBhY2tIdG1sICs9ICc8ZGl2IGNsYXNzPSJlbW9qaV9yZWNlbnRfc3RpY2tlcnNfY29udCIgaWQ9ImVtb2ppX3JlY2VudF9zdGlja2Vyc19jb250JyArIG9wdElkICsgJyI+JzsKICAgICAgfQogICAgICB2YXIgbGlzdCA9IHBhY2suc3RpY2tlcnM7CiAgICAgIGZvciAodmFyIGkgaW4gbGlzdCkgewogICAgICAgIHBhY2tIdG1sICs9IHJzKEVtb2ppLnN0aWNrZXJJdGVtKCksIHsKICAgICAgICAgIG9wdElkOiBvcHRJZCwKICAgICAgICAgIHNlbElkOiBwYWNrSWQsCiAgICAgICAgICBzdGlja2VySWQ6IGxpc3RbaV1bMF0sCiAgICAgICAgICBzaXplOiBsaXN0W2ldWzFdLAogICAgICAgICAgc3RpY2tlclNpemU6IHN0aWNrZXJTaXplCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgaWYgKHBhY2tJZCA9PSBFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTKSB7CiAgICAgICAgcmVjZW50SHRtbCA9IHBhY2tIdG1sICsgJzwvZGl2Pic7CiAgICAgIH0gZWxzZSBpZiAoaXNGb3JjZWQpIHsKICAgICAgICBodG1sID0gcGFja0h0bWwgKyBodG1sOwogICAgICB9IGVsc2UgewogICAgICAgIGh0bWwgKz0gcGFja0h0bWw7CiAgICAgIH0KICAgIH0KICAgIGh0bWwgPSByZWNlbnRIdG1sICsgaHRtbDsKICB9IGVsc2UgewogICAgaHRtbCA9IEVtb2ppLnR0RW1vamlMaXN0KG9wdElkKTsKICB9CiAgcmV0dXJuIGh0bWw7Cn0sCgp1cGRhdGVTdGlja2Vyc0NvbnQ6IGZ1bmN0aW9uKG9wdElkKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICB2YXIgaHRtbCA9IEVtb2ppLmdldFRhYkNvbnQob3B0SWQsIEVtb2ppLlRBQl9SRUNFTlRfU1RJQ0tFUlMpOwogIHZhciBjb250ID0gZ2VCeUNsYXNzMSgnZW1vamlfc2Nyb2xsX3N0aWNrZXJzJywgb3B0cy50dCk7CiAgY29udC5pbm5lckhUTUwgPSBodG1sOwoKICBvcHRzLmluaXRlZFN0aWNrZXJzID0gMTsKICBvcHRzLmltYWdlc0xvYWRpbmcgPSBbXTsKICBjbGVhclRpbWVvdXQob3B0cy5wcmVsb2FkU3RpY2tlcnNUaW1lcik7CgogIHZhciBwb3NUcmVlID0gW10sIHNwbGl0ZXJzUG9zID0gW107CiAgdmFyIGVsID0gY29udC5maXJzdENoaWxkOwogIHZhciByZWNlbnQgPSBmYWxzZTsKICB3aGlsZShlbCkgewogICAgaWYgKCFyZWNlbnQgJiYgaGFzQ2xhc3MoZWwsICdlbW9qaV9yZWNlbnRfc3RpY2tlcnNfY29udCcpKSB7CiAgICAgIGVsID0gZWwuZmlyc3RDaGlsZDsKICAgICAgcmVjZW50ID0gdHJ1ZTsKICAgIH0KICAgIGlmIChoYXNDbGFzcyhlbCwgJ2Vtb2ppX3N0aWNrZXJfaXRlbScpKSB7CiAgICAgIHZhciBpZCA9IGVsLmlkLnJlcGxhY2UoJ2Vtb2ppX3N0aWNrZXJfaXRlbScsICcnKTsKICAgICAgcG9zVHJlZS5wdXNoKFtpZCwgZWwub2Zmc2V0VG9wXSk7CiAgICB9IGVsc2UgaWYgKGhhc0NsYXNzKGVsLCAnZW1vamlfc3RpY2tlcnNfc3BsaXRlcicpKSB7CiAgICAgIHZhciBpZCA9IGVsLmlkLnJlcGxhY2UoJ2Vtb2ppX3RhYl9jb250XycsICcnKS5zcGxpdCgnXycpOwogICAgICBzcGxpdGVyc1Bvcy5wdXNoKFtpbnR2YWwoaWRbMF0pLCBlbC5vZmZzZXRUb3BdKTsKICAgIH0KICAgIGlmICghZWwubmV4dFNpYmxpbmcgJiYgcmVjZW50KSB7CiAgICAgIGVsID0gZWwucGFyZW50Tm9kZTsKICAgIH0KICAgIGVsID0gZWwubmV4dFNpYmxpbmc7CiAgfQogIG9wdHMubmVlZExvYWRTdGlja2VycyA9IHBvc1RyZWU7CiAgb3B0cy5zdGlja2Vyc1NwbGl0ZXJzUG9zID0gc3BsaXRlcnNQb3M7Cn0sCgpzdGlja2VySXRlbTogZnVuY3Rpb24oKSB7CiAgLy8gPGltZyBjbGFzcz0iZW1vamlfc3RpY2tlcl9pbWFnZSBlbW9qaV9uZWVkX2xvYWQiIHNyYz0iL2ltYWdlcy9ibGFuay5naWYiIGRhdGEtc3JjPSIvaW1hZ2VzL3N0aWNrZXJzLyVzdGlja2VySWQlLyVzdGlja2VyU2l6ZSUucG5nIiAvPgogIHJldHVybiAnPGEgaWQ9ImVtb2ppX3N0aWNrZXJfaXRlbSVvcHRJZCVfJXNlbElkJV8lc3RpY2tlcklkJSIgZGF0YS1wYWNrLWlkPSIlc2VsSWQlIiBkYXRhLXNyYz0iL2ltYWdlcy9zdGlja2Vycy8lc3RpY2tlcklkJS8lc3RpY2tlclNpemUlLnBuZyIgY2xhc3M9ImVtb2ppX3N0aWNrZXJfaXRlbSIgb25jbGljaz0iRW1vamkuc3RpY2tlckNsaWNrKCVvcHRJZCUsICVzdGlja2VySWQlLCAlc2l6ZSUsIHRoaXMsIFwna2V5Ym9hcmRcJyk7Ij48L2E+JzsKfSwKaGludHNTdGlja2VySXRlbTogZnVuY3Rpb24oKSB7CiAgcmV0dXJuICc8YSBpZD0iZW1vamlfc3RpY2tlcl9pdGVtJW9wdElkJV8lc2VsSWQlXyVzdGlja2VySWQlIiBkYXRhLXBhY2staWQ9IiVzZWxJZCUiIGNsYXNzPSJlbW9qaV9zdGlja2VyX2l0ZW0gJWNsYXNzJSIgb25jbGljaz0iJW9uY2xpY2slIiBvbm1vdXNlb3Zlcj0iRW1vamkuc3RpY2tlckhpbnRPdmVyKHRoaXMpIiBvbm1vdXNlb3V0PSJFbW9qaS5zdGlja2VySGludE91dCh0aGlzKSI+PGltZyBjbGFzcz0iZW1vamlfc3RpY2tlcl9pbWFnZSIgc3JjPSIvaW1hZ2VzL3N0aWNrZXJzLyVzdGlja2VySWQlLyVzdGlja2VyU2l6ZSUucG5nIiAvPjwvYT4nOwp9LAp0YWJTd2l0Y2g6IGZ1bmN0aW9uKG9iaiwgc2VsSWQsIG9wdElkLCBub1Njcm9sbFVwZGF0ZSkgewogIGlmIChvYmogPT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm47CiAgfQogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF0sIHR0ID0gb3B0cy50dDsKCiAgaWYgKHR5cGVvZiBvYmogPT09ICdudW1iZXInKSB7CiAgICBvYmogPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJfJyArIG9iaiwgdHQpOwogIH0KCiAgdmFyIGVtb2ppV3JhcCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3Njcm9sbF9zbWlsZXMnLCB0dCksCiAgICBzdGlja2Vyc1dyYXAgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc3RpY2tlcnMnLCB0dCk7CgogIHZhbChnZUJ5Q2xhc3MxKCdlbW9qaV9jYXRzX3RpdGxlX2hlbHBlcicsIHR0KSwgJycpOwogIG9wdHMuY3VyRW1vamlDYXRJZCA9IG51bGw7CgogIGlmIChzZWxJZCA9PSBFbW9qaS5UQUJfRU1PSkkpIHsKICAgIGhpZGUoc3RpY2tlcnNXcmFwKTsKICAgIHNob3coZW1vamlXcmFwKTsKCiAgICBpZiAoIW9wdHMuZW1vamlJbml0ZWQpIHsKICAgICAgdmFsKGVtb2ppV3JhcCwgRW1vamkuZ2V0SW5pdEVtb2ppQ29udGVudChvcHRJZCkpOwogICAgICBvcHRzLmVtb2ppSW5pdGVkID0gdHJ1ZTsKICAgIH0KICAgIGlmIChvcHRzLmltYWdlc0xvYWRlcikgewogICAgICBvcHRzLmltYWdlc0xvYWRlci5wcm9jZXNzTG9hZCgpOwogICAgfQoKICAgIGlmIChvcHRzLmVtb2ppT3ZlcmVkICYmIG9wdHMuY3VyVGFiID09PSAwKSB7CiAgICAgIEVtb2ppLmVtb2ppT3ZlcihvcHRJZCwgRW1vamkuZ2V0Rmlyc3RFbW9qaUVsKG9wdElkKSk7CiAgICB9CiAgICBpZiAob3B0cy5jdXJUYWIgIT0gRW1vamkuVEFCX0VNT0pJKSB7CiAgICAgIG9wdHMuZW1vamlTY3JvbGwgJiYgb3B0cy5lbW9qaVNjcm9sbC5zY3JvbGxUb3AoMCk7CiAgICB9CiAgICBFbW9qaS51cGRhdGVSZWNlbnRFbW9qaShvcHRJZCk7CiAgICBFbW9qaS51cGRhdGVFbW9qaUNhdFRpdGxlKG9wdElkKTsKICB9IGVsc2UgewogICAgaGlkZShlbW9qaVdyYXApOwogICAgc2hvdyhzdGlja2Vyc1dyYXApOwoKICAgIHZhciBzdGlja2VycyA9IEVtb2ppLnN0aWNrZXJzICYmIGNsb25lKEVtb2ppLnN0aWNrZXJzKTsKICAgIGlmIChzdGlja2VycykgewogICAgICBkZWxldGUgc3RpY2tlcnNbRW1vamkuVEFCX1JFQ0VOVF9TVElDS0VSU107CiAgICB9CiAgICBpZiAoIXN0aWNrZXJzIHx8IGlzRW1wdHkoc3RpY2tlcnMpIHx8ICFzdGlja2Vyc1tzZWxJZF0gJiYgc2VsSWQgIT0gRW1vamkuVEFCX1JFQ0VOVF9TVElDS0VSUykgewogICAgICBFbW9qaS5vblN0aWNrZXJzTG9hZCA9IEVtb2ppLnRhYlN3aXRjaC5wYmluZChzZWxJZCwgc2VsSWQsIG9wdElkLCBub1Njcm9sbFVwZGF0ZSk7CiAgICAgIEVtb2ppLnN0aWNrZXJzTG9hZGluZ1Byb2dyZXNzKG9wdElkLCBzZWxJZCwgb2JqKTsKICAgICAgb3B0cy5zdGlja2Vyc0luaXRlZCA9IGZhbHNlOwogICAgICBvcHRzLmN1clRhYiA9IG51bGw7CiAgICAgIEVtb2ppLmVtb2ppTG9hZE1vcmUob3B0SWQpOwogICAgfSBlbHNlIGlmICghb3B0cy5zdGlja2Vyc0luaXRlZCkgewogICAgICBFbW9qaS51cGRhdGVTdGlja2Vyc0NvbnQob3B0SWQpOwogICAgICBvcHRzLnN0aWNrZXJzSW5pdGVkID0gdHJ1ZTsKICAgIH0KICAgIGlmIChvcHRzLmN1clRhYiAhPSBzZWxJZCB8fCBvcHRzLmFmdGVyTG9hZCkgewogICAgICBFbW9qaS5zY3JvbGxUb1N0aWNrZXJQYWNrKG9wdElkLCBzZWxJZCwgb3B0cy5jdXJUYWIgPT0gRW1vamkuVEFCX0VNT0pJKTsKICAgICAgb3B0cy5hZnRlckxvYWQgPSAwOwogICAgfQogICAgRW1vamkudXBkYXRlU2hvd25TdGlja2VycyhvcHRJZCwgdHJ1ZSk7CiAgfQoKICBpZiAoIUVtb2ppLm9uU3RpY2tlcnNMb2FkIHx8IHNlbElkID09IEVtb2ppLlRBQl9FTU9KSSkgewogICAgRW1vamkuc2VsZWN0VGFiKG9wdElkLCBzZWxJZCwgb2JqKTsKICB9Cn0sCgpnZXRGaXJzdEVtb2ppRWw6IGZ1bmN0aW9uIChvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgdmFyIGVsID0gZ2VCeUNsYXNzMSgnZW1vamlfc2Nyb2xsX3NtaWxlcycsIG9wdHMudHQpLmZpcnN0Q2hpbGQ7CgogIHdoaWxlKGVsKSB7CiAgICBpZiAoaGFzQ2xhc3MoZWwsICdlbW9qaV9zbWlsZXNfcm93JykpIHsKICAgICAgcmV0dXJuIGVsLmZpcnN0Q2hpbGQ7CiAgICB9CiAgICBlbCA9IGVsLm5leHRTaWJsaW5nOwogIH0KCiAgcmV0dXJuIG51bGw7Cn0sCgpnZXRFbW9qaUVsOiBmdW5jdGlvbiAoZWwsIG5hdikgewogIHZhciBjbnQgPSAwOwoKICB2YXIgcm93ID0gZWwucGFyZW50Tm9kZSwgcG9zID0gMCwgcmVzOwoKICB2YXIgX2VsID0gcm93LmZpcnN0Q2hpbGQ7CiAgd2hpbGUgKF9lbCkgewogICAgcG9zKys7CiAgICBpZiAoX2VsID09PSBlbCkgewogICAgICBicmVhazsKICAgIH0KICAgIF9lbCA9IF9lbC5uZXh0U2libGluZzsKICB9CgogIHdoaWxlKGVsICYmICFyZXMpIHsKCiAgICBpZiAobmF2ID09ICdsZWZ0JyB8fCBuYXYgPT0gJ3JpZ2h0JykgewogICAgICByZXMgPSBuYXYgPT0gJ2xlZnQnID8gZWwucHJldmlvdXNTaWJsaW5nIDogZWwubmV4dFNpYmxpbmc7CgogICAgICBpZiAoIXJlcykgewogICAgICAgIGlmIChuYXYgPT0gJ2xlZnQnKSB7CiAgICAgICAgICBuYXYgPSAndXAnOwogICAgICAgICAgcG9zID0gMTA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5hdiA9ICdkb3duJzsKICAgICAgICAgIHBvcyA9IDE7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKG5hdiA9PSAndXAnIHx8IG5hdiA9PSAnZG93bicpIHsKICAgICAgdmFyIF9yb3cgPSByb3c7CiAgICAgIHdoaWxlKF9yb3cpIHsKICAgICAgICBfcm93ID0gbmF2ID09ICd1cCcgPyBfcm93LnByZXZpb3VzU2libGluZyA6IF9yb3cubmV4dFNpYmxpbmc7CiAgICAgICAgaWYgKCFfcm93IHx8IGhhc0NsYXNzKF9yb3csICdlbW9qaV9zbWlsZXNfcm93JykpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoX3JvdykgewogICAgICAgIGlmIChwb3MgJiYgX3JvdykgewogICAgICAgICAgdmFyIF9wb3MgPSAwLCBfZWwgPSBfcm93LmZpcnN0Q2hpbGQ7CiAgICAgICAgICB3aGlsZShfZWwgJiYgX3BvcyA8IHBvcykgewogICAgICAgICAgICBfcG9zKys7CiAgICAgICAgICAgIGlmIChfcG9zID49IHBvcykgewogICAgICAgICAgICAgIHJlcyA9IF9lbDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBfZWwgPSBfZWwubmV4dFNpYmxpbmc7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIXJlcyAmJiBfcm93KSB7CiAgICAgICAgICByZXMgPSAobmF2ID09ICd1cCcgfHwgcG9zICYmIG5hdiA9PSAnZG93bicpID8gX3Jvdy5sYXN0Q2hpbGQgOiBfcm93LmZpcnN0Q2hpbGQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CgogICAgY250Kys7CiAgICBpZiAoY250ID4gMjApIHsKICAgICAgZGVidWdMb2coJ0VSUiEhJyk7CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgcmV0dXJuIHJlczsKfSwKCnN0aWNrZXJDbGljazogZnVuY3Rpb24ob3B0SWQsIHN0aWNrZXJOdW0sIHdpZHRoLCBvYmosIHN0aWNrZXJfcmVmZXJyZXIpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwoKICBpZiAodmtOb3coKSAtIG9wdHMudHRTaG93VCA8IEVtb2ppLkNMSUNLX0RFTEFZKSB7CiAgICByZXR1cm4KICB9CgogIHZhciBwYWNrSWQgPSBwYXJzZUludChhdHRyKG9iaiwgJ2RhdGEtcGFjay1pZCcpKTsKCiAgdmFyIGFkZFRvUmVjZW50ID0gdHJ1ZTsKICBpZiAod2luZG93LmVtb2ppU3RpY2tlcnMpIHsKICAgIGVhY2god2luZG93LmVtb2ppU3RpY2tlcnMsIGZ1bmN0aW9uKGksIHBhY2spIHsKICAgICAgaWYgKHBhY2tbMF0gPT0gcGFja0lkKSB7CiAgICAgICAgYWRkVG9SZWNlbnQgPSAhIXBhY2tbMV07CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9KTsKICB9CgogIGlmIChhZGRUb1JlY2VudCkgewogICAgaWYgKCFFbW9qaS5zdGlja2Vyc1stMV0pIHsKICAgICAgRW1vamkuc3RpY2tlcnNbLTFdID0ge3N0aWNrZXJzOltdfTsKICAgIH0KICAgIGZvcih2YXIgaSBpbiBFbW9qaS5zdGlja2Vyc1stMV0uc3RpY2tlcnMpIHsKICAgICAgaWYgKEVtb2ppLnN0aWNrZXJzWy0xXS5zdGlja2Vyc1tpXVswXSA9PSBzdGlja2VyTnVtKSB7CiAgICAgICAgRW1vamkuc3RpY2tlcnNbLTFdLnN0aWNrZXJzLnNwbGljZShpLCAxKTsKICAgICAgfQogICAgfQogICAgRW1vamkuc3RpY2tlcnNbLTFdLnN0aWNrZXJzLnVuc2hpZnQoW3N0aWNrZXJOdW0sIHdpZHRoXSk7CiAgICBscy5zZXQoJ3JlY2VudF9zdGlja2VycycsIEVtb2ppLnN0aWNrZXJzWy0xXSk7CiAgICBFbW9qaS51cGRhdGVSZWNlbnRTdGlja2VycyhvcHRJZCk7CiAgfQoKICBpZiAob3B0cy5vblN0aWNrZXJTZW5kKSB7CiAgICBvcHRzLm9uU3RpY2tlclNlbmQoc3RpY2tlck51bSwgc3RpY2tlcl9yZWZlcnJlcik7CiAgfQoKICBFbW9qaS50dEhpZGUob3B0SWQsIGZhbHNlLCBmYWxzZSwgdHJ1ZSk7CiAgb3B0cy5yZWNlbnRTdGlja2VyID0gc3RpY2tlck51bTsKfSwKCnN0aWNrZXJPdmVyOiBmdW5jdGlvbihzdGlja2VyTnVtLCBlbCkgewogIHZhciBwYXJhbXMgPSB7YWN0OiAnYV9zdGlja2Vyc19ob3ZlcicsIHN0aWNrZXJfaWQ6IHN0aWNrZXJOdW0sIGZyb206IGN1ci5tb2R1bGV9OwoKICBpZiAoaXNPYmplY3QoZWwudHQpICYmIGVsLmZpcnN0Q2hpbGQubm9kZU5hbWUgPT09ICdJTUcnKSB7CiAgICByZXR1cm4gZWwudHQuc2hvdygpOwogIH0KCiAgdmFyIG9uRG9uZSA9IGZ1bmN0aW9uICh0b29sdGlwLCBjb250ZW50KSB7CiAgICB2YXIgdHRfaW5kZXggPSAoY3VyLnRvb2x0aXBzIHx8IFtdKS5sZW5ndGg7CiAgICB2YXIgdHRfY2xhc3NuYW1lID0gWwogICAgICAnc3Vic2NyaWJlX3Bvc3RfdHQnLAogICAgICAnc3RpY2tlcl9leHRyYV90dCcsCiAgICAgICdzdGlja2VyX2V4dHJhX3R0JyArIHR0X2luZGV4LAogICAgICAhdG9vbHRpcC5pbWFnZSA/ICd0dF90ZXh0X29ubHknIDogJycKICAgIF07CgogICAgdHRfY2xhc3NuYW1lID0gdHRfY2xhc3NuYW1lLmpvaW4oJyAnKTsKCiAgICBpZiAoIXRvb2x0aXAuc2hvdykgewogICAgICByZXR1cm47CiAgICB9CgoKICAgIHZhciBvcHQgPSB7CiAgICAgIGluZGV4OiB0dF9pbmRleCwKICAgICAgY2xhc3NOYW1lOiB0dF9jbGFzc25hbWUsCiAgICAgIGNvbnRlbnQ6IGNvbnRlbnQsCiAgICAgIHNoaWZ0OiBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gWy0xMzgsIDAsIC0yMDBdOwogICAgICB9LAogICAgICBoYXNvdmVyOiAxLAogICAgICBzbGlkZVg6IDE1LAogICAgICBzaG93c3A6IDE1MCwKICAgICAgY2FjaGU6IDEsCiAgICAgIGZvcmNldG9kb3duOiB0cnVlLAogICAgICBub19zaGFkb3c6IHRydWUsCiAgICAgIGRpcjogJ2xlZnQnLAogICAgICBvblNob3dTdGFydDogZnVuY3Rpb24gKHR0KSB7CiAgICAgICAgdmFyIGVsID0gdHQuY29udGFpbmVyLAogICAgICAgICAgICBzaXplID0gZ2V0U2l6ZSh0dC5jb250YWluZXIpLAogICAgICAgICAgICBlbF9oZWlnaHQgPSBzaXplWzFdLAogICAgICAgICAgICBlbF9oZWlnaHRfZGVmYXVsdCA9IDIyNSwKICAgICAgICAgICAgZWxfaGVpZ2h0X2ZhdWx0ID0gMTA7CgogICAgICAgIGlmIChlbF9oZWlnaHQgPj0gZWxfaGVpZ2h0X2RlZmF1bHQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGVsX2RpZmYgPSBpbnR2YWwoKGVsX2hlaWdodF9kZWZhdWx0IC0gZWxfaGVpZ2h0KSAvIDIpICsgZWxfaGVpZ2h0X2ZhdWx0OwogICAgICAgIGVsX2N1cl90b3AgPSBpbnR2YWwoZ2V0U3R5bGUoZWwsICd0b3AnLCB0cnVlKSk7CiAgICAgICAgZWxfdG9wID0gZWxfY3VyX3RvcCArIGVsX2RpZmY7CiAgICAgICAgc2V0U3R5bGUoZWwsICd0b3AnLCBlbF90b3ApOwogICAgICB9CiAgICB9CgogICAgaWYgKGdwZUJ5Q2xhc3MoJ19pbV9wZWVyX2hpc3RvcnlfdycsIGVsKSkgewogICAgICBvcHQuYXBwZW5kUGFyZW50Q2xzID0gJ19pbV9wZWVyX2hpc3Rvcnlfdyc7CiAgICB9CgogICAgc2hvd1Rvb2x0aXAoZWwsIG9wdCk7CiAgfQoKICBhamF4LnBvc3QoJ2FsX2ltLnBocCcsIHBhcmFtcywge29uRG9uZTogb25Eb25lfSk7Cn0sCgpzZWxlY3RQZWVyOiBmdW5jdGlvbihvcHRJZCkgewogIGlmIChvcHRJZCAhPT0gdW5kZWZpbmVkKSB7CiAgICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogICAgaWYgKG9wdHMucGVlcikgewogICAgICByZXR1cm4gb3B0cy5wZWVyOwogICAgfQogIH0KICB2YXIgcGVlciA9IGN1ci5wZWVyIHx8IChjdXIubWJUbyA/IGN1ci5tYlRvWzBdIDogJycpOwogIGlmIChwZWVyID09IC0zKSB7CiAgICBpZiAoY3VyLndkZFsnaW13X2RkJ10pIHsKICAgICAgdmFyIGNudCA9IDA7CiAgICAgIGZvcih2YXIgaSBpbiBjdXIud2RkWydpbXdfZGQnXS5zZWxlY3RlZCl7CiAgICAgICAgcGVlciA9IGN1ci53ZGRbJ2ltd19kZCddLnNlbGVjdGVkW2ldWzBdOwogICAgICAgIGNudCArPSAxOwogICAgICB9CiAgICAgIGlmIChjbnQgPiAxKSB7CiAgICAgICAgcGVlciA9ICcnOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiBwZWVyOwp9LAoKc2hvd015U3RpY2tlcnM6IGZ1bmN0aW9uKCkgewogIGN1ci5ib3hNeVN0aWNrZXJzID0gc2hvd0JveCgnYWxfaW0ucGhwJywge2FjdDogJ3N0aWNrZXJzX215J30sIHtkYXJrOiAxLCBzdGF0OiBbJ2ltLmNzcycsICdpbW4uanMnLCAnc29ydGVyLmpzJ119KTsKfSwKCnNob3dTdGlja2Vyc1N0b3JlOiBmdW5jdGlvbihvcHRJZCwgZnJvbSkgewogIHZhciBwZWVyID0gRW1vamkuc2VsZWN0UGVlcihvcHRJZCAhPT0gZmFsc2UgPyBvcHRJZCA6IHVuZGVmaW5lZCksCiAgICAgIHBhcmFtcyA9IHthY3Q6ICdzdGlja2Vyc19zdG9yZScsIHBlZXI6IHBlZXIsIGJveDogMX07CiAgaWYgKGZyb20pIHBhcmFtcy5mcm9tID0gZnJvbTsKICBjdXIuYm94U3RpY2tlcnNTdG9yZSA9IHNob3dCb3goJ2FsX2ltLnBocCcsIHBhcmFtcywge2Rhcms6IDEsIHN0YXQ6IFsnaW0uY3NzJywgJ2ltbi5qcycsICdwYWdlX2hlbHAuY3NzJywgJ3NvcnRlci5qcyddfSk7CiAgZWFjaChnZUJ5Q2xhc3MoJ2Vtb2ppX3NtaWxlX2ljb25fcHJvbW8nKSwgZnVuY3Rpb24oaSwgZWwpIHsgZ2VCeUNsYXNzMSgnZW1vamlfc21pbGVfaWNvbicsIGVsLnBhcmVudE5vZGUpOyByZShlbCk7IH0pOwogIGVhY2goZ2VCeUNsYXNzKCdlbW9qaV9zaG9wX2ljb25fYmFkZ2UnKSwgZnVuY3Rpb24oaSwgZWwpIHsgcmUoZWwpOyB9KTsKICBFbW9qaS5oYXNOZXdTdGlja2VycyA9IGZhbHNlOwp9LAoKcHJldmlld1N0aWNrZXI6IGZ1bmN0aW9uKHBhY2tJZCwgb2JqLCBvcHRzLCBldikgewogIG9wdHMgPSBvcHRzIHx8IHt9OwogIGlmIChldiAmJiBjaGVja0V2ZW50KGV2KSkgcmV0dXJuIHRydWU7CiAgdmFyIHBhcmFtcyA9IHthY3Q6ICdzdGlja2VyX3ByZXZpZXcnLCBwYWNrX2lkOiBwYWNrSWR9OwogIHZhciBwZWVyID0gRW1vamkuc2VsZWN0UGVlcigpOwogIGlmIChvcHRzLnBlZXIpIHsKICAgIHBhcmFtcy5wZWVyID0gb3B0cy5wZWVyOwogIH0gZWxzZSBpZiAocGVlcikgewogICAgcGFyYW1zLnBlZXIgPSBwZWVyOwogIH0KICBpZiAob3B0cy5wcmV2aWV3KSB7CiAgICBwYXJhbXMucHJldmlldyA9IDE7CiAgfQogIGlmIChvcHRzLnN0aWNrZXJJZCkgewogICAgcGFyYW1zLnN0aWNrZXJfaWQgPSBvcHRzLnN0aWNrZXJJZDsKICB9CiAgcGFyYW1zLnN0aWNrZXJfcmVmZXJyZXIgPSBvcHRzLnN0aWNrZXJfcmVmZXJyZXIgfHwgJ3N0b3JlJzsKICBpZiAob3B0cy5uYW1lKSB7CiAgICB2YXIgcXVlcnkgPSBuYXYub2JqTG9jWzBdLnNwbGl0KCcvJyk7CiAgICBpZiAocXVlcnlbMF0gPT0gJ3N0aWNrZXJzJyAmJiBxdWVyeVsxXSAhPSBvcHRzLm5hbWUpIHsKICAgICAgbmF2LnNldExvYyh7MDogJ3N0aWNrZXJzLycgKyBvcHRzLm5hbWV9KTsKICAgIH0KICB9CiAgY3VyLmJveFN0aWNrZXJzUHJldmlldyA9IHNob3dCb3goJ2FsX2ltLnBocCcsIHBhcmFtcywge2Rhcms6IDEsIHN0YXQ6IFsnaW0uY3NzJywgJ2ltbi5qcyddLCBvbkZhaWw6IGZ1bmN0aW9uKGUpIHsKICAgIGlmICghd2luZG93LmVtb2ppU3RpY2tlcnNEaXNhYmxlZCkgewogICAgICB3aW5kb3cuZW1vamlTdGlja2Vyc0Rpc2FibGVkID0ge307CiAgICB9CiAgICBpZiAocGFja0lkKSB7CiAgICAgIHdpbmRvdy5lbW9qaVN0aWNrZXJzRGlzYWJsZWRbcGFja0lkXSA9IHRydWU7CiAgICB9CiAgICBpZiAoZSkgcmV0dXJuIHRydWU7CiAgfX0pOwogIGNhbmNlbEV2ZW50KGV2KTsKICByZXR1cm4gZmFsc2U7Cn0sCgppc1N0aWNrZXJQYWNrRW5hYmxlZDogZnVuY3Rpb24ocGFja0lkLCBvblN0aWNrZXJzTG9hZCkgewogIHZhciBlbiA9IGZhbHNlOwogIGlmICghd2luZG93LmVtb2ppU3RpY2tlcnMgJiYgb25TdGlja2Vyc0xvYWQpIHsKICAgIGFqYXgucG9zdCgnYWxfaW0ucGhwJywge2FjdDogJ2Ffc3RpY2tlcnNfbGlzdCd9LCB7CiAgICAgIG9uRG9uZTogZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHdpbmRvdy5lbW9qaVN0aWNrZXJzID0gZGF0YTsKICAgICAgICBvblN0aWNrZXJzTG9hZCgpOwogICAgICB9CiAgICB9KQogICAgcmV0dXJuIDA7CiAgfSBlbHNlIGlmICghd2luZG93LmVtb2ppU3RpY2tlcnMpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZm9yICh2YXIgaSBpbiB3aW5kb3cuZW1vamlTdGlja2VycykgewogICAgaWYgKHdpbmRvdy5lbW9qaVN0aWNrZXJzW2ldWzBdID09IHBhY2tJZCkgewogICAgICBlbiA9IHdpbmRvdy5lbW9qaVN0aWNrZXJzW2ldWzFdID8gdHJ1ZSA6IGZhbHNlOwogICAgICBicmVhazsKICAgIH0KICB9CiAgcmV0dXJuIGVuOwp9LAoKY2xpY2tTdGlja2VyOiBmdW5jdGlvbihwYWNrSWQsIG9iaiwgZXYpIHsKICBpZiAod2luZG93LmVtb2ppU3RpY2tlcnNEaXNhYmxlZCAmJiB3aW5kb3cuZW1vamlTdGlja2Vyc0Rpc2FibGVkW3BhY2tJZF0pIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAob2JqKSB7CiAgICB2YXIgZW4gPSBFbW9qaS5pc1N0aWNrZXJQYWNrRW5hYmxlZChwYWNrSWQsIEVtb2ppLmNsaWNrU3RpY2tlci5wYmluZChwYWNrSWQsIG9iaiwgZXYpKTsKICAgIGlmIChlbiA9PT0gMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoZW4pIHsKICAgICAgdmFyIHR4dCA9IGZhbHNlOwogICAgICBpZiAob2JqLmdldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJykpIHsKICAgICAgICB0eHQgPSBvYmo7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIGVsID0gb2JqLnBhcmVudE5vZGU7CiAgICAgICAgdmFyIG1pbmkgPSBmYWxzZTsKICAgICAgICB3aGlsZSAoZWwgPSBlbC5wYXJlbnROb2RlKSB7CiAgICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICdqcy1pbS1wYWdlJykpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICdmY190YWInKSkgewogICAgICAgICAgICBtaW5pID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICdtdl9jaGF0JykpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWwpIHJldHVybiBmYWxzZTsKICAgICAgICBpZiAoIW1pbmkpIHsKICAgICAgICAgIGlmIChoYXNDbGFzcyhlbCwgJ2pzLWltLXBhZ2UnKSkgewogICAgICAgICAgICB0eHQgPSBnZUJ5Q2xhc3MxKCdfaW1fdGV4dCcpOwogICAgICAgICAgfSBlbHNlIGlmIChoYXNDbGFzcyhlbCwgJ212X2NoYXQnKSkgewogICAgICAgICAgICB0eHQgPSBkb21CeUNsYXNzKGVsLCAnbXZfY2hhdF9yZXBseV9pbnB1dCcpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0eHQgPSBnZUJ5Q2xhc3MxKCdmY19lZGl0YWJsZScsIGVsKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0eHQpIHsKICAgICAgICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbdHh0LmVtb2ppSWRdOwoKICAgICAgICBFbW9qaS50dENsaWNrKHR4dC5lbW9qaUlkLCBnZUJ5Q2xhc3MxKCdfZW1vamlfYnRuJywgdHh0LnBhcmVudE5vZGUucGFyZW50Tm9kZSksIGZhbHNlLCB0cnVlKTsKCiAgICAgICAgdmFyIHRhYiA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYl8nK3BhY2tJZCwgb3B0cy50dCk7CiAgICAgICAgdmFyIHN0aWNrZXJzID0gRW1vamkuc3RpY2tlcnMgJiYgY2xvbmUoRW1vamkuc3RpY2tlcnMpOwogICAgICAgIGlmIChzdGlja2VycykgewogICAgICAgICAgZGVsZXRlIHN0aWNrZXJzWy0xXTsKICAgICAgICB9CiAgICAgICAgaWYgKCFzdGlja2VycyB8fCBpc0VtcHR5KHN0aWNrZXJzKSkgewogICAgICAgICAgRW1vamkub25TdGlja2Vyc0xvYWQgPSBFbW9qaS50YWJTd2l0Y2gucGJpbmQocGFja0lkLCBwYWNrSWQsIHR4dC5lbW9qaUlkKTsKICAgICAgICAgIEVtb2ppLnN0aWNrZXJzTG9hZGluZ1Byb2dyZXNzKHR4dC5lbW9qaUlkLCBwYWNrSWQsIHRhYik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG9wdHMuaW5pdGVkU3RpY2tlcnMgPSAwOwogICAgICAgICAgRW1vamkudGFiU3dpdGNoKHRhYiwgcGFja0lkLCB0eHQuZW1vamlJZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGlmICghb2JqIHx8ICFlbikgewogICAgRW1vamkucHJldmlld1N0aWNrZXIocGFja0lkLCBmYWxzZSwge3N0aWNrZXJfcmVmZXJyZXI6ICdtZXNzYWdlJ30pOwogIH0KICBldiAmJiBjYW5jZWxFdmVudChldik7CiAgcmV0dXJuIGZhbHNlOwp9LAoKc3RpY2tlcnNMb2FkaW5nUHJvZ3Jlc3M6IGZ1bmN0aW9uIChvcHRJZCwgc2VsSWQsIG9iaikgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgcmVtb3ZlQ2xhc3MoZ2VCeUNsYXNzMSgnZW1vamlfdGFiX3NlbCcsIG9wdHMudHQpLCAnZW1vamlfdGFiX3NlbCcpOwogIGFkZENsYXNzKG9iaiwgJ2Vtb2ppX3RhYl9zZWwnKTsKICBnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc3RpY2tlcnMnLCBvcHRzLnR0KS5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz0iZW1vamlfc2Nyb2xsX3Byb2dyZXNzIj4nICsgcnModmsucHJfdHBsLCB7aWQ6ICcnLCBjbHM6ICdwcl9iaWcnfSkgKyAnPC9kaXY+JzsKfSwKCmJ1eVN0aWNrZXJzOiBmdW5jdGlvbihwYWNrSWQsIGV2LCBvYmosIGhhc2gsIHN0aWNrZXJfcmVmZXJyZXIpIHsKICBpZiAob2JqKSB7CiAgICB2YXIgYmFjayA9IG9iai5pbm5lckhUTUw7CiAgICBpZiAoaGFzQ2xhc3Mob2JqLCAnc2Vjb25kYXJ5JykpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQogIHZhciBwZWVyID0gRW1vamkuc2VsZWN0UGVlcigpOwogIGFqYXgucG9zdCgnL2FsX2ltLnBocCcsIHthY3Q6ICdhX3N0aWNrZXJzX2J1eScsIHBhY2tfaWQ6IHBhY2tJZCwgaGFzaDogaGFzaCwgcGVlcjogcGVlciwgc3RpY2tlcl9yZWZlcnJlcjogdW5jbGVhbihzdGlja2VyX3JlZmVycmVyKX0sIHsKICAgIG9uRG9uZTogZnVuY3Rpb24odGV4dCwgbmV3U3RpY2tlcnMsIGtleXdvcmRzLCBidG5UZXh0LCBoaWRlQm94KSB7CiAgICAgIGVhY2goZ2VCeUNsYXNzKCdfc3RpY2tlcl9idG5fJyArIHBhY2tJZCksIGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuaW5uZXJIVE1MID0gYnRuVGV4dDsKICAgICAgICB0aGlzLm9ubW91c2VvdmVyID0gJyc7CiAgICAgICAgdGhpcy5vbmNsaWNrID0gJyc7CiAgICAgICAgYWRkQ2xhc3ModGhpcywgJ3NlY29uZGFyeScpOwogICAgICB9KTsKICAgICAgaWYgKGN1ci5ib3hTdGlja2Vyc1ByZXZpZXcpIHsKICAgICAgICBjdXIuYm94U3RpY2tlcnNQcmV2aWV3LmhpZGUoKTsKICAgICAgfQogICAgICBpZiAoaGlkZUJveCAmJiBjdXIuYm94U3RpY2tlcnNTdG9yZSkgewogICAgICAgIGN1ci5ib3hTdGlja2Vyc1N0b3JlLmhpZGUoKTsKICAgICAgfQogICAgICBzaG93RG9uZUJveCh0ZXh0KTsKICAgICAgaWYgKG5ld1N0aWNrZXJzKSB7CiAgICAgICAgRW1vamkudXBkYXRlVGFicyhuZXdTdGlja2Vycywga2V5d29yZHMsIHRydWUpOwogICAgICAgIHRyeSB7dmsud2lkZ2V0ICYmIFJwYy5jYWxsTWV0aG9kKCdwcm94eScsICd1cGRhdGVTdGlja2VycycpO30gY2F0Y2goZSkge30gLy8gZm9yIHdpZGdldF9jb21tZW50cy5qcwogICAgICAgIGlmICh3aW5kb3cuVmlkZW92aWV3KSB7CiAgICAgICAgICBWaWRlb3ZpZXcub25TdGlja2Vyc1B1cmNoYXNlZChwYWNrSWQpOwogICAgICAgIH0KICAgICAgfQogICAgICB2YXIgYm94ID0gY3VyLnRhYmJlZFN0aWNrZXJzQm94OwogICAgICBpZiAoYm94ICYmIGJveC50YlVwZGF0ZSkgewogICAgICAgIGZvciAodmFyIGkgaW4gYm94LnRiVXBkYXRlKSB7CiAgICAgICAgICBib3gudGJVcGRhdGVbaV0gPSAxOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdmFyIG9wdElkID0gY3VyLmVtb2ppSWQgJiYgY3VyLmVtb2ppSWRbY3VyLnBlZXJdOwogICAgICBpZiAob3B0SWQpIHsKICAgICAgICB2YXIgdGFiRWwgPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJfJytwYWNrSWQsIEVtb2ppLm9wdHNbb3B0SWRdLnR0KTsKICAgICAgICBpZiAodGFiRWwpIHsKICAgICAgICAgIEVtb2ppLnRhYlN3aXRjaCh0YWJFbCwgcGFja0lkLCBvcHRJZCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LAogICAgc2hvd1Byb2dyZXNzOiBsb2NrQnV0dG9uLnBiaW5kKG9iaiksCiAgICBoaWRlUHJvZ3Jlc3M6IHVubG9ja0J1dHRvbi5wYmluZChvYmopLAogICAgb25GYWlsOiBmdW5jdGlvbih0ZXh0KSB7CiAgICAgIGlmICh0ZXh0KSB7CiAgICAgICAgc2V0VGltZW91dChzaG93RmFzdEJveChnZXRMYW5nKCdnbG9iYWxfZXJyb3InKSwgdGV4dCkuaGlkZSwgMzAwMCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfSk7CiAgcmV0dXJuIGNhbmNlbEV2ZW50KGV2KTsKfSwKCnN0aWNrZXJBY3Q6IGZ1bmN0aW9uKG9iaiwgcGFja0lkLCBoYXNoLCBldiwgZnJvbUJ0bikgewogIGlmIChmcm9tQnRuICYmIGhhc0NsYXNzKG9iaiwgJ3NlY29uZGFyeScpKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgdmFyIGJhY2sgPSBvYmouaW5uZXJIVE1MOwogIHZhciBhY3QgPSBmcm9tQnRuID8gaGFzQ2xhc3Mob2JqLCAnc2Vjb25kYXJ5JykgOiBoYXNDbGFzcyhvYmosICdfaW1fc3RpY2tlcl9hY3RpdmF0ZWQnKTsKICBpZiAoYWN0KSB7CiAgICBzdGF0ZSA9IDE7CiAgfSBlbHNlIHsKICAgIHN0YXRlID0gMDsKICB9CiAgdmFyIGJveCA9IGN1ci50YWJiZWRTdGlja2Vyc0JveDsKICBpZiAoYm94KSB7CiAgICBmb3IgKHZhciBpIGluIGJveC50YlVwZGF0ZSkgewogICAgICBib3gudGJVcGRhdGVbaV0gPSAxOwogICAgfQogIH0KICBhamF4LnBvc3QoJy9hbF9pbS5waHAnLCB7YWN0OiAnYV9zdGlja2Vyc19zd2l0Y2gnLCBwYWNrX2lkOiBwYWNrSWQsIGhhc2g6IGhhc2gsIHN0YXRlOiBzdGF0ZSwgZnJvbV9idG46IGZyb21CdG4gPyAxIDogMH0sIHsKICAgIG9uRG9uZTogZnVuY3Rpb24odGV4dCwgbmV3U3RpY2tlcnMsIGtleXdvcmRzLCBidG5UZXh0KSB7CiAgICAgIGlmICghZnJvbUJ0bikgewogICAgICAgIG9iai5pbm5lckhUTUwgPSB0ZXh0OwogICAgICAgIG9iai5vbm1vdXNlb3ZlciA9ICcnOwogICAgICAgIHNldFN0eWxlKG9iaiwge3dpZHRoOiAnYXV0byd9KTsKICAgICAgICB0b2dnbGVDbGFzcyhvYmosICdfaW1fc3RpY2tlcl9hY3RpdmF0ZWQnLCAhc3RhdGUpOwogICAgICB9CiAgICAgIGVhY2goZ2VCeUNsYXNzKCdfc3RpY2tlcl9idG5fJyArIHBhY2tJZCksIGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuaW5uZXJIVE1MID0gYnRuVGV4dDsKICAgICAgICB0aGlzLm9ubW91c2VvdmVyID0gJyc7CiAgICAgICAgdG9nZ2xlQ2xhc3ModGhpcywgJ3NlY29uZGFyeScsICFzdGF0ZSk7CiAgICAgIH0pOwogICAgICBFbW9qaS51cGRhdGVUYWJzKG5ld1N0aWNrZXJzLCBrZXl3b3JkcywgdHJ1ZSk7CiAgICAgIHZhciBlbCA9IG9iai5wYXJlbnROb2RlLnBhcmVudE5vZGU7CiAgICAgIGlmIChmcm9tQnRuKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGN1ci5zdGlja2Vyc1NvcnRlci5kZXN0cm95KCk7CiAgICAgIGlmIChzdGF0ZSkgewogICAgICAgIHNob3coJ2ltX3N0aWNrZXJzX2RlYWN0Jyk7CiAgICAgICAgdmFyIG5ld0NvbnQgPSBnZSgnaW1fc3RpY2tlcnNfZGVhY3Rfd3JhcCcpOwogICAgICAgIGlmIChuZXdDb250LmZpcnN0Q2hpbGQpIHsKICAgICAgICAgIG5ld0NvbnQuaW5zZXJ0QmVmb3JlKGVsLCBuZXdDb250LmZpcnN0Q2hpbGQpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG5ld0NvbnQuYXBwZW5kQ2hpbGQoZWwpOwogICAgICAgIH0KICAgICAgICBzZXRTdHlsZShlbCwge2N1cnNvcjogJ2RlZmF1bHQnfSkKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgbmV3Q29udCA9IGdlQnlUYWcxKCdkaXYnLCAnaW1fc3RpY2tlcnNfbXlfd3JhcCcpOwogICAgICAgIG5ld0NvbnQuYXBwZW5kQ2hpbGQoZWwpOwogICAgICAgIHZhciBvbGRDb250ID0gZ2UoJ2ltX3N0aWNrZXJzX2RlYWN0X3dyYXAnKTsKICAgICAgICBpZiAoIW9sZENvbnQuY2hpbGROb2Rlcy5sZW5ndGgpIHsKICAgICAgICAgIGhpZGUoJ2ltX3N0aWNrZXJzX2RlYWN0Jyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGN1ci5zdGlja2Vyc1NvcnRlckluaXQoKTsKICAgIH0sCiAgICBzaG93UHJvZ3Jlc3M6IGxvY2tCdXR0b24ucGJpbmQob2JqKSwKICAgIGhpZGVQcm9ncmVzczogdW5sb2NrQnV0dG9uLnBiaW5kKG9iaikKICB9KTsKICByZXR1cm4gY2FuY2VsRXZlbnQoZXYpOwp9LAoKZ2V0VGFic0NvZGU6IGZ1bmN0aW9uKG5ld1N0aWNrZXJzLCBvcHRJZCkgewogIHZhciBodG1sID0gJyc7CiAgLy92YXIgc3RpY2tlcnMgPSBbWzAsIDFdXTsKICB2YXIgc3RpY2tlcnMgPSBbXTsKICBpZiAobmV3U3RpY2tlcnMpIHsKICAgIHN0aWNrZXJzLnB1c2guYXBwbHkoc3RpY2tlcnMsIG5ld1N0aWNrZXJzKTsKICB9CiAgaWYgKHN0aWNrZXJzLmxlbmd0aCA+IDEpIHsKICAgIEVtb2ppLmhhc05ld1N0aWNrZXJzID0gZmFsc2U7CiAgfQogIHZhciBmb3JjZVN0aWNrZXJQYWNrID0gRW1vamkub3B0c1tvcHRJZF0uZm9yY2VTdGlja2VyUGFjazsKICB2YXIgc3lzdGVtVGFic0h0bWwgPSAnJzsKICB2YXIgc3RpY2tlcnNUYWJzSHRtbCA9ICcnOwoKICBmb3IgKHZhciBpIGluIHN0aWNrZXJzKSB7CiAgICB2YXIgc3ROdW0gPSBzdGlja2Vyc1tpXVswXTsKICAgIHZhciBpc0FjdGl2ZSA9IHN0aWNrZXJzW2ldWzFdOwogICAgdmFyIGlzUHJvbW90ZWQgPSBzdGlja2Vyc1tpXVszXTsKICAgIHZhciBpc0ZvcmNlZCA9IHN0aWNrZXJzW2ldWzRdICYmIHN0TnVtID09IGZvcmNlU3RpY2tlclBhY2s7CiAgICBpZiAoIWlzQWN0aXZlICYmICFpc1Byb21vdGVkICYmICFpc0ZvcmNlZCkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBpZiAoaXNBY3RpdmUgfHwgaXNGb3JjZWQpIHsKICAgICAgdmFyIGFjdCA9ICdyZXR1cm4gRW1vamkudGFiU3dpdGNoKHRoaXMsICcrc3ROdW0rJywgJytvcHRJZCsnKTsnOwogICAgfSBlbHNlIHsKICAgICAgdmFyIGFjdCA9ICdyZXR1cm4gRW1vamkucHJldmlld1N0aWNrZXIoJytzdE51bSsnLCBmYWxzZSwge3N0aWNrZXJfcmVmZXJyZXI6IFwna2V5Ym9hcmRcJ30pOyc7CiAgICB9CiAgICBpZiAoc3RpY2tlcnNbaV1bMl0pIHsKICAgICAgRW1vamkuaGFzTmV3U3RpY2tlcnMgPSBzdGlja2Vyc1tpXVsyXTsKICAgIH0KICAgIGlmIChzdE51bSA9PT0gLTEpIHsKICAgICAgc3lzdGVtVGFic0h0bWwgKz0gJzxhIGNsYXNzPSJlbW9qaV90YWIgZW1vamlfdGFiX2ltZ19jb250IGVtb2ppX3RhYl9yZWNlbnQgZW1vamlfdGFiXycgKyBzdE51bSArIChjdXIuc3RpY2tlcnNUYWIgPT0gc3ROdW0gPyAnIGVtb2ppX3RhYl9zZWwnIDogJycpKyciIG9uY2xpY2s9IicrYWN0KyciPjxzcGFuIGNsYXNzPSJlbW9qaV90YWJfaWNvbiBlbW9qaV9zcHJpdGUgZW1vamlfdGFiX2ljb25fcmVjZW50Ij48L3NwYW4+PC9hPic7CiAgICB9IGVsc2UgaWYgKHN0TnVtKSB7CiAgICAgIHZhciB0YWJIdG1sID0gJzxhIGNsYXNzPSJlbW9qaV90YWIgZW1vamlfdGFiX2ltZ19jb250IGVtb2ppX3RhYl8nICsgc3ROdW0gKyAoY3VyLnN0aWNrZXJzVGFiID09IHN0TnVtID8gJyBlbW9qaV90YWJfc2VsJyA6ICcnKSsoaXNBY3RpdmUgfHwgaXNGb3JjZWQgPyAnJyA6ICcgZW1vamlfdGFiX3Byb21vJykrJyIgb25jbGljaz0iJythY3QrJyI+PGltZyB3aWR0aD0iMjIiIGhlaWdodD0iMjIiIHNyYz0iL2ltYWdlcy9zdG9yZS9zdGlja2Vycy8nK3N0TnVtKycvdGh1bWJfJysod2luZG93LmRldmljZVBpeGVsUmF0aW8gPj0gMiA/ICc0NCcgOiAnMjInKSsnLnBuZyIgY2xhc3M9ImVtb2ppX3RhYl9pbWciLz48L2E+JzsKICAgICAgaWYgKGlzRm9yY2VkKSB7CiAgICAgICAgc3RpY2tlcnNUYWJzSHRtbCA9IHRhYkh0bWwgKyBzdGlja2Vyc1RhYnNIdG1sOwogICAgICB9IGVsc2UgewogICAgICAgIHN0aWNrZXJzVGFic0h0bWwgKz0gdGFiSHRtbDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgc3lzdGVtVGFic0h0bWwgKz0gJzxhIGNsYXNzPSJlbW9qaV90YWIgZW1vamlfdGFiXycrc3ROdW0rKGN1ci5zdGlja2Vyc1RhYiA9PSBzdE51bSA/ICcgZW1vamlfdGFiX3NlbCcgOiAnJykrKGlzQWN0aXZlID8gJycgOiAnIGVtb2ppX3RhYl9wcm9tbycpKyciIG9uY2xpY2s9IicrYWN0KyciPjxkaXYgY2xhc3M9ImVtb2ppX3RhYl9pY29uIGVtb2ppX3Nwcml0ZSBlbW9qaV90YWJfaWNvbl8nK3N0TnVtKyciPjwvZGl2PjwvYT4nOwogICAgfQogIH0KICByZXR1cm4gc3lzdGVtVGFic0h0bWwgKyBzdGlja2Vyc1RhYnNIdG1sOwp9LAoKdXBkYXRlVGFiczogZnVuY3Rpb24obmV3U3RpY2tlcnMsIGtleXdvcmRzLCB1cGRhdGUpIHsKICBpZiAobmV3U3RpY2tlcnMgJiYgdXBkYXRlICYmIHdpbmRvdy5Ob3RpZmllcikgewogICAgTm90aWZpZXIubGNTZW5kKCdlbW9qaScsIHthY3Q6ICd1cGRhdGVUYWJzJywgbmV3U3RpY2tlcnM6IG5ld1N0aWNrZXJzLCBrZXl3b3Jkczoga2V5d29yZHN9KTsKICB9CgogIHZhciBuZWVkS2V5d29yZHMgPSAwOwogIGlmIChrZXl3b3JkcyA9PT0gdW5kZWZpbmVkKSB7CiAgICBFbW9qaS5pbml0U3RpY2tlcnNLZXl3b3JkcygpOwogICAgaWYgKCF3aW5kb3cuc3RpY2tlcnNLZXl3b3Jkc0RhdGEpIHsKICAgICAgbmVlZEtleXdvcmRzID0gMTsKICAgIH0KICB9IGVsc2UgewogICAgd2luZG93LnN0aWNrZXJzS2V5d29yZHNEYXRhID0ga2V5d29yZHM7CiAgICBFbW9qaS5zZXRTdGlja2Vyc0tleXdvcmRzKHdpbmRvdy5zdGlja2Vyc0tleXdvcmRzRGF0YSwgdXBkYXRlKTsKICB9CgogIGlmIChuZXdTdGlja2VycyA9PT0gdW5kZWZpbmVkKSB7CiAgICBpZiAoIXdpbmRvdy5lbW9qaVN0aWNrZXJzIHx8ICF3aW5kb3cuc3RpY2tlcnNLZXl3b3Jkc0RhdGEpIHsKICAgICAgYWpheC5wb3N0KCdhbF9pbS5waHAnLCB7YWN0OiAnYV9zdGlja2Vyc19saXN0JywgbmVlZF9rZXl3b3JkczogbmVlZEtleXdvcmRzLCBjYWNoZV90aW1lOiBFbW9qaS5jYWNoZWRTdGlja2Vyc0tleXdvcmRzVGltZSgpfSwgewogICAgICAgIG9uRG9uZTogRW1vamkudXBkYXRlVGFicwogICAgICB9KQogICAgfQogIH0gZWxzZSB7CiAgICB3aW5kb3cuZW1vamlTdGlja2VycyA9IG5ld1N0aWNrZXJzOwogIH0KICBmb3IgKHZhciBpIGluIEVtb2ppLm9wdHMpIHsKICAgIHZhciBvcHRzID0gRW1vamkub3B0c1tpXTsKICAgIGlmIChvcHRzLm5vU3RpY2tlcnMpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICB2YXIgaHRtbCA9ICcnOwogICAgaHRtbCArPSBFbW9qaS5nZXRUYWJzQ29kZSh3aW5kb3cuZW1vamlTdGlja2VycywgaSk7CiAgICB2YXIgdGFic0NvbnQgPSBnZSgnZW1vamlfdGFic19jb250XycraSk7CiAgICBpZiAodGFic0NvbnQpIHsKICAgICAgdGFic0NvbnQuaW5uZXJIVE1MID0gaHRtbDsKICAgIH0KICAgIEVtb2ppLmNoZWNrRW1vamlTbGlkZXIob3B0cyk7CiAgICBFbW9qaS5jaGVja05ld1N0aWNrZXJzKG9wdHMpOwogICAgb3B0cy5zdGlja2Vyc0luaXRlZCA9IGZhbHNlOwogIH0KCiAgdmFyIHN0aWNrZXJzID0gRW1vamkuc3RpY2tlcnMgJiYgY2xvbmUoRW1vamkuc3RpY2tlcnMpOwogIGlmIChzdGlja2VycykgewogICAgZGVsZXRlIHN0aWNrZXJzW0Vtb2ppLlRBQl9SRUNFTlRfU1RJQ0tFUlNdOwogIH0KICBpZiAoRW1vamkub25TdGlja2Vyc0xvYWQgJiYgd2luZG93LmVtb2ppU3RpY2tlcnMgJiYgIWlzRW1wdHkoc3RpY2tlcnMpKSB7CiAgICBFbW9qaS5vblN0aWNrZXJzTG9hZCgpOwogICAgRW1vamkub25TdGlja2Vyc0xvYWQgPSBmYWxzZTsKICB9Cn0sCgpjaGVja05ld1N0aWNrZXJzOiBmdW5jdGlvbihvcHRzKSAgewogIHZhciB0eHQgPSBvcHRzLnR4dDsKICBpZiAoIW9wdHMubm9TdGlja2VycyAmJiAhb3B0cy5ub1N0aWNrZXJzU3RvcmUgJiYgd2luZG93LmVtb2ppU3RpY2tlcnMgJiYgdHh0LmdldEF0dHJpYnV0ZSgnY29udGVudGVkaXRhYmxlJykpIHsKCiAgICBmb3IgKHZhciBpIGluIHdpbmRvdy5lbW9qaVN0aWNrZXJzKSB7CiAgICAgIGlmICh3aW5kb3cuZW1vamlTdGlja2Vyc1tpXVsyXSkgewogICAgICAgIEVtb2ppLmhhc05ld1N0aWNrZXJzID0gd2luZG93LmVtb2ppU3RpY2tlcnNbaV1bMl07CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChFbW9qaS5oYXNOZXdTdGlja2VycyA8IDAgJiYgIUVtb2ppLm5vTmV3U3RpY2tlcnMpIHsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBlYWNoKGdlQnlDbGFzcygnZW1vamlfc21pbGVfaWNvbicpLCBmdW5jdGlvbihpLCBlbCkgewoKICAgICAgICAgIHZhciBwcm9tb05vZGUgPSBlbC5wYXJlbnROb2RlOwogICAgICAgICAgaWYgKCFnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZV9pY29uX3Byb21vJywgcHJvbW9Ob2RlKSkgewogICAgICAgICAgICBwcm9tb05vZGUuYXBwZW5kQ2hpbGQoY2UoJ2RpdicsIHtjbGFzc05hbWU6ICdlbW9qaV9zbWlsZV9pY29uX3Byb21vJ30pKTsKICAgICAgICAgICAgYWRkRXZlbnQoZWwsICdtb3VzZW92ZXInLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBzaG93VG9vbHRpcCh0aGlzLCB7dGV4dDogZ2V0TGFuZygnZ2xvYmFsX3N0b3JlX3N0aWNrZXJzX25ld19hdmFpbGFibGUnKSwgc2hpZnQ6IFs3LDEsNF0sIHNob3dkdDogMCwgYmxhY2s6IDF9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0sIGhhc0NsYXNzKHR4dCwgJ2ZjX2VkaXRhYmxlJykgPyAyMDAgOiAwKTsKICAgIH0KICB9Cn0sCgpjaGVja0Vtb2ppU2xpZGVyOiBmdW5jdGlvbihvcHRzKSB7CiAgdmFyIGNvbnQgPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzX3dyYXAnLCBvcHRzLnR0KTsKICB2YXIgc2hvdWxkU2hvdyA9IGZhbHNlOwogIGlmICghY29udCkgewogICAgcmV0dXJuOwogIH0KICBpZiAoY29udC5maXJzdENoaWxkLmNsaWVudFdpZHRoICYmIChjb250LmZpcnN0Q2hpbGQuY2xpZW50V2lkdGggPiBjb250LmNsaWVudFdpZHRoICsgY29udC5zY3JvbGxMZWZ0KSkgewogICAgc2hvdWxkU2hvdyA9IHRydWU7CiAgfSBlbHNlIHsKICAgIHZhciBjYXRzID0gY29udC5maXJzdENoaWxkLmNoaWxkTm9kZXM7CiAgICBpZiAoY2F0cy5sZW5ndGggPiA2KSB7CiAgICAgIGlmICgob3B0cy5zY3JvbGxMZWZ0IHx8IDApIDwgKGNhdHMubGVuZ3RoIC0gNikgKiAzNCAtIDE2KSB7CiAgICAgICAgc2hvdWxkU2hvdyA9IHRydWU7CiAgICAgIH0KICAgIH0KICB9CgogIHZhciByZGlyID0gdmsucnRsID8gJ2wnIDogJ3InOwogIGlmIChzaG91bGRTaG93KSB7CiAgICBvcHRzLnNsaWRlclNob3duID0gdHJ1ZTsKICAgIEVtb2ppLnNjcm9sbFRvZ2dsZUFycm93KHRydWUsIHJkaXIsIG9wdHMsIHRydWUpOwogIH0gZWxzZSBpZiAob3B0cy5zbGlkZXJTaG93bikgewogICAgb3B0cy5zbGlkZXJTaG93biA9IGZhbHNlOwogICAgRW1vamkuc2Nyb2xsVG9nZ2xlQXJyb3coZmFsc2UsIHJkaXIsIG9wdHMsIHRydWUpOwogIH0KfSwKCmdpZnRTdGlja2VyOiBmdW5jdGlvbihwYWNrSWQsIHBlZXJzSWRzLCBldiwgb3B0cykgewogIG9wdHMgPSBvcHRzIHx8IHt9OwogIHZhciBwYXJhbXMgPSB7CiAgICBhY3Q6ICdzdGlja2Vyc19naWZ0X2JveCcsCiAgICBwYWNrX2lkOiBwYWNrSWQsCiAgICBwZWVyczogcGVlcnNJZHMKICB9OwogIGlmIChvcHRzLmZyb20pIHsKICAgIHBhcmFtcy5mcm9tID0gb3B0cy5mcm9tOwogIH0KICBwYXJhbXMuc3RpY2tlcl9yZWZlcnJlciA9IG9wdHMuc3RpY2tlcl9yZWZlcnJlciB8fCAnc3RvcmUnOwogIGJveExheWVyV3JhcC5zY3JvbGxUb3AgPSAwOwogIHNob3dCb3goJy9hbF9pbS5waHAnLCBwYXJhbXMsIHsKICAgIHN0YXQ6IFsnd2lkZV9kZC5qcycsICd3aWRlX2RkLmNzcycsICdub3RpZmllci5jc3MnLCAnbm90aWZpZXIuanMnXSwKICAgIGRhcms6IDEKICB9KTsKICByZXR1cm4gY2FuY2VsRXZlbnQoZXYpOwp9LAoKc2hvd1N0aWNrZXJUVDogZnVuY3Rpb24oZWwpIHsKICB2YXIgdGV4dCA9IGVsLmdldEF0dHJpYnV0ZSgnZGF0YS10aXRsZScpOwogIGlmICghdGV4dCkgcmV0dXJuOwogIHNob3dUb29sdGlwKGVsLCB7CiAgICB0ZXh0OiB0ZXh0LAogICAgc2xpZGU6IDE1LAogICAgc2hpZnQ6IFs3NCAtIGdldFNpemUoZWwpWzBdIC8gMiwgMTIwLCA1XSwKICAgIGNsYXNzTmFtZTogJ3N0aWNrZXJfaGludF90dCcsCiAgICBoYXNvdmVyOiAxCiAgfSk7Cn0sCgpzY3JvbGxUb1N0aWNrZXJQYWNrOiBmdW5jdGlvbiAob3B0SWQsIHNlbElkLCBmYXN0KSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXSwKICAgIHN0aWNrZXJzU3RhcnQgPSBnZSgnZW1vamlfdGFiX2NvbnRfJyArIHNlbElkICsgJ18nICsgb3B0SWQpLAogICAgc3QgPSAoc3RpY2tlcnNTdGFydCAmJiBzZWxJZCAhPSBFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTKSA/IHN0aWNrZXJzU3RhcnQub2Zmc2V0VG9wICsgZ2V0U2l6ZShzdGlja2Vyc1N0YXJ0KVsxXSA6IDA7CgogIG9wdHMuc2Nyb2xsQW5pbWF0aW9uID0gMTsKICBvcHRzLmVtb2ppU2Nyb2xsLnNjcm9sbFRvcChzdCwgZmFzdCA/IDAgOiAyMDAsIGZ1bmN0aW9uICgpIHsKICAgIG9wdHMuc2Nyb2xsQW5pbWF0aW9uID0gMDsKICB9KTsKICBFbW9qaS5zY3JvbGxUb1RhYihzZWxJZCwgb3B0SWQpOwp9LAoKdG9nZ2xlU3RpY2tlcnM6IGZ1bmN0aW9uKG9wdElkLCBub1N0aWNrZXJzKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBpZiAob3B0cyAmJiBvcHRzLnR0KSB7CiAgICBvcHRzLm5vU3RpY2tlcnMgPSBub1N0aWNrZXJzOwogICAgdG9nZ2xlQ2xhc3Mob3B0cy50dCwgJ2Vtb2ppX25vX3RhYnMnLCBub1N0aWNrZXJzKTsgLy8gd29ya3MgaWYgaW5pdCgpIHdhcyB3aXRoIHN0aWNrZXJzCiAgICBpZiAob3B0cy5jdXJUYWIpCiAgICAgIEVtb2ppLnRhYlN3aXRjaCgwLCAwLCBvcHRJZCk7CiAgfSBlbHNlIGlmIChvcHRzKSB7CiAgICBvcHRzLmhpZGVTdGlja2Vyc0luaXRpYWwgPSBub1N0aWNrZXJzOwogIH0KfSwKCmdldFNpemVDYWNoZWQ6IGZ1bmN0aW9uIChlbCkgewogIGVsID0gZ2UoZWwpOwogIGlmICghZWwpIHsKICAgIHJldHVybiBbMCwgMF07CiAgfQoKICBpZiAoZWxbRW1vamkuQ0FDSEVEX1dJRFRIX1BST1BdID09PSB1bmRlZmluZWQgfHwgZWxbRW1vamkuQ0FDSEVEX0hFSUdIVF9QUk9QXSA9PT0gdW5kZWZpbmVkKSB7CiAgICBlbFtFbW9qaS5DQUNIRURfV0lEVEhfUFJPUF0gPSBlbC5vZmZzZXRXaWR0aDsKICAgIGVsW0Vtb2ppLkNBQ0hFRF9IRUlHSFRfUFJPUF0gPSBlbC5vZmZzZXRIZWlnaHQ7CiAgfQoKICByZXR1cm4gW2VsW0Vtb2ppLkNBQ0hFRF9XSURUSF9QUk9QXSwgZWxbRW1vamkuQ0FDSEVEX0hFSUdIVF9QUk9QXV07Cn0sCgpfX2VvZjogMX19CnRyeXtzdE1hbmFnZXIuZG9uZSgnZW1vamkuanMnKTt9Y2F0Y2goZSl7fQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPBody>
        <TcpPackets>
          <PacketInfo time="295642078" offset="0" length="461" />
          <PacketInfo time="295642156" offset="461" length="8193" />
          <PacketInfo time="295642156" offset="8654" length="8193" />
          <PacketInfo time="295642156" offset="16847" length="8193" />
          <PacketInfo time="295642171" offset="25040" length="8193" />
          <PacketInfo time="295642171" offset="33233" length="4" />
          <PacketInfo time="295642171" offset="33237" length="3845" />
          <PacketInfo time="295642171" offset="37082" length="5" />
        </TcpPackets>
      </HTTPResponse>
    </HTTPTask>
  </HTTPTask>
</HTTPSnapshot>
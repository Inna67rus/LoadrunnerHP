<?xml version="1.0" encoding="utf-8"?>
<HTTPSnapshot xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" id="171">
  <HTTPTask id="6842" hostname="vk.com" path="/notifier.php?act=storage_frame&amp;from=vk.com&amp;4" url="https://vk.com/notifier.php?act=storage_frame&amp;from=vk.com&amp;4" ip="87.240.165.80" port="443" connectionId="13" origin="Primary" frame="1" startDateTime="2017-11-24T14:51:37.338+03:00" startTime="75352312" endTime="75352453">
    <QueryString>
      <HTTPDataSet>
        <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
          <ActualData>YWN0PXN0b3JhZ2VfZnJhbWUmZnJvbT12ay5jb20mNA==</ActualData>
        </HTTPData>
      </HTTPDataSet>
      <IsExternalData>false</IsExternalData>
    </QueryString>
    <HTTPSplittedQueryStrings>
      <HTTPHeaderEntity name="act" index="0">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>c3RvcmFnZV9mcmFtZQ==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="from" index="1">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>dmsuY29t</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
      <HTTPHeaderEntity name="" index="2">
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>NA==</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPHeaderEntity>
    </HTTPSplittedQueryStrings>
    <HTTPRequest method="GET">
      <HTTPHeaders>
        <HTTPHeaderEntity name="Host" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dmsuY29t</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Upgrade-Insecure-Requests" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="User-Agent" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYyLjAuMzIwMi45NCBTYWZhcmkvNTM3LjM2</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Referer" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aHR0cHM6Ly92ay5jb20v</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Encoding" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Accept-Language" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cnUtUlUscnU7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjc=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cookie" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cmVtaXhsYW5nPTA7IHJlbWl4c3RpZD01MDQxNzY4MjFfMDY0ZjMxMDQ4MmZhYzAyNGMyOyByZW1peGZsYXNoPTAuMC4wOyByZW1peHNjcmVlbl9kZXB0aD0yNDsgcmVtaXhkdD0wOyB0bXJfZGV0ZWN0PTElN0MxNTExNTI0MTUzMDQwOyByZW1peHNpZD1hZWU5YjhiMzhhNDg0Y2I3ZWQ5NGYwM2IwNmYwYWFjNGQ2MGIwNjBmNjlmMTdjYjljNmU1NQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>R0VUIC9ub3RpZmllci5waHA/YWN0PXN0b3JhZ2VfZnJhbWUmZnJvbT12ay5jb20mNCBIVFRQLzEuMQ0KSG9zdDogdmsuY29tDQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpVcGdyYWRlLUluc2VjdXJlLVJlcXVlc3RzOiAxDQpVc2VyLUFnZW50OiBNb3ppbGxhLzUuMCAoV2luZG93cyBOVCAxMC4wOyBXaW42NDsgeDY0KSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvNjIuMC4zMjAyLjk0IFNhZmFyaS81MzcuMzYNCkFjY2VwdDogdGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOA0KUmVmZXJlcjogaHR0cHM6Ly92ay5jb20vDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUsIGJyDQpBY2NlcHQtTGFuZ3VhZ2U6IHJ1LVJVLHJ1O3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43DQpDb29raWU6IHJlbWl4bGFuZz0wOyByZW1peHN0aWQ9NTA0MTc2ODIxXzA2NGYzMTA0ODJmYWMwMjRjMjsgcmVtaXhmbGFzaD0wLjAuMDsgcmVtaXhzY3JlZW5fZGVwdGg9MjQ7IHJlbWl4ZHQ9MDsgdG1yX2RldGVjdD0xJTdDMTUxMTUyNDE1MzA0MDsgcmVtaXhzaWQ9YWVlOWI4YjM4YTQ4NGNiN2VkOTRmMDNiMDZmMGFhYzRkNjBiMDYwZjY5ZjE3Y2I5YzZlNTUNCg0K</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
        <HTTPCookies>
          <HTTPHeaderEntity name="remixlang" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixstid" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>NTA0MTc2ODIxXzA2NGYzMTA0ODJmYWMwMjRjMg==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixflash" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MC4wLjA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixscreen_depth" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MjQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixdt" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="tmr_detect" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>MSU3QzE1MTE1MjQxNTMwNDA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="remixsid" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>YWVlOWI4YjM4YTQ4NGNiN2VkOTRmMDNiMDZmMGFhYzRkNjBiMDYwZjY5ZjE3Y2I5YzZlNTU=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
        </HTTPCookies>
      </HTTPHeaders>
    </HTTPRequest>
    <HTTPResponse>
      <contentLenght>2526</contentLenght>
      <HTTPHeaders>
        <HTTPHeaderEntity name="Server" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bmdpbng=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Date" index="1">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>RnJpLCAyNCBOb3YgMjAxNyAxMTo0OTo0MiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Type" index="2">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>dGV4dC9odG1sOyBjaGFyc2V0PXdpbmRvd3MtMTI1MQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Adguard-Filtered" index="3">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>QWRHdWFyZCBmb3IgV2luZG93czsgdmVyc2lvbj02LjIuNDMzLjIxNjc=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Connection" index="4">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Powered-By" index="5">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>UEhQLzMuMTQxNTg=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Pragma" index="6">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>cHVibGlj</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Cache-Control" index="7">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4YWdlPTM0NTYwMA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Expires" index="8">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>VHVlLCAyOCBOb3YgMjAxNyAxMTo0OTo0MiBHTVQ=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Content-Length" index="9">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>MjUyNg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Strict-Transport-Security" index="10">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>bWF4LWFnZT0w</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="X-Frontend" index="11">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>ZnJvbnQ1MDgxMjE=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPHeaderEntity name="Access-Control-Expose-Headers" index="12">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>WC1Gcm9udGVuZA==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
        <HTTPAllHeaders>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54DQpEYXRlOiBGcmksIDI0IE5vdiAyMDE3IDExOjQ5OjQyIEdNVA0KQ29udGVudC1UeXBlOiB0ZXh0L2h0bWw7IGNoYXJzZXQ9d2luZG93cy0xMjUxDQpYLUFkZ3VhcmQtRmlsdGVyZWQ6IEFkR3VhcmQgZm9yIFdpbmRvd3M7IHZlcnNpb249Ni4yLjQzMy4yMTY3DQpDb25uZWN0aW9uOiBrZWVwLWFsaXZlDQpYLVBvd2VyZWQtQnk6IFBIUC8zLjE0MTU4DQpQcmFnbWE6IHB1YmxpYw0KQ2FjaGUtQ29udHJvbDogbWF4YWdlPTM0NTYwMA0KRXhwaXJlczogVHVlLCAyOCBOb3YgMjAxNyAxMTo0OTo0MiBHTVQNCkNvbnRlbnQtTGVuZ3RoOiAyNTI2DQpTdHJpY3QtVHJhbnNwb3J0LVNlY3VyaXR5OiBtYXgtYWdlPTANClgtRnJvbnRlbmQ6IGZyb250NTA4MTIxDQpBY2Nlc3MtQ29udHJvbC1FeHBvc2UtSGVhZGVyczogWC1Gcm9udGVuZA0KDQo=</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPAllHeaders>
      </HTTPHeaders>
      <HTTPBody>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>PCFET0NUWVBFIGh0bWwgUFVCTElDICItLy9XM0MvL0RURCBYSFRNTCAxLjAgU3RyaWN0Ly9FTiIgImh0dHA6Ly93d3cudzMub3JnL1RSL3hodG1sMS9EVEQveGh0bWwxLXN0cmljdC5kdGQiPgo8aHRtbCB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgeG1sOmxhbmc9ImVuIiBsYW5nPSJlbiI+CjxoZWFkPgogIDxtZXRhIGh0dHAtZXF1aXY9ImNvbnRlbnQtdHlwZSIgY29udGVudD0idGV4dC9odG1sOyBjaGFyc2V0PXdpbmRvd3MtMTI1MSIgLz4KICA8bWV0YSBodHRwLWVxdWl2PSJYLVVBLUNvbXBhdGlibGUiIGNvbnRlbnQ9IklFPWVkZ2UiIC8+Cg0KPCEtLSBTdGFydDogaW5qZWN0ZWQgYnkgQWRndWFyZCAtLT4NCjxzY3JpcHQgc3JjPSIvL2xvY2FsLmFkZ3VhcmQuY29tL2FkZ3VhcmQtYWpheC1hcGkvaW5qZWN0aW9ucy91c2Vyc2NyaXB0cy5qcz90cz02MzY0NzA1NjUyODY0MCZuYW1lPUFkZ3VhcmQlMjBBc3Npc3RhbnQlMjBCZXRhJm5hbWU9V2ViJTIwb2YlMjBUcnVzdCUyMEJldGEiIG5vbmNlPSIxOGE3NzYxNDc5NjQ0MzU2OTBhNjgyMDQwYzJiZjBlYiIgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij48L3NjcmlwdD4NCjxzY3JpcHQgc3JjPSIvL2xvY2FsLmFkZ3VhcmQuY29tL2FkZ3VhcmQtYWpheC1hcGkvaW5qZWN0aW9ucy9jb250ZW50LXNjcmlwdC5qcz90cz02MzY0NzA3ODA3OTA2NyZhbXA7ZG9tYWluPXZrLmNvbSZhbXA7bWFzaz0xMTEiIG5vbmNlPSIxOGE3NzYxNDc5NjQ0MzU2OTBhNjgyMDQwYzJiZjBlYiIgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij48L3NjcmlwdD4NCg0KPCEtLSBFbmQ6IGluamVjdGVkIGJ5IEFkZ3VhcmQgLS0+DQo8L2hlYWQ+Cjxib2R5Pgo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+Cgp2YXIgcmlnaHRPcmlnaW4gPSBsb2NhdGlvbi5wcm90b2NvbCArICcvL3ZrLmNvbSc7Ci8vIHJpZ2h0T3JpZ2luID0gJyonOwoKZnVuY3Rpb24gb25TdG9yYWdlRXYoZSkgewogIGUgPSBlIHx8IHdpbmRvdy5ldmVudDsKICB2YXIga2V5ID0gZS5rZXksIHZhbCA9IGUubmV3VmFsdWU7CiAgaWYgKCFrZXkpIHsKICAgIGtleSA9IF9rZXk7CiAgICB2YWwgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpIHx8ICcnOwogICAgaWYgKHZhbCA9PSBwcmV2VmFsKSByZXR1cm47CiAgICBwcmV2VmFsID0gdmFsOwogIH0KICBpZiAoMCkgewogICAgdHJ5IHtjb25zb2xlLmxvZygnb24gc3RvcmFnZScsIGtleSwgdmFsKTt9IGNhdGNoKGUpIHt9CiAgfQogIHZhciBuZXdLZXkgPSAoKGtleS5zdWJzdHIoMCwgNCkgPT0gJ3Ffc3QnKSA/IGtleSA6ICdxX3N0JyArIGtleSkgKyAnOicgKyB2YWw7CiAgcGFyZW50LnBvc3RNZXNzYWdlKG5ld0tleSwgcmlnaHRPcmlnaW4pOwp9CmZ1bmN0aW9uIG9uTWVzc2FnZUV2KGUpIHsKICBpZiAoZS5vcmlnaW4gJiYgcmlnaHRPcmlnaW4gIT0gJyonICYmIGUub3JpZ2luICE9IHJpZ2h0T3JpZ2luKSB7CiAgICByZXR1cm47CiAgfQogIHZhciBtc2cgPSBlLmRhdGEsIHBvcyA9IG1zZy5pbmRleE9mKCc6Jyk7CiAgaWYgKHBvcyA9PSAtMSkgcmV0dXJuOwoKICB2YXIga2V5ID0gbXNnLnN1YnN0cigwLCBwb3MpLCB2YWx1ZSA9IG1zZy5zdWJzdHIocG9zICsgMSk7CiAgaWYgKDApIHsKICAgIHRyeSB7Y29uc29sZS5sb2coJ3NldCBzdG9yYWdlJywgZG9jdW1lbnQuZG9tYWluLCBrZXksIHZhbHVlKTt9IGNhdGNoKGUpIHt9CiAgfQogIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpOwp9CnZhciBfa2V5ID0gbG9jYXRpb24uaGFzaC5yZXBsYWNlKC9eIy8sICcnKSwgcHJldlZhbCA9ICcnOwpzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICBpZiAod2luZG93LmF0dGFjaEV2ZW50KSB7CiAgICB3aW5kb3cuYXR0YWNoRXZlbnQoJ29uc3RvcmFnZScsIG9uU3RvcmFnZUV2KTsKICAgIHdpbmRvdy5hdHRhY2hFdmVudCgnb25tZXNzYWdlJywgb25NZXNzYWdlRXYpOwogICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoJ29uc3RvcmFnZScsIG9uU3RvcmFnZUV2KTsKICAgIGRvY3VtZW50LmJvZHkuYXR0YWNoRXZlbnQoJ29uc3RvcmFnZScsIG9uU3RvcmFnZUV2KTsKICAgIGRvY3VtZW50Lm9uc3RvcmFnZSA9IG9uU3RvcmFnZUV2OwogICAgd2luZG93Lm9uc3RvcmFnZSA9IG9uU3RvcmFnZUV2OwogICAgZG9jdW1lbnQuYm9keS5vbnN0b3JhZ2UgPSBvblN0b3JhZ2VFdjsKICB9IGVsc2UgewogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBvbk1lc3NhZ2VFdiwgZmFsc2UpOwogICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCBvblN0b3JhZ2VFdiwgZmFsc2UpOwogICAgaWYgKG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goL2ZpcmVmb3gvaSkpIHsKICAgICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdzdG9yYWdlJywgb25TdG9yYWdlRXYsIGZhbHNlKTsKICAgIH0KICB9CiAgd2luZG93LnBhcmVudC5wb3N0TWVzc2FnZSgncV9zdHJlYWR5JywgcmlnaHRPcmlnaW4pOwp9LCAxMDApOwo8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </HTTPBody>
      <TcpPackets>
        <PacketInfo time="75352453" offset="0" length="446" />
        <PacketInfo time="75352468" offset="446" length="2526" />
      </TcpPackets>
    </HTTPResponse>
    <HTTPTask id="6904" hostname="vk.com" path="/js/al/emoji.js?700456431" url="https://vk.com/js/al/emoji.js?700456431" ip="87.240.165.80" port="443" connectionId="17" origin="HTML" frame="1" startDateTime="2017-11-24T14:51:37.487+03:00" startTime="75353484" endTime="75353546">
      <QueryString>
        <HTTPDataSet>
          <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
            <ActualData>NzAwNDU2NDMx</ActualData>
          </HTTPData>
        </HTTPDataSet>
        <IsExternalData>false</IsExternalData>
      </QueryString>
      <HTTPSplittedQueryStrings>
        <HTTPHeaderEntity name="" index="0">
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>NzAwNDU2NDMx</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPHeaderEntity>
      </HTTPSplittedQueryStrings>
      <HTTPRequest method="GET">
        <HTTPHeaders>
          <HTTPHeaderEntity name="Host" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>dmsuY29t</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="User-Agent" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>TW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYyLjAuMzIwMi45NCBTYWZhcmkvNTM3LjM2</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Ki8q</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Referer" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>aHR0cHM6Ly92ay5jb20v</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Encoding" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcCwgZGVmbGF0ZSwgYnI=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Accept-Language" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cnUtUlUscnU7cT0wLjksZW4tVVM7cT0wLjgsZW47cT0wLjc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cookie" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>cmVtaXhsYW5nPTA7IHJlbWl4c3RpZD01MDQxNzY4MjFfMDY0ZjMxMDQ4MmZhYzAyNGMyOyByZW1peGZsYXNoPTAuMC4wOyByZW1peHNjcmVlbl9kZXB0aD0yNDsgcmVtaXhkdD0wOyB0bXJfZGV0ZWN0PTElN0MxNTExNTI0MTUzMDQwOyByZW1peHNpZD1hZWU5YjhiMzhhNDg0Y2I3ZWQ5NGYwM2IwNmYwYWFjNGQ2MGIwNjBmNjlmMTdjYjljNmU1NQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>R0VUIC9qcy9hbC9lbW9qaS5qcz83MDA0NTY0MzEgSFRUUC8xLjENCkhvc3Q6IHZrLmNvbQ0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KVXNlci1BZ2VudDogTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV2luNjQ7IHg2NCkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzYyLjAuMzIwMi45NCBTYWZhcmkvNTM3LjM2DQpBY2NlcHQ6ICovKg0KUmVmZXJlcjogaHR0cHM6Ly92ay5jb20vDQpBY2NlcHQtRW5jb2Rpbmc6IGd6aXAsIGRlZmxhdGUsIGJyDQpBY2NlcHQtTGFuZ3VhZ2U6IHJ1LVJVLHJ1O3E9MC45LGVuLVVTO3E9MC44LGVuO3E9MC43DQpDb29raWU6IHJlbWl4bGFuZz0wOyByZW1peHN0aWQ9NTA0MTc2ODIxXzA2NGYzMTA0ODJmYWMwMjRjMjsgcmVtaXhmbGFzaD0wLjAuMDsgcmVtaXhzY3JlZW5fZGVwdGg9MjQ7IHJlbWl4ZHQ9MDsgdG1yX2RldGVjdD0xJTdDMTUxMTUyNDE1MzA0MDsgcmVtaXhzaWQ9YWVlOWI4YjM4YTQ4NGNiN2VkOTRmMDNiMDZmMGFhYzRkNjBiMDYwZjY5ZjE3Y2I5YzZlNTUNCg0K</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
          <HTTPCookies>
            <HTTPHeaderEntity name="remixlang" index="0">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixstid" index="1">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>NTA0MTc2ODIxXzA2NGYzMTA0ODJmYWMwMjRjMg==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixflash" index="2">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MC4wLjA=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixscreen_depth" index="3">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MjQ=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixdt" index="4">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MA==</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="tmr_detect" index="5">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>MSU3QzE1MTE1MjQxNTMwNDA=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
            <HTTPHeaderEntity name="remixsid" index="6">
              <HTTPDataSet>
                <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                  <ActualData>YWVlOWI4YjM4YTQ4NGNiN2VkOTRmMDNiMDZmMGFhYzRkNjBiMDYwZjY5ZjE3Y2I5YzZlNTU=</ActualData>
                </HTTPData>
              </HTTPDataSet>
              <IsExternalData>false</IsExternalData>
            </HTTPHeaderEntity>
          </HTTPCookies>
        </HTTPHeaders>
      </HTTPRequest>
      <HTTPResponse>
        <contentLenght>0</contentLenght>
        <HTTPHeaders>
          <HTTPHeaderEntity name="Server" index="0">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bmdpbng=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Date" index="1">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>RnJpLCAyNCBOb3YgMjAxNyAxMTo0OTo0NCBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Type" index="2">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>YXBwbGljYXRpb24veC1qYXZhc2NyaXB0</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Last-Modified" index="3">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>VHVlLCAyMSBOb3YgMjAxNyAwODoxMDozNyBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Transfer-Encoding" index="4">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Y2h1bmtlZA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Connection" index="5">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>a2VlcC1hbGl2ZQ==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="ETag" index="6">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Vy8iNWExM2RmN2QtMWQyZjYi</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Expires" index="7">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>VHVlLCAyOCBOb3YgMjAxNyAxMTo0OTo0NCBHTVQ=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Cache-Control" index="8">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>bWF4LWFnZT0zNDU2MDA=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Frontend" index="9">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>ZnJvbnQ1MDgxMTc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Access-Control-Expose-Headers" index="10">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>WC1Gcm9udGVuZA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="Content-Encoding" index="11">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>Z3ppcA==</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPHeaderEntity name="X-Adguard-Filtered" index="12">
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>QWRHdWFyZCBmb3IgV2luZG93czsgdmVyc2lvbj02LjIuNDMzLjIxNjc=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPHeaderEntity>
          <HTTPAllHeaders>
            <HTTPDataSet>
              <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
                <ActualData>SFRUUC8xLjEgMjAwIE9LDQpTZXJ2ZXI6IG5naW54DQpEYXRlOiBGcmksIDI0IE5vdiAyMDE3IDExOjQ5OjQ0IEdNVA0KQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi94LWphdmFzY3JpcHQNCkxhc3QtTW9kaWZpZWQ6IFR1ZSwgMjEgTm92IDIwMTcgMDg6MTA6MzcgR01UDQpUcmFuc2Zlci1FbmNvZGluZzogY2h1bmtlZA0KQ29ubmVjdGlvbjoga2VlcC1hbGl2ZQ0KRVRhZzogVy8iNWExM2RmN2QtMWQyZjYiDQpFeHBpcmVzOiBUdWUsIDI4IE5vdiAyMDE3IDExOjQ5OjQ0IEdNVA0KQ2FjaGUtQ29udHJvbDogbWF4LWFnZT0zNDU2MDANClgtRnJvbnRlbmQ6IGZyb250NTA4MTE3DQpBY2Nlc3MtQ29udHJvbC1FeHBvc2UtSGVhZGVyczogWC1Gcm9udGVuZA0KQ29udGVudC1FbmNvZGluZzogZ3ppcA0KWC1BZGd1YXJkLUZpbHRlcmVkOiBBZEd1YXJkIGZvciBXaW5kb3dzOyB2ZXJzaW9uPTYuMi40MzMuMjE2Nw0KDQo=</ActualData>
              </HTTPData>
            </HTTPDataSet>
            <IsExternalData>false</IsExternalData>
          </HTTPAllHeaders>
        </HTTPHeaders>
        <HTTPBody>
          <HTTPDataSet>
            <HTTPData dataFilePath="" dfeDataType="Raw" sectionDataType="1">
              <ActualData>aWYgKCF3aW5kb3cuRW1vamkpIHsKdmFyIEVtb2ppID0gewoKRU1PSklfU1BSSVRFU19OVU06IDMsCgpvcHRzOiB7fSwKbGFzdDogMCwKc2hvd25JZDogZmFsc2UsCmhhc05ld1N0aWNrZXJzOiBmYWxzZSwKcHJldmVudE1vdXNlT3ZlcjogZmFsc2UsCgp0dFNoaWZ0OiA0NSwKCnN0aWNrZXJzOiB7fSwKClRBQl9FTU9KSTogMCwKVEFCX1JFQ0VOVF9TVElDS0VSUzogLTEsCgpDTElDS19ERUxBWTogNTAwLApTT1JURURfRU1PSklfQ0FURUdPUklFUzogWy0xLCAxLCAzLCA4LCAyLCA0LCA1LCA2LCA3LCA5XSwKQ0FDSEVEX0hFSUdIVF9QUk9QOiAnX2Vtb2ppSGVpZ2h0JywKQ0FDSEVEX1dJRFRIX1BST1A6ICdfZW1vamlXaWR0aCcsCkJPVFRPTV9SRVNUX0ZPUl9BRERfRU1PSklfQ0FURUdPUlk6IDE1MCwKU0hPV19UVF9USU1FT1VUOiAxMDAsCkhJREVfVFRfVElNRU9VVDogMzAwLApTSE9XTl9UVF9DTFM6ICdlbW9qaV90dF9zaG93bicsCgppbml0OiBmdW5jdGlvbih0eHQsIG9wdHMpIHsKICB2YXIgb3B0SWQgPSBFbW9qaS5sYXN0OwogIG9wdHMudHh0ID0gdHh0OwogIG9wdHMuaWQgPSBvcHRJZDsKICBvcHRzLmZpZWxkV3JhcCA9IGdwZUJ5Q2xhc3MoJ19lbW9qaV9maWVsZF93cmFwJywgdHh0KTsKICBvcHRzLmVtb2ppV3JhcCA9IGRvbUJ5Q2xhc3Mob3B0cy5maWVsZFdyYXAsICdfZW1vamlfd3JhcCcpOwogIG9wdHMuZW1vamlCdG4gPSBkb21CeUNsYXNzKG9wdHMuZW1vamlXcmFwLCAnX2Vtb2ppX2J0bicpOwogIG9wdHMuZW1vamlXcmFwICYmIGRhdGEob3B0cy5lbW9qaVdyYXAsICdvcHRJZCcsIG9wdElkKTsKICB0eHQuZW1vamlJZCA9IG9wdElkOwogIG9wdHMubGFzdExvYWRlZEVtb2ppQ2F0ZWdvcmllc0lkeGVzID0ge307CiAgaWYgKG9wdHMuZm9yY2VUeHQpIHsKICAgIG9wdHMuZWRpdGFibGUgPSAwOwogICAgLy8gcGxhY2Vob2xkZXJTZXR1cCh0eHQpOwogICAgcGxhY2Vob2xkZXJJbml0KHR4dCk7CiAgfSBlbHNlIHsKICAgIG9wdHMuZWRpdGFibGUgPSAxOwogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgLy8gcGxhY2Vob2xkZXJTZXR1cCh0eHQsIHtlZGl0YWJsZTogMSwgZWRpdGFibGVGb2N1czogRW1vamkuZWRpdGFibGVGb2N1c30pOwogICAgICBwbGFjZWhvbGRlckluaXQodHh0LCB7ZWRpdGFibGU6IDEsIGVkaXRhYmxlRm9jdXM6IEVtb2ppLmVkaXRhYmxlRm9jdXMsIGdsb2JhbDogb3B0cy5nbG9iYWx9KTsKICAgICAgaWYgKG9wdHMuc2hvdWxkRm9jdXMpIHsKICAgICAgICBFbW9qaS5lZGl0YWJsZUZvY3VzKHR4dCwgZmFsc2UsIHRydWUpOwogICAgICB9CiAgICB9LCAwKTsKICAgIGlmIChicm93c2VyLm1vemlsbGEpIHsKICAgICAgdHJ5IHsKICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgiZW5hYmxlT2JqZWN0UmVzaXppbmciLCBmYWxzZSwgZmFsc2UpOwogICAgICAgIGN1ci5kZXN0cm95LnB1c2goZnVuY3Rpb24oKSB7CiAgICAgICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgiZW5hYmxlT2JqZWN0UmVzaXppbmciLCBmYWxzZSwgdHJ1ZSk7CiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2goZSkgewogICAgICB9CgogICAgfQoKICAgIGFkZEV2ZW50KHdpbmRvdywgJ21vdXNlbW92ZScsIEVtb2ppLnByZXZlbnRNb3VzZU92ZXJIYW5kbGUpOwoKICAgIGFkZEV2ZW50KHR4dCwgYnJvd3Nlci5vcGVyYSAmJiAhYnJvd3Nlci5jaHJvbWUgPyAnY2xpY2snIDogJ21vdXNlZG93bicsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LnRhZ05hbWUgPT0gJ0lNRycpIHsKICAgICAgICBpZiAoRW1vamkuZ2V0Q29kZShlLnRhcmdldCkpIHsKICAgICAgICAgIEVtb2ppLmVkaXRhYmxlRm9jdXModHh0LCBlLnRhcmdldCwgZS5vZmZzZXRYID4gOCk7CiAgICAgICAgICByZXR1cm4gY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChFbW9qaS5zaG93bikgewogICAgICAgIEVtb2ppLnR0Q2xpY2sob3B0SWQsIGdlQnlDbGFzczEoJ2Vtb2ppX3NtaWxlJywgb3B0cy5jb250cm9sc0NvbnQpLCB0cnVlKTsKICAgICAgfQogICAgfSk7CgogICAgaWYgKG9wdHMubm9MaW5lQnJlYWtzKSB7CiAgICAgIGFkZEV2ZW50KHR4dCwgJ2JsdXInLCBmdW5jdGlvbihlKSB7CiAgICAgICAgaWYgKCF0eHQudGV4dENvbnRlbnQgJiYgIXR4dC5pbm5lclRleHQpIHsKICAgICAgICAgIGVhY2goZ2VCeVRhZygnYnInLCB0eHQpLCBmdW5jdGlvbihrLCBicikgewogICAgICAgICAgICByZShicik7CiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgYWRkRXZlbnQodHh0LCAna2V5cHJlc3Mga2V5ZG93biBrZXl1cCBwYXN0ZScsIGZ1bmN0aW9uKGUpIHsKICAgICAgaWYgKGUuY2FuY2VsZWQpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKGUudHlwZSA9PSAna2V5ZG93bicpIHsKICAgICAgICB2YXIgbm9FbnRlciA9IG9wdHMuY3RybFNlbmQgPyBvcHRzLmN0cmxTZW5kKCkgOiBvcHRzLm5vRW50ZXJTZW5kOwogICAgICAgIGlmIChlLmtleUNvZGUgPT0gS0VZLlJFVFVSTiB8fCBlLmtleUNvZGUgPT0gMTApIHsKICAgICAgICAgIGlmIChvcHRzLmZvcmNlRW50ZXJTZW5kICYmIG9wdHMub25TZW5kKSB7CiAgICAgICAgICAgIG9wdHMub25TZW5kKCk7CiAgICAgICAgICAgIHJldHVybiBjYW5jZWxFdmVudChlKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBjdHJsU3VibSA9IChjdXIuY3RybF9zdWJtaXQgJiYgIW9wdHMubm9DdHJsU2VuZCk7CiAgICAgICAgICBpZiAoKGN0cmxTdWJtIHx8IG5vRW50ZXIpICYmIChlLmN0cmxLZXkgfHwgYnJvd3Nlci5tYWMgJiYgZS5tZXRhS2V5KSB8fAogICAgICAgICAgICAgICFjdHJsU3VibSAmJiAhZS5zaGlmdEtleSAmJiAhKGUuY3RybEtleSB8fCBicm93c2VyLm1hYyAmJiBlLm1ldGFLZXkpKSB7CiAgICAgICAgICAgIHZhciBjb21wb3NlciA9IGRhdGEodHh0LCAnY29tcG9zZXInKTsKICAgICAgICAgICAgaWYgKCFFbW9qaS5lbW9qaUVudGVyKG9wdElkLCBlKSB8fCAhRW1vamkuc3RpY2tlckhpbnRNb3ZlKGUpIHx8IGNvbXBvc2VyICYmIGNvbXBvc2VyLndkZCAmJiBpc1Zpc2libGUoY29tcG9zZXIud2RkLmxpc3RXcmFwKSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIW5vRW50ZXIgfHwgKGUuY3RybEtleSB8fCBicm93c2VyLm1hYyAmJiBlLm1ldGFLZXkpKSB7CiAgICAgICAgICAgICAgRW1vamkudHRDbGljayhvcHRJZCwgZ2VCeUNsYXNzMSgnZW1vamlfc21pbGUnLCBvcHRzLmNvbnRyb2xzQ29udCksIHRydWUpOwogICAgICAgICAgICAgIG9wdHMub25TZW5kICYmIG9wdHMub25TZW5kKCk7CiAgICAgICAgICAgICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0cy5ub0xpbmVCcmVha3MpIHsKICAgICAgICAgICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoZS5jdHJsS2V5ICYmIGUua2V5Q29kZSA9PSBLRVkuUkVUVVJOKSB7CiAgICAgICAgICB2YXIgdmFsID0gdGhpcy52YWx1ZTsKICAgICAgICAgIGlmIChvcHRzLmVkaXRhYmxlKSB7CiAgICAgICAgICAgIEVtb2ppLmluc2VydEhUTUwoJzxkaXY+PGJyLz48L2Rpdj4nKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdGhpcy5zZWxlY3Rpb25TdGFydCA9PSAibnVtYmVyIiAmJiB0eXBlb2YgdGhpcy5zZWxlY3Rpb25FbmQgPT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0OwogICAgICAgICAgICAgIHRoaXMudmFsdWUgPSB2YWwuc2xpY2UoMCwgc3RhcnQpICsgIlxuIiArIHZhbC5zbGljZSh0aGlzLnNlbGVjdGlvbkVuZCk7CiAgICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydCA9IHRoaXMuc2VsZWN0aW9uRW5kID0gc3RhcnQgKyAxOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRvY3VtZW50LnNlbGVjdGlvbiAmJiBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UpIHsKICAgICAgICAgICAgICB0aGlzLmZvY3VzKCk7CiAgICAgICAgICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CiAgICAgICAgICAgICAgcmFuZ2UudGV4dCA9ICJcclxuIjsKICAgICAgICAgICAgICByYW5nZS5jb2xsYXBzZShmYWxzZSk7CiAgICAgICAgICAgICAgaWYgKGJyb3dzZXIub3BlcmEgJiYgIWJyb3dzZXIuY2hyb21lKSB7CiAgICAgICAgICAgICAgICByYW5nZS5tb3ZlRW5kKCdjaGFyYWN0ZXInLCAwKTsKICAgICAgICAgICAgICAgIHJhbmdlLm1vdmVTdGFydCgnY2hhcmFjdGVyJywgMCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJhbmdlLnNlbGVjdCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHR4dC5hdXRvc2l6ZS51cGRhdGUoKTsKICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdHh0LmF1dG9zaXplLnVwZGF0ZSgpOwogICAgICAgICAgICB9LCAwKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGUua2V5Q29kZSA9PSBLRVkuVEFCICYmICEoZS5jdHJsS2V5IHx8IGJyb3dzZXIubWFjICYmIGUubWV0YUtleSkpIHsKICAgICAgICAgIHZhciBzdENvbnQgPSBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50cycsIGRvbVBOKG9wdHMudHh0KSk7CiAgICAgICAgICBpZiAoc3RDb250ICYmIGlzVmlzaWJsZShzdENvbnQpKSB7CiAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9IGdlQnlDbGFzczEoJ292ZXInLCBzdENvbnQpOwogICAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHsKICAgICAgICAgICAgICBFbW9qaS5zdGlja2VySGludEtleU91dChvcHRJZCwgc2VsZWN0ZWQpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIEVtb2ppLnN0aWNrZXJIaW50S2V5T3ZlcihvcHRJZCwgZ2VCeUNsYXNzMSgnZW1vamlfc3RpY2tlcl9pdGVtJywgc3RDb250KSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghRW1vamkuc2hvd24pIHsKICAgICAgICAgICAgICByZXR1cm4gY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChFbW9qaS5zaG93bikgewogICAgICAgICAgICBFbW9qaS5lZGl0YWJsZUZvY3VzKHR4dCwgZmFsc2UsIHRydWUsIHZvaWQoMCksIHRydWUpOwogICAgICAgICAgICBFbW9qaS50dENsaWNrKG9wdElkLCBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIG9wdHMuY29udHJvbHNDb250KSwgdHJ1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBFbW9qaS50dENsaWNrKG9wdElkLCBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIG9wdHMuY29udHJvbHNDb250KSwgZmFsc2UsIHRydWUsIHZvaWQoMCksIHRydWUpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogICAgICAgIH0KICAgICAgICBpZiAoZS5rZXlDb2RlID09IEtFWS5FU0MpIHsKICAgICAgICAgIHZhciBzdENvbnQgPSBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50cycsIGRvbVBOKG9wdHMudHh0KSksIG5lZWRDYW5jZWwgPSBmYWxzZTsKICAgICAgICAgIGlmIChzdENvbnQgJiYgaXNWaXNpYmxlKHN0Q29udCkpIHsKICAgICAgICAgICAgRW1vamkuc3RpY2tlckhpbnRLZXlPdXQob3B0SWQsIGdlQnlDbGFzczEoJ2Vtb2ppX3N0aWNrZXJfaXRlbScsIHN0Q29udCkpOwogICAgICAgICAgICBFbW9qaS5zdGlja2Vyc0hpbnRzSGlkZShzdENvbnQsIG9wdHMsIDEwMCk7CiAgICAgICAgICAgIG5lZWRDYW5jZWwgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKEVtb2ppLnNob3duKSB7CiAgICAgICAgICAgIEVtb2ppLmVkaXRhYmxlRm9jdXModHh0LCBmYWxzZSwgdHJ1ZSwgdm9pZCgwKSwgdHJ1ZSk7CiAgICAgICAgICAgIEVtb2ppLnR0Q2xpY2sob3B0SWQsIGdlQnlDbGFzczEoJ2Vtb2ppX3NtaWxlJywgb3B0cy5jb250cm9sc0NvbnQpLCB0cnVlKTsKICAgICAgICAgICAgbmVlZENhbmNlbCA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobmVlZENhbmNlbCkgewogICAgICAgICAgICByZXR1cm4gY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3B0cy5vbkVzYykgewogICAgICAgICAgICByZXR1cm4gb3B0cy5vbkVzYyhlKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmIChlLnR5cGUgPT0gJ3Bhc3RlJykgewogICAgICAgIEVtb2ppLm9uRWRpdGFibGVQYXN0ZSh0eHQsIG9wdHMsIG9wdElkLCBlKTsKICAgICAgICBpZiAob3B0cy5jaGVja0VkaXRhYmxlKSB7CiAgICAgICAgICBzZXRUaW1lb3V0KG9wdHMuY2hlY2tFZGl0YWJsZS5wYmluZChvcHRJZCwgdHh0KSwgMCk7CiAgICAgICAgfQogICAgICAgIEVtb2ppLmNoZWNrU3RpY2tlcnNLZXl3b3JkcyhvcHRJZCwgb3B0cyk7CiAgICAgIH0gZWxzZSBpZiAoZS50eXBlID09ICdrZXl1cCcpIHsKICAgICAgICBpZiAob3B0cy5ub0xpbmVCcmVha3MgJiYgIXR4dC50ZXh0Q29udGVudCAmJiAhdHh0LmlubmVyVGV4dCkgewogICAgICAgICAgZWFjaChnZUJ5VGFnKCdicicsIHR4dCksIGZ1bmN0aW9uKGssIGJyKSB7CiAgICAgICAgICAgIHJlKGJyKTsKICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICAgIGlmIChvcHRzLmNoZWNrRWRpdGFibGUpIHsKICAgICAgICAgIG9wdHMuY2hlY2tFZGl0YWJsZShvcHRJZCwgdHh0KTsKICAgICAgICB9CiAgICAgICAgRW1vamkuY2hlY2tTdGlja2Vyc0tleXdvcmRzKG9wdElkLCBvcHRzKTsKICAgICAgfSBlbHNlIGlmIChlLnR5cGUgPT0gJ2tleWRvd24nKSB7CiAgICAgICAgaWYgKG9wdHMuY2hlY2tFZGl0YWJsZSkgewogICAgICAgICAgc2V0VGltZW91dChvcHRzLmNoZWNrRWRpdGFibGUucGJpbmQob3B0SWQsIHR4dCksIDApOwogICAgICAgIH0KICAgICAgICBFbW9qaS5jaGVja1N0aWNrZXJzS2V5d29yZHMob3B0SWQsIG9wdHMpOwogICAgICB9CgogICAgICBpZiAob3B0cy5vbktleUFjdGlvbikgewogICAgICAgIG9wdHMub25LZXlBY3Rpb24oZSk7CiAgICAgIH0KCiAgICAgIGlmIChjdXIub25SZXBseUZvcm1TaXplVXBkYXRlKSB7CiAgICAgICAgY3VyLm9uUmVwbHlGb3JtU2l6ZVVwZGF0ZShlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9KTsKICB9CgogIHdpbmRvdy5Ob3RpZmllciAmJiBOb3RpZmllci5hZGRSZWN2Q2xiaygnZW1vamknLCAwLCBFbW9qaS5sY1JlY3YsIHRydWUpOwogIEVtb2ppLmluaXRTdGlja2Vyc0tleXdvcmRzKCk7CiAgRW1vamkuY2hlY2tOZXdTdGlja2VycyhvcHRzKTsKCiAgRW1vamkub3B0c1tFbW9qaS5sYXN0XSA9IG9wdHM7CiAgcmV0dXJuIEVtb2ppLmxhc3QrKzsKfSwKCnByZXZlbnRNb3VzZU92ZXJIYW5kbGU6IGZ1bmN0aW9uKCkgewogIEVtb2ppLnByZXZlbnRNb3VzZU92ZXIgPSBmYWxzZTsKfSwKCmxjUmVjdjogZnVuY3Rpb24oZGF0YSkgewogIHN3aXRjaChkYXRhLmFjdCkgewogICAgY2FzZSAndXBkYXRlVGFicyc6CiAgICAgIEVtb2ppLnVwZGF0ZVRhYnMoZGF0YS5uZXdTdGlja2VycywgZGF0YS5rZXl3b3Jkcyk7CiAgICAgIGJyZWFrOwogIH0KfSwKCmNvcnJlY3RDYXJldDogZnVuY3Rpb24odHh0KSB7CiAgdmFyIGJvdHRvbSA9IGdldENhcmV0Qm91bmRpbmdSZWN0KHR4dCkuYm90dG9tOwogIGlmIChib3R0b20gPCAwIHx8IGJvdHRvbSA+IHR4dC5vZmZzZXRIZWlnaHQpIHsKICAgIHR4dC5zY3JvbGxUb3AgKz0gYm90dG9tIC0gdHh0Lm9mZnNldEhlaWdodDsKICB9Cn0sCgppbnNlcnRXaXRoQnI6IGZ1bmN0aW9uIChyYW5nZSwgdGV4dCkgewogIGlmICh0ZXh0KSB7CiAgICB2YXIgY2xlYW5UZXh0ID0gdGV4dC5yZXBsYWNlKC9cbi9nLCAnPGJyLz4nKTsKICAgIHZhciBkaXYgPSBjZSgnZGl2JywgeyBpbm5lckhUTUw6IGNsZWFuVGV4dCB9KTsKICAgIEVtb2ppLmNsZWFuQ29udChkaXYpOwogICAgRW1vamkuaW5zZXJ0SFRNTChkaXYuaW5uZXJIVE1MKTsKICB9Cn0sCgppbnNlcnRXaXRob3V0Tkw6IGZ1bmN0aW9uIChyYW5nZSwgdGV4dCkgewogIGlmICh0ZXh0KSB7CiAgICB2YXIgY2xlYW5UZXh0ID0gdGV4dC5yZXBsYWNlKC9cbi9nLCAnJyk7CiAgICB2YXIgZGl2ID0gY2UoJ2RpdicsIHsgaW5uZXJIVE1MOiBjbGVhblRleHQgfSk7CiAgICBFbW9qaS5jbGVhbkNvbnQoZGl2KTsKICAgIEVtb2ppLmluc2VydEhUTUwoZGl2LmlubmVySFRNTCk7CiAgfQp9LAoKZm9jdXNUcmljazogZnVuY3Rpb24gKHR4dCwgaW5zZXJ0LCBmaW5hbGl6ZSwgcmFuZ2UsIGNvbnQpIHsKICBpZiAoIWNvbnQpIHsKICAgIGNvbnQgPSB0eHQ7CiAgfQogIHZhciB0ZXh0YXJlYSA9IGNlKCdURVhUQVJFQScsIHtjbGFzc05hbWU6ICdlbW9qaV90bXBfdGV4dGFyZWEnfSk7CiAgdHh0LnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQodGV4dGFyZWEpOwogIHRleHRhcmVhLmZvY3VzKCk7CiAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgIHZhciBzY3JvbGwgPSBjb250LnNjcm9sbFRvcDsKICAgIHJlKHRleHRhcmVhKTsKICAgIHR4dC5mb2N1cygpOwogICAgY29udC5zY3JvbGxUb3AgPSBzY3JvbGw7CiAgICBFbW9qaS5zZXRSYW5nZShyYW5nZSk7CiAgICBpbnNlcnQoY2xlYW4odmFsKHRleHRhcmVhKSkpOwogICAgZmluYWxpemUodHh0KTsKICB9LCAwKTsKfSwKCmZpbmFsaXplSW5zZXJ0OiBmdW5jdGlvbih0eHQpIHsKICBFbW9qaS5jbGVhbkNvbnQodHh0KTsKICBzZXRUaW1lb3V0KEVtb2ppLmNvcnJlY3RDYXJldC5wYmluZCh0eHQpLCAxMCk7Cn0sCgpnZXRDbGlwYm9hcmQ6IGZ1bmN0aW9uKGUpIHsKICBpZiAoZS5jbGlwYm9hcmREYXRhKSB7CiAgICByZXR1cm4gY2xlYW4oZS5jbGlwYm9hcmREYXRhLmdldERhdGEoJ3RleHQnKSk7CiAgfSBlbHNlIGlmICh3aW5kb3cuY2xpcGJvYXJkRGF0YSkgewogICAgcmV0dXJuIGNsZWFuKHdpbmRvdy5jbGlwYm9hcmREYXRhLmdldERhdGEoIlRleHQiKSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0sCgpwcm9jZXNzSW1hZ2VQYXN0ZTogZnVuY3Rpb24oZSwgdHh0LCBvcHRzLCBvbkRvbmUpIHsKICBpZiAoZS5jbGlwYm9hcmREYXRhICE9IG51bGwpIHsKICAgIHZhciBjbGlwYm9hcmREYXRhID0gZS5jbGlwYm9hcmREYXRhOwoKICAgIGZ1bmN0aW9uIF9vbkltYWdlQmxvYlJlYWR5KGJsb2IpIHsKICAgICAgdmFyIGFkZE1lZGlhLCBjb21wb3NlcjsKCiAgICAgIGJsb2IubmFtZSA9IGJsb2IuZmlsZW5hbWUgPSAndXBsb2FkXycgKyBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgKyAnXycgKyBpcmFuZCgwLCAxMDApICsgICcucG5nJzsKCiAgICAgIGlmIChoYXNDbGFzcyh0eHQsICdfaW1fdGV4dCcpKSB7CiAgICAgICAgaWYgKG9wdHMudXBsb2FkQWN0aW9ucykgewogICAgICAgICAgb3B0cy51cGxvYWRBY3Rpb25zLnBhc3RlKFsgYmxvYiBdKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodHh0LmlkID09ICdwb3N0X2ZpZWxkJykgeyAvLyBmaWVsZCBmb3IgcG9zdCBzdWJtaXQKICAgICAgICBhZGRNZWRpYSA9IGN1ci53YWxsQWRkTWVkaWE7CiAgICAgIH0gZWxzZSB7IC8vIHJlcGxpZXMgaW5wdXRzCiAgICAgICAgY29tcG9zZXIgPSBkYXRhKHR4dCwgJ2NvbXBvc2VyJyk7CiAgICAgICAgYWRkTWVkaWEgPSBjb21wb3NlciAmJiBjb21wb3Nlci5hZGRNZWRpYTsKICAgICAgfQoKICAgICAgaWYgKCFhZGRNZWRpYSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGlzRnVuY3Rpb24ob3B0cy5pbml0VXBsb2FkRm9ySW1hZ2VQYXN0ZUNhbGxiYWNrKSkgewogICAgICAgIG9wdHMuaW5pdFVwbG9hZEZvckltYWdlUGFzdGVDYWxsYmFjayh0eHQsIGFkZE1lZGlhLCBibG9iKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIF9jaGVja0ltYWdlc0VscyhjYikgewogICAgICB2YXIgdGltZXNwYW4gPSBNYXRoLmZsb29yKDEwMDAgKiBNYXRoLnJhbmRvbSgpKTsKCiAgICAgIHZhciBpbWdzID0gZ2VCeVRhZygnaW1nJywgdHh0KTsKICAgICAgZm9yICh2YXIgaiA9IDAsIGxlbiA9IGltZ3MubGVuZ3RoOyBqIDwgbGVuOyBqKyspIHsKICAgICAgICB2YXIgaW1nID0gaW1nc1tqXTsKICAgICAgICBpbWdbJ19iZWZvcmVfcGFzdGVfJyArIHRpbWVzcGFuXSA9IHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBpbWdzID0gZ2VCeVRhZygnaW1nJywgdHh0KTsKICAgICAgICB2YXIgcGFzdGVkSW1hZ2UgPSBmYWxzZTsKCiAgICAgICAgZm9yICh2YXIgayA9IDAsIGxlbjEgPSBpbWdzLmxlbmd0aDsgayA8IGxlbjE7IGsrKykgewogICAgICAgICAgdmFyIGltZyA9IGltZ3Nba107CiAgICAgICAgICBpZiAoIWltZ1snX2JlZm9yZV9wYXN0ZV8nICsgdGltZXNwYW5dKSB7CiAgICAgICAgICAgIGNiKGltZy5zcmMpOwogICAgICAgICAgICByZShpbWcpOwogICAgICAgICAgICBwYXN0ZWRJbWFnZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoIXBhc3RlZEltYWdlKSB7CiAgICAgICAgICBvbkRvbmUoKTsKICAgICAgICB9CiAgICAgIH0sIDEpOwogICAgfQoKICAgIGZ1bmN0aW9uIF9oYW5kbGVJbWFnZShzcmMpIHsKICAgICAgaWYgKHNyYy5tYXRjaCgvXndlYmtpdFwtZmFrZVwtdXJsXDpcL1wvLykpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBsb2FkZXIgPSBuZXcgSW1hZ2UoKTsKICAgICAgbG9hZGVyLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7CiAgICAgIGxvYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgY2FudmFzLndpZHRoID0gbG9hZGVyLndpZHRoOwogICAgICAgIGNhbnZhcy5oZWlnaHQgPSBsb2FkZXIuaGVpZ2h0OwogICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgICBjdHguZHJhd0ltYWdlKGxvYWRlciwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKCiAgICAgICAgY2FudmFzLnRvQmxvYihmdW5jdGlvbihibG9iKSB7CiAgICAgICAgICBfb25JbWFnZUJsb2JSZWFkeShibG9iKTsKICAgICAgICB9LCAnaW1hZ2UvcG5nJyk7CgogICAgICAgIG9uRG9uZSh0cnVlKTsKICAgICAgfTsKCiAgICAgIHJldHVybiBsb2FkZXIuc3JjID0gc3JjOwogICAgfQoKICAgIGlmIChjbGlwYm9hcmREYXRhLml0ZW1zKSB7IC8vIGJlc3Qgd2F5CiAgICAgIHZhciBpbWFnZVBhc3RlID0gZmFsc2U7CgogICAgICBmb3IgKHZhciBqID0gMCwgbGVuID0gY2xpcGJvYXJkRGF0YS5pdGVtcy5sZW5ndGg7IGogPCBsZW47IGorKykgewogICAgICAgIHZhciBpdGVtID0gY2xpcGJvYXJkRGF0YS5pdGVtc1tqXTsKCiAgICAgICAgaWYgKGl0ZW0udHlwZS5tYXRjaCgvXmltYWdlXC8vKSkgewogICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24oZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuIF9oYW5kbGVJbWFnZShldmVudC50YXJnZXQucmVzdWx0KTsKICAgICAgICAgIH07CiAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChpdGVtLmdldEFzRmlsZSgpKTsKCiAgICAgICAgICBpbWFnZVBhc3RlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgaWYgKGl0ZW0udHlwZSA9PT0gJ3RleHQvcGxhaW4nKSB7CiAgICAgICAgICByZXR1cm4gb25Eb25lKCk7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaW1hZ2VQYXN0ZTsKCiAgICB9IGVsc2UgeyAvLyBubyBpbWFnZXMgb3IgRkYKICAgICAgaWYgKC0xICE9PSBBcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGNsaXBib2FyZERhdGEudHlwZXMsICd0ZXh0L3BsYWluJykpIHsKICAgICAgICByZXR1cm4gb25Eb25lKCk7CiAgICAgIH0KCiAgICAgIF9jaGVja0ltYWdlc0VscyhmdW5jdGlvbihzcmMpIHsKICAgICAgICByZXR1cm4gX2hhbmRsZUltYWdlKHNyYyk7CiAgICAgIH0pOwogICAgfQoKICB9IGVsc2UgewogICAgb25Eb25lKCk7CiAgfQp9LAoKb25FZGl0YWJsZVBhc3RlOiBmdW5jdGlvbih0eHQsIG9wdHMsIG9wdElkLCBlLCBvbmx5Rm9jdXMpIHsKICB2YXIgcmFuZ2UgPSBmYWxzZTsKCiAgaWYgKHR4dC5nZXRBdHRyaWJ1dGUoJ2NvbnRlbnRlZGl0YWJsZScpID09PSAndHJ1ZScpIHsKICAgIHJhbmdlID0gRW1vamkuZ2V0UmFuZ2UoKTsKICB9CgogIHZhciB0ZXh0ID0gdGhpcy5nZXRDbGlwYm9hcmQoZSk7CiAgdmFyIHRleHRSYW5nZUFuZE5vRm9jdXMgPSB0ZXh0ICYmIHJhbmdlICYmICFvbmx5Rm9jdXM7CgogIGlmIChlLmNsaXBib2FyZERhdGEgJiYgaW5BcnJheSgndGV4dC9odG1sJywgZS5jbGlwYm9hcmREYXRhLnR5cGVzKSAmJiBpbkFycmF5KCdGaWxlcycsIGUuY2xpcGJvYXJkRGF0YS50eXBlcykpIHsKICAgIGNhbmNlbEV2ZW50KGUpOwogIH0KCiAgdmFyIGlzSW1hZ2VQYXN0ZSA9IHRoaXMucHJvY2Vzc0ltYWdlUGFzdGUoZSwgdHh0LCBvcHRzLCAoZnVuY3Rpb24oaXNJbWFnZVBhc3RlKSB7CiAgICBpZiAoaXNJbWFnZVBhc3RlKSB7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBpZiAodGV4dFJhbmdlQW5kTm9Gb2N1cykgewogICAgICBvcHRzLm5vTGluZUJyZWFrcyA/IHRoaXMuaW5zZXJ0V2l0aG91dE5MKHJhbmdlLCB0ZXh0KSA6IHRoaXMuaW5zZXJ0V2l0aEJyKHJhbmdlLCB0ZXh0KTsKICAgICAgc2V0VGltZW91dCh0aGlzLmZpbmFsaXplSW5zZXJ0LmJpbmQodGhpcywgdHh0KSwgMCk7CiAgICB9IGVsc2UgaWYgKHJhbmdlKSB7CiAgICAgIHRoaXMuZm9jdXNUcmljayh0eHQsIG9wdHMubm9MaW5lQnJlYWtzID8gdGhpcy5pbnNlcnRXaXRob3V0TkwucGJpbmQocmFuZ2UpIDogdGhpcy5pbnNlcnRXaXRoQnIucGJpbmQocmFuZ2UpLCB0aGlzLmZpbmFsaXplSW5zZXJ0LmJpbmQodGhpcywgdHh0KSwgcmFuZ2UpOwogICAgfQogIH0pLmJpbmQodGhpcykpOwoKICBpZiAoaXNJbWFnZVBhc3RlIHx8IHRleHRSYW5nZUFuZE5vRm9jdXMpIHsKICAgIGNhbmNlbEV2ZW50KGUpOwogIH0KfSwKCmNsZWFuQ29udDogZnVuY3Rpb24oY29udCkgewogIHZhciBlbCA9IGNvbnQuZmlyc3RDaGlsZDsKICB3aGlsZSAoZWwpIHsKICAgIHZhciBuZXh0ID0gZWwubmV4dFNpYmxpbmc7CiAgICBzd2l0Y2ggKGVsLm5vZGVUeXBlKSB7CiAgICAgIGNhc2UgMToKICAgICAgICBpZiAoZWwuaWQgPT0gJ3RtcF9wYXN0ZV9jb250JykgYnJlYWs7CiAgICAgICAgaWYgKGVsLnRhZ05hbWUgPT0gJ0RJVicgfHwgZWwudGFnTmFtZSA9PSAnUCcgfHwgZWwudGFnTmFtZSA9PSAnU1BBTicpIHsKICAgICAgICAgIGVsLnNldEF0dHJpYnV0ZSgnc3R5bGUnLCAnJyk7CiAgICAgICAgICBlbC5jbGFzc05hbWUgPSAnJzsKICAgICAgICAgIGVsLmlkID0gJyc7CiAgICAgICAgICBFbW9qaS5jbGVhbkNvbnQoZWwpOwogICAgICAgIH0gZWxzZSBpZiAoZWwudGFnTmFtZSA9PSAnSU1HJykgewogICAgICAgICAgaWYgKCFFbW9qaS5nZXRDb2RlKGVsKSkgewogICAgICAgICAgICByZShlbCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChlbC50YWdOYW1lICE9ICdCUicgKXsKICAgICAgICAgIHZhciB0ZXh0ID0gRW1vamkuZWRpdGFibGVWYWwoZWwsIHtzYXZlRW1vamk6IHRydWV9KTsKICAgICAgICAgIHZhciBmID0gY2YoY2xlYW4odGV4dCkucmVwbGFjZSgvXG4vZywgJzxici8+JykpOwogICAgICAgICAgdmFyIGxhc3QgPSBmLmxhc3RDaGlsZDsKICAgICAgICAgIGVsLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGYsIGVsKTsKICAgICAgICAgIC8vaWYgKGxhc3QpIHsKICAgICAgICAgIC8vICBFbW9qaS5lZGl0YWJsZUZvY3VzKGNvbnQsIGxhc3QsIHRydWUpOwogICAgICAgICAgLy99CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDM6CiAgICAgICAgdmFyIHN0ciA9IGNsZWFuKGVsLnRleHRDb250ZW50IHx8IGVsLmlubmVyVGV4dCk7CgogICAgICAgIGlmIChzdHIgJiYgc3RyLm1hdGNoKEVtb2ppLmVtb2ppUmVnRXgpKSB7IC8vIGVtb2ppIHBhc3RlZAogICAgICAgICAgc3RyID0gc3RyLnJlcGxhY2UoRW1vamkuZW1vamlSZWdFeCwgRW1vamkuZW1vamlSZXBsYWNlKS8vLnJlcGxhY2UoL1x1RkUwRi9nLCAnJyk7CiAgICAgICAgICBlbC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChjZihzdHIpLCBlbCk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgfQogICAgZWwgPSBuZXh0OwogIH0KfSwKCmZvY3VzOiBmdW5jdGlvbihjb250LCBzaG91bGRTY3JvbGwpIHsKICBFbW9qaS5lZGl0YWJsZUZvY3VzKGNvbnQsIGZhbHNlLCB0cnVlKTsKICB2YXIgZWwgPSBjb250LnBhcmVudE5vZGU7CgogIGlmIChzaG91bGRTY3JvbGwpIHsKICAgIHZhciB5ID0gZ2V0WFkoZWwpWzFdOwogICAgdmFyIHNjID0gc2Nyb2xsR2V0WSgpOwogICAgdmFyIGhlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodCA/IHdpbmRvdy5pbm5lckhlaWdodCA6IChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA6IGJveExheWVyQkcub2Zmc2V0SGVpZ2h0KTsKICAgIHZhciBlbFNpemUgPSBnZXRTaXplKGVsKVsxXTsKICAgIGlmIChzYytoZWlnaHQgPCB5ICsgZWxTaXplKSB7CiAgICAgIHNjcm9sbFRvWSh5IC0gaGVpZ2h0ICsgZWxTaXplICsgNjAsIDEwMCk7CiAgICB9IGVsc2UgaWYgKHNjID4geSkgewogICAgICBzY3JvbGxUb1koeSAtIDYwLCAxMDApOwogICAgfQogIH0KfSwKCmRlc3Ryb3k6IGZ1bmN0aW9uKG9wdElkKSB7CiAgRW1vamkub3B0c1tvcHRJZF0udHh0LmJsdXIoKTsKICBpZiAoRW1vamkub3B0c1tvcHRJZF0uaW1hZ2VzTG9hZGVyKSB7CiAgICBFbW9qaS5vcHRzW29wdElkXS5pbWFnZXNMb2FkZXIuZGVzdHJveSgpOwogIH0KICBkZWxldGUgRW1vamkub3B0c1tvcHRJZF07Cn0sCgplZGl0YWJsZUZvY3VzOiBmdW5jdGlvbihlZGl0YWJsZSwgb2JqLCBhZnRlciwgbm9Db2xsYXBzZSwgbm9Gb3JjZSkgewogIGlmICghZWRpdGFibGUgfHwgKG5vRm9yY2UgJiYgZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gZWRpdGFibGUpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGVkaXRhYmxlID0gZ2UoZWRpdGFibGUpOwogIGVkaXRhYmxlLmZvY3VzKCk7CiAgaWYgKGVkaXRhYmxlLnBob25mb2N1cykgewogICAgZWRpdGFibGUucGhvbmZvY3VzKCk7CiAgfQogIGlmICh0eXBlb2Ygd2luZG93LmdldFNlbGVjdGlvbiAhPSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZG9jdW1lbnQuY3JlYXRlUmFuZ2UgIT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7CiAgICBpZiAoYnJvd3Nlci5vcGVyYSAmJiAhYnJvd3Nlci5jaHJvbWUgJiYgIWFmdGVyKSB7CiAgICAgIHNlbC5jb2xsYXBzZShvYmogfHwgZWRpdGFibGUsIDApOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHJhbmdlID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsKICAgICAgaWYgKG9iaikgewogICAgICAgIHJhbmdlLnNlbGVjdE5vZGUob2JqKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByYW5nZS5zZWxlY3ROb2RlQ29udGVudHMoZWRpdGFibGUpOwogICAgICB9CgogICAgICBpZiAoYnJvd3Nlci5tb3ppbGxhICYmIGVkaXRhYmxlLmlubmVySFRNTCA9PT0gJzxicj4nKSB7CiAgICAgICAgZWRpdGFibGUuaW5uZXJIVE1MID0gJyc7IC8vIGZpeCBzdHJhbmdlIGZmIGJlaGF2aW91ciwgaW5zZXJ0aW5nIGVtcHR5IGJycyBpbiBjb250ZW50ZWlkdGFibGUKICAgICAgfQoKICAgICAgaWYgKCFub0NvbGxhcHNlKSB7CiAgICAgICAgcmFuZ2UuY29sbGFwc2UoIWFmdGVyKTsKICAgICAgfQogICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpOwogICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7CiAgICAgIHNlbC5hZGRSYW5nZShyYW5nZSk7CiAgICB9CiAgfSBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnQuYm9keS5jcmVhdGVUZXh0UmFuZ2UgIT0gJ3VuZGVmaW5lZCcpIHsKICAgIHZhciB0ZXh0UmFuZ2UgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpOwogICAgdGV4dFJhbmdlLm1vdmVUb0VsZW1lbnRUZXh0KG9iaiB8fCBlZGl0YWJsZSk7CiAgICB0ZXh0UmFuZ2UuY29sbGFwc2UoIWFmdGVyKTsKICAgIHRleHRSYW5nZS5zZWxlY3QoKTsKICB9Cn0sCgpnZXRSYW5nZTogZnVuY3Rpb24oKSB7CiAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHsKICAgIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKICAgIGlmIChzZWwuZ2V0UmFuZ2VBdCAmJiBzZWwucmFuZ2VDb3VudCkgewogICAgICByZXR1cm4gc2VsLmdldFJhbmdlQXQoMCk7CiAgICB9CiAgfSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24gJiYgZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKSB7CiAgICByZXR1cm4gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7CiAgfQogIHJldHVybiBudWxsOwp9LAoKc2V0UmFuZ2U6IGZ1bmN0aW9uKHJhbmdlKSB7CiAgaWYgKHdpbmRvdy5nZXRTZWxlY3Rpb24pIHsKICAgIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsKICAgIHNlbC5yZW1vdmVBbGxSYW5nZXMoKTsKICAgIHNlbC5hZGRSYW5nZShyYW5nZSk7CiAgfSBlbHNlIGlmIChkb2N1bWVudC5zZWxlY3Rpb24gJiYgcmFuZ2Uuc2VsZWN0KSB7CiAgICByYW5nZS5zZWxlY3QoKTsKICB9Cn0sCgp2YWw6IGZ1bmN0aW9uKGNvbnQsIHZhbHVlKSB7CiAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgIHJldHVybiBFbW9qaS5lZGl0YWJsZVZhbChjb250KTsKICB9IGVsc2UgewogICAgdmFsdWUgPSBFbW9qaS5lbW9qaVRvSFRNTCh2YWx1ZSwgdHJ1ZSk7CiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoLyAkLywgJyZuYnNwOycpOwogICAgaWYgKGNvbnQuc2V0VmFsdWUpIHsKICAgICAgY29udC5zZXRWYWx1ZSh2YWx1ZSk7CiAgICAgIGNvbnQucGhvbmJsdXIgJiYgY29udC5waG9uYmx1cigpOwogICAgfSBlbHNlIHsKICAgICAgY29udC5pbm5lckhUTUwgPSB2YWx1ZTsKICAgIH0KICAgIEVtb2ppLnVwZGF0ZVN0aWNrZXJzSGludHMoKTsKICAgIHZhciBjb21wb3NlciA9IGRhdGEoY29udCwgJ2NvbXBvc2VyJyk7CiAgICBpZiAoY29tcG9zZXIgJiYgd2luZG93LkNvbXBvc2VyKSB7CiAgICAgIHNldFRpbWVvdXQoQ29tcG9zZXIudXBkYXRlQXV0b0NvbXBsZXRlLnBiaW5kKGNvbXBvc2VyKSk7CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0sCgplZGl0YWJsZVZhbDogZnVuY3Rpb24oY29udCwgb3B0cykgewogIGlmICghY29udCkgcmV0dXJuICcnOwogIGlmIChjb250LnRhZ05hbWUgPT0gJ1RFWFRBUkVBJykgcmV0dXJuIHZhbChjb250KTsKICB2YXIgZWwgPSBjb250LmZpcnN0Q2hpbGQ7CiAgdmFyIHYgPSAnJzsKICB2YXIgY29udFRhZyA9IG5ldyBSZWdFeHAoJ14oRElWfFB8TEl8T0x8VFJ8VER8QkxPQ0tRVU9URSkkJyk7CiAgd2hpbGUgKGVsKSB7CiAgICBzd2l0Y2ggKGVsLm5vZGVUeXBlKSB7CiAgICAgIGNhc2UgMzoKICAgICAgICB2YXIgc3RyID0gZWwuZGF0YS5yZXBsYWNlKC9eXG58XG4kL2csICcgJykucmVwbGFjZSgvW1xuXHhhMF0vZywgJyAnKS5yZXBsYWNlKC9bIF0rL2csICcgJyk7CiAgICAgICAgdiArPSBzdHI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICB2YXIgc3RyID0gRW1vamkuZWRpdGFibGVWYWwoZWwpOwogICAgICAgIGlmIChlbC50YWdOYW1lICYmIGVsLnRhZ05hbWUubWF0Y2goY29udFRhZykgJiYgc3RyKSB7CiAgICAgICAgICBpZiAoc3RyLnN1YnN0cigtMSkgIT0gJ1xuJykgewogICAgICAgICAgICBzdHIgKz0gJ1xuJzsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcHJldiA9IGVsLnByZXZpb3VzU2libGluZzsKICAgICAgICAgIHdoaWxlIChwcmV2ICYmIHByZXYubm9kZVR5cGUgPT0gMyAmJiB0cmltKHByZXYubm9kZVZhbHVlKSA9PSAnJykgewogICAgICAgICAgICBwcmV2ID0gcHJldi5wcmV2aW91c1NpYmxpbmc7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAocHJldiAmJiAhKHByZXYudGFnTmFtZSAmJiAocHJldi50YWdOYW1lLm1hdGNoKGNvbnRUYWcpIHx8IHByZXYudGFnTmFtZSA9PSAnQlInKSkpIHsKICAgICAgICAgICAgc3RyID0gJ1xuJyArIHN0cjsKICAgICAgICAgIH0KCiAgICAgICAgfSBlbHNlIGlmIChlbC50YWdOYW1lID09ICdJTUcnKSB7CiAgICAgICAgICB2YXIgY29kZSA9IEVtb2ppLmdldENvZGUoZWwpOwogICAgICAgICAgaWYgKGNvZGUpIHsKICAgICAgICAgICAgaWYgKG9wdHMgJiYgb3B0cy5zYXZlRW1vamkpIHsKICAgICAgICAgICAgICBzdHIgKz0gRW1vamkuZ2V0RW1vamlIVE1MKGNvZGUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0ciArPSBFbW9qaS5jb2RlVG9DaHIoY29kZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGVsLnRhZ05hbWUgPT0gJ0JSJykgewogICAgICAgICAgc3RyICs9ICdcbic7CiAgICAgICAgfQogICAgICAgIHYgKz0gc3RyOwogICAgICAgIGJyZWFrOwogICAgfQogICAgZWwgPSBlbC5uZXh0U2libGluZzsKICB9CiAgcmV0dXJuIHY7Cn0sCgpjc3NFbW9qaTogewogICdEODNEREUwQSc6IFswLCAnOi0pJ10sICdEODNEREUwMyc6IFsxLCAnOi1EJ10sICdEODNEREUwOSc6IFsyLCAnOy0pJ10sICdEODNEREUwNic6IFszLCAneEQnXSwgJ0Q4M0RERTFDJzogWzQsICc7LVAnXSwgJ0Q4M0RERTBCJzogWzUsICc6LXAnXSwgJ0Q4M0RERTBEJzogWzYsICc4LSknXSwgJ0Q4M0RERTBFJzogWzcsICdCLSknXSwgJ0Q4M0RERTEyJzogWzgsICc6LSgnXSwgJ0Q4M0RERTBGJzogWzksICc7LV0nXSwgJ0Q4M0RERTE0JzogWzEwLCAnMygnXSwgJ0Q4M0RERTIyJzogWzExLCAnOlwnKCddLCAnRDgzRERFMkQnOiBbMTIsICc6XygnXSwgJ0Q4M0RERTI5JzogWzEzLCAnOigoJ10sICdEODNEREUyOCc6IFsxNCwgJzpvJ10sICdEODNEREUxMCc6IFsxNSwgJzp8J10sICdEODNEREUwQyc6IFsxNiwgJzMtKSddLCAnRDgzRERFMjAnOiBbMTcsICc+KCddLCAnRDgzRERFMjEnOiBbMTgsICc+KCgnXSwgJ0Q4M0RERTA3JzogWzE5LCAnTzopJ10sICdEODNEREUzMCc6IFsyMCwgJztvJ10sICdEODNEREUzMyc6IFsyMSwgJzh8J10sICdEODNEREUzMic6IFsyMiwgJzhvJ10sICdEODNEREUzNyc6IFsyMywgJzpYJ10sICdEODNEREUxQSc6IFsyNCwgJzotKiddLCAnRDgzRERFMDgnOiBbMjUsICd9OiknXSwgJzI3NjQnOiBbMjYgLCAnPDMnXSwgJ0Q4M0REQzREJzogWzI3LCAnOmxpa2U6J10sICdEODNEREM0RSc6IFsyOCwgJzpkaXNsaWtlOiddLCAnMjYxRCc6IFsyOSwgJzp1cDonXSwgJzI3MEMnOiBbMzAsICc6djonXSwgJ0Q4M0REQzRDJzogWzMxLCAnOm9rOiddCn0sCmltZ0Vtb2ppOiB7J0Q4M0RERTE1JzogMSwgJ0Q4M0RERTFGJzogMSwgJ0Q4M0RERTJFJzogMSwgJ0Q4M0RERTM0JzogMX0sCgpnZXRFbW9qaUhUTUw6IGZ1bmN0aW9uKGNvZGUsIHN5bWJvbCwgZW5hYmxlZCwgaXNfdGFiKSB7CgogIGlmIChjb2RlLm1hdGNoKEVtb2ppLmVtb2ppSm9pbmVyc1JlZ0V4KSkgewogICAgY29kZSA9IGNvZGUucmVwbGFjZSgnRkUwRicsICcnKSArICdGRTBGJzsKCiAgICBpZiAoIWluQXJyYXkoY29kZSwgRW1vamkuZW1vamlXaXRoSm9pbmVycykpIHsKICAgICAgdmFyIHNtaWxlcyA9IGNvZGUucmVwbGFjZSgnRkUwRicsICcnKS5zcGxpdChFbW9qaS5lbW9qaUpvaW5lcnNSZWdFeCk7CiAgICAgIHZhciBvdXQgPSAnJzsKICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHNtaWxlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGlmICghc21pbGVzW2ldKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgb3V0ICs9IEVtb2ppLmdldEVtb2ppSFRNTChzbWlsZXNbaV0sIEVtb2ppLmNvZGVUb0NocihzbWlsZXNbaV0pLCBlbmFibGVkLCBpc190YWIpOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9IGVsc2UgIGlmIChzeW1ib2wpIHsKICAgICAgc3ltYm9sID0gc3ltYm9sLnJlcGxhY2UoL1x1RkUwRi9nLCAnJyk7CiAgICAgIHN5bWJvbCArPSBFbW9qaS5jb2RlVG9DaHIoJ0ZFMEYnKTsKICAgIH0KICB9CgogIHZhciBlZGl0YWJsZSA9IChicm93c2VyLm1zaWUgJiYgaW50dmFsKGJyb3dzZXIudmVyc2lvbikgPiA4KSA/ICcgY29udGVudGVkaXRhYmxlPSJmYWxzZSInIDogJyc7CiAgaWYgKEVtb2ppLmNzc0Vtb2ppW2NvZGVdICE9IHVuZGVmaW5lZCkgewogICAgdmFyIG51bSA9IC1FbW9qaS5jc3NFbW9qaVtjb2RlXVswXSAqIDE3OwogICAgcmV0dXJuICc8aW1nJytlZGl0YWJsZSsnIHNyYz0iL2ltYWdlcy9ibGFuay5naWYiIGVtb2ppPSInK2NvZGUrJyIgJysoc3ltYm9sID8gJ2FsdD0iJytzeW1ib2wrJyInIDogc3ltYm9sKSsnIGNsYXNzPSJlbW9qaV9jc3MiIHN0eWxlPSJiYWNrZ3JvdW5kLXBvc2l0aW9uOiAwcHggJytudW0rJ3B4OyIgLz4nOwogIH0gZWxzZSB7CiAgICBpZiAoIUVtb2ppLmltZ0Vtb2ppW2NvZGVdICYmIHN5bWJvbCAmJiAhZW5hYmxlZCkgewogICAgICByZXR1cm4gc3ltYm9sOwogICAgfSBlbHNlIGlmIChpc190YWIpIHsKICAgICAgdmFyIGNvZGVfbG93ZXJfY2FzZSA9IGNvZGUudG9Mb3dlckNhc2UoKTsKICAgICAgdmFyIHNwcml0ZUlkID0gcGFyc2VJbnQoY29kZV9sb3dlcl9jYXNlLCAxNikgJSBFbW9qaS5FTU9KSV9TUFJJVEVTX05VTTsKICAgICAgcmV0dXJuICc8aSBjbGFzcz0iZW1vamkgZW1vamlfc3ByaXRlXycgKyBzcHJpdGVJZCArICcgZW1vamlfJyArIGNvZGVfbG93ZXJfY2FzZSArICciIGVtb2ppPSInICsgY29kZSArICciICcrKHN5bWJvbCA/ICdhbHQ9Iicrc3ltYm9sKyciJyA6ICcnKSsnPjwvaT4nOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICc8aW1nIGNsYXNzPSJlbW9qaSIgJysoc3ltYm9sID8gJ2FsdD0iJytzeW1ib2wrJyInIDogJycpKycgc3JjPSIvaW1hZ2VzL2Vtb2ppLycrY29kZSsod2luZG93LmRldmljZVBpeGVsUmF0aW8gPj0gMiA/ICdfMngnIDogJycpKycucG5nIiAvPic7CiAgICB9CiAgfQp9LAoKY29kZVRvQ2hyOiBmdW5jdGlvbihjb2RlKSB7CiAgdmFyIGxlbiA9IE1hdGgucm91bmQoY29kZS5sZW5ndGggLyA0KTsKICB2YXIgY2hyID0gJyc7CiAgdmFyIGkgPSAwOwogIHdoaWxlKGxlbi0tKSB7CiAgICBjaHIgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShwYXJzZUludChjb2RlLnN1YnN0cihpLCA0KSwgMTYpKQogICAgaSArPSA0OwogIH0KICByZXR1cm4gY2hyOwp9LAoKY2hlY2tFZGl0YWJsZTogZnVuY3Rpb24ob3B0SWQsIG9iaiwgb3B0aW9ucykgewogIHZhciBzY0ggPSBvYmouc2Nyb2xsSGVpZ2h0OwogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgaWYgKCFvcHRzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmICghb3B0cy5zY1BhZGRpbmdzKSB7CiAgICBvcHRzLnNjUGFkZGluZ3MgPSBpbnR2YWwoZ2V0U3R5bGUob2JqLCAncGFkZGluZ1RvcCcpKSArIGludHZhbChnZXRTdHlsZShvYmosICdwYWRkaW5nQm90dG9tJykpOwogIH0KICBzY0ggLT0gb3B0cy5zY1BhZGRpbmdzOwogIHZhciBibCA9IG9wdHMudHQ7CiAgaWYgKHNjSCA+IG9wdGlvbnMuaGVpZ2h0ICsgKGJyb3dzZXIubW96aWxsYSAmJiBvcHRzLmlzQ2hhdCA/IDAgOiA1KSkgewogICAgaWYgKCFvcHRzLmlzU2l6ZWQpIHsKICAgICAgc2V0U3R5bGUob2JqLCB7aGVpZ2h0OiBvcHRpb25zLmhlaWdodCsncHgnLCBvdmVyZmxvd1k6ICdhdXRvJ30pOwogICAgICB2YXIgc20gPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIG9wdHMuY29udHJvbHNDb250KTsKICAgICAgdmFyIHB0ID0gZ2VCeUNsYXNzMSgnZW1vamlfc21pbGVfaWNvbl9wcm9tbycsIG9wdHMuY29udHJvbHNDb250KTsKICAgICAgdmFyIHBoID0gZ2UoJ2ltX3VwbG9hZCcpOwogICAgICB2YXIgZGlmZiA9IHNiV2lkdGgoKTsKICAgICAgc2V0U3R5bGUoc20sIHZrLnJ0bCA/IHtsZWZ0OiAxICsgZGlmZn0gOiB7cmlnaHQ6IDEgKyBkaWZmfSk7CiAgICAgIGlmIChwdCkgewogICAgICAgIHNldFN0eWxlKHB0LCB2ay5ydGwgPyB7bGVmdDogMiArIGRpZmZ9IDoge3JpZ2h0OiAyICsgZGlmZn0pOwogICAgICB9CiAgICAgIGlmIChwaCkgewogICAgICAgIHNldFN0eWxlKHBoLnBhcmVudE5vZGUsIHZrLnJ0bCA/IHtsZWZ0OiAxICsgZGlmZn0gOiB7cmlnaHQ6IDEgKyBkaWZmfSk7CiAgICAgIH0KICAgICAgaWYgKGJsKSBzZXRTdHlsZShibCwgdmsucnRsID8ge2xlZnQ6IChvcHRzLnR0RGlmZiB8fCAzMSkgKyBkaWZmfSA6IHtyaWdodDogKG9wdHMudHREaWZmIHx8IDMxKSArIGRpZmZ9KQogICAgICBvcHRzLmlzU2l6ZWQgPSB0cnVlOwogICAgfQogIH0gZWxzZSBpZiAob3B0cy5pc1NpemVkKSB7CiAgICBzZXRTdHlsZShvYmosIHtoZWlnaHQ6ICdhdXRvJywgb3ZlcmZsb3dZOiAnaGlkZGVuJ30pOwogICAgdmFyIHNtID0gZ2VCeUNsYXNzMSgnZW1vamlfc21pbGUnLCBvcHRzLmNvbnRyb2xzQ29udCk7CiAgICB2YXIgcHQgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZV9pY29uX3Byb21vJywgb3B0cy5jb250cm9sc0NvbnQpOwogICAgdmFyIHBoID0gZ2UoJ2ltX3VwbG9hZCcpOwogICAgc2V0U3R5bGUoc20sIHZrLnJ0bCA/IHtsZWZ0OiAxfSA6IHtyaWdodDogMX0pOwogICAgaWYgKHB0KSB7CiAgICAgIHNldFN0eWxlKHB0LCB2ay5ydGwgPyB7bGVmdDogMn0gOiB7cmlnaHQ6IDJ9KTsKICAgIH0KICAgIGlmIChwaCkgewogICAgICBzZXRTdHlsZShwaC5wYXJlbnROb2RlLCB2ay5ydGwgPyB7bGVmdDogMX06IHtyaWdodDogMX0pOwogICAgfQogICAgaWYgKGJsKSBzZXRTdHlsZShibCwgdmsucnRsID8ge2xlZnQ6IChvcHRzLnR0RGlmZiB8fCAzMSl9IDoge3JpZ2h0OiAob3B0cy50dERpZmYgfHwgMzEpfSkKICAgIG9wdHMuaXNTaXplZCA9IGZhbHNlOwogIH0KICBpZiAob3B0cy5vblJlc2l6ZSkgewogICAgb3B0cy5vblJlc2l6ZSgpOwogIH0KfSwKCnN0aWNrZXJzSGludHNTaG93OiBmdW5jdGlvbihlbCwgb3B0cywgZGVsYXkpIHsKICBpZiAoIWlzVmlzaWJsZShlbCkpIHsKICAgIGZhZGVJbihlbCwgZGVsYXkpOwogIH0KICBpZiAoIW9wdHMuc3RpY2tlckV2ZW50c0luaXRlZCkgewogICAgdmFyIGlubmVyID0gZWwgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHNfaW5uZXInLCBlbCk7CiAgICBvcHRzLm9uSGludHNXaGVlbCA9IEVtb2ppLm9uV2hlZWxTdGlja2Vyc0hpbnRzLnBiaW5kKGlubmVyKTsKICAgIGFkZEV2ZW50KGlubmVyLCAnRE9NTW91c2VTY3JvbGwgd2hlZWwnLCBvcHRzLm9uSGludHNXaGVlbCk7CiAgICBhZGRFdmVudChkb2N1bWVudCwgJ2tleWRvd24nLCBFbW9qaS5zdGlja2VySGludE1vdmUpOwogICAgb3B0cy5vbkhpbnRzTW91c2VEb3duID0gZnVuY3Rpb24oKSB7CiAgICAgIG9wdHMuaGludHNDbGlja2VkID0gdHJ1ZTsKICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBkZWxldGUgb3B0cy5oaW50c0NsaWNrZWQ7CiAgICAgIH0sIDApOwogICAgfQogICAgYWRkRXZlbnQoZWwsICdtb3VzZWRvd24nLCBvcHRzLm9uSGludHNNb3VzZURvd24pOwogICAgaWYgKG9wdHMudHh0KSB7CiAgICAgIGlmIChvcHRzLm9uVHh0Rm9jdXMpIHsKICAgICAgICByZW1vdmVFdmVudChvcHRzLnR4dCwgJ2ZvY3VzJywgb3B0cy5vblR4dEZvY3VzKTsKICAgICAgICBkZWxldGUgb3B0cy5vblR4dEZvY3VzOwogICAgICB9CiAgICAgIG9wdHMub25UeHRCbHVyID0gZnVuY3Rpb24oZXYpIHsKICAgICAgICBpZiAob3B0cy5oaW50c0NsaWNrZWQpIHsKICAgICAgICAgIGNhbmNlbEV2ZW50KGV2KTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBFbW9qaS5zdGlja2Vyc0hpbnRzSGlkZShlbCwgb3B0cywgZGVsYXkpOwogICAgICB9CiAgICAgIGFkZEV2ZW50KG9wdHMudHh0LCAnYmx1cicsIG9wdHMub25UeHRCbHVyKTsKICAgIH0KICAgIG9wdHMuc3RpY2tlckV2ZW50c0luaXRlZCA9IHRydWU7CiAgfQogIEVtb2ppLmNoZWNrU3RpY2tlcnNIaW50c1NpemUoZWwsIG9wdHMpOwp9LAoKc3RpY2tlcnNIaW50c0hpZGU6IGZ1bmN0aW9uKGVsLCBvcHRzLCBkZWxheSkgewogIGZhZGVPdXQoZWwsIGRlbGF5KTsKICByZW1vdmVFdmVudChkb2N1bWVudCwgJ2tleWRvd24nLCBFbW9qaS5zdGlja2VySGludE1vdmUpOwogIGlmIChvcHRzLm9uSGludHNNb3VzZURvd24pIHsKICAgIHJlbW92ZUV2ZW50KGVsLCAnbW91c2Vkb3duJywgRW1vamkub25IaW50c01vdXNlRG93bik7CiAgfQogIGlmIChvcHRzLm9uSGludHNXaGVlbCkgewogICAgdmFyIGlubmVyID0gZWwgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHNfaW5uZXInLCBlbCk7CiAgICByZW1vdmVFdmVudChpbm5lciwgJ0RPTU1vdXNlU2Nyb2xsIHdoZWVsJywgRW1vamkub25IaW50c1doZWVsKTsKICB9CiAgaWYgKG9wdHMudHh0KSB7CiAgICBpZiAob3B0cy5vblR4dEJsdXIpIHsKICAgICAgcmVtb3ZlRXZlbnQob3B0cy50eHQsICdibHVyJywgb3B0cy5vblR4dEJsdXIpOwogICAgICBkZWxldGUgb3B0cy5vblR4dEJsdXI7CiAgICB9CiAgICBvcHRzLm9uVHh0Rm9jdXMgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIHN0Q29udCA9IG9wdHMudHh0ICYmIGdlQnlDbGFzczEoJ19zdGlja2VyX2hpbnRzJywgZG9tUE4ob3B0cy50eHQpKTsKICAgICAgaWYgKHN0Q29udCAmJiAhaXNWaXNpYmxlKHN0Q29udCkpIHsKICAgICAgICBkZWxldGUgb3B0cy5zdGlja2VySGludHNTdHJpbmc7CiAgICAgICAgRW1vamkuY2hlY2tTdGlja2Vyc0tleXdvcmRzKG9wdHMuaWQsIG9wdHMsIGZhbHNlKTsKICAgICAgfQogICAgfQogICAgYWRkRXZlbnQob3B0cy50eHQsICdmb2N1cycsIG9wdHMub25UeHRGb2N1cyk7CiAgfQogIGRlbGV0ZSBvcHRzLnN0aWNrZXJFdmVudHNJbml0ZWQ7CiAgZGVsZXRlIEVtb2ppLnNob3duSGludElkOwp9LAoKc3RpY2tlckhpbnRPdmVyOiBmdW5jdGlvbihlbCkgewogIEVtb2ppLnN0aWNrZXJIaW50T3V0KGVsKTsKICBhZGRDbGFzcyhlbCwgJ292ZXInKTsKfSwKCnN0aWNrZXJIaW50T3V0OiBmdW5jdGlvbihlbCkgewogIGVhY2goZ2VCeUNsYXNzKCdvdmVyJywgZG9tUE4oZWwpKSwgZnVuY3Rpb24oKSB7CiAgICByZW1vdmVDbGFzcyh0aGlzLCAnb3ZlcicpOwogIH0pOwp9LAoKc3RpY2tlckhpbnRDbGljazogZnVuY3Rpb24ob3B0SWQsIHN0aWNrZXJJZCwgZWwpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdIHx8IHt9LAogICAgICB0ZXh0ID0gb3B0cy50eHQsCiAgICAgIHN0Q29udCA9IHRleHQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHMnLCBkb21QTih0ZXh0KSksCiAgICAgIHN0aWNrZXJfcmVmZXJyZXIgPSAnc3VnZ2VzdGlvbl8nICsgRW1vamkuZ2V0U3RpY2tlcnNIaW50c1F1ZXJ5KHRleHQpOwoKICBpZiAoc3RpY2tlcklkIDwgMCkgewogICAgRW1vamkucHJldmlld1N0aWNrZXIoZmFsc2UsIGVsLCB7c3RpY2tlcklkOiAtc3RpY2tlcklkLCBzdGlja2VyX3JlZmVycmVyOiBzdGlja2VyX3JlZmVycmVyfSk7CiAgfSBlbHNlIHsKICAgIHZhbCh0ZXh0LCAnJyk7CiAgICBFbW9qaS5zdGlja2VyQ2xpY2sob3B0SWQsIHN0aWNrZXJJZCwgMjU2LCBlbCwgc3RpY2tlcl9yZWZlcnJlcik7CiAgICBpZiAob3B0cy5jaGVja0VkaXRhYmxlKSB7CiAgICAgIG9wdHMuY2hlY2tFZGl0YWJsZShvcHRJZCwgdGV4dCk7CiAgICB9CiAgfQogIEVtb2ppLnN0aWNrZXJzSGludHNIaWRlKHN0Q29udCwgb3B0cywgMCk7CgogIHJldHVybiBmYWxzZTsKfSwKCnN0aWNrZXJIaW50S2V5T3ZlcjogZnVuY3Rpb24ob3B0SWQsIGVsKSB7CiAgRW1vamkuc3RpY2tlckhpbnRPdmVyKGVsKTsKICBFbW9qaS5zaG93bkhpbnRJZCA9IG9wdElkOwp9LAoKc3RpY2tlckhpbnRLZXlPdXQ6IGZ1bmN0aW9uKG9wdElkLCBlbCkgewogIEVtb2ppLnN0aWNrZXJIaW50T3V0KGVsKTsKICBkZWxldGUgRW1vamkuc2hvd25IaW50SWQ7Cn0sCgpzdGlja2VySGludE1vdmU6IGZ1bmN0aW9uKGUpIHsKICB2YXIgb3B0SWQgPSBFbW9qaS5zaG93bkhpbnRJZDsKICBpZiAob3B0SWQgPT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdLAogICAgICBzdENvbnQgPSBvcHRzICYmIGdlQnlDbGFzczEoJ19zdGlja2VyX2hpbnRzJywgZG9tUE4ob3B0cy50eHQpKTsKICBpZiAoc3RDb250ICYmIGlzVmlzaWJsZShzdENvbnQpKSB7CiAgICB2YXIgZWwgPSBnZUJ5Q2xhc3MxKCdvdmVyJywgc3RDb250KSB8fCBnZUJ5Q2xhc3MxKCdlbW9qaV9zdGlja2VyX2l0ZW0nLCBzdENvbnQpOwogICAgc3dpdGNoIChlLmtleUNvZGUpIHsKICAgICAgY2FzZSBLRVkuTEVGVDoKICAgICAgICBlbCA9IGRvbVBTKGVsKTsKICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgIEVtb2ppLnN0aWNrZXJIaW50T3ZlcihlbCk7CiAgICAgICAgICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTY3JvbGwoZWwpOwogICAgICAgIH0KICAgICAgICBjYW5jZWxFdmVudChlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgS0VZLlJJR0hUOgogICAgICAgIGVsID0gZG9tTlMoZWwpOwogICAgICAgIGlmIChlbCkgewogICAgICAgICAgRW1vamkuc3RpY2tlckhpbnRPdmVyKGVsKTsKICAgICAgICAgIEVtb2ppLmNoZWNrU3RpY2tlcnNIaW50c1Njcm9sbChlbCk7CiAgICAgICAgfQogICAgICAgIGNhbmNlbEV2ZW50KGUpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBLRVkuRU5URVI6CiAgICAgICAgZWwuY2xpY2soKTsKICAgICAgICBjYW5jZWxFdmVudChlKTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9LAoKY2hlY2tTdGlja2Vyc0hpbnRzU2l6ZTogZnVuY3Rpb24oZWwsIG9wdHMsIGFuaW1hdGVkKSB7CiAgaWYgKGFuaW1hdGVkKSB7CiAgICBhZGRDbGFzcyhlbCwgJ19tYXJnaW5fdHJhbnNpdGlvbicpOwogICAgcmVtb3ZlQ2xhc3NEZWxheWVkKGVsLCAnX21hcmdpbl90cmFuc2l0aW9uJyk7CiAgfQoKICBzZXRTdHlsZShlbCwge21hcmdpbkxlZnQ6IDB9KTsKICB2YXIgZ2FwID0gMTAsCiAgICAgIGhpbnRYWSA9IGdldFhZKGVsKSwKICAgICAgaGludFNpemUgPSBnZXRTaXplKGVsKSwKICAgICAgZW1vamlYWSA9IEVtb2ppLmdldEVtb2ppVHRYWShvcHRzLnR0KTsKCiAgaWYgKG9wdHMudHQgJiYgZW1vamlYWSAmJgogICAgICBlbW9qaVhZWzBdICYmIGhpbnRYWVswXSArIGhpbnRTaXplWzBdICsgZ2FwID4gZW1vamlYWVswXSAmJgogICAgICBoaW50WFlbMV0gKyBoaW50U2l6ZVsxXSA+IGVtb2ppWFlbMV0pIHsKICAgIHNldFN0eWxlKGVsLCB7bWFyZ2luTGVmdDogZW1vamlYWVswXSAtIGhpbnRYWVswXSAtIGhpbnRTaXplWzBdIC0gZ2FwfSk7CiAgfQoKICB3aGlsZSAoZ2V0WFkoZWwpWzBdIDwgMCAmJiBkb21GQyhlbCkpIHsKICAgIHJlKGRvbUZDKGVsKSk7CiAgfQogIGlmICghZG9tRkMoZWwpKSB7CiAgICBFbW9qaS5zdGlja2Vyc0hpbnRzSGlkZShlbCwgb3B0cywgMCk7CiAgfQp9LAoKZ2V0RW1vamlUdFhZOiBmdW5jdGlvbih0b29sdGlwKSB7CiAgdmFyIHJlc3VsdDsKCiAgaWYgKHRvb2x0aXAgJiYgaGFzQ2xhc3ModG9vbHRpcCwgRW1vamkuU0hPV05fVFRfQ0xTKSkgewogICAgcmVzdWx0ID0gZ2V0WFkodG9vbHRpcCk7CiAgfSBlbHNlIHsKICAgIHJlc3VsdCA9IFswLCAwXTsKICB9CgogIHJldHVybiByZXN1bHQ7Cn0sCgpnZXRTdGlja2Vyc0hpbnRzUXVlcnk6IGZ1bmN0aW9uKGVsKSB7CiAgdmFyIHN0ciA9IEVtb2ppLnZhbChlbCk7CiAgaWYgKHN0ci5sZW5ndGggPiAzMCkgewogICAgcmV0dXJuICcnOwogIH0KCiAgdmFyIGN1ciA9IHdpbmRvdy5jdXIud2FsbExheWVyID8gd2tjdXIgOiB3aW5kb3cuY3VyLAogICAgICByZXBseU5hbWUgPSBjdXIucmVwbHlfdG8gJiYgd2luZG93LldhbGwgJiYgV2FsbC5nZXRSZXBseU5hbWUoY3VyLnJlcGx5X3RvWzBdKTsKICBpZiAocmVwbHlOYW1lICYmIHJlcGx5TmFtZVsxXSkgewogICAgc3RyID0gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cCgnXignICsgZXNjYXBlUkUocmVwbHlOYW1lWzFdKSArICcpJyksICcnKTsKICB9CgogIGVhY2goRW1vamkuY3NzRW1vamksIGZ1bmN0aW9uKGNvZGUsIGRhdGEpIHsKICAgIHZhciByZSA9IG5ldyBSZWdFeHAoJyhcXHN8XikoJyArIGVzY2FwZVJFKGRhdGFbMV0pICsgKGRhdGFbMV1bZGF0YVsxXS5sZW5ndGggLSAxXSA9PSAnKScgPyAnKycgOiAnJykgKyAnKShbXFxzXFwuLF18JCknLCAnZycpOwogICAgc3RyID0gc3RyLnJlcGxhY2UocmUsIGZ1bmN0aW9uKG1hdGNoLCBwcmUsIHNtaWxlLCBzcGFjZSkgewogICAgICByZXR1cm4gKHByZSB8fCAnJykgKyBFbW9qaS5jb2RlVG9DaHIoY29kZSkrKHNwYWNlIHx8ICcnKTsKICAgIH0pOwogIH0pOwogIHN0ciA9IHN0ci5yZXBsYWNlKC9eW1xzXHVGRUZGXHhBMF0rfFtcLiFcP1xuXSskL2csICcnKS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJ7gnLCAn5ScpOwoKICByZXR1cm4gc3RyOwp9LAoKY2hlY2tTdGlja2Vyc0tleXdvcmRzOiBmdW5jdGlvbihvcHRJZCwgb3B0cywgZm9yY2UpIHsKICBpZiAob3B0cy5ub1N0aWNrZXJzIHx8ICF3aW5kb3cuc3RpY2tlcnNLZXl3b3JkcyB8fAogICAgIXdpbmRvdy5zdGlja2Vyc0tleXdvcmRzRGF0YSB8fCAhd2luZG93LnN0aWNrZXJzS2V5d29yZHNEYXRhLmxlbmd0aCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgdmFyIGRlbGF5ID0gZm9yY2UgPyAwIDogMTAwLAogICAgICB0ZXh0ID0gb3B0cy50eHQsCiAgICAgIHN0Q29udCA9IGdlQnlDbGFzczEoJ19zdGlja2VyX2hpbnRzJywgZG9tUE4odGV4dCkpLAogICAgICBzaG93SGludHMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBzdHIgPSBFbW9qaS5nZXRTdGlja2Vyc0hpbnRzUXVlcnkodGV4dCk7CiAgICBpZiAoIXN0Q29udCkgewogICAgICBzdENvbnQgPSBFbW9qaS5pbml0U3RpY2tlcnNIaW50cyh0ZXh0KTsKICAgICAgaWYgKCFzdENvbnQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdHIgPT0gb3B0cy5zdGlja2VySGludHNTdHJpbmcpIHJldHVybjsKICAgIGlmIChzdHIgJiYgc3RpY2tlcnNLZXl3b3Jkc1tzdHJdICYmIHN0aWNrZXJzS2V5d29yZHNbc3RyXS5sZW5ndGgpIHsKICAgICAgdmFyIHN0aWNrZXJzID0gRW1vamkuc29ydFN0aWNrZXJzSGludHModGV4dCwgc3RpY2tlcnNLZXl3b3Jkc1tzdHJdKSwKICAgICAgICAgIHN0aWNrZXJTaXplID0gKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvID49IDIpID8gJzEyOCcgOiAnNjQnLCBodG1sID0gJyc7CiAgICAgIGVhY2goc3RpY2tlcnMsIGZ1bmN0aW9uKCkgewogICAgICAgIGh0bWwgKz0gcnMoRW1vamkuaGludHNTdGlja2VySXRlbSgpLCB7CiAgICAgICAgICBvcHRJZDogb3B0SWQsCiAgICAgICAgICBzZWxJZDogMCwKICAgICAgICAgIHN0aWNrZXJJZDogTWF0aC5hYnModGhpcyksCiAgICAgICAgICBjbGFzczogKHRoaXMgPCAwID8gJ3Byb21vJyA6ICcnKSwKICAgICAgICAgIG9uY2xpY2s6ICdFbW9qaS5zdGlja2VySGludENsaWNrKCcgKyBvcHRJZCArICcsICcgKyB0aGlzICsgJywgdGhpcyknLAogICAgICAgICAgc3RpY2tlclNpemU6IHN0aWNrZXJTaXplCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgICBFbW9qaS5zaG93U3RpY2tlcnNIaW50cyhzdENvbnQsIG9wdHMsIGh0bWwpOwogICAgfSBlbHNlIHsKICAgICAgRW1vamkuc3RpY2tlcnNIaW50c0hpZGUoc3RDb250LCBvcHRzLCBkZWxheSk7CiAgICB9CiAgICBvcHRzLnN0aWNrZXJIaW50c1N0cmluZyA9IHN0cjsKICB9CiAgaWYgKGZvcmNlKSB7CiAgICBzaG93SGludHMoKTsKICB9IGVsc2UgewogICAgY2xlYXJUaW1lb3V0KG9wdHMuc3RpY2tlckhpbnRUVCk7CiAgICBvcHRzLnN0aWNrZXJIaW50VFQgPSBzZXRUaW1lb3V0KHNob3dIaW50cywgc3RDb250ICYmIGlzVmlzaWJsZShzdENvbnQpID8gMCA6IDIwMCk7CiAgfQp9LAoKc2hvd1N0aWNrZXJzSGludHM6IGZ1bmN0aW9uKHN0Q29udCwgb3B0cywgaHRtbCkgewogIHZhciBpbm5lciA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50c19pbm5lcicsIHN0Q29udCk7CiAgaWYgKCFpbm5lciB8fCBvcHRzLm5vU3RpY2tlcnMpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHZhbChpbm5lciwgaHRtbCk7CiAgRW1vamkuc3RpY2tlcnNIaW50c1Nob3coc3RDb250LCBvcHRzLCAxMDApOwogIGlubmVyLnNjcm9sbExlZnQgPSAwOwogIEVtb2ppLmNoZWNrU3RpY2tlcnNIaW50c1Njcm9sbChzdENvbnQsIGlubmVyLnNjcm9sbExlZnQpOwp9LAoKY2hlY2tTdGlja2Vyc0hpbnRzU2Nyb2xsOiBmdW5jdGlvbihlbCwgbmV3TGVmdCkgewogIHZhciBzdENvbnQgPSBkb21DbG9zZXN0KCdfc3RpY2tlcl9oaW50cycsIGVsKSwKICAgICAgaW5uZXIgPSBzdENvbnQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHNfaW5uZXInLCBzdENvbnQpLAogICAgICBhcnJvd0xlZnQgPSBzdENvbnQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfbGVmdCcsIHN0Q29udCksCiAgICAgIGFycm93UmlnaHQgPSBzdENvbnQgJiYgZ2VCeUNsYXNzMSgnX3N0aWNrZXJfcmlnaHQnLCBzdENvbnQpOwogIGlmICghaW5uZXIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGlmIChoYXNDbGFzcyhlbCwgJ2Vtb2ppX3N0aWNrZXJfaXRlbScpKSB7CiAgICB2YXIgbWF4TGVmdCA9IGVsLm9mZnNldExlZnQgLSA4IC0gZ2V0U2l6ZShhcnJvd0xlZnQpWzBdLAogICAgICAgIG1pbkxlZnQgPSBlbC5vZmZzZXRMZWZ0ICsgZ2V0U2l6ZShlbClbMV0gKyAyICsgZ2V0U2l6ZShhcnJvd1JpZ2h0KVswXSAtIGlubmVyLmNsaWVudFdpZHRoOwogICAgaWYgKGlubmVyLnNjcm9sbExlZnQgPiBtYXhMZWZ0KSB7CiAgICAgIGlubmVyLnNjcm9sbExlZnQgPSBtYXhMZWZ0OwogICAgfQogICAgaWYgKGlubmVyLnNjcm9sbExlZnQgPCBtaW5MZWZ0KSB7CiAgICAgIGlubmVyLnNjcm9sbExlZnQgPSBtaW5MZWZ0OwogICAgfQogICAgbmV3TGVmdCA9IGlubmVyLnNjcm9sbExlZnQ7CiAgfQoKICB0b2dnbGUoYXJyb3dMZWZ0LCBuZXdMZWZ0ID4gMCk7CiAgdG9nZ2xlKGFycm93UmlnaHQsIG5ld0xlZnQgKyBpbm5lci5jbGllbnRXaWR0aCA8IGlubmVyLnNjcm9sbFdpZHRoKTsKfSwKCnNjcm9sbFN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGVsLCBkaXIsIGV2KSB7CiAgdmFyIHN0Q29udCA9IGRvbUNsb3Nlc3QoJ19zdGlja2VyX2hpbnRzJywgZWwpLAogICAgICBpbm5lciA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50c19pbm5lcicsIHN0Q29udCksCiAgICAgIGFycm93TGVmdCA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9sZWZ0Jywgc3RDb250KSwKICAgICAgYXJyb3dSaWdodCA9IHN0Q29udCAmJiBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9yaWdodCcsIHN0Q29udCk7OwogIGlmICghaW5uZXIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHZhciBuZXdMZWZ0ID0gaW5uZXIuc2Nyb2xsTGVmdCArIGRpciAqIChpbm5lci5jbGllbnRXaWR0aCAtIDIgKiBnZXRTaXplKGVsKVswXSksCiAgICAgIGhpbnRzID0gZ2VCeUNsYXNzKCdlbW9qaV9zdGlja2VyX2l0ZW0nLCBpbm5lcik7CiAgZWFjaChoaW50cywgZnVuY3Rpb24oaSwgZWwpIHsKICAgIGlmIChkaXIgPiAwICYmIGVsLm9mZnNldExlZnQgLSA4IC0gZ2V0U2l6ZShhcnJvd0xlZnQpWzBdID4gbmV3TGVmdCkgewogICAgICBuZXdMZWZ0ID0gaGludHNbaSAtIDFdICYmIGhpbnRzW2kgLSAxXS5vZmZzZXRMZWZ0IC0gOCAtIGdldFNpemUoYXJyb3dMZWZ0KVswXSB8fCBuZXdMZWZ0OwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9IGVsc2UgaWYgKGRpciA8IDAgJiYgZWwub2Zmc2V0TGVmdCArIGdldFNpemUoZWwpWzFdICsgMiArIGdldFNpemUoYXJyb3dSaWdodClbMF0gLSBpbm5lci5jbGllbnRXaWR0aCA+IG5ld0xlZnQpIHsKICAgICAgbmV3TGVmdCA9IGVsLm9mZnNldExlZnQgKyBnZXRTaXplKGVsKVsxXSArIDIgKyBnZXRTaXplKGFycm93UmlnaHQpWzBdIC0gaW5uZXIuY2xpZW50V2lkdGggfHwgbmV3TGVmdDsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0pOwogIG5ld0xlZnQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihpbm5lci5zY3JvbGxXaWR0aCAtIGlubmVyLmNsaWVudFdpZHRoLCBuZXdMZWZ0KSk7CiAgYW5pbWF0ZShpbm5lciwge3Njcm9sbExlZnQ6IG5ld0xlZnR9LCB7ZHVyYXRpb246IE1hdGguYWJzKGlubmVyLnNjcm9sbExlZnQgLSBuZXdMZWZ0KSArIDUwLCB0cmFuc2l0aW9uOiBGeC5UcmFuc2l0aW9ucy5lYXNlT3V0Q3ViaWN9KTsKICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTY3JvbGwoaW5uZXIsIG5ld0xlZnQpOwp9LAoKb25XaGVlbFN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGlubmVyLCBldikgewogIHZhciBkZWx0YTsKICBpZiAoZXYudHlwZSA9PSAnd2hlZWwnKSB7IC8vIGdlY2tvID49IDE3LCB3ZWJraXQKICAgIGRlbHRhID0gKE1hdGguYWJzKGV2LmRlbHRhWSkgPiBNYXRoLmFicyhldi5kZWx0YVgpKSA/IC1ldi5kZWx0YVkgOiAtZXYuZGVsdGFYOwogIH0gZWxzZSBpZiAoZXYud2hlZWxEZWx0YVkgIT09IHZvaWQoMCkpIHsgLy8gcHJlc3RvLCBvbGQgd2Via2l0CiAgICBkZWx0YSA9IGV2LndoZWVsRGVsdGFZOwogIH0gZWxzZSBpZiAoZXYud2hlZWxEZWx0YSAhPT0gdm9pZCgwKSkgeyAvLyBpZSA4IC0gMTEKICAgIGRlbHRhID0gZXYud2hlZWxEZWx0YTsKICB9IGVsc2UgaWYgKGV2LmRldGFpbCAmJiBldi5heGlzID09PSAyKSB7IC8vIGdlY2tvIDwgMTcKICAgIGRlbHRhID0gLWV2LmRldGFpbDsKICB9CiAgaWYgKE1hdGguYWJzKGRlbHRhKSA+PSAxMjApIHsKICAgIGRlbHRhID0gNzQgKiBNYXRoLm1heCgtMSwgTWF0aC5taW4oMSwgZGVsdGEpKTsKICB9CiAgaW5uZXIuc2Nyb2xsTGVmdCAtPSBkZWx0YTsKICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTY3JvbGwoaW5uZXIsIGlubmVyLnNjcm9sbExlZnQpOwogIGNhbmNlbEV2ZW50KGV2KTsKfSwKCnNvcnRTdGlja2Vyc0hpbnRzOiBmdW5jdGlvbihlbCwgc3RpY2tlcnMpIHsKICB2YXIgcmVjZW50ID0gKEVtb2ppLnN0aWNrZXJzWy0xXSB8fCB7fSkuc3RpY2tlcnMgfHwgW10sCiAgICAgIHJlc3VsdCA9IFtdLCBhZGRlZCA9IHt9OwoKICBlYWNoKHJlY2VudCwgZnVuY3Rpb24oKSB7CiAgICBpZiAoaW5BcnJheSh0aGlzWzBdLCBzdGlja2VycykpIHsKICAgICAgcmVzdWx0LnB1c2godGhpc1swXSk7CiAgICAgIGFkZGVkW3RoaXNbMF1dID0gMTsKICAgIH0KICB9KTsKCiAgZWFjaChzdGlja2VycywgZnVuY3Rpb24oKSB7CiAgICBpZiAoIWFkZGVkW3RoaXNdKSB7CiAgICAgIHJlc3VsdC5wdXNoKHRoaXMpOwogICAgfQogIH0pOwoKICBpZiAoY3VyLnN0aWNrZXJzUHJvbW90ZVRlc3RHcm91cCkgewogICAgdmFyIHByb21vdGVDb3VudCA9IDA7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICB2YXIgc3RpY2tlcklkID0gcmVzdWx0W2ldOwoKICAgICAgaWYgKHN0aWNrZXJJZCA+IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQoKICAgICAgc3dpdGNoIChjdXIuc3RpY2tlcnNQcm9tb3RlVGVzdEdyb3VwKSB7CiAgICAgICAgY2FzZSAnc2Vjb25kX2xhc3QnOgogICAgICAgICAgaWYgKHByb21vdGVDb3VudCA9PT0gMCkgewogICAgICAgICAgICByZXN1bHQuc3BsaWNlKDEsIDAsIHJlc3VsdC5zcGxpY2UoaSwgMSkpCiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICd0aGlyZF9sYXN0JzoKICAgICAgICAgIGlmIChwcm9tb3RlQ291bnQgPT09IDApIHsKICAgICAgICAgICAgcmVzdWx0LnNwbGljZSgyLCAwLCByZXN1bHQuc3BsaWNlKGksIDEpKQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndGhpcmRfZm91cic6CiAgICAgICAgICBpZiAocHJvbW90ZUNvdW50ID09PSAwKSB7CiAgICAgICAgICAgIHJlc3VsdC5zcGxpY2UoMiwgMCwgcmVzdWx0LnNwbGljZShpLCAxKSkKICAgICAgICAgIH0gZWxzZSBpZiAocHJvbW90ZUNvdW50ID09PSAxKSB7CiAgICAgICAgICAgIHJlc3VsdC5zcGxpY2UoMywgMCwgcmVzdWx0LnNwbGljZShpLCAxKSkKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHByb21vdGVDb3VudCsrCiAgICB9CiAgfQoKICByZXR1cm4gcmVzdWx0Owp9LAoKaW5pdFN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGVsKSB7CiAgaWYgKCFlbCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIGRvbVBOKGVsKS5pbnNlcnRCZWZvcmUoc2UoJzxkaXYgY2xhc3M9Il9zdGlja2VyX2hpbnRzIHN0aWNrZXJfaGludHNfdHQiPjxkaXYgY2xhc3M9InN0aWNrZXJfaGludHNfYXJyb3cgc3RpY2tlcl9sZWZ0IF9zdGlja2VyX2xlZnQiIG9uY2xpY2s9IkVtb2ppLnNjcm9sbFN0aWNrZXJzSGludHModGhpcywgLTEsIGV2ZW50KSI+PC9kaXY+PGRpdiBjbGFzcz0iX3N0aWNrZXJfaGludHNfaW5uZXIgc3RpY2tlcl9oaW50c19pbm5lciI+PC9kaXY+PGRpdiBjbGFzcz0ic3RpY2tlcl9oaW50c19hcnJvdyBzdGlja2VyX3JpZ2h0IF9zdGlja2VyX3JpZ2h0IiBvbmNsaWNrPSJFbW9qaS5zY3JvbGxTdGlja2Vyc0hpbnRzKHRoaXMsIDEsIGV2ZW50KSI+PC9kaXY+PC9kaXY+JyksIGVsKTsKfSwKCnVwZGF0ZVN0aWNrZXJzSGludHM6IGZ1bmN0aW9uKGZvcmNlKSB7CiAgaWYgKEVtb2ppLm9wdHMpIHsKICAgIGVhY2goRW1vamkub3B0cywgZnVuY3Rpb24ob3B0SWQsIG9wdHMpIHsKICAgICAgaWYgKGZvcmNlKSB7CiAgICAgICAgZGVsZXRlIG9wdHMuc3RpY2tlckhpbnRzU3RyaW5nOwogICAgICB9CiAgICAgIEVtb2ppLmNoZWNrU3RpY2tlcnNLZXl3b3JkcyhvcHRJZCwgb3B0cywgdHJ1ZSk7CiAgICB9KTsKICB9Cn0sCgppbml0U3RpY2tlcnNLZXl3b3JkczogZnVuY3Rpb24oKSB7CiAgaWYgKCF3aW5kb3cuc3RpY2tlcnNLZXl3b3Jkc0RhdGEpIHsKICAgIHZhciBkYXRhID0gbHMuZ2V0KCdzdGlja2Vyc19rZXl3b3JkcycpOwogICAgaWYgKGRhdGEgJiYgZGF0YS50aW1lICYmIGRhdGEudGltZSA+IHZrTm93KCkgLSA4NjQwMDAwMCAqICgyICsgTWF0aC5yYW5kb20oKSkpIHsKICAgICAgd2luZG93LnN0aWNrZXJzS2V5d29yZHNEYXRhID0gZGF0YS5rZXl3b3JkczsKICAgIH0KICB9CiAgaWYgKHdpbmRvdy5zdGlja2Vyc0tleXdvcmRzRGF0YSkgewogICAgRW1vamkuc2V0U3RpY2tlcnNLZXl3b3Jkcyh3aW5kb3cuc3RpY2tlcnNLZXl3b3Jkc0RhdGEpOwogIH0KfSwKCmNhY2hlZFN0aWNrZXJzS2V5d29yZHNUaW1lOiBmdW5jdGlvbigpIHsKICB2YXIgZGF0YSA9IGxzLmdldCgnc3RpY2tlcnNfa2V5d29yZHMnKTsKICByZXR1cm4gZGF0YSAmJiBkYXRhLnRpbWUgPyBNYXRoLmZsb29yKGRhdGEudGltZSAvIDEwMDApIDogMDsKfSwKCnNldFN0aWNrZXJzS2V5d29yZHM6IGZ1bmN0aW9uKGtleXdvcmRzLCB1cGRhdGUpIHsKICBpZiAoIWtleXdvcmRzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICB3aW5kb3cuc3RpY2tlcnNLZXl3b3JkcyA9IHt9OwoKICB2YXIgZWwgPSBjZSgnZGl2Jyk7CiAgdmFyIHNlcCA9ICdcbic7CiAgdmFyIGFjYyA9IFtdOwogIHZhciBzdHIgPSAnJzsKCiAga2V5d29yZHMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7CiAgICB2YXIgd29yZHMgPSBpdGVtLndvcmRzIHx8IFtdOwogICAgdmFyIHVzZXIgPSBpdGVtLnVzZXJfc3RpY2tlcnMgfHwgW107CiAgICB2YXIgcHJvbW8gPSBpdGVtLnByb21vdGVkX3N0aWNrZXJzIHx8IFtdOwogICAgdmFyIHJlcyA9IHVzZXIuY29uY2F0KHByb21vLm1hcChmdW5jdGlvbihpZCkgewogICAgICByZXR1cm4gLWlkOwogICAgfSkpOwoKICAgIHdvcmRzLmZvckVhY2goZnVuY3Rpb24od29yZCkgewogICAgICBzdHIgKz0gc2VwICsgd29yZDsKICAgICAgYWNjLnB1c2gocmVzKTsKICAgIH0pOwogIH0pOwoKICB2YWwoZWwsIHN0cik7CgogIHN0ciA9IGVsLnRleHRDb250ZW50IHx8IGVsLmlubmVyVGV4dDsKCiAgc3RyICYmIHN0ci5zbGljZShzZXAubGVuZ3RoKS5zcGxpdChzZXApLmZvckVhY2goZnVuY3Rpb24od29yZCwgaSkgewogICAgd2luZG93LnN0aWNrZXJzS2V5d29yZHNbd29yZF0gPSBhY2NbaV07CiAgfSk7CgogIGlmICghRW1vamkuc3RpY2tlcnNbLTFdKSB7CiAgICB2YXIgcmVjZW50ID0gbHMuZ2V0KCdyZWNlbnRfc3RpY2tlcnMnKTsKICAgIGlmIChyZWNlbnQpIHsKICAgICAgRW1vamkuc3RpY2tlcnNbLTFdID0gcmVjZW50OwogICAgfQogIH0KCiAgaWYgKHVwZGF0ZSkgewogICAgbHMuc2V0KCdzdGlja2Vyc19rZXl3b3JkcycsIHt0aW1lOiB2a05vdygpLCBrZXl3b3Jkczoga2V5d29yZHN9KTsKICAgIEVtb2ppLnVwZGF0ZVN0aWNrZXJzSGludHModHJ1ZSk7CiAgfQp9LAoKZW1vamlFbnRlcjogZnVuY3Rpb24ob3B0SWQsIGUpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdLAogICAgY3RybFNlbmQgPSAob3B0cy5jdHJsU2VuZCA/IG9wdHMuY3RybFNlbmQoKSA6IG9wdHMubm9FbnRlclNlbmQpIHx8IChjdXIuY3RybF9zdWJtaXQgJiYgIW9wdHMubm9DdHJsU2VuZCk7CiAgaWYgKAogICAgb3B0cy5lbW9qaUZvY3VzZWQgJiYKICAgIG9wdHMuZW1vamlPdmVyZWQgJiYKICAgIG9wdHMub3BlbmVkQnlUYWJLZXkgJiYKICAgIChjdHJsU2VuZCA/ICEoZS5jdHJsS2V5IHx8IGJyb3dzZXIubWFjICYmIGUubWV0YUtleSkgOiAhZS5zaGlmdEtleSkKICApIHsKICAgIGlmIChvcHRzLmN1clRhYiA9PT0gMCkgewogICAgICB2YXIgaW1nID0gZ2VCeVRhZzEoJ2ltZycsIG9wdHMuZW1vamlPdmVyZWQpIHx8IGdlQnlUYWcxKCdpJywgb3B0cy5lbW9qaU92ZXJlZCk7CiAgICAgIEVtb2ppLmFkZEVtb2ppKG9wdElkLCBFbW9qaS5nZXRDb2RlKGltZyksIG9wdHMuZW1vamlPdmVyZWQpOwogICAgfQogICAgcmV0dXJuIGNhbmNlbEV2ZW50KGUpOwogIH0KICByZXR1cm4gdHJ1ZTsKfSwKCmluc2VydEhUTUw6IGZ1bmN0aW9uKGh0bWwpIHsKICBpZiAoYnJvd3Nlci5tc2llICYmIHBhcnNlSW50KGJyb3dzZXIudmVyc2lvbikgPCAxMikgewogICAgaWYgKGRvY3VtZW50LnNlbGVjdGlvbikgewogICAgICB2YXIgciA9IGRvY3VtZW50LnNlbGVjdGlvbi5jcmVhdGVSYW5nZSgpOwogICAgICBpZiAoci5wYXN0ZUhUTUwpIHsKICAgICAgICByLnBhc3RlSFRNTChodG1sKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdmFyIHIgPSBkb2N1bWVudC5nZXRTZWxlY3Rpb24oKS5nZXRSYW5nZUF0KDApOwogICAgICB2YXIgbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTsKICAgICAgci5zdXJyb3VuZENvbnRlbnRzKG4pOwogICAgICBuLmlubmVySFRNTCA9IGh0bWw7CiAgICAgIHIuY29sbGFwc2UoZmFsc2UpOwogICAgfQogIH0gZWxzZSB7CiAgICBpZiAoaHRtbCkgewogICAgICBkb2N1bWVudC5leGVjQ29tbWFuZCgnaW5zZXJ0SFRNTCcsIGZhbHNlLCBodG1sKTsKICAgIH0KICB9Cn0sCgphZGRFbW9qaTogZnVuY3Rpb24ob3B0SWQsIGNvZGUsIG9iaikgewogIGlmIChvcHRJZCA9PT0gZmFsc2UgfHwgY29kZSA9PT0gZmFsc2UpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBpZiAodmtOb3coKSAtIG9wdHMudHRTaG93VCA8IEVtb2ppLkNMSUNLX0RFTEFZKSB7CiAgICByZXR1cm4KICB9CiAgaWYgKG9wdHMuZWRpdGFibGUpIHsKICAgIHZhciBpbWcgPSBFbW9qaS5nZXRFbW9qaUhUTUwoY29kZSwgRW1vamkuY29kZVRvQ2hyKGNvZGUpLCB0cnVlKTsKICAgIHZhciBlZGl0YWJsZSA9IG9wdHMudHh0OwogICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyB3aW5kb3cuZ2V0U2VsZWN0aW9uKCkgOiBmYWxzZTsKICAgIGlmIChzZWwgJiYgc2VsLnJhbmdlQ291bnQpIHsKICAgICAgciA9IHNlbC5nZXRSYW5nZUF0KDApOwogICAgICBpZiAoci5jb21tb25BbmNlc3RvckNvbnRhaW5lcikgewogICAgICAgIHZhciByQ29udCA9IHIuY29tbW9uQW5jZXN0b3JDb250YWluZXI7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdmFyIHJDb250ID0gci5wYXJlbnRFbGVtZW50ID8gci5wYXJlbnRFbGVtZW50KCkgOiByLml0ZW0oMCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciByQ29udCA9IGZhbHNlOwogICAgfQogICAgZWwgPSByQ29udDsKICAgIHdoaWxlKGVsICYmIGVsICE9IGVkaXRhYmxlKSB7CiAgICAgIGVsID0gZWwucGFyZW50Tm9kZTsKICAgIH0KICAgIHZhciBlZExhc3QgPSAoZWRpdGFibGUubGFzdENoaWxkIHx8IHt9KTsKICAgIGlmIChicm93c2VyLm1vemlsbGEgJiYgZWRMYXN0LnRhZ05hbWUgPT0gJ0JSJyAmJiAhZWRMYXN0LnByZXZpb3VzU2libGluZykgewogICAgICByZShlZGl0YWJsZS5sYXN0Q2hpbGQpOwogICAgfQogICAgaWYgKCFlbCkgewogICAgICBFbW9qaS5lZGl0YWJsZUZvY3VzKGVkaXRhYmxlLCBmYWxzZSwgdHJ1ZSk7CiAgICB9CiAgICBFbW9qaS5pbnNlcnRIVE1MKGltZyk7CiAgICB2YXIgZW1vamllcyA9IGdlQnlDbGFzcygnZW1vamknLCBlZGl0YWJsZSk7CiAgICBlbW9qaWVzLnB1c2guYXBwbHkoZW1vamllcywgZ2VCeUNsYXNzKCdlbW9qaV9jc3MnLCBlZGl0YWJsZSkpOwogICAgZm9yIChpIGluIGVtb2ppZXMpIHsKICAgICAgdmFyIHByZXYgPSBlbW9qaWVzW2ldLnByZXZpb3VzU2libGluZzsKICAgICAgaWYgKHByZXYgJiYgcHJldi5ub2RlVHlwZSA9PSAzICYmIHByZXYudGV4dENvbnRlbnQgJiYgcHJldi50ZXh0Q29udGVudC5jaGFyQ29kZUF0KDApID09IDMyKSB7CiAgICAgICAgdmFyIHAgPSBwcmV2LnByZXZpb3VzU2libGluZzsKICAgICAgICBpZiAocCAmJiBwLm5vZGVUeXBlID09IDMgJiYgcC50ZXh0Q29udGVudCAmJiBwLnRleHRDb250ZW50LmNoYXJDb2RlQXQocC50ZXh0Q29udGVudC5sZW5ndGggLSAxKSA9PSAxNjApIHsKICAgICAgICAgIHJlKHByZXYpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGVkaXRhYmxlLmNoZWNrKSBlZGl0YWJsZS5jaGVjaygpOwogICAgc2V0VGltZW91dChFbW9qaS5jb3JyZWN0Q2FyZXQucGJpbmQoZWRpdGFibGUpLCA1KTsKICB9IGVsc2UgewogICAgdmFyIHRleHRBcmVhID0gb3B0cy50eHQ7CiAgICB2YXIgdmFsID0gdGV4dEFyZWEudmFsdWU7CiAgICBpZiAoYnJvd3Nlci5pcGhvbmUgfHwgYnJvd3Nlci5pcGFkKSB7CiAgICAgIHZhciB0ZXh0ID0gRW1vamkuY29kZVRvQ2hyKGNvZGUpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIHRleHQgPSBFbW9qaS5jc3NFbW9qaVtjb2RlXVsxXSsnICc7CiAgICB9CiAgICB2YXIgZW5kSW5kZXgsIHJhbmdlOwogICAgaWYgKHRleHRBcmVhLnNlbGVjdGlvblN0YXJ0ICE9IHVuZGVmaW5lZCAmJiB0ZXh0QXJlYS5zZWxlY3Rpb25FbmQgIT0gdW5kZWZpbmVkKSB7CiAgICAgIGVuZEluZGV4ID0gdGV4dEFyZWEuc2VsZWN0aW9uRW5kOwogICAgICB0ZXh0QXJlYS52YWx1ZSA9IHZhbC5zbGljZSgwLCB0ZXh0QXJlYS5zZWxlY3Rpb25TdGFydCkgKyB0ZXh0ICsgdmFsLnNsaWNlKGVuZEluZGV4KTsKICAgICAgdGV4dEFyZWEuc2VsZWN0aW9uU3RhcnQgPSB0ZXh0QXJlYS5zZWxlY3Rpb25FbmQgPSBlbmRJbmRleCArIHRleHQubGVuZ3RoOwogICAgfSBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnQuc2VsZWN0aW9uICE9ICd1bmRlZmluZWQnICYmIHR5cGVvZiBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UgIT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdGV4dEFyZWEuZm9jdXMoKTsKICAgICAgcmFuZ2UgPSBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTsKICAgICAgcmFuZ2UudGV4dCA9IHRleHQ7CiAgICAgIHJhbmdlLnNlbGVjdCgpOwogICAgfQogIH0KICBpZiAob3B0cy5jaGVja0VkaXRhYmxlKSB7CiAgICBvcHRzLmNoZWNrRWRpdGFibGUob3B0SWQsIG9wdHMudHh0KTsKICB9CiAgRW1vamkuY2hlY2tTdGlja2Vyc0tleXdvcmRzKG9wdElkLCBvcHRzKTsKICBpZiAob3B0cy5zYXZlRHJhZnQpIHsKICAgIG9wdHMuc2F2ZURyYWZ0KCk7CiAgfQogIG9wdHMub25FbW9qaUFkZGVkICYmIG9wdHMub25FbW9qaUFkZGVkKCk7CiAgRW1vamkuaW5jclJlY2VudEVtb2ppUmF0ZShvcHRJZCwgY29kZSk7Cn0sCgpzaG93U2hhZG93OiBmdW5jdGlvbigpIHsKICByZXR1cm4gIShicm93c2VyLm1zaWUgJiYgYnJvd3Nlci52ZXJzaW9uIDwgMTApOwp9LAoKc2Nyb2xsVG9nZ2xlQXJyb3c6IGZ1bmN0aW9uKGlzU2hvdywgc2lkZSwgb3B0cywgbm9BbmltKSB7CiAgdmFyIHMgPSBnZUJ5Q2xhc3MxKCdlbW9qaV90YWJzXycrc2lkZSsnX3MnLCBvcHRzLnR0KQogIGlmIChub0FuaW0pIHsKICAgIChpc1Nob3cgPyBzaG93IDogaGlkZSkocyk7CiAgfSBlbHNlIGlmIChpc1Nob3cpIHsKICAgIGZhZGVJbihzLCAyMDApOwogIH0gZWxzZSB7CiAgICBmYWRlT3V0KHMsIDIwMCk7CiAgfQogIG9wdHNbc2lkZSsnU2hvd24nXSA9IGlzU2hvdzsKfSwKCnNjcm9sbFRhYnM6IGZ1bmN0aW9uKG9wdElkLCByaWdodCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgaWYgKCFvcHRzKSB7CiAgICByZXR1cm47CiAgfQogIHZhciBjb250ID0gZ2VCeUNsYXNzMSgnZW1vamlfdGFic193cmFwJywgb3B0cy50dCk7CiAgdmFyIG1heFNjcm9sbCA9IGNvbnQuZmlyc3RDaGlsZC5jbGllbnRXaWR0aCAtIGNvbnQuY2xpZW50V2lkdGg7CiAgaWYgKHJpZ2h0KSB7CiAgICB2YXIgbVBvcyA9IHJpZ2h0ID09IDIgPyBjb250LnNjcm9sbExlZnQgOiBjb250LnNjcm9sbExlZnQgKyA1KjM0OwogICAgaWYgKG1Qb3MgPj0gbWF4U2Nyb2xsKSB7CiAgICAgIG1Qb3MgPSBtYXhTY3JvbGw7CiAgICAgIHZhciBycyA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnNfcl9zJywgb3B0cy50dCkKICAgICAgZmFkZU91dChycywgMjAwKTsKICAgICAgb3B0cy5yU2hvd24gPSBmYWxzZTsKICAgICAgRW1vamkuc2Nyb2xsVG9nZ2xlQXJyb3coZmFsc2UsICdyJywgb3B0cyk7CiAgICB9CiAgICBpZiAobVBvcyAmJiAhb3B0cy5sU2hvd24pIHsKICAgICAgRW1vamkuc2Nyb2xsVG9nZ2xlQXJyb3codHJ1ZSwgJ2wnLCBvcHRzKTsKICAgIH0KICB9CiAgaWYgKCFyaWdodCB8fCByaWdodCA9PSAyKSB7CiAgICB2YXIgbVBvcyA9IHJpZ2h0ID09IDIgPyBjb250LnNjcm9sbExlZnQgOiBNYXRoLm1heChjb250LnNjcm9sbExlZnQgLSA1KjM0LCAwKTsKICAgIGlmIChtUG9zIDw9IDApIHsKICAgICAgbVBvcyA9IDA7CiAgICAgIEVtb2ppLnNjcm9sbFRvZ2dsZUFycm93KGZhbHNlLCAnbCcsIG9wdHMpOwogICAgfQogICAgaWYgKG1Qb3MgPCBtYXhTY3JvbGwgJiYgIW9wdHMuclNob3duKSB7CiAgICAgIEVtb2ppLnNjcm9sbFRvZ2dsZUFycm93KHRydWUsICdyJywgb3B0cyk7CiAgICB9CiAgfQogIGlmIChyaWdodCA9PSAyKSB7IC8vIHVwZGF0ZSBhcnJvd3Mgb25seQogICAgcmV0dXJuOwogIH0KICBvcHRzLnNjcm9sbExlZnQgPSBtUG9zOwogIGFuaW1hdGUoY29udCwge3Njcm9sbExlZnQ6IG1Qb3N9LCAzMDApOwp9LAoKc2Nyb2xsVG9UYWI6IGZ1bmN0aW9uKHRhYklkLCBvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF0sIHR0ID0gb3B0cy50dDsKICB2YXIgY29udCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnNfd3JhcCcsIHR0KTsKICB2YXIgdGFiID0gZ2VCeUNsYXNzMSgnZW1vamlfdGFiXycgKyB0YWJJZCwgdHQpOwogIGlmICghdGFiKSB7CiAgICByZXR1cm47CiAgfQogIHZhciB0d2VlbiA9IGRhdGEoY29udCwgJ3R3ZWVuJyk7CiAgaWYgKHR3ZWVuICYmIHR3ZWVuLmlzVHdlZW5pbmcgJiYgdGFiSWQgPT0gb3B0cy5jdXJUYWIpIHsKICAgIHJldHVybjsKICB9CiAgdmFyIHRhYldpZHRoID0gZ2V0U2l6ZSh0YWIpWzBdOwogIHZhciB0YWJQb3MgPSB0YWIub2Zmc2V0TGVmdCwgY29udFcgPSBnZXRTaXplKGNvbnQpWzBdOwogIHZhciBjZW50ZXJQb3MgPSB0YWJQb3MgLSBjb250VyAvIDIgKyAxMDsKCiAgaWYgKHRhYlBvcyArIHRhYldpZHRoIDwgY29udC5zY3JvbGxMZWZ0KSB7CiAgICBjb250LnNjcm9sbExlZnQgPSBNYXRoLm1heCh0YWJQb3MsIGNvbnQuc2Nyb2xsTGVmdCAtIGNvbnRXIC8gMik7CiAgfSBlbHNlIGlmICh0YWJQb3MgKyB0YWJXaWR0aCAtIGNvbnQuc2Nyb2xsTGVmdCA+IGNvbnRXKSB7CiAgICBjb250LnNjcm9sbExlZnQgPSBNYXRoLm1pbih0YWJQb3MgKyB0YWJXaWR0aCAtIGNvbnQuc2Nyb2xsTGVmdCwgY29udC5zY3JvbGxMZWZ0ICsgY29udFcgLyAyKTsKICB9CgogIGFuaW1hdGUoY29udCwge3Njcm9sbExlZnQ6IGNlbnRlclBvc30sIDMwMCwgZnVuY3Rpb24gKCkgewogICAgRW1vamkuc2Nyb2xsVGFicyhvcHRJZCwgMik7CiAgfSk7CiAgRW1vamkuc2VsZWN0VGFiKG9wdElkLCB0YWJJZCwgdGFiKTsKfSwKCnNlbGVjdFRhYjogZnVuY3Rpb24gKG9wdElkLCBzZWxJZCwgb2JqKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXSwgdHQgPSBvcHRzLnR0OwogIHZhciB0YWJzQ29udCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnMnLCB0dCk7CiAgdmFyIHNlbEVsID0gZ2VCeUNsYXNzMSgnZW1vamlfdGFiX3NlbCcsIHRhYnNDb250KTsKCiAgcmVtb3ZlQ2xhc3Moc2VsRWwsICdlbW9qaV90YWJfc2VsJyk7CiAgYWRkQ2xhc3Mob2JqLCAnZW1vamlfdGFiX3NlbCcpOwogIG9wdHMuY3VyVGFiID0gc2VsSWQ7CiAgY3VyLnN0aWNrZXJzVGFiID0gc2VsSWQ7CiAgbHMuc2V0KCdzdGlja2Vyc190YWInLCBzZWxJZCk7Cn0sCgp0YWJzV2hlZWw6IGZ1bmN0aW9uKGUsIG9wdElkKSB7CiAgY2FuY2VsRXZlbnQoZSk7CgogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgdmFyIGRlbHRhID0gTWF0aC5hYnMoZS5kZWx0YVkpID4gTWF0aC5hYnMoZS5kZWx0YVgpID8gZS5kZWx0YVkgOiBlLmRlbHRhWDsKICB2YXIgY29udCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnNfd3JhcCcsIG9wdHMudHQpOwoKICB2YXIgY3VyU2Nyb2xsID0gY29udC5zY3JvbGxMZWZ0OwogIGNvbnQuc2Nyb2xsTGVmdCArPSBkZWx0YTsKICBpZiAoY3VyU2Nyb2xsID09IGNvbnQuc2Nyb2xsTGVmdCkgewogICAgcmV0dXJuOwogIH0KCiAgRW1vamkuc2Nyb2xsVGFicyhvcHRJZCwgMik7Cn0sCgpzaG93OiBmdW5jdGlvbihvYmosIGV2KSB7CiAgdmFyIG9wdElkID0gZGF0YShkb21QTihvYmopLCAnb3B0SWQnKTsKICBpZiAoaXNVbmRlZmluZWQob3B0SWQpKSByZXR1cm47CiAgRW1vamkudHRTaG93KG9wdElkLCBvYmosIGV2KTsKfSwKCmhpZGU6IGZ1bmN0aW9uKG9iaiwgZXYsIGZvcmNlKSB7CiAgdmFyIG9wdElkID0gZGF0YShkb21QTihvYmopLCAnb3B0SWQnKTsKICBpZiAoaXNVbmRlZmluZWQob3B0SWQpKSByZXR1cm47CiAgRW1vamkudHRIaWRlKG9wdElkLCBvYmosIGV2LCBmb3JjZSk7Cn0sCgp0dFNob3c6IGZ1bmN0aW9uKG9wdElkLCBvYmosIGV2KSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBjbGVhclRpbWVvdXQob3B0cy5jdHQpOwogIGNsZWFyVGltZW91dChvcHRzLnN0dCk7CiAgaWYgKG9wdHMuc2Nyb2xsaW5nKSB7CiAgICBvcHRzLmFmdGVyU2Nyb2xsRm4gPSBmYWxzZTsKICB9CiAgaWYgKG9wdHMudHRTaG93bikgcmV0dXJuOwogIGlmIChvYmopIG9wdHMub2JqID0gb2JqOwogIGVsc2Ugb2JqID0gb3B0cy5vYmo7CgogIG9wdHMuc3R0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICBFbW9qaS50dENsaWNrKG9wdElkLCBvYmosIGZhbHNlLCB0cnVlLCBldik7CiAgfSwgRW1vamkuU0hPV19UVF9USU1FT1VUKTsKCn0sCgp0dEhpZGU6IGZ1bmN0aW9uKG9wdElkLCBvYmosIGV2LCBmb3JjZSkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgY2xlYXJUaW1lb3V0KG9wdHMuc3R0KTsKICBpZiAoIW9wdHMudHRTaG93bikgcmV0dXJuOwogIGlmIChvcHRzLnNjcm9sbGluZykgewogICAgb3B0cy5hZnRlclNjcm9sbEZuID0gRW1vamkudHRIaWRlLnBiaW5kKG9wdElkLCBvYmosIGV2LCBmb3JjZSk7CiAgICByZXR1cm47CiAgfQogIG9iaiA9IG9iaiB8fCBvcHRzLm9iaiB8fCBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIG9wdHMuY29udHJvbHNDb250KTsKICB2YXIgaGlkZVRUID0gZnVuY3Rpb24oKSB7CiAgICBFbW9qaS50dENsaWNrKG9wdElkLCBvYmosIHRydWUsIGZhbHNlLCBldik7CiAgfTsKCiAgaWYgKGZvcmNlKSB7CiAgICBoaWRlVFQoKTsKICB9IGVsc2UgewogICAgY2xlYXJUaW1lb3V0KG9wdHMuY3R0KTsKICAgIG9wdHMuY3R0ID0gc2V0VGltZW91dChoaWRlVFQsIEVtb2ppLkhJREVfVFRfVElNRU9VVCk7CiAgfQp9LAoKdHRDbGljazogZnVuY3Rpb24ob3B0SWQsIG9iaiwgbmVlZEhpZGUsIG5lZWRTaG93LCBldiwgdGFiS2V5KSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBpZiAoIW9wdHMpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKChuZWVkSGlkZSAmJiAhRW1vamkuc2hvd24pIHx8IChuZWVkU2hvdyAmJiBFbW9qaS5zaG93bikpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKCFvYmopIHsKICAgIG9iaiA9IEVtb2ppLnNob3duIHx8IGdlKChjdXIucGVlciA9PSAtMykgPyAnaW13X3NtaWxlJyA6ICdpbV9zbWlsZScpOwogICAgaWYgKCFvYmopIHJldHVybjsKICB9CiAgaWYgKG9iai50dCAmJiBvYmoudHQuZGVzdHJveSkgewogICAgb2JqLnR0LmRlc3Ryb3koKTsKICB9CiAgaWYgKCFvcHRzLnR0ICYmIG9wdHMuc2hhcmVkVFQgJiYgb3B0cy5zaGFyZWRUVC5lbW9qaVRUKSB7CiAgICBvcHRzLnR0ID0gb3B0cy5zaGFyZWRUVC5lbW9qaVRUOwogICAgb3B0cy5lbW9qaVNjcm9sbCA9IG9wdHMuc2hhcmVkVFQuZW1vamlTY3JvbGw7CiAgICBvcHRzLmFsbEVtb2ppSWQgPSBvcHRzLnNoYXJlZFRULmVtb2ppQWxsSWQ7CiAgfQogIHZhciB0dCA9IG9wdHMudHQ7CiAgaWYgKCF0dCkgewogICAgdmFyIHByZXZUYWIgPSBscy5nZXQoJ3N0aWNrZXJzX3RhYicpOwogICAgaWYgKCFwcmV2VGFiKSB7CiAgICAgIHByZXZUYWIgPSBFbW9qaS5UQUJfRU1PSkk7CiAgICB9CiAgICBvcHRzLmN1clRhYiA9IGN1ci5zdGlja2Vyc1RhYiA9IEVtb2ppLlRBQl9FTU9KSTsKICAgIGlmIChwcmV2VGFiICE9IEVtb2ppLlRBQl9FTU9KSSAmJiAhb3B0cy5ub1N0aWNrZXJzKSB7CiAgICAgIEVtb2ppLnN0aWNrZXJzW0Vtb2ppLlRBQl9SRUNFTlRfU1RJQ0tFUlNdID0gbHMuZ2V0KCdyZWNlbnRfc3RpY2tlcnMnKTsKICAgICAgb3B0cy5jdXJUYWIgPSBjdXIuc3RpY2tlcnNUYWIgPSBwcmV2VGFiOwogICAgfQogICAgdmFyIHRhYnMgPSAnPGRpdiBjbGFzcz0iZW1vamlfdGFic19sX3MiIG9uY2xpY2s9IkVtb2ppLnNjcm9sbFRhYnMoJytvcHRJZCsnLCAwKTsiPjxkaXYgY2xhc3M9ImVtb2ppX3Nwcml0ZSBlbW9qaV90YWJzX2xfc2MiPjwvZGl2PjxkaXYgY2xhc3M9ImVtb2ppX3Nwcml0ZSBlbW9qaV90YWJzX2xfc2kiPjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9ImVtb2ppX3RhYnNfcl9zIiBvbmNsaWNrPSJFbW9qaS5zY3JvbGxUYWJzKCcrb3B0SWQrJywgMSk7Ij48ZGl2IGNsYXNzPSJlbW9qaV9zcHJpdGUgZW1vamlfdGFic19yX3NjIj48L2Rpdj48ZGl2IGNsYXNzPSJlbW9qaV9zcHJpdGUgZW1vamlfdGFic19yX3NpIj48L2Rpdj48L2Rpdj4nOwogICAgdGFicyArPSBFbW9qaS5nZXRUYWJzQ29kZShbWzAsIDFdXSwgb3B0SWQpOwogICAgdGFicyArPSAnPHNwYW4gY2xhc3M9ImVtb2ppX3RhYnNfd3JhcCI+PHNwYW4gaWQ9ImVtb2ppX3RhYnNfY29udF8nK29wdElkKyciIGNsYXNzPSJlbW9qaV90YWJzX2NvbnQiPic7CiAgICBpZiAoIW9wdHMubm9TdGlja2VycyAmJiB3aW5kb3cuZW1vamlTdGlja2VycyAhPT0gZmFsc2UgJiYgd2luZG93LmVtb2ppU3RpY2tlcnMgIT09IHVuZGVmaW5lZCkgewogICAgICB0YWJzICs9IEVtb2ppLmdldFRhYnNDb2RlKHdpbmRvdy5lbW9qaVN0aWNrZXJzLCBvcHRJZCk7CiAgICB9CiAgICB2YXIgY2xhc3NBZGRyID0gJyc7CiAgICB2YXIgc2hvcEV2ZW50cyA9ICdvbmNsaWNrPSJFbW9qaS5zaG93U3RpY2tlcnNTdG9yZSgnK29wdElkKycpOyInOwogICAgdmFyIHNob3BIaW50ID0gJ3Nob3dUb29sdGlwKHRoaXMsIHt0ZXh0OiBcJycrZ2V0TGFuZygnZ2xvYmFsX3N0b3JlX3N0aWNrZXJzJykrJ1wnLCBzaGlmdDogWzQsNiw2XSwgc2hvd2R0OiAwLCBibGFjazogMX0pOyc7CiAgICBpZiAob3B0cy5yUG9pbnRlcikgewogICAgICBzaG9wRXZlbnRzICs9ICcgb25tb3VzZW92ZXI9ImFkZENsYXNzKHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUsIFwnZW1vamlfc2hvcF9vdmVyXCcpOycrc2hvcEhpbnQrJyIgIG9ubW91c2VvdXQ9InJlbW92ZUNsYXNzKHRoaXMucGFyZW50Tm9kZS5wYXJlbnROb2RlLnBhcmVudE5vZGUsIFwnZW1vamlfc2hvcF9vdmVyXCcpOyInOwogICAgfSBlbHNlIHsKICAgICAgc2hvcEV2ZW50cyArPSAnIG9ubW91c2VvdmVyPSInK3Nob3BIaW50KyciJzsKICAgIH0KICAgIHRhYnMgKz0gJzwvc3Bhbj48L3NwYW4+JzsKICAgIGlmICghb3B0cy5ub1N0aWNrZXJzKSB7CiAgICAgIHRhYnMgKz0gJzxhIGNsYXNzPSJmbF9yIGVtb2ppX3Nob3AiICcrc2hvcEV2ZW50cysnPjxkaXYgY2xhc3M9ImVtb2ppX3Nwcml0ZSBlbW9qaV9zaG9wX2ljb24iPicrKEVtb2ppLmhhc05ld1N0aWNrZXJzID8gJzxkaXYgY2xhc3M9ImVtb2ppX3Nob3BfaWNvbl9iYWRnZSI+JytNYXRoLmFicyhFbW9qaS5oYXNOZXdTdGlja2VycykrJzwvZGl2PicgOiAnJykrJzwvZGl2PjwvYT4nOwogICAgfQogICAgaWYgKCFFbW9qaS5zaG93U2hhZG93KCkpIHsKICAgICAgY2xhc3NBZGRyICs9ICcgZW1vamlfbm9fb3BhY2l0eSc7CiAgICB9CiAgICBpZiAob3B0cy5ub1N0aWNrZXJzIHx8IG9wdHMuaGlkZVN0aWNrZXJzSW5pdGlhbCkgewogICAgICBjbGFzc0FkZHIgKz0gJyBlbW9qaV9ub190YWJzJzsKICAgIH0KICAgIHZhciB0dCA9IGNlKCdkaXYnLCB7CiAgICAgIGlkOiAnZW1vamlfYmxvY2tfJytvcHRJZCwKICAgICAgY2xhc3NOYW1lOiAnZW1vamlfdHRfd3JhcCB0dF9kb3duJyArIGNsYXNzQWRkciwKICAgICAgaW5uZXJIVE1MOiAnPGRpdiBjbGFzcz0iZW1vamlfYmxvY2tfY29udCI+PGRpdiBjbGFzcz0iZW1vamlfYmxvY2tfcmVsIj48ZGl2IGNsYXNzPSJlbW9qaV9saXN0X2NvbnQiPjxkaXYgY2xhc3M9ImVtb2ppX2NhdHNfdGl0bGVfaGVscGVyIj48L2Rpdj48ZGl2IGNsYXNzPSJlbW9qaV9saXN0Ij48ZGl2IGNsYXNzPSJlbW9qaV9zY3JvbGwgZW1vamlfc2Nyb2xsX3NtaWxlcyI+PC9kaXY+PGRpdiBjbGFzcz0iZW1vamlfc2Nyb2xsIGVtb2ppX3Njcm9sbF9zdGlja2VycyI+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0iZW1vamlfdGFicyBjbGVhcl9maXgiPicrdGFicysnPC9kaXY+PC9kaXY+JywKICAgICAgb25tb3VzZW92ZXI6IGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAoIWhhc0NsYXNzKHR0LCAnZW1vamlfYW5pbWF0ZWQnKSkgRW1vamkudHRTaG93KG9wdElkLCBmYWxzZSwgZSk7CiAgICAgIH0sCiAgICAgIG9ubW91c2VvdXQ6IGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAoIWhhc0NsYXNzKHR0LCAnZW1vamlfYW5pbWF0ZWQnKSkgRW1vamkudHRIaWRlKG9wdElkLCBmYWxzZSwgZSk7CiAgICAgIH0KICAgIH0pOwogICAgb3B0cy50dCA9IHR0OwogICAgRW1vamkucmVhcHBlbmRFbW9qaShvcHRJZCwgdHQpOwogICAgRW1vamkuZW1vamlPdmVyKG9wdElkLCBnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc21pbGVzJywgdHQpLmZpcnN0Q2hpbGQpOwoKICAgIGVhY2goWydlbW9qaV90YWJzX2xfcycsICdlbW9qaV90YWJzX3JfcycsICdlbW9qaV90YWJzX3dyYXAnXSwgZnVuY3Rpb24oKSB7CiAgICAgIGFkZEV2ZW50KGdlQnlDbGFzczEodGhpcywgb3B0cy50dCksICdET01Nb3VzZVNjcm9sbCB3aGVlbCcsIGZ1bmN0aW9uKGUpIHsKICAgICAgICBFbW9qaS50YWJzV2hlZWwoZSwgb3B0SWQpOwogICAgICB9KTsKICAgIH0pOwoKICAgIGlmIChvcHRzLnNoYXJlZFRUKSB7CiAgICAgIG9wdHMuc2hhcmVkVFQuZW1vamlUVCA9IHR0OwogICAgfQogICAgRW1vamkuY2hlY2tFbW9qaVNsaWRlcihvcHRzKTsKICB9CiAgY2xlYXJUaW1lb3V0KG9wdHMudHRFbW9qaUhpZGUpOwoKICBpZiAoRW1vamkuc2hvd25JZCAhPT0gZmFsc2UgJiYgRW1vamkuc2hvd25JZCAhPSBvcHRJZCkgewogICAgRW1vamkudHRDbGljayhFbW9qaS5zaG93bklkLCBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZScsIEVtb2ppLm9wdHNbRW1vamkuc2hvd25JZF0uY29udHJvbHNDb250KSwgdHJ1ZSk7CiAgfQogIEVtb2ppLnByZXZlbnRNb3VzZU92ZXIgPSBmYWxzZTsKCiAgaWYgKCFvcHRzLmVtb2ppRXhwYW5kZWQpIHsKICAgIEVtb2ppLmVtb2ppRXhwYW5kKG9wdElkLCB0dCk7CiAgfQogIGlmIChFbW9qaS5zaG93bikgewogICAgRW1vamkuaGlkZVR0KHR0KTsKICAgIHZhciBzdENvbnQgPSBnZUJ5Q2xhc3MxKCdfc3RpY2tlcl9oaW50cycsIGRvbVBOKG9wdHMudHh0KSk7CiAgICBpZiAoc3RDb250ICYmIGlzVmlzaWJsZShzdENvbnQpKSB7CiAgICAgIEVtb2ppLmNoZWNrU3RpY2tlcnNIaW50c1NpemUoc3RDb250LCBvcHRzLCB0cnVlKTsKICAgIH0KICAgIEVtb2ppLnNob3duID0gZmFsc2U7CiAgICBFbW9qaS5zaG93bklkID0gZmFsc2U7CiAgICBvcHRzLnR0U2hvd24gPSBmYWxzZTsKICAgIG9wdHMuZW1vamlGb2N1c2VkID0gZmFsc2U7CiAgICBjdXIub25Nb3VzZUNsaWNrID0gZmFsc2U7CiAgICByZW1vdmVFdmVudChkb2N1bWVudCwgJ2tleWRvd24nLCBFbW9qaS5lbW9qaU1vdmUpOwogICAgcmVtb3ZlQ2xhc3Mob2JqLCAnZW1vamlfc21pbGVfb24nKTsKICAgIGlmIChvcHRzLm9uSGlkZSkgewogICAgICBvcHRzLm9uSGlkZSgpOwogICAgfQogIH0gZWxzZSB7CiAgICBvcHRzLm9wZW5lZEJ5VGFiS2V5ID0gISF0YWJLZXk7CiAgICBFbW9qaS5zaG93VHQodHQpOwogICAgRW1vamkucmVwb3NpdGlvbkVtb2ppKG9wdElkLCBvYmosIHR0KTsKCiAgICB2YXIgc3RDb250ID0gZ2VCeUNsYXNzMSgnX3N0aWNrZXJfaGludHMnLCBkb21QTihvcHRzLnR4dCkpOwogICAgaWYgKHN0Q29udCAmJiBpc1Zpc2libGUoc3RDb250KSkgewogICAgICBFbW9qaS5jaGVja1N0aWNrZXJzSGludHNTaXplKHN0Q29udCwgb3B0cywgdHJ1ZSk7CiAgICB9CiAgICBFbW9qaS5zaG93bklkID0gb3B0SWQ7CiAgICBFbW9qaS5zaG93biA9IG9iajsKICAgIGN1ci5lbW9qaUxpc3QgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9saXN0JywgdHQpOwogICAgb3B0cy50dFNob3duID0gdHJ1ZTsKICAgIG9wdHMudHRTaG93VCA9IHZrTm93KCk7CiAgICBvcHRzLmVtb2ppRm9jdXNlZCA9IHRydWU7CiAgICByZW1vdmVFdmVudChkb2N1bWVudCwgJ2tleWRvd24nLCBFbW9qaS5lbW9qaU1vdmUpOwogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgY3VyLm9uTW91c2VDbGljayA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgZWwgPSBlLnRhcmdldDsKICAgICAgICB3aGlsZShlbCkgewogICAgICAgICAgaWYgKGVsLmlkID09ICdpbV90ZXh0cycgfHwgaGFzQ2xhc3MoZWwsICdlbW9qaV90dF93cmFwJykgfHwgaGFzQ2xhc3MoZWwsICdpbXdfZW1vamlfd3JhcCcpKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGVsID0gZWwucGFyZW50Tm9kZTsKICAgICAgICB9CiAgICAgICAgRW1vamkudHRDbGljayhvcHRJZCwgZmFsc2UsIHRydWUpOwogICAgICB9CiAgICAgIGFkZEV2ZW50KGRvY3VtZW50LCAna2V5ZG93bicsIEVtb2ppLmVtb2ppTW92ZSk7CiAgICB9LCAwKTsKICAgIGFkZENsYXNzKG9iaiwgJ2Vtb2ppX3NtaWxlX29uJyk7CiAgICBpZiAob3B0cy5lbW9qaVNjcm9sbCAmJiBvcHRzLmVtb2ppRXhwYW5kZWQpIHsKICAgICAgb3B0cy5lbW9qaVNjcm9sbC51cGRhdGUoKTsKICAgICAgaWYgKGJyb3dzZXIubXNpZSAmJiBvcHRzLmN1clRhYiA9PT0gMCAmJiBvcHRzLmVtb2ppT3ZlcmVkKSB7CiAgICAgICAgRW1vamkuc2Nyb2xsVG9MaXN0RWwob3B0SWQsIG9wdHMuZW1vamlPdmVyZWQpOwogICAgICB9CiAgICB9CiAgICBFbW9qaS50YWJTd2l0Y2gob3B0cy5jdXJUYWIsIG9wdHMuY3VyVGFiLCBvcHRJZCk7CiAgICBvcHRzLm9uUmVjZW50RW1vamlVcGRhdGUgJiYgb3B0cy5vblJlY2VudEVtb2ppVXBkYXRlKCk7CgogICAgaWYgKG9wdHMub25TaG93KSB7CiAgICAgIG9wdHMub25TaG93KCk7CiAgICB9CiAgfQogIGVhY2goZ2VCeUNsYXNzKCdlbW9qaV9zbWlsZV9pY29uX3Byb21vJyksIGZ1bmN0aW9uKGksIGVsKSB7CiAgICByZW1vdmVFdmVudChnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZV9pY29uJywgZWwucGFyZW50Tm9kZSksICdtb3VzZW92ZXInKTsKICAgIHJlKGVsKTsKICAgIEVtb2ppLm5vTmV3U3RpY2tlcnMgPSB0cnVlOwogIH0pOwoKICBpZiAob3B0cy5ub1N0aWNrZXJzU3RvcmUpIHsKICAgIGFkZENsYXNzKGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnMnLCAnZW1vamlfYmxvY2tfJytvcHRJZCksICdlbW9qaV90YWJzX25vX3N0b3JlJyk7CiAgfSBlbHNlIHsKICAgIHJlbW92ZUNsYXNzKGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnMnLCAnZW1vamlfYmxvY2tfJytvcHRJZCksICdlbW9qaV90YWJzX25vX3N0b3JlJyk7CiAgfQogIHJldHVybiBjYW5jZWxFdmVudChldik7Cn0sCmN1ckVtb2ppS2V5czoge30sCmN1ckVtb2ppQ2F0czogezE6IFsnRDgzRERFMDQnLCAnRDgzRERFMDEnLCAnRDgzRERFMEEnLCAnRDgzRERFMDMnLCAnRDgzRUREMjMnLCAnRDgzRERFMDYnLCAnRDgzRERFMDknLCAnRDgzRERFMUMnLCAnRDgzRERFMEInLCAnRDgzRUREMTcnLCAnRDgzRERFMEQnLCAnRDgzRERFMEUnLCAnRDgzRERFMTInLCAnRDgzRERFMEYnLCAnRDgzRERFNDInLCAnRDgzRERFNDMnLCAnRDgzRERFMTQnLCAnRDgzRERFMjInLCAnRDgzRERFMkQnLCAnRDgzRERFMjknLCAnRDgzRERFMjgnLCAnRDgzRERFMTAnLCAnRDgzRERFMEMnLCAnRDgzRUREMjQnLCAnRDgzRERFMDcnLCAnRDgzRERFMzAnLCAnRDgzRUREMjcnLCAnRDgzRERFMzInLCAnRDgzRUREMjInLCAnRDgzRERFMzMnLCAnRDgzRERFMzcnLCAnRDgzRERFMDInLCAnMjc2NCcsICdEODNEREM4QicsICdEODNEREUxQScsICdEODNEREUxNScsICdEODNEREUyRicsICdEODNEREUyNicsICdEODNEREUzNScsICdEODNEREU0NCcsICdEODNFREQxNCcsICdEODNEREUyMCcsICdEODNEREUyMScsICdEODNEREUxRCcsICdEODNEREUzNCcsICdEODNEREUxOCcsICdEODNEREUxNycsICdEODNEREUxOScsICdEODNEREUxRicsICdEODNEREU0MScsICcyNjM5JywgJ0Q4M0RERTJDJywgJ0Q4M0RERTM2JywgJ0Q4M0VERDEwJywgJ0Q4M0RERTJCJywgJzI2M0EnLCAnRDgzRERFMDAnLCAnRDgzRERFMjUnLCAnRDgzRERFMUInLCAnRDgzRERFMTYnLCAnRDgzRERFMjQnLCAnRDgzRERFMjMnLCAnRDgzRERFMjcnLCAnRDgzRERFMTEnLCAnRDgzRERFMDUnLCAnRDgzRERFMkUnLCAnRDgzRERFMUUnLCAnRDgzRERFMTMnLCAnRDgzRERFMzEnLCAnRDgzRUREMTMnLCAnRDgzRUREMTEnLCAnRDgzRERFMkEnLCAnRDgzRUREMTInLCAnRDgzRUREMTUnLCAnRDgzRUREMjUnLCAnRDgzRUREMjAnLCAnRDgzRERFMDgnLCAnRDgzRERDN0YnLCAnRDgzRERDN0QnLCAnRDgzRERDN0InLCAnRDgzRERFMzgnLCAnRDgzRERFMzknLCAnRDgzRERFM0MnLCAnRDgzRERFM0QnLCAnRDgzRERFM0UnLCAnRDgzRERFM0YnLCAnRDgzRERFM0InLCAnRDgzRERFNDAnLCAnRDgzRERFM0EnLCAnRDgzRERFNDgnLCAnRDgzRERFNDknLCAnRDgzRERFNEEnLCAnRDgzRERDQTknLCAnRDgzRERDODAnLCAnRDgzRERDNzknLCAnRDgzRERDN0EnXSwgMjogWydEODNDREYzMScsICdEODNDREYzMicsICdEODNDREYzMycsICdEODNDREYzNCcsICdEODNDREYzNycsICdEODNDREYzOCcsICdEODNDREY0NScsICdEODNDREY0NicsICdEODNDREY0NycsICdEODNDREY0OCcsICdEODNDREY0OScsICdEODNDREY0QScsICdEODNDREY0QicsICdEODNDREY0QycsICdEODNDREY0RCcsICdEODNDREY0RScsICdEODNDREY0RicsICdEODNDREY1MCcsICdEODNDREY1MScsICdEODNEREMwMCcsICdEODNEREMwMScsICdEODNEREMwMicsICdEODNEREMwMycsICdEODNEREMwNCcsICdEODNEREMwNScsICdEODNEREMwNicsICdEODNEREMwNycsICdEODNEREMwOCcsICdEODNEREMwOScsICdEODNEREMwQScsICdEODNEREMwQicsICdEODNEREMwQycsICdEODNEREMwRCcsICdEODNEREMwRScsICdEODNEREMwRicsICdEODNEREMxMCcsICdEODNEREMxMScsICdEODNEREMxMicsICdEODNEREMxMycsICdEODNEREMxNCcsICdEODNEREMxNScsICdEODNEREMxNicsICdEODNEREMxNycsICdEODNEREMxOCcsICdEODNEREMxOScsICdEODNEREMxQScsICdEODNEREMxQicsICdEODNEREMxQycsICdEODNEREMxRCcsICdEODNEREMxRScsICdEODNEREMxRicsICdEODNEREMyMCcsICdEODNEREMyMScsICdEODNEREMyMicsICdEODNEREMyMycsICdEODNEREMyNCcsICdEODNEREMyNScsICdEODNEREMyNicsICdEODNEREMyNycsICdEODNEREMyOCcsICdEODNEREMyQScsICdEODNEREMyQicsICdEODNEREMyQycsICdEODNEREMyRCcsICdEODNEREMyRScsICdEODNEREMyRicsICdEODNEREMzMCcsICdEODNEREMzMicsICdEODNEREMzMycsICdEODNEREMzNCcsICdEODNEREMzNScsICdEODNEREMzNicsICdEODNEREMzNycsICdEODNEREMzOCcsICdEODNEREMzOScsICdEODNEREMzQScsICdEODNEREMzQicsICdEODNEREMzQycsICdEODNEREMzRCcsICdEODNEREMzRScsICdEODNDREYzMCcsICdEODNDREYzNScsICdEODNDREYzOScsICdEODNDREYzQScsICdEODNDREYzQicsICdEODNDREYzQycsICdEODNDREYzRCcsICdEODNDREYzRScsICdEODNDREYzRicsICdEODNDREY0MCcsICdEODNDREY0MScsICdEODNDREY0MicsICdEODNDREY0MycsICdEODNDREY0NCcsICdEODNERENBNicsICdEODNERENBNycsICdEODNFREQ4OScsICdEODNFREQ4RCcsICdEODNFREQ4RicsICdEODNFREQ4QicsICdEODNFREQ4QScsICdEODNFREQ4OCcsICdEODNFREQ4NScsICdEODNFREQ4NicsICdEODNFREQ4NycsICdEODNFREQ4RScsICdEODNFREQ5MCcsICdEODNFREQ5MScsICdEODNFREQ0MCcsICdEODNFREQ4QyddLCAzOiBbJ0Q4M0REQzREJywgJ0Q4M0REQzRFJywgJzI2MUQnLCAnMjcwQycsICdEODNEREM0QycsICdEODNEREQ5NUQ4M0NERkZCJywgJ0Q4M0VERDE4RDgzQ0RGRkInLCAnRDgzRERDNEYnLCAnRDgzRERDNEEnLCAnRDgzRERDQUEnLCAnMjcwQicsICdEODNEREQ5MEQ4M0NERkZCJywgJ0Q4M0RERDk2RDgzQ0RGRkInLCAnRDgzRERFNEYnLCAnRDgzRERFNEMnLCAnMjcwQScsICdEODNEREM0NicsICdEODNEREM0NycsICdEODNEREM0OCcsICdEODNEREM0OScsICdEODNEREM0QicsICdEODNEREM1MCcsICdEODNFREQxRUQ4M0NERkZCJywgJ0Q4M0VERDFEJywgJ0Q4M0VERDE5RDgzQ0RGRkInLCAnRDgzRUREMUJEODNDREZGQicsICdEODNFREQxQ0Q4M0NERkZCJywgJ0Q4M0REQzQwJywgJ0Q4M0REQzQyJywgJ0Q4M0REQzQzJywgJzI3MEREODNDREZGQicsICdEODNEREM0NScsICdEODNEREM2QicsICdEODNEREM2QycsICdEODNEREM2RCcsICdEODNEREM4RicsICdEODNEREM5MScsICdEODNEREM2RicsICdEODNEREM2QScsICdEODNEREM3MCcsICdEODNEREM2NicsICdEODNEREM2NycsICdEODNEREM2OCcsICdEODNEREM2OScsICdEODNEREM3MScsICdEODNEREM2RScsICdEODNEREM3MicsICdEODNEREM3MycsICdEODNEREM4MicsICdEODNEREM3NCcsICdEODNEREM3NScsICdEODNEREM3NicsICdEODNEREM3NycsICdEODNEREM3OCcsICdEODNEREM3QycsICdEODNEREU0NycsICdEODNFREQzMEQ4M0NERkZCJywgJ0Q4M0REQzg1JywgJ0Q4M0REQzg0JywgJ0Q4M0REQzQ0JywgJ0Q4M0REQzgzJywgJ0Q4M0NERjhFJywgJ0Q4M0NERjg1JywgJ0Q4M0RERUI2JywgJ0Q4M0REQzcxMjAwRDI2NDBGRTBGJywgJ0Q4M0REQzZFMjAwRDI2NDBGRTBGJywgJ0Q4M0REQzc3MjAwRDI2NDBGRTBGJywgJ0Q4M0RERDc1MjAwRDI2NDBGRTBGJywgJ0Q4M0RERTQ3MjAwRDI2NDBGRTBGJywgJ0Q4M0RERTRCMjAwRDI2NDJGRTBGJywgJ0Q4M0RERTRCJywgJ0Q4M0REQzgxMjAwRDI2NDJGRTBGJywgJ0Q4M0REQzgxJywgJ0Q4M0RERTQ1MjAwRDI2NDJGRTBGJywgJ0Q4M0RERTQ1JywgJ0Q4M0RERTQ2MjAwRDI2NDJGRTBGJywgJ0Q4M0RERTQ2JywgJ0Q4M0RERTRFMjAwRDI2NDJGRTBGJywgJ0Q4M0RERTRFJywgJ0Q4M0REQzg2MjAwRDI2NDJGRTBGJywgJ0Q4M0REQzg2JywgJ0Q4M0REQzg3MjAwRDI2NDJGRTBGJywgJ0Q4M0REQzg3JywgJ0Q4M0VERDM3RDgzQ0RGRkIyMDBEMjY0MkZFMEYnLCAnRDgzRUREMzdEODNDREZGQjIwMEQyNjQwRkUwRicsICdEODNFREQyNkQ4M0NERkZCMjAwRDI2NDJGRTBGJywgJ0Q4M0VERDI2MjAwRDI2NDBGRTBGJywgJ0Q4M0RERTREMjAwRDI2NDJGRTBGJywgJ0Q4M0RERUI2MjAwRDI2NDBGRTBGJywgJ0Q4M0VERDMzRDgzQ0RGRkInLCAnRDgzQ0RGQzMyMDBEMjY0MEZFMEYnLCAnRDgzRERDNkYyMDBEMjY0MkZFMEYnLCAnRDgzQ0RGQ0MyMDBEMjY0MEZFMEYnLCAnRDgzRERDMzEnLCAnRDgzRUREMjEnLCAnRDgzREREN0EnLCAnRDgzRERDNzMyMDBEMjY0MEZFMEYnLCAnRDgzRERDODIyMDBEMjY0MEZFMEYnLCAnRDgzRUREMzUnLCAnRDgzRUREMzQnLCAnRDgzRUREMzkyMDBEMjY0MkZFMEYnLCAnRDgzRUREMzkyMDBEMjY0MEZFMEYnLCAnRDgzRERDNjgyMDBEMjY5NkZFMEYnLCAnRDgzRERDNjkyMDBEMjY5NkZFMEYnLCAnRDgzRERDNjgyMDBEMjcwOEZFMEYnLCAnRDgzRERDNjkyMDBEMjcwOEZFMEYnLCAnRDgzRERDNjgyMDBERDgzRERFOTJGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERTkyRkUwRicsICdEODNEREM2ODIwMEREODNDREZBNEZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGQTRGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERjkzRkUwRicsICdEODNEREM2OTIwMEREODNDREY5M0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGRUJGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERkVCRkUwRicsICdEODNEREM2ODIwMEREODNDREYzRUZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGM0VGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERjczRkUwRicsICdEODNEREM2OTIwMEREODNDREY3M0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzREREMjdGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERDI3RkUwRicsICdEODNEREM2ODIwMEREODNDREZFREZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGRURGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0REQ0JDRkUwRicsICdEODNEREM2OTIwMEREODNERENCQ0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzREREMkNGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERDJDRkUwRicsICdEODNEREM2ODIwMEREODNERENCQkZFMEYnLCAnRDgzRERDNjkyMDBERDgzRERDQkJGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERkE4RkUwRicsICdEODNEREM2OTIwMEREODNDREZBOEZFMEYnLCAnRDgzRERDNjgyMDBERDgzRERFODBGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERTgwRkUwRicsICdEODNEREM2ODIwMEQyNjk1RkUwRicsICdEODNEREM2OTIwMEQyNjk1RkUwRiddLCA0OiBbJ0Q4M0NERjUyJywgJ0Q4M0NERjUzJywgJ0Q4M0NERjU0JywgJ0Q4M0NERjU1JywgJ0Q4M0NERjU2JywgJ0Q4M0NERjU3JywgJ0Q4M0NERjVBJywgJ0Q4M0NERjVCJywgJ0Q4M0NERjVDJywgJ0Q4M0NERjVEJywgJ0Q4M0NERjVFJywgJ0Q4M0NERjVGJywgJ0Q4M0NERjYwJywgJ0Q4M0NERjYxJywgJ0Q4M0NERjYyJywgJ0Q4M0NERjYzJywgJ0Q4M0NERjY0JywgJ0Q4M0NERjY1JywgJ0Q4M0NERjY2JywgJ0Q4M0NERjY3JywgJ0Q4M0NERjY4JywgJ0Q4M0NERjY5JywgJ0Q4M0NERjZBJywgJ0Q4M0NERjZCJywgJ0Q4M0NERjZDJywgJ0Q4M0NERjZEJywgJ0Q4M0NERjZFJywgJ0Q4M0NERjZGJywgJ0Q4M0NERjcwJywgJ0Q4M0NERjcxJywgJ0Q4M0NERjcyJywgJ0Q4M0NERjczJywgJ0Q4M0NERjc0JywgJ0Q4M0NERjc1JywgJ0Q4M0NERjc2JywgJ0Q4M0NERjc3JywgJ0Q4M0NERjc4JywgJ0Q4M0NERjc5JywgJ0Q4M0NERjdBJywgJ0Q4M0NERjdCJywgJ0Q4M0NERjdDJywgJ0Q4M0VERDU5JywgJ0Q4M0VERDVEJywgJ0Q4M0VERDVDJywgJ0Q4M0VERDU4JywgJ0Q4M0VERDU3JywgJ0Q4M0VERDU2JywgJ0Q4M0VERDUzJywgJ0Q4M0VERDUwJywgJ0Q4M0VERDQyJywgJ0Q4M0VERDUxJywgJ0Q4M0VERDQzJywgJ0Q4M0VERDU1JywgJ0Q4M0VERDU0JywgJ0Q4M0VERDUyJywgJ0Q4M0VERDVFJywgJ0Q4M0VERDVBJywgJ0Q4M0VERDVCJ10sIDU6IFsnMjZCRCcsICcyNkJFJywgJ0Q4M0NERkFGJywgJ0Q4M0NERkIxJywgJ0Q4M0NERkJEJywgJ0Q4M0NERkJFJywgJ0Q4M0NERkJGJywgJ0Q4M0NERkMwJywgJ0Q4M0NERkMxJywgJ0Q4M0NERkMyJywgJ0Q4M0NERkMzJywgJ0Q4M0NERkM0JywgJ0Q4M0NERkM2JywgJ0Q4M0NERkM3JywgJ0Q4M0NERkM4JywgJ0Q4M0NERkM5JywgJ0Q4M0NERkNBJywgJ0Q4M0REQzVGJywgJ0Q4M0RERUEzJywgJ0Q4M0RERUI0JywgJ0Q4M0RERUI1JywgJzI2RjMnLCAnMjZFQScsICdEODNFREQzREQ4M0NERkZCMjAwRDI2NDJGRTBGJywgJ0Q4M0VERDNERDgzQ0RGRkIyMDBEMjY0MEZFMEYnLCAnRDgzRUREM0VEODNDREZGQjIwMEQyNjQyRkUwRicsICdEODNFREQzQzIwMEQyNjQyRkUwRicsICdEODNFREQzOEQ4M0NERkZCMjAwRDI2NDJGRTBGJywgJ0Q4M0NERkNCMjAwRDI2NDBGRTBGJywgJzI2RjkyMDBEMjY0MEZFMEYnLCAnRDgzQ0RGQzQyMDBEMjY0MEZFMEYnLCAnRDgzQ0RGQ0EyMDBEMjY0MEZFMEYnLCAnRDgzRERFQjUyMDBEMjY0MEZFMEYnLCAnRDgzRERFQjQyMDBEMjY0MEZFMEYnLCAnRDgzRUREM0EnLCAnRDgzRERFRjQnLCAnRDgzRERFRjYnLCAnRDgzRURENEEnLCAnRDgzRURENEInLCAnRDgzRURENDUnLCAnRDgzRURENDEnXSwgNjogWydEODNEREU4NScsICdEODNEREU4NicsICdEODNEREU4NycsICdEODNEREU4OCcsICdEODNEREU4QScsICdEODNEREU4QycsICdEODNEREU4RCcsICdEODNEREU4RScsICdEODNEREU4RicsICdEODNEREU5MCcsICdEODNEREU5MScsICdEODNEREU5MicsICdEODNEREU5MycsICdEODNEREU5NCcsICdEODNEREU5NScsICdEODNEREU5NicsICdEODNEREU5NycsICdEODNEREU5OCcsICdEODNEREU5OScsICdEODNEREU5QScsICdEODNEREU5QicsICdEODNEREU5QycsICdEODNEREU5RCcsICdEODNEREU5RScsICdEODNEREU5RicsICdEODNEREVBMCcsICdEODNEREVBMScsICdEODNEREVBNCcsICdEODNEREVBNycsICdEODNEREVBOCcsICcyNkY1JywgJ0Q4M0RERTgwJywgJ0Q4M0RERTgxJywgJ0Q4M0RERTgyJywgJ0Q4M0RERTgzJywgJ0Q4M0RERTg0JywgJzI2RkQnLCAnMjcwOCcsICdEODNEREVGNScsICdEODNDREZEQyddLCA3OiBbJzIzRjAnLCAnMjNGMycsICcyNjBFJywgJzI2MTUnLCAnMjY3QicsICcyNkExJywgJzI3MDInLCAnMjcwOScsICcyNzBGJywgJzI3MTInLCAnRDgzQ0RDMDQnLCAnRDgzQ0RDQ0YnLCAnRDgzQ0RGMDInLCAnRDgzQ0RGMUYnLCAnRDgzQ0RGODAnLCAnRDgzQ0RGODEnLCAnRDgzQ0RGODInLCAnRDgzQ0RGODMnLCAnRDgzQ0RGODQnLCAnRDgzQ0RGODgnLCAnRDgzQ0RGODknLCAnRDgzQ0RGOEEnLCAnRDgzQ0RGOEInLCAnRDgzQ0RGOEMnLCAnRDgzQ0RGOEQnLCAnRDgzQ0RGOEYnLCAnRDgzQ0RGOTAnLCAnRDgzQ0RGOTInLCAnRDgzQ0RGOTMnLCAnRDgzQ0RGQTMnLCAnRDgzQ0RGQTQnLCAnRDgzQ0RGQTcnLCAnRDgzQ0RGQTgnLCAnRDgzQ0RGQTknLCAnRDgzQ0RGQUEnLCAnRDgzQ0RGQUInLCAnRDgzQ0RGQUMnLCAnRDgzQ0RGQUQnLCAnRDgzQ0RGQjAnLCAnRDgzQ0RGQjInLCAnRDgzQ0RGQjMnLCAnRDgzQ0RGQjQnLCAnRDgzQ0RGQjcnLCAnRDgzQ0RGQjgnLCAnRDgzQ0RGQjknLCAnRDgzQ0RGQkEnLCAnRDgzQ0RGQkInLCAnRDgzRERDNTEnLCAnRDgzRERDNTInLCAnRDgzRERDNTMnLCAnRDgzRERDNTQnLCAnRDgzRERDNTUnLCAnRDgzRERDNTYnLCAnRDgzRERDNTcnLCAnRDgzRERDNTgnLCAnRDgzRERDNTknLCAnRDgzRERDNUEnLCAnRDgzRERDNUInLCAnRDgzRERDNjAnLCAnRDgzRERDNUMnLCAnRDgzRERDNUQnLCAnRDgzRERDNUUnLCAnRDgzRERDNjEnLCAnRDgzRERDNjInLCAnRDgzRERDNjMnLCAnRDgzRERDN0UnLCAnRDgzRERDODgnLCAnRDgzRERDODknLCAnRDgzRERDOEEnLCAnRDgzRERDOEMnLCAnRDgzRERDOEQnLCAnRDgzRERDOEUnLCAnRDgzRERDOTAnLCAnRDgzRERDOTInLCAnRDgzRERDQTEnLCAnRDgzRERDQTMnLCAnRDgzRERDQTUnLCAnRDgzRERDQjAnLCAnRDgzRERDQjMnLCAnRDgzRERDQjQnLCAnRDgzRERDQjUnLCAnRDgzRERDQjYnLCAnRDgzRERDQjcnLCAnRDgzRERDQjgnLCAnRDgzRERDQkEnLCAnRDgzRERDQkInLCAnRDgzRERDQkMnLCAnRDgzRERDQkQnLCAnRDgzRERDQkUnLCAnRDgzRERDQkYnLCAnRDgzRERDQzQnLCAnRDgzRERDQzUnLCAnRDgzRERDQzcnLCAnRDgzRERDQzgnLCAnRDgzRERDQzknLCAnRDgzRERDQ0EnLCAnRDgzRERDQ0InLCAnRDgzRERDQ0MnLCAnRDgzRERDQ0QnLCAnRDgzRERDQ0UnLCAnRDgzRERDRDAnLCAnRDgzRERDRDEnLCAnRDgzRERDRDInLCAnRDgzRERDRDMnLCAnRDgzRERDRDQnLCAnRDgzRERDRDUnLCAnRDgzRERDRDYnLCAnRDgzRERDRDcnLCAnRDgzRERDRDgnLCAnRDgzRERDRDknLCAnRDgzRERDREEnLCAnRDgzRERDREMnLCAnRDgzRERDREQnLCAnRDgzRERDREYnLCAnRDgzRERDRTAnLCAnRDgzRERDRTEnLCAnRDgzRERDRTInLCAnRDgzRERDRTYnLCAnRDgzRERDRUQnLCAnRDgzRERDRUUnLCAnRDgzRERDRUYnLCAnRDgzRERDRjAnLCAnRDgzRERDRjEnLCAnRDgzRERDRjcnLCAnRDgzRERDRjknLCAnRDgzRERDRkEnLCAnRDgzRERDRkInLCAnRDgzRERDRkMnLCAnRDgzREREMDYnLCAnRDgzREREMEUnLCAnRDgzREREMTEnLCAnRDgzREREMTQnLCAnRDgzREREMTYnLCAnRDgzREREMjYnLCAnRDgzREREMjcnLCAnRDgzREREMjgnLCAnRDgzREREMjknLCAnRDgzREREMkEnLCAnRDgzREREMkInLCAnRDgzREREMkMnLCAnRDgzREREMkQnLCAnRDgzREREMkUnLCAnRDgzREREMzEnLCAnRDgzRERERkYnLCAnRDgzRERFQUEnLCAnRDgzRERFQUMnLCAnRDgzRERFQkQnLCAnRDgzRERFQkYnLCAnRDgzRERFQzAnLCAnRDgzRURENDQnLCAnRDgzRURENDcnLCAnRDgzRURENDgnLCAnRDgzRURENDknLCAnRDgzRERFRDInXSwgODogWydEODNEREM5MycsICdEODNEREM5NCcsICdEODNEREM5NScsICdEODNEREM5NicsICdEODNEREM5NycsICdEODNEREM5OCcsICdEODNEREM5OScsICdEODNEREM5QScsICdEODNEREM5QicsICdEODNEREM5QycsICdEODNEREM5RCcsICdEODNEREM5RScsICdEODNEREM5RicsICdEODNERENBQycsICdEODNERENBRCcsICdEODNEREQxRScsICcyNkEwJywgJzI2RDQnLCAnRDgzRERDMjknLCAnRDgzQ0REOTgnLCAnRDgzQ0RGMUEnLCAnRDgzREREQTQnLCAnRDgzRERDQTgnLCAnRDgzREREMjUnLCAnMjYwMCcsICcyNjAxJywgJzI2QzQnLCAnMjZDNScsICcyNzI4JywgJ0Q4M0NERjBEJywgJ0Q4M0NERjFCJywgJ0Q4M0NERjFEJywgJ0Q4M0NERjFFJywgJzI2MDQnLCAnRDgzQ0RGMDgnLCAnRDgzQ0RGMTYnLCAnMjY5NSddLCA5OiBbJ0Q4M0NEREU4RDgzQ0RERjMnLCAnRDgzQ0RERTlEODNDRERFQScsICdEODNDRERFQUQ4M0NEREY4JywgJ0Q4M0NEREVCRDgzQ0RERjcnLCAnRDgzQ0RERUNEODNDRERFNycsICdEODNDRERFRUQ4M0NEREY5JywgJ0Q4M0NEREVGRDgzQ0RERjUnLCAnRDgzQ0RERjBEODNDRERGNycsICdEODNDRERGN0Q4M0NEREZBJywgJ0Q4M0NEREZBRDgzQ0RERjgnLCAnRDgzQ0RERkFEODNDRERFNicsICdEODNDRERGMEQ4M0NEREZGJywgJ0Q4M0NEREU3RDgzQ0RERkUnLCAnRDgzQ0RERTZEODNDRERGQScsICdEODNDRERFNkQ4M0NEREY5JywgJ0Q4M0NEREU3RDgzQ0RERUEnLCAnRDgzQ0RERTdEODNDRERGNycsICdEODNDRERGQkQ4M0NEREYzJywgJ0Q4M0NEREVERDgzQ0RERjAnLCAnRDgzQ0RERTlEODNDRERGMCcsICdEODNDRERFRUQ4M0NEREYxJywgJ0Q4M0NEREVFRDgzQ0RERjMnLCAnRDgzQ0RERUVEODNDRERFOScsICdEODNDRERFRUQ4M0NEREVBJywgJ0Q4M0NEREU4RDgzQ0RERTYnLCAnRDgzQ0RERThEODNDRERGNCcsICdEODNDRERGMkQ4M0NEREY0JywgJ0Q4M0NEREYyRDgzQ0RERkUnLCAnRDgzQ0RERjJEODNDRERGRCcsICdEODNDRERGM0Q4M0NEREYxJywgJ0Q4M0NEREYzRDgzQ0RERkYnLCAnRDgzQ0RERjNEODNDRERGNCcsICdEODNDRERFNkQ4M0NEREVBJywgJ0Q4M0NEREY1RDgzQ0RERjEnLCAnRDgzQ0RERjVEODNDRERGOScsICdEODNDRERGNUQ4M0NEREY3JywgJ0Q4M0NEREY4RDgzQ0RERTYnLCAnRDgzQ0RERjhEODNDRERFQycsICdEODNDRERGOUQ4M0NEREY3JywgJ0Q4M0NEREY1RDgzQ0RERUQnLCAnRDgzQ0RERUJEODNDRERFRScsICdEODNDRERFOEQ4M0NEREYxJywgJ0Q4M0NEREU4RDgzQ0RERUQnLCAnRDgzQ0RERjhEODNDRERFQScsICdEODNDRERGRkQ4M0NEREU2JywgJ0Q4M0NERkYzMjAwREQ4M0NERjA4RkUwRiddfSwKY3VyRW1vamlSZWNlbnQ6IHt9LAplbW9qaVdpdGhKb2luZXJzOiBbIkQ4M0REQzcxMjAwRDI2NDBGRTBGIiwiRDgzRERDNkUyMDBEMjY0MEZFMEYiLCJEODNEREM3NzIwMEQyNjQwRkUwRiIsIkQ4M0RERDc1MjAwRDI2NDBGRTBGIiwiRDgzRERFNDcyMDBEMjY0MEZFMEYiLCJEODNEREM4MTIwMEQyNjQyRkUwRiIsIkQ4M0RERTQ1MjAwRDI2NDJGRTBGIiwiRDgzRERFNDYyMDBEMjY0MkZFMEYiLCJEODNEREU0RTIwMEQyNjQyRkUwRiIsIkQ4M0RERTREMjAwRDI2NDJGRTBGIiwiRDgzRERDODYyMDBEMjY0MkZFMEYiLCJEODNEREM4NzIwMEQyNjQyRkUwRiIsIkQ4M0RERUI2MjAwRDI2NDBGRTBGIiwiRDgzQ0RGQzMyMDBEMjY0MEZFMEYiLCJEODNDREZDQjIwMEQyNjQwRkUwRiIsIjI2RjkyMDBEMjY0MEZFMEYiLCJEODNDREZDNDIwMEQyNjQwRkUwRiIsIkQ4M0NERkNBMjAwRDI2NDBGRTBGIiwiRDgzRERFQjUyMDBEMjY0MEZFMEYiLCJEODNEREVCNDIwMEQyNjQwRkUwRiIsIkQ4M0REQzZGMjAwRDI2NDJGRTBGIiwiRDgzQ0RGQ0MyMDBEMjY0MEZFMEYiLCJEODNEREU0QjIwMEQyNjQyRkUwRiIsIkQ4M0REQzczMjAwRDI2NDBGRTBGIiwiRDgzRERDODIyMDBEMjY0MEZFMEYiLCJEODNDREZGMzIwMEREODNDREYwOEZFMEYiLCJEODNFREQyNkQ4M0NERkZCMjAwRDI2NDJGRTBGIiwiRDgzRUREMzdEODNDREZGQjIwMEQyNjQwRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkIyMDBEMjY0MkZFMEYiLCJEODNFREQzREQ4M0NERkZCMjAwRDI2NDJGRTBGIiwiRDgzRUREM0REODNDREZGQjIwMEQyNjQwRkUwRiIsIkQ4M0VERDNFRDgzQ0RGRkIyMDBEMjY0MkZFMEYiLCJEODNFREQzQzIwMEQyNjQyRkUwRiIsIkQ4M0VERDM4RDgzQ0RGRkIyMDBEMjY0MkZFMEYiLCJEODNFREQzNzIwMEQyNjQyRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkMyMDBEMjY0MkZFMEYiLCJEODNFREQzN0Q4M0NERkZEMjAwRDI2NDJGRTBGIiwiRDgzRUREMzdEODNDREZGRTIwMEQyNjQyRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkYyMDBEMjY0MkZFMEYiLCJEODNFREQyNjIwMEQyNjQyRkUwRiIsIkQ4M0VERDI2RDgzQ0RGRkMyMDBEMjY0MkZFMEYiLCJEODNFREQyNkQ4M0NERkZEMjAwRDI2NDJGRTBGIiwiRDgzRUREMjZEODNDREZGRTIwMEQyNjQyRkUwRiIsIkQ4M0VERDI2RDgzQ0RGRkYyMDBEMjY0MkZFMEYiLCJEODNFREQzNzIwMEQyNjQwRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkMyMDBEMjY0MEZFMEYiLCJEODNFREQzN0Q4M0NERkZEMjAwRDI2NDBGRTBGIiwiRDgzRUREMzdEODNDREZGRTIwMEQyNjQwRkUwRiIsIkQ4M0VERDM3RDgzQ0RGRkYyMDBEMjY0MEZFMEYiLCJEODNFREQzRDIwMEQyNjQyRkUwRiIsIkQ4M0VERDNERDgzQ0RGRkMyMDBEMjY0MkZFMEYiLCJEODNFREQzREQ4M0NERkZEMjAwRDI2NDJGRTBGIiwiRDgzRUREM0REODNDREZGRTIwMEQyNjQyRkUwRiIsIkQ4M0VERDNERDgzQ0RGRkYyMDBEMjY0MkZFMEYiLCJEODNFREQzRDIwMEQyNjQwRkUwRiIsIkQ4M0VERDNERDgzQ0RGRkMyMDBEMjY0MEZFMEYiLCJEODNFREQzREQ4M0NERkZEMjAwRDI2NDBGRTBGIiwiRDgzRUREM0REODNDREZGRTIwMEQyNjQwRkUwRiIsIkQ4M0VERDNERDgzQ0RGRkYyMDBEMjY0MEZFMEYiLCJEODNFREQzRTIwMEQyNjQyRkUwRiIsIkQ4M0VERDNFRDgzQ0RGRkMyMDBEMjY0MkZFMEYiLCJEODNFREQzRUQ4M0NERkZEMjAwRDI2NDJGRTBGIiwiRDgzRUREM0VEODNDREZGRTIwMEQyNjQyRkUwRiIsIkQ4M0VERDNFRDgzQ0RGRkYyMDBEMjY0MkZFMEYiLCJEODNFREQzODIwMEQyNjQyRkUwRiIsIkQ4M0VERDM4RDgzQ0RGRkMyMDBEMjY0MkZFMEYiLCJEODNFREQzOEQ4M0NERkZEMjAwRDI2NDJGRTBGIiwiRDgzRUREMzhEODNDREZGRTIwMEQyNjQyRkUwRiIsIkQ4M0VERDM4RDgzQ0RGRkYyMDBEMjY0MkZFMEYiLCJEODNFREQxOUQ4M0NERkZCIiwiRDgzRUREMTlEODNDREZGQyIsIkQ4M0VERDE5RDgzQ0RGRkQiLCJEODNFREQxOUQ4M0NERkZFIiwiRDgzRUREMTlEODNDREZGRiIsIkQ4M0VERDFCRDgzQ0RGRkIiLCJEODNFREQxQkQ4M0NERkZDIiwiRDgzRUREMUJEODNDREZGRCIsIkQ4M0VERDFCRDgzQ0RGRkUiLCJEODNFREQxQkQ4M0NERkZGIiwiRDgzRUREMUNEODNDREZGQiIsIkQ4M0VERDFDRDgzQ0RGRkMiLCJEODNFREQxQ0Q4M0NERkZEIiwiRDgzRUREMUNEODNDREZGRSIsIkQ4M0VERDFDRDgzQ0RGRkYiLCAnRDgzRUREMjYyMDBEMjY0MEZFMEYnLCAnRDgzRUREMzkyMDBEMjY0MkZFMEYnLCAnRDgzRUREMzkyMDBEMjY0MEZFMEYnLCAnRDgzRERDNjgyMDBERDgzRERFOTJGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERTkyRkUwRicsICdEODNEREM2ODIwMEREODNDREZBNEZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGQTRGRTBGJywgJ0Q4M0REQzY4MjAwRDI2OTVGRTBGJywgJ0Q4M0REQzY5MjAwRDI2OTVGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERjkzRkUwRicsICdEODNEREM2OTIwMEREODNDREY5M0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzQ0RGRUJGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0NERkVCRkUwRicsICdEODNEREM2ODIwMEQyNjk2RkUwRicsICdEODNEREM2OTIwMEQyNjk2RkUwRicsICdEODNEREM2ODIwMEREODNDREYzRUZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGM0VGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERjczRkUwRicsICdEODNEREM2OTIwMEREODNDREY3M0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzREREMjdGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERDI3RkUwRicsICdEODNEREM2ODIwMEREODNDREZFREZFMEYnLCAnRDgzRERDNjkyMDBERDgzQ0RGRURGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0REQ0JDRkUwRicsICdEODNEREM2OTIwMEREODNERENCQ0ZFMEYnLCAnRDgzRERDNjgyMDBERDgzREREMkNGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERDJDRkUwRicsICdEODNEREM2ODIwMEREODNERENCQkZFMEYnLCAnRDgzRERDNjkyMDBERDgzRERDQkJGRTBGJywgJ0Q4M0REQzY4MjAwREQ4M0NERkE4RkUwRicsICdEODNEREM2OTIwMEREODNDREZBOEZFMEYnLCAnRDgzRERDNjgyMDBEMjcwOEZFMEYnLCAnRDgzRERDNjkyMDBEMjcwOEZFMEYnLCAnRDgzRERDNjgyMDBERDgzRERFODBGRTBGJywgJ0Q4M0REQzY5MjAwREQ4M0RERTgwRkUwRiddLAplbW9qaUxvYWRNb3JlOiBmdW5jdGlvbihvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgaWYgKG9wdHMuZW1vamlNb3JlU3QpIHsKICAgIHJldHVybjsKICB9CiAgb3B0cy5lbW9qaU1vcmVTdCA9IDE7CgogIHZhciBwYXJhbXMgPSB7YWN0OiAnZ2V0X2Vtb2ppX2xpc3QnfTsKICBpZiAoRW1vamkuaGFzTmV3U3RpY2tlcnMgPCAwKSBwYXJhbXMubmV3X3Nob3duID0gMTsKICBhamF4LnBvc3QoJ2FsX2ltLnBocCcsIHBhcmFtcywgewogICAgb25Eb25lOiBmdW5jdGlvbihzdGlja2VycywgcmVjZW50X2Vtb2ppKSB7CiAgICAgIEVtb2ppLnN0aWNrZXJzID0gc3RpY2tlcnM7CiAgICAgIG9wdHMuZW1vamlNb3JlU3QgPSAwOwoKICAgICAgaWYgKEVtb2ppLnN0aWNrZXJzWy0xXSkgewogICAgICAgIGxzLnNldCgncmVjZW50X3N0aWNrZXJzJywgRW1vamkuc3RpY2tlcnNbLTFdKTsKICAgICAgICBFbW9qaS51cGRhdGVSZWNlbnRFbW9qaShvcHRJZCk7CiAgICAgIH0KICAgICAgb3B0cy5hbGxFbW9qaUlkID0gMDsKICAgICAgaWYgKG9wdHMuc2hhcmVkVFQpIHsKICAgICAgICBvcHRzLnNoYXJlZFRULmVtb2ppQWxsSWQgPSAwOwogICAgICB9CgogICAgICBpZiAoRW1vamkub25TdGlja2Vyc0xvYWQpIHsKICAgICAgICBvcHRzLmFmdGVyTG9hZCA9IDE7CiAgICAgIH0KCiAgICAgIGlmIChFbW9qaS5vblN0aWNrZXJzTG9hZCAmJiB3aW5kb3cuZW1vamlTdGlja2VycykgewogICAgICAgIEVtb2ppLm9uU3RpY2tlcnNMb2FkKCk7CiAgICAgICAgRW1vamkub25TdGlja2Vyc0xvYWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgdmFyIGVtb2ppTGlzdCA9IEVtb2ppLmVtb2ppR2V0UmVjZW50RnJvbVN0b3JhZ2UoKTsKICAgICAgaWYgKCFlbW9qaUxpc3QpIHsKICAgICAgICBFbW9qaS5lbW9qaU9sZFJlY2VudFByZXBhcmUocmVjZW50X2Vtb2ppLCBvcHRJZCk7CiAgICAgICAgRW1vamkudXBkYXRlRW1vamlDb250KG9wdElkKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBFbW9qaS5jdXJFbW9qaVJlY2VudCA9IEVtb2ppLmZpbHRlckVtb2ppKGVtb2ppTGlzdCk7CiAgICAgIH0KICAgICAgRW1vamkudXBkYXRlUmVjZW50RW1vamkob3B0SWQpOwogICAgICBvcHRzLm9uUmVjZW50RW1vamlVcGRhdGUgJiYgb3B0cy5vblJlY2VudEVtb2ppVXBkYXRlKCk7CiAgICB9LAogICAgb25GYWlsOiBmdW5jdGlvbiAoKSB7CiAgICAgIG9wdHMuZW1vamlNb3JlU3QgPSAwOwogICAgfQogIH0pCgogIGlmIChFbW9qaS5jdXJFbW9qaVJlY2VudCkgewogICAgb3B0cy5vblJlY2VudEVtb2ppVXBkYXRlICYmIG9wdHMub25SZWNlbnRFbW9qaVVwZGF0ZSgpOwogIH0KfSwKCmZpbHRlckVtb2ppOiBmdW5jdGlvbiAoZW1vamlfbGlzdCkgewogIHZhciBub0NoZWNrZWQgPSBPYmplY3Qua2V5cyhlbW9qaV9saXN0KTsKCiAgY2hlY2tpbmc6CiAgZm9yKHZhciBpIGluIEVtb2ppLmN1ckVtb2ppQ2F0cykgewogICAgZm9yKHZhciBqIGluIEVtb2ppLmN1ckVtb2ppQ2F0c1tpXSkgewogICAgICB2YXIgY29kZSA9IEVtb2ppLmN1ckVtb2ppQ2F0c1tpXVtqXSwgcG9zID0gbm9DaGVja2VkLmluZGV4T2YoY29kZSk7CiAgICAgIGlmIChwb3MgIT0gLTEpIHsKICAgICAgICBub0NoZWNrZWQuc3BsaWNlKHBvcywgMSk7CiAgICAgICAgaWYgKG5vQ2hlY2tlZC5sZW5ndGggPT0gMCkgewogICAgICAgICAgYnJlYWsgY2hlY2tpbmc7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICB2YXIgcmVzdWx0ID0ge307CiAgZm9yKHZhciBpIGluIGVtb2ppX2xpc3QpIHsKICAgIGlmIChub0NoZWNrZWQuaW5kZXhPZihpKSA9PSAtMSkgewogICAgICByZXN1bHRbaV0gPSBlbW9qaV9saXN0W2ldOwogICAgfQogIH0KCiAgaWYgKG5vQ2hlY2tlZC5sZW5ndGggPiAwKSB7CiAgICBFbW9qaS5zZXRSZWNlbnRFbW9qaUxpc3QocmVzdWx0KTsKICB9CgogIHJldHVybiByZXN1bHQ7Cn0sCgplbW9qaUdldFJlY2VudEZyb21TdG9yYWdlOiBmdW5jdGlvbiAoKSB7CiAgdHJ5IHsKICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdlbW9qaV9yZWNlbnRfbGlzdCcpKTsKICB9IGNhdGNoKGUpIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0sCgplbW9qaU9sZFJlY2VudFByZXBhcmU6IGZ1bmN0aW9uIChyZWNlbnRfZW1vamkpIHsKICB2YXIgZW1vamlfbGlzdCA9IHt9OwogIGZvcih2YXIgaSBpbiByZWNlbnRfZW1vamkpIHsKICAgIHZhciBpdGVtID0gcmVjZW50X2Vtb2ppW2ldOwogICAgaWYgKGlzU3RyaW5nKGl0ZW0pKSB7CiAgICAgIHZhciByYXRlID0gMSwgY29kZSA9IGl0ZW07CiAgICB9IGVsc2UgewogICAgICB2YXIgcmF0ZSA9IGl0ZW0sIGNvZGUgPSBpOwogICAgfQogICAgZW1vamlfbGlzdFtjb2RlXSA9IHJhdGU7CiAgfQogIEVtb2ppLnNldFJlY2VudEVtb2ppTGlzdChFbW9qaS5maWx0ZXJFbW9qaShlbW9qaV9saXN0KSk7Cn0sCgpnZXRSZWNlbnRFbW9qaVNvcnRlZDogZnVuY3Rpb24gKCkgewogIHZhciByZWNlbnQgPSBbXTsKICBmb3IodmFyIGkgaW4gRW1vamkuY3VyRW1vamlSZWNlbnQpIHsKICAgIHZhciBpdGVtID0gRW1vamkuY3VyRW1vamlSZWNlbnRbaV07CiAgICByZWNlbnQucHVzaChbaSwgaXRlbV0pOwogIH0KICByZWNlbnQuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgcmV0dXJuIGJbMV0gLSBhWzFdOwogIH0pOwoKICB2YXIgcmVzID0gW107CiAgZm9yKHZhciBpIGluIHJlY2VudCkgewogICAgcmVzLnB1c2gocmVjZW50W2ldWzBdKTsKICB9CiAgcmV0dXJuIHJlcy5zbGljZSgwLCAyMCk7Cn0sCgppbmNyUmVjZW50RW1vamlSYXRlOiBmdW5jdGlvbiAob3B0SWQsIGNvZGUpIHsKICB2YXIgcmF0ZUludGVydmFsID0gNjsKICBpZiAoIUVtb2ppLmVtb2ppUmVjZW50UmF0ZVRpbWUpIHsKICAgIEVtb2ppLmVtb2ppUmVjZW50UmF0ZVRpbWUgPSB2a05vdygpIC8gMTAwMCAtIHJhdGVJbnRlcnZhbDsKICB9CiAgdmFyIHRpbWVEaWZmID0gdmtOb3coKSAvIDEwMDAgLSBFbW9qaS5lbW9qaVJlY2VudFJhdGVUaW1lOwoKICBpZiAodGltZURpZmYgPj0gcmF0ZUludGVydmFsKSB7CiAgICB2YXIgcG93ZXIgPSBNYXRoLm1pbigxMDAsIE1hdGguZmxvb3IodGltZURpZmYgLyByYXRlSW50ZXJ2YWwpKTsKICAgIGZvcih2YXIgaSBpbiBFbW9qaS5jdXJFbW9qaVJlY2VudCkgewogICAgICBpZiAoaSA9PSBjb2RlKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgRW1vamkuY3VyRW1vamlSZWNlbnRbaV0gKj0gTWF0aC5wb3coMC45OTgwNzYsIHBvd2VyKTsKICAgIH0KCiAgICBFbW9qaS5lbW9qaVJlY2VudFJhdGVUaW1lICs9IHJhdGVJbnRlcnZhbCAqIHBvd2VyOwogIH0KICBpZiAoIUVtb2ppLmN1ckVtb2ppUmVjZW50W2NvZGVdKSB7CiAgICBFbW9qaS5jdXJFbW9qaVJlY2VudFtjb2RlXSA9IDA7CiAgfQogIEVtb2ppLmN1ckVtb2ppUmVjZW50W2NvZGVdICs9IDE7CgogIHZhciBjb2RlcyA9IEVtb2ppLmdldFJlY2VudEVtb2ppU29ydGVkKCk7CiAgRW1vamkuY3VyRW1vamlDYXRzWy0xXSA9IGNvZGVzOwoKICBpZiAoY29kZXMubGVuZ3RoID49IDIwICYmIGNvZGVzLmluZGV4T2YoY29kZSkgPT0gLTEpIHsKICAgIGNvZGVzLnNwbGljZSgtMSk7CiAgICBjb2Rlcy5wdXNoKGNvZGUpOwogIH0KCiAgdmFyIHJlcyA9IHt9OwogIGZvcih2YXIgaSBpbiBjb2RlcykgewogICAgdmFyIGNvZGUgPSBjb2Rlc1tpXTsKICAgIHJlc1tjb2RlXSA9IEVtb2ppLmN1ckVtb2ppUmVjZW50W2NvZGVdOwogIH0KCiAgRW1vamkuc2V0UmVjZW50RW1vamlMaXN0KHJlcyk7CiAgd2luZG93Lk5vdGlmaWVyICYmIE5vdGlmaWVyLmxjU2VuZCgncmVjZW50X2Vtb2ppX3NldCcsIHJlcyk7Cn0sCgpzZXRSZWNlbnRFbW9qaUxpc3Q6IGZ1bmN0aW9uIChsaXN0KSB7CiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2Vtb2ppX3JlY2VudF9saXN0JywgSlNPTi5zdHJpbmdpZnkobGlzdCkpOwogIEVtb2ppLmN1ckVtb2ppUmVjZW50ID0gbGlzdDsKfSwKCnVwZGF0ZUVtb2ppQ29udDogZnVuY3Rpb24gKG9wdElkKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKCiAgaWYgKG9wdHMuY3VyVGFiID09IDApIHsKICAgIHZhbChnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc21pbGVzJywgb3B0cy50dCksIEVtb2ppLmdldEluaXRFbW9qaUNvbnRlbnQob3B0SWQpKTsKICAgIEVtb2ppLnVwZGF0ZUVtb2ppQ2F0VGl0bGUob3B0SWQpOwogIH0KfSwKCnR0RW1vamlMaXN0OiBmdW5jdGlvbihvcHRJZCwgY2F0ZWdvcnlJZHMpIHsKICB2YXIgcmVzID0gJyc7CgogIHZhciBlbW9qaUxpc3QgPSBFbW9qaS5lbW9qaUdldFJlY2VudEZyb21TdG9yYWdlKCk7CiAgaWYgKGVtb2ppTGlzdCkgewogICAgRW1vamkuc2V0UmVjZW50RW1vamlMaXN0KGVtb2ppTGlzdCk7CiAgfQoKICBFbW9qaS5jdXJFbW9qaUNhdHNbLTFdID0gRW1vamkuZ2V0UmVjZW50RW1vamlTb3J0ZWQoKTsKCiAgdmFyIHNvcnRlZENhdHMgPSBjYXRlZ29yeUlkcyA/IGNhdGVnb3J5SWRzOiBFbW9qaS5TT1JURURfRU1PSklfQ0FURUdPUklFUzsKCiAgZm9yKHZhciBpIGluIHNvcnRlZENhdHMpIHsKICAgIHZhciBjYXRJZCA9IHNvcnRlZENhdHNbaV07CiAgICByZXMgKz0gRW1vamkuZ2V0RW1vamlDYXRlZ29yeUh0bWwob3B0SWQsIGNhdElkKTsKICB9CiAgcmV0dXJuIHJlczsKfSwKCmdldEluaXRFbW9qaUNvbnRlbnQ6IGZ1bmN0aW9uIChvcHRJZCkgewogIEVtb2ppLnNldEVtb2ppTGFzdEFkZGVkQ2F0ZWdvcnlJZHgob3B0SWQsIDEpOwogIHZhciByZWNlbnRBbmRFbW90aW9ucyA9IFstMSwgMV07CiAgcmV0dXJuIEVtb2ppLnR0RW1vamlMaXN0KG9wdElkLCByZWNlbnRBbmRFbW90aW9ucyk7Cn0sCgpnZXRFbW9qaUNhdGVnb3J5SHRtbDogZnVuY3Rpb24gKG9wdElkLCBjYXRlZ29yeUlkKSB7CiAgdmFyIGNhdHMgPSBFbW9qaS5jdXJFbW9qaUNhdHMsIHJlcyA9ICcnOwogIHZhciBjYXQgPSBjYXRzW2NhdGVnb3J5SWRdOwogIGlmICghY2F0Lmxlbmd0aCkgewogICAgcmV0dXJuIHJlczsKICB9CgogIHZhciBsbmdTdWIgPSBjYXRlZ29yeUlkID09IC0xID8gJ3JlY2VudCcgOiBjYXRlZ29yeUlkOwogIHZhciBjb250ID0gJzxkaXYgY2xhc3M9ImVtb2ppX2NhdF90aXRsZV9oZWxwZXIiIGRhdGEtaWQ9IicgKyBjYXRlZ29yeUlkICsgJyIgaWQ9ImVtb2ppX3JlY2VudF9saXN0JyArIG9wdElkICsgJ18nICsgY2F0ZWdvcnlJZCArICciPjxkaXYgY2xhc3M9ImVtb2ppX2NhdF90aXRsZSI+JyArIGdldExhbmcoJ2dsb2JhbF9lbW9qaV9jYXRfJyArIGxuZ1N1YikgKyAnPC9kaXY+PC9kaXY+JzsKICBjb250ICs9IEVtb2ppLmVtb2ppR2V0Q2F0Q29udChvcHRJZCwgY2F0KTsKICByZXMgKz0gY29udDsKCiAgcmV0dXJuIHJlczsKfSwKCmdldEVtb2ppTGFzdEFkZGVkQ2F0ZWdvcnlJZHg6IGZ1bmN0aW9uKG9wdElkKXsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIHJldHVybiBvcHRzLmxhc3RMb2FkZWRFbW9qaUNhdGVnb3JpZXNJZHhlc1tvcHRJZF07Cn0sCgpzZXRFbW9qaUxhc3RBZGRlZENhdGVnb3J5SWR4OiBmdW5jdGlvbihvcHRJZCwgaWR4KSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBvcHRzLmxhc3RMb2FkZWRFbW9qaUNhdGVnb3JpZXNJZHhlc1tvcHRJZF0gPSBpZHg7Cn0sCgphZGROZXh0RW1vamlDYXRlZ290eTogZnVuY3Rpb24gKG9wdElkKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXSwKICAgIHR0ID0gb3B0cy50dCwKICAgIGxhc3RMb2FkZWRDYXRlZ29yeUlkeCA9IEVtb2ppLmdldEVtb2ppTGFzdEFkZGVkQ2F0ZWdvcnlJZHgob3B0SWQpOwoKICBpZiAob3B0cy5lbW9qaUNhdGVnb3J5QWRkaW5nIHx8IG9wdHMuYWxsRW1vamlMb2FkZWQpIHsKICAgIHJldHVybjsKICB9CgogIG9wdHMuZW1vamlDYXRlZ29yeUFkZGluZyA9IHRydWU7CgogIGlmICghbGFzdExvYWRlZENhdGVnb3J5SWR4KSB7CiAgICBkZWJ1Z0xvZygnTm8gZW1vamkgbGFzdCBjYXRlZ29yeSBpZHgnKTsKICAgIHJldHVybjsKICB9CiAgdmFyIGVtb2ppV3JhcCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3Njcm9sbF9zbWlsZXMnLCB0dCk7CiAgbGFzdExvYWRlZENhdGVnb3J5SWR4Kys7CiAgaWYgKEVtb2ppLlNPUlRFRF9FTU9KSV9DQVRFR09SSUVTLmxlbmd0aCA+IGxhc3RMb2FkZWRDYXRlZ29yeUlkeCkgewogICAgdmFyIGNhdGVnb3J5SWQgPSBFbW9qaS5TT1JURURfRU1PSklfQ0FURUdPUklFU1tsYXN0TG9hZGVkQ2F0ZWdvcnlJZHhdOwogICAgZW1vamlXcmFwLmluc2VydEFkamFjZW50SFRNTCgnYmVmb3JlRW5kJywgRW1vamkuZ2V0RW1vamlDYXRlZ29yeUh0bWwob3B0SWQsIGNhdGVnb3J5SWQpKTsKICAgIEVtb2ppLnNldEVtb2ppTGFzdEFkZGVkQ2F0ZWdvcnlJZHgob3B0SWQsIGxhc3RMb2FkZWRDYXRlZ29yeUlkeCk7CiAgICBvcHRzLmVtb2ppU2Nyb2xsLnVwZGF0ZSgpOyAvLyBuZWVkIGlmIHJlc2l6ZSBzZW5zb3Igbm90IHdhcyBoYW5kbGVkIHJlc2l6ZS4KICB9IGVsc2UgewogICAgb3B0cy5hbGxFbW9qaUxvYWRlZCA9IHRydWU7CiAgfQogIG9wdHMuZW1vamlDYXRlZ29yeUFkZGluZyA9IGZhbHNlOwp9LAoKaGlkZVR0OiBmdW5jdGlvbiAodHQpIHsKICByZW1vdmVDbGFzcyh0dCwgRW1vamkuU0hPV05fVFRfQ0xTKTsKfSwKCnNob3dUdDogZnVuY3Rpb24odHQpewogIGFkZENsYXNzKHR0LCBFbW9qaS5TSE9XTl9UVF9DTFMpOwp9LAoKZW1vamlHZXRDYXRDb250OiBmdW5jdGlvbiAob3B0SWQsIGNhdCkgewogIHZhciByZXMgPSAnJywgcm93ID0gJycsIHRvdGFsID0gY2F0Lmxlbmd0aCAtIDE7CiAgZm9yKHZhciBqID0gMDsgaiA8PSB0b3RhbDsgaisrKSB7CiAgICByb3cgKz0gRW1vamkuZW1vamlXcmFwSXRlbShvcHRJZCwgY2F0W2pdLCBqKTsKICAgIGlmIChqID4gMCAmJiBqICUgMTAgPT0gOSB8fCBqID49IHRvdGFsKSB7CiAgICAgIHJlcyArPSAnPGRpdiBjbGFzcz0iZW1vamlfc21pbGVzX3JvdyI+JyArIHJvdyArICc8L2Rpdj4nOwogICAgICByb3cgPSAnJzsKICAgIH0KICB9CiAgcmV0dXJuIHJlczsKfSwKCnVwZGF0ZVJlY2VudEVtb2ppOiBmdW5jdGlvbiAob3B0SWQpIHsKICB2YXIgZW1vamlMaXN0ID0gRW1vamkuZ2V0UmVjZW50RW1vamlTb3J0ZWQoKSwKICAgIHJlY2VudF9lbHMgPSBFbW9qaS5lbW9qaUdldENhdENvbnQob3B0SWQsIGVtb2ppTGlzdCk7CgogIHZhciB0aXRsZUVsID0gZ2UoJ2Vtb2ppX3JlY2VudF9saXN0JyArIG9wdElkICsgJ18tMScpOwogIGlmICghdGl0bGVFbCkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIGVsID0gdGl0bGVFbC5uZXh0U2libGluZzsKICB3aGlsZShlbCkgewogICAgZWwgPSBlbC5uZXh0U2libGluZzsKICAgIGlmIChoYXNDbGFzcyhlbC5wcmV2aW91c1NpYmxpbmcsICdlbW9qaV9zbWlsZXNfcm93JykpIHsKICAgICAgcmUoZWwucHJldmlvdXNTaWJsaW5nKTsKICAgIH0gZWxzZSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgdmFyIHJvd3MgID0gY2UoJ2RpdicsIHsKICAgIGlubmVySFRNTDogcmVjZW50X2VscwogIH0pLCBuZXh0VGl0bGUgPSB0aXRsZUVsLm5leHRTaWJsaW5nLCBwYXJlbnQgPSB0aXRsZUVsLnBhcmVudE5vZGU7CiAgd2hpbGUoZWwgPSByb3dzLmZpcnN0Q2hpbGQpIHsKICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoZWwsIG5leHRUaXRsZSk7CiAgfQp9LAoKdXBkYXRlUmVjZW50U3RpY2tlcnM6IGZ1bmN0aW9uIChvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgaWYgKCFFbW9qaS5zdGlja2Vyc1stMV0gfHwgIW9wdHMgfHwgIW9wdHMuZW1vamlFeHBhbmRlZCkgewogICAgcmV0dXJuOwogIH0KICB2YXIgcmVjZW50V3JhcCA9IGdlKCdlbW9qaV9yZWNlbnRfc3RpY2tlcnNfY29udCcgKyBvcHRJZCk7CiAgaWYgKCFyZWNlbnRXcmFwKSB7CiAgICByZXR1cm47CiAgfQogIHZhbChyZWNlbnRXcmFwLCAnJyk7CgogIHZhciBzdGlja2VyU2l6ZSA9ICh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+PSAyKSA/ICcxMjgnIDogJzY0JzsKICB2YXIgc3RpY2tlcnMgPSBFbW9qaS5zdGlja2Vyc1stMV0uc3RpY2tlcnM7CiAgZm9yKHZhciBpID0gMDsgaSA8IHN0aWNrZXJzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc3RpY2tlckVsID0gc2UocnMoRW1vamkuc3RpY2tlckl0ZW0oKSwgewogICAgICBvcHRJZDogb3B0SWQsCiAgICAgIHNlbElkOiBFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTLAogICAgICBzdGlja2VySWQ6IHN0aWNrZXJzW2ldWzBdLAogICAgICBzaXplOiBzdGlja2Vyc1tpXVsxXSwKICAgICAgc3RpY2tlclNpemU6IHN0aWNrZXJTaXplCiAgICB9KSk7CiAgICByZWNlbnRXcmFwLmFwcGVuZENoaWxkKHN0aWNrZXJFbCk7CiAgICB2YXIgdG9wID0gTWF0aC5jZWlsKChpICsxKSAvIDQpICogNjg7CiAgICBvcHRzLm5lZWRMb2FkU3RpY2tlcnMudW5zaGlmdChbb3B0SWQgKyAnXycgKyBFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTICsgJ18nICsgc3RpY2tlcnNbaV1bMF0sIHRvcF0pOwogIH0KfSwKCnVwZGF0ZUVtb2ppQ2F0VGl0bGU6IGZ1bmN0aW9uIChvcHRJZCkgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CgogIGlmICghb3B0cyB8fCAhb3B0cy5lbW9qaVNjcm9sbCkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIGVtb2ppX2Jsb2NrX2VsID0gZ2UoJ2Vtb2ppX2Jsb2NrXycgKyBvcHRJZCk7CiAgdmFyIGVscyA9IGdlQnlDbGFzcygnZW1vamlfY2F0X3RpdGxlX2hlbHBlcicsIGVtb2ppX2Jsb2NrX2VsKTsKICB2YXIgc3QgPSBvcHRzLmVtb2ppU2Nyb2xsLmRhdGEuc2Nyb2xsVG9wOwogIHZhciBoZWxwZXIgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9jYXRzX3RpdGxlX2hlbHBlcicsIG9wdHMudHQpOwogIHZhciByb3dILCBjdXJSb3csIHJvd0k7CiAgaWYgKGVscy5sZW5ndGgpIHsKICAgIHZhciBmaXJzdFRpdGxlID0gZWxzWzBdOwogICAgcm93SCA9IEVtb2ppLmdldFNpemVDYWNoZWQoZmlyc3RUaXRsZSlbMV07CiAgfQoKICBmb3IodmFyIGkgPSBlbHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgIGlmIChzdCA+IGVsc1tpXS5vZmZzZXRUb3AgLSByb3dIKSB7CiAgICAgIGN1clJvdyA9IGVsc1tpXTsKICAgICAgcm93SSA9IGk7CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgaWYgKCFjdXJSb3cpIHsKICAgIHJldHVybiBkZWJ1Z0xvZygndGl0bGUgbm90IGZvdW5kJyk7CiAgfQoKICB2YXIgY3VyUm93SWQgPSBpbnR2YWwoYXR0cihjdXJSb3csICdkYXRhLWlkJykpOwogIGlmIChvcHRzLmN1ckVtb2ppQ2F0SWQgIT0gY3VyUm93SWQpIHsKICAgIG9wdHMuY3VyRW1vamlDYXRJZCA9IGN1clJvd0lkOwoKICAgIHZhciBuZWVkX3Jlc2V0ID0gW2N1clJvd107CgogICAgdmFyIHByZXZSb3cgPSBlbHNbcm93SSAtIDFdOwogICAgaWYgKHByZXZSb3cpIHsKICAgICAgYWRkQ2xhc3MocHJldlJvdywgJ2Vtb2ppX2NhdF90aXRsZV9maXgnKTsKICAgICAgc2V0U3R5bGUocHJldlJvdy5maXJzdENoaWxkLCAndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZVkoJyArIChjdXJSb3cub2Zmc2V0VG9wIC0gcHJldlJvdy5vZmZzZXRUb3AgLSByb3dIKSArICdweCknKTsKICAgIH0KCiAgICB2YXIgZWwgPSBjdXJSb3cubmV4dFNpYmxpbmc7CiAgICB3aGlsZShlbCkgewogICAgICBpZiAoaGFzQ2xhc3MoZWwsICdlbW9qaV9jYXRfdGl0bGVfZml4JykpIHsKICAgICAgICBuZWVkX3Jlc2V0LnB1c2goZWwpOwogICAgICB9CiAgICAgIGVsID0gZWwubmV4dFNpYmxpbmc7CiAgICB9CgogICAgZm9yKHZhciBpIGluIG5lZWRfcmVzZXQpIHsKICAgICAgcmVtb3ZlQ2xhc3MobmVlZF9yZXNldFtpXSwgJ2Vtb2ppX2NhdF90aXRsZV9maXgnKTsKICAgICAgc2V0U3R5bGUobmVlZF9yZXNldFtpXS5maXJzdENoaWxkLCAndHJhbnNmb3JtJywgJ3RyYW5zbGF0ZVkoMHB4KScpOwogICAgfQoKICAgIHZhbChoZWxwZXIsICcnKTsKICAgIG9wdHMuZW1vamlUaXRsZUhlbHBlcklzU2V0ID0gMDsKICB9CgogIGlmICghb3B0cy5lbW9qaVRpdGxlSGVscGVySXNTZXQgJiYgc3QgPj0gY3VyUm93Lm9mZnNldFRvcCAmJiBzdCA+IDApIHsKICAgIHZhbChoZWxwZXIsIHZhbChjdXJSb3cpKTsKICAgIG9wdHMuZW1vamlUaXRsZUhlbHBlcklzU2V0ID0gMTsKICB9IGVsc2UgaWYgKG9wdHMuZW1vamlUaXRsZUhlbHBlcklzU2V0ICYmIChzdCA8IGN1clJvdy5vZmZzZXRUb3AgfHwgc3QgPT0gMCkpIHsKICAgIHZhbChoZWxwZXIsICcnKTsKICAgIG9wdHMuZW1vamlUaXRsZUhlbHBlcklzU2V0ID0gMDsKICB9Cn0sCgplbW9qaVdyYXBJdGVtOiBmdW5jdGlvbihvcHRJZCwgY29kZSwgaSkgewogIHZhciBpbmZvID0gRW1vamkuY3NzRW1vamlbY29kZV07CiAgaWYgKGluZm8pIHsKICAgIHZhciB0aXRsZVN0ciA9ICcgdGl0bGU9IicraW5mb1sxXSsnIic7CiAgfSBlbHNlIHsKICAgIHZhciB0aXRsZVN0ciA9ICcnOwogIH0KICBpZiAoYnJvd3Nlci5tb2JpbGUpIHsKICAgIHZhciBvdmVyRXZlbnQgPSAnJzsKICB9IGVsc2UgewogICAgdmFyIG92ZXJFdmVudCA9ICcgb25tb3VzZW92ZXI9InJldHVybiBFbW9qaS5lbW9qaU92ZXIoJytvcHRJZCsnLCB0aGlzLCB0cnVlKTsiJzsKICB9CiAgcmV0dXJuICc8YSBjbGFzcz0iZW1vamlfc21pbGVfY29udCAnKygoY29kZSAhPSAnMjc2NCcgJiYgaSAmJiAoaSA8IDU0KSkgPyAnZW1vamlfc21pbGVfc2hhZG93JyA6ICcnKSsnIiAnK3RpdGxlU3RyKycgb25tb3VzZWRvd249IkVtb2ppLmFkZEVtb2ppKEVtb2ppLnNob3duSWQsIFwnJytjb2RlKydcJywgdGhpcyk7IHJldHVybiBjYW5jZWxFdmVudChldmVudCk7IiBvbmNsaWNrPSJyZXR1cm4gY2FuY2VsRXZlbnQoZXZlbnQpOyInK292ZXJFdmVudCsnPjxkaXYgY2xhc3M9ImVtb2ppX2JnIj48L2Rpdj48ZGl2IGNsYXNzPSJlbW9qaV9zaGFkb3ciPjwvZGl2PicrRW1vamkuZ2V0RW1vamlIVE1MKGNvZGUsIGZhbHNlLCBmYWxzZSwgdHJ1ZSkrJzwvYT4nCn0sCgpyZWFwcGVuZEVtb2ppOiBmdW5jdGlvbihvcHRJZCwgdHQpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGlmIChvcHRzICYmIG9wdHMucmNlQ29udCkgewogICAgaWYgKCFvcHRzLmFkZE1lZGlhQnRuKSB7CiAgICAgIG9wdHMuc2VuZFdyYXAuYXBwZW5kQ2hpbGQob3B0cy5yY2VDb250KTsKICAgIH0gZWxzZSB7CiAgICAgIG9wdHMuc2VuZFdyYXAuaW5zZXJ0QmVmb3JlKG9wdHMucmNlQ29udCwgb3B0cy5hZGRNZWRpYUJ0bik7CiAgICB9CiAgfQogIGlmICghdHQpIHJldHVybjsKICB2YXIgY29udHJvbHMgPSBvcHRzLmNvbnRyb2xzQ29udDsKICAvLyB2YXIgZGlmZiA9IG9wdHMuaXNTaXplZCA/IHNiV2lkdGgoKSA6IDA7CgogIGlmIChvcHRzLmVtb2ppV3JhcCkgeyAvLyBuZXcgd2F5CiAgICBvcHRzLmVtb2ppV3JhcC5hcHBlbmRDaGlsZCh0dCk7CiAgfSBlbHNlIHsKICAgIG9wdHMub2JqLmFwcGVuZENoaWxkKHR0KTsKICB9CiAgLy8gZGlmZiArPSBvcHRzLnR0RGlmZiArIEVtb2ppLnR0U2hpZnQ7CiAgLy8gc2V0U3R5bGUodHQsIHZrLnJ0bCA/IHtsZWZ0OiBkaWZmfSA6IHtyaWdodDogZGlmZn0pOwogIGNsZWFyVGltZW91dChjdXIudHRFbW9qaUhpZGUpOwogIEVtb2ppLmhpZGVUdCh0dCk7Cn0sCnR0Q2FsY0hlaWdodDogZnVuY3Rpb24ob3B0SWQsIG9iaiwgdHQpIHsKICB3aW5kb3cuaGVhZEggPSB3aW5kb3cuaGVhZEggfHwgZ2UoJ3BhZ2VfaGVhZGVyJykgJiYgRW1vamkuZ2V0U2l6ZUNhY2hlZChnZSgncGFnZV9oZWFkZXInKSlbMV0gfHwgMDsgLy8gaGVpZ2h0IG9mIGhlYWRlciBlbCBub3QgY2hhbmdlZAogIHZhciB3aCA9ICh3aW5kb3cucGFnZU5vZGUgJiYgd2luZG93LmJyb3dzZXIubW96aWxsYSA/IE1hdGgubWluKGdldFNpemUocGFnZU5vZGUpWzFdLCB3aW5kb3cubGFzdFdpbmRvd0hlaWdodCkgOiB3aW5kb3cubGFzdFdpbmRvd0hlaWdodCkgfHwgZ2V0U2Nyb2xsKClbM10sCiAgICAgIHNjcm9sbFkgPSB3aW5kb3cuc2Nyb2xsR2V0WSA/IHNjcm9sbEdldFkoKSA6IGdldFNjcm9sbCgpWzFdLAogICAgICBvYmpZID0gZ2V0WFkob2JqKVsxXSwgb2JqSCA9IEVtb2ppLmdldFNpemVDYWNoZWQob2JqKVsxXSwgLy8gaGVpZ2h0IG9mIGVtb2ppIGVsIG5vdCBjaGFuZ2VkCiAgICAgIGxpc3QgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9saXN0JywgdHQpLAogICAgICBzbWlsZUggPSBFbW9qaS5vcHRzW29wdElkXS5lbW9qaVNtaWxlSGVpZ2gsCiAgICAgIGhlYWRTcGFjZSA9IGhlYWRILCByb3dzQ250ID0gRW1vamkub3B0c1tvcHRJZF0uZW1vamlSb3dzQ291bnQsIG9mZnNldEggPSA5LCBsaXN0UGFkZGluZyA9IDg7CgogIGlmICghaXNBbmNlc3RvcihvYmosIHBhZ2VOb2RlKSkgewogICAgaGVhZFNwYWNlID0gMDsKICB9CiAgc2V0U3R5bGUobGlzdCwge2hlaWdodDogcm93c0NudCAqIHNtaWxlSCArIGxpc3RQYWRkaW5nfSk7CgogIHZhciB1cEVkZ2VZID0gc2Nyb2xsWSArIGhlYWRTcGFjZSwKICAgIGRvd25FZGdlWSA9IHNjcm9sbFkgKyB3aCwKICAgIGVsID0gb2JqLAogICAgdHRIID0gZ2V0U2l6ZSh0dClbMV0sCiAgICB0b1VwLAogICAgdXBTcGFjZSA9IDAsCiAgICBkb3duU3BhY2UgPSAwLAogICAgc3BhY2UgPSAwOwoKICB3aGlsZSAoZWwgIT09IGJvZHlOb2RlICYmIChlbCA9IGRvbUNsb3Nlc3RPdmVyZmxvd0hpZGRlbihlbCkpKSB7CiAgICB2YXIgeSA9IGdldFhZKGVsKVsxXTsKICAgIHVwRWRnZVkgPSBNYXRoLm1heCh1cEVkZ2VZLCB5KTsKICAgIGRvd25FZGdlWSA9IE1hdGgubWluKGRvd25FZGdlWSwgeSArIGdldFNpemUoZWwpWzFdKTsKICB9CgogIHVwU3BhY2UgPSBvYmpZIC0gb2Zmc2V0SCAtIHVwRWRnZVk7CiAgZG93blNwYWNlID0gZG93bkVkZ2VZIC0gb2JqWSAtIG9iakggLSBvZmZzZXRIOwoKICBpZiAodXBTcGFjZSA8IHR0SCAmJiBkb3duU3BhY2UgPCB0dEgpIHsKICAgIHRvVXAgPSAodXBTcGFjZSA+PSBkb3duU3BhY2UpOwogIH0gZWxzZSB7CiAgICB0b1VwID0gKHVwU3BhY2UgPj0gdHRIKTsKICB9CiAgc3BhY2UgPSAodG9VcCA/IHVwU3BhY2UgOiBkb3duU3BhY2UpOwogIHdoaWxlIChzcGFjZSA8IHR0SCAmJiByb3dzQ250ID4gMykgewogICAgcm93c0NudC0tOwogICAgdHRIIC09IHNtaWxlSDsKICB9CiAgRW1vamkub3B0c1tvcHRJZF0uZW1vamlSb3dzQ291bnQgPSByb3dzQ250OwogIEVtb2ppLm9wdHNbb3B0SWRdLmVtb2ppU21pbGVIZWlnaCA9IHNtaWxlSDsKICBzZXRTdHlsZShsaXN0LCB7aGVpZ2h0OiByb3dzQ250ICogc21pbGVIICsgbGlzdFBhZGRpbmd9KTsKICB0b2dnbGVDbGFzcyh0dCwgJ3R0X2Rvd24nLCB0b1VwKTsKICB0b2dnbGVDbGFzcyh0dCwgJ3R0X3VwJywgIXRvVXApOwp9LApyZXBvc2l0aW9uRW1vamk6IGZ1bmN0aW9uKG9wdElkLCBvYmosIHR0KSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXSwgYXJyb3c7CiAgaWYgKCFvcHRzKSB7CiAgICByZXR1cm47CiAgfQogIGlmICh0dC5wYXJlbnROb2RlICYmIGdldFhZICYmIGdldFN0eWxlICYmIHNldFN0eWxlICYmIGdlQnlDbGFzcyAmJiAoYXJyb3cgPSBnZUJ5Q2xhc3MxKCJlbW9qaV9ycG9pbnRlciIsIHR0KSkpIHsKICAgIHZhciB3aWR0aCA9IHBhcnNlSW50KGdldFN0eWxlKHR0LCAid2lkdGgiKSksCiAgICAgICAgYXJyb3dMZWZ0ID0gMjY2LAogICAgICAgIGFycm93Q2VudGVyID0gNywKICAgICAgICBuZWVkT2Zmc2V0ID0gMTAsCiAgICAgICAgbmVlZFggPSBnZXRYWShvYmopWzBdLAogICAgICAgIG9ialdpZHRoID0gcGFyc2VJbnQoZ2V0U3R5bGUob2JqLCAid2lkdGgiKSksCiAgICAgICAgcGFyZW50TGVmdCA9IGdldFhZKHR0LnBhcmVudE5vZGUpWzBdOwoKICAgIGlmIChuZWVkWCArIG9ialdpZHRoIC8gMiA8IGFycm93TGVmdCArIGFycm93Q2VudGVyICsgbmVlZE9mZnNldCkgewogICAgICBzZXRTdHlsZSh0dCwgJ2xlZnQnLCAtd2lkdGggLSBwYXJlbnRMZWZ0KTsKICAgICAgc2V0U3R5bGUoYXJyb3csICdsZWZ0JywgKG5lZWRYICsgb2JqV2lkdGggLyAyIC0gbmVlZE9mZnNldCAqIDIpICsgInB4Iik7CiAgICB9IGVsc2UgewogICAgICBzZXRTdHlsZSh0dCwgJ2xlZnQnLCAnJyk7CiAgICAgIHNldFN0eWxlKGFycm93LCAnbGVmdCcsICcnKTsKICAgIH0KICB9IGVsc2UgewogICAgc2V0U3R5bGUodHQsICdsZWZ0JywgJycpOwogIH0KCiAgdmFyIGxpc3QgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9saXN0JywgdHQpLAogICAgICBmaXJzdFNtaWxlID0gZ2VCeUNsYXNzMSgnZW1vamlfc21pbGVfY29udCcsIGxpc3QpOwogIEVtb2ppLm9wdHNbb3B0SWRdLmVtb2ppU21pbGVIZWlnaCA9IGZpcnN0U21pbGUgJiYgRW1vamkuZ2V0U2l6ZUNhY2hlZChmaXJzdFNtaWxlKVsxXSB8fCAyNjsKICBFbW9qaS5vcHRzW29wdElkXS5lbW9qaVJvd3NDb3VudCA9IDk7CiAgRW1vamkudHRDYWxjSGVpZ2h0KG9wdElkLCBvYmosIHR0KTsKfSwKZW1vamlPdmVyOiBmdW5jdGlvbihvcHRJZCwgb2JqLCB3aXRoTW91c2UpIHsKICBpZiAoYnJvd3Nlci5tb2JpbGUgfHwgd2l0aE1vdXNlICYmIEVtb2ppLnByZXZlbnRNb3VzZU92ZXIpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdCiAgYWRkQ2xhc3Mob2JqLCAnZW1vamlfb3ZlcicpOwogIGlmIChvcHRzLmVtb2ppT3ZlcmVkICYmIG9wdHMuZW1vamlPdmVyZWQgIT0gb2JqKSB7CiAgICByZW1vdmVDbGFzcyhvcHRzLmVtb2ppT3ZlcmVkLCAnZW1vamlfb3ZlcicpOwogIH0KICBvcHRzLmVtb2ppT3ZlcmVkID0gb2JqOwp9LAplbW9qaUV4cGFuZDogZnVuY3Rpb24ob3B0SWQsIGJsb2NrKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICBhZGRDbGFzcyhibG9jaywgJ2Vtb2ppX2V4cGFuZGVkJyk7CiAgRW1vamkuZW1vamlMb2FkTW9yZShvcHRJZCk7CgogIGlmIChvcHRzLmVtb2ppU2Nyb2xsKSB7CiAgICBvcHRzLmVtb2ppU2Nyb2xsLnVwZGF0ZSgpOwogIH0gZWxzZSB7CiAgICBvcHRzLmVtb2ppU2Nyb2xsID0gbmV3IHVpU2Nyb2xsKGdlQnlDbGFzczEoJ2Vtb2ppX2xpc3QnLCBibG9jayksIHsKICAgICAgdGhlbWU6ICdkZWZhdWx0IGVtb2ppIG5vX3RyYW5zaXRpb24nLAogICAgICBzaGFkb3dzOiB0cnVlLAogICAgICBnbG9iYWw6IHRydWUsCiAgICAgIG5vRm9yY2VSZUZsb3c6IHRydWUsCiAgICAgIG9uZHJhZ3N0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICBvcHRzLnNjcm9sbGluZyA9IHRydWU7CiAgICAgIH0sCiAgICAgIG9uZHJhZ3N0b3A6IGZ1bmN0aW9uKCkgewogICAgICAgIG9wdHMuc2Nyb2xsaW5nID0gZmFsc2U7CiAgICAgICAgaXNGdW5jdGlvbihvcHRzLmFmdGVyU2Nyb2xsRm4pICYmIG9wdHMuYWZ0ZXJTY3JvbGxGbigpOwogICAgICB9LAogICAgICBvbnNjcm9sbHN0YXJ0OiBmdW5jdGlvbigpIHsKICAgICAgICB3aW5kb3cudG9vbHRpcHMgJiYgdG9vbHRpcHMuZGVzdHJveUFsbCgpOwogICAgICAgIG9wdHMuc2Nyb2xsU3RhcnRlZCA9IHRydWU7CiAgICAgIH0sCiAgICAgIG9udXBkYXRlOiBmdW5jdGlvbihzY3JvbGwpIHsKICAgICAgICBpZiAob3B0cy5jdXJUYWIgPT0gRW1vamkuVEFCX0VNT0pJKSB7CiAgICAgICAgICBFbW9qaS51cGRhdGVFbW9qaUNhdGVnb3JpZXMoc2Nyb2xsLCBvcHRzLCBvcHRJZCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIEVtb2ppLnVwZGF0ZVNob3duU3RpY2tlcnMob3B0SWQpOwogICAgICAgIH0KICAgICAgfQogICAgfSk7CiAgICBvcHRzLmltYWdlc0xvYWRlciA9IG9wdHMuaW1hZ2VzTG9hZGVyIHx8IGltYWdlc0xvYWRlcihvcHRzLmVtb2ppU2Nyb2xsLnNjcm9sbGVyLCB7dXNlX2lmcmFtZTogdHJ1ZSwgbmVlZF9sb2FkX2NsYXNzOiAnZW1vamlfbmVlZF9sb2FkJ30pOwogICAgaWYgKG9wdHMuc2hhcmVkVFQpIHsKICAgICAgb3B0cy5zaGFyZWRUVC5lbW9qaVNjcm9sbCA9IG9wdHMuZW1vamlTY3JvbGw7CiAgICB9CiAgfQoKICBvcHRzLmVtb2ppRXhwYW5kZWQgPSB0cnVlOwp9LAoKdXBkYXRlRW1vamlDYXRlZ29yaWVzOiBmdW5jdGlvbiAoc2Nyb2xsLCBvcHRzLCBvcHRJZCkgewogIGlmICgoc2Nyb2xsLmRhdGEuc2Nyb2xsQm90dG9tIC0gRW1vamkuQk9UVE9NX1JFU1RfRk9SX0FERF9FTU9KSV9DQVRFR09SWSkgPD0gMCAmJiBvcHRzLnNjcm9sbFN0YXJ0ZWQpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgICBFbW9qaS5hZGROZXh0RW1vamlDYXRlZ290eShvcHRJZCk7CiAgICAgIEVtb2ppLnVwZGF0ZUVtb2ppQ2F0VGl0bGUob3B0SWQpOwogICAgfSwgMCk7CiAgfQogIEVtb2ppLnVwZGF0ZUVtb2ppQ2F0VGl0bGUob3B0SWQpOwp9LAoKdXBkYXRlU2hvd25TdGlja2VyczogZnVuY3Rpb24ob3B0SWQsIG5vQ2hhbmdlVGFiKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKCiAgaWYgKCFvcHRzLmVtb2ppU2Nyb2xsIHx8ICFvcHRzLnN0aWNrZXJzU3BsaXRlcnNQb3MpIHsKICAgIHJldHVybjsKICB9CgogIGlmICghb3B0cy5uZWVkTG9hZFN0aWNrZXJzKSB7CiAgICBvcHRzLm5lZWRMb2FkU3RpY2tlcnMgPSBbXTsKICB9CgogIHZhciBzdCA9IG9wdHMuZW1vamlTY3JvbGwuZGF0YS5zY3JvbGxUb3AsIHZoID0gb3B0cy5lbW9qaVNjcm9sbC5kYXRhLnZpZXdwb3J0SGVpZ2h0OwogIHZhciBzdGFydFBvcyA9IHN0LCBlbmRQb3MgPSBzdCArIHZoOwogIHZhciBuZWVkTG9hZCA9IG9wdHMubmVlZExvYWRTdGlja2VyczsKCiAgY2xlYXJUaW1lb3V0KG9wdHMucHJlbG9hZFN0aWNrZXJzVGltZXIpOwoKICB2YXIgbmVlZF9sb2FkID0gW107CiAgZm9yICh2YXIgaSA9IDA7IGkgPCBuZWVkTG9hZC5sZW5ndGg7IGkrKykgewogICAgdmFyIGl0ZW0gPSBuZWVkTG9hZFtpXTsKCiAgICBpZiAoaXRlbVsxXSArIDcyID49IHN0YXJ0UG9zICYmIGl0ZW1bMV0gPD0gZW5kUG9zKSB7CiAgICAgIHZhciBlbCA9IGdlKCdlbW9qaV9zdGlja2VyX2l0ZW0nICsgaXRlbVswXSk7CiAgICAgIGlmICghZWwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB2YXIgc3JjID0gYXR0cihlbCwgJ2RhdGEtc3JjJyk7CiAgICAgIHZhbChlbCwgJzxpbWcgY2xhc3M9ImVtb2ppX3N0aWNrZXJfaW1hZ2UiIHNyYz0iL2ltYWdlcy9ibGFuay5naWYiIGRhdGEtc3JjPSInICsgc3JjICsgJyIvPicpOwogICAgICBuZWVkX2xvYWQucHVzaChbc3JjLCBpdGVtWzBdXSk7CiAgICB9CiAgfQoKICBFbW9qaS5sb2FkU3RpY2tlcnMob3B0SWQsIG5lZWRfbG9hZCk7CgogIGlmICghbmVlZF9sb2FkLmxlbmd0aCkgewogICAgRW1vamkucHJlbG9hZFN0aWNrZXJzKG9wdElkKTsKICB9CgogIGlmIChub0NoYW5nZVRhYiB8fCBvcHRzLnNjcm9sbEFuaW1hdGlvbiB8fCBFbW9qaS5vblN0aWNrZXJzTG9hZCkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIHBhY2tJZCA9IC0xOwogIGZvcih2YXIgaSA9IDA7IGkgPCBvcHRzLnN0aWNrZXJzU3BsaXRlcnNQb3MubGVuZ3RoOyBpKyspIHsKICAgIHZhciBpdGVtID0gb3B0cy5zdGlja2Vyc1NwbGl0ZXJzUG9zW2ldOwoKICAgIGlmIChpdGVtWzFdIC0gMzAgPCBzdCkgewogICAgICBwYWNrSWQgPSBpdGVtWzBdOwogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICBpZiAob3B0cy5jdXJUYWIgIT0gcGFja0lkKSB7CiAgICBFbW9qaS5zY3JvbGxUb1RhYihwYWNrSWQsIG9wdElkKTsKICB9Cn0sCgpsb2FkU3RpY2tlcnM6IGZ1bmN0aW9uIChvcHRJZCwgbmVlZF9sb2FkKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKCiAgaWYgKCFuZWVkX2xvYWQubGVuZ3RoKSB7CiAgICByZXR1cm47CiAgfQoKICB2YXIgbG9hZGluZyA9IHt9OwogIGZvcih2YXIgaSA9IDA7IGkgPCBuZWVkX2xvYWQubGVuZ3RoOyBpKyspIHsKICAgIHZhciByYXdfaWQgPSBuZWVkX2xvYWRbaV1bMF0gKyAnOicgKyBuZWVkX2xvYWRbaV1bMV07CiAgICBpZiAob3B0cy5pbWFnZXNMb2FkaW5nW3Jhd19pZF0pIHsKICAgICAgbG9hZGluZ1tyYXdfaWRdID0gb3B0cy5pbWFnZXNMb2FkaW5nW3Jhd19pZF07CiAgICAgIGRlbGV0ZSBvcHRzLmltYWdlc0xvYWRpbmdbcmF3X2lkXTsKICAgICAgbmVlZF9sb2FkLnNwbGljZShpLCAxKTsKICAgICAgaS0tOwogICAgfQogIH0KCiAgZm9yKHZhciBpIGluIG9wdHMuaW1hZ2VzTG9hZGluZykgewogICAgdmFyIGltZyA9IG9wdHMuaW1hZ2VzTG9hZGluZ1tpXTsKICAgIGlmICghaW1nKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGltZy5zcmMgPSAnJzsKICAgIC8vdmFyIHBhcmVudCA9IGltZy5wYXJlbnROb2RlOwogICAgLy90cnkgeyBwYXJlbnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChwYXJlbnQpOyB9IGNhdGNoKGUpIHsgfQogIH0KICBvcHRzLmltYWdlc0xvYWRpbmcgPSBsb2FkaW5nOwoKICBmb3IodmFyIGkgaW4gbmVlZF9sb2FkKSB7CiAgICB2YXIgcmF3X2lkID0gbmVlZF9sb2FkW2ldWzBdICsgJzonICsgbmVlZF9sb2FkW2ldWzFdOwogICAgb3B0cy5pbWFnZXNMb2FkaW5nW3Jhd19pZF0gPSBvcHRzLmltYWdlc0xvYWRlci5pbG9hZGVyLmFkZChuZWVkX2xvYWRbaV1bMF0sIEVtb2ppLm9uU3RpY2tlckxvYWRlZCwgb3B0SWQgKyAnOicgKyBuZWVkX2xvYWRbaV1bMV0pOwogIH0KfSwKCnByZWxvYWRTdGlja2VyczogZnVuY3Rpb24gKG9wdElkKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKCgogIGlmIChvcHRzLmltYWdlc0xvYWRpbmcgJiYgT2JqZWN0LmtleXMob3B0cy5pbWFnZXNMb2FkaW5nKS5sZW5ndGggPiAwKSB7CiAgICByZXR1cm47CiAgfQoKICBjbGVhclRpbWVvdXQob3B0cy5wcmVsb2FkU3RpY2tlcnNUaW1lcik7CiAgb3B0cy5wcmVsb2FkU3RpY2tlcnNUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgewogICAgdmFyIHN0ID0gb3B0cy5lbW9qaVNjcm9sbC5kYXRhLnNjcm9sbFRvcCwgdmggPSBvcHRzLmVtb2ppU2Nyb2xsLmRhdGEudmlld3BvcnRIZWlnaHQ7CiAgICB2YXIgZW5kUG9zID0gc3QgKyB2aDsKCiAgICB2YXIgYmVmb3JlID0gewogICAgICB0b3A6IHN0IC0gdmgsCiAgICAgIGJvdHRvbTogc3QsCiAgICB9LCBhZnRlciA9IHsKICAgICAgdG9wOiBlbmRQb3MsCiAgICAgIGJvdHRvbTogZW5kUG9zICsgdmgsCiAgICB9OwoKICAgIHZhciBlbCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3Njcm9sbF9zdGlja2VycycsIG9wdHMudHQpLmZpcnN0Q2hpbGQsIG5lZWRMb2FkID0gW107CiAgICB3aGlsZShlbCkgewogICAgICBpZiAoaGFzQ2xhc3MoZWwsICdlbW9qaV9zdGlja2VyX2l0ZW0nKSAmJiAhaGFzQ2xhc3MoZWwsICdfX2xvYWRlZCcpKSB7CiAgICAgICAgdmFyIHRvcCA9IGVsLm9mZnNldFRvcDsKCiAgICAgICAgaWYgKHRvcCA+PSBiZWZvcmUudG9wICYmIHRvcCA8PSBiZWZvcmUuYm90dG9tIHx8IHRvcCA+PSBhZnRlci50b3AgJiYgdG9wIDw9IGFmdGVyLmJvdHRvbSkgewogICAgICAgICAgdmFyIGlkID0gZWwuaWQucmVwbGFjZSgnZW1vamlfc3RpY2tlcl9pdGVtJywgJycpLCBzcmMgPSBhdHRyKGVsLCAnZGF0YS1zcmMnKTsKICAgICAgICAgIHZhbChlbCwgJzxpbWcgY2xhc3M9ImVtb2ppX3N0aWNrZXJfaW1hZ2UiIHNyYz0iL2ltYWdlcy9ibGFuay5naWYiIGRhdGEtc3JjPSInICsgc3JjICsgJyIvPicpOwogICAgICAgICAgbmVlZExvYWQucHVzaChbc3JjLCBpZF0pOwogICAgICAgIH0KICAgICAgfQogICAgICBlbCA9IGVsLm5leHRTaWJsaW5nOwogICAgfQoKICAgIEVtb2ppLmxvYWRTdGlja2VycyhvcHRJZCwgbmVlZExvYWQpOwoKICB9LCA1MCk7Cn0sCgpvblN0aWNrZXJMb2FkZWQ6IGZ1bmN0aW9uIChzcmMpIHsKICB2YXIgZXhwID0gU3RyaW5nKHRoaXMpLnNwbGl0KCc6Jyk7CiAgdmFyIHJhd19pZCA9IGV4cFsxXTsKICB2YXIgb3B0SWQgPSBpbnR2YWwoZXhwWzBdKTsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwoKCiAgdmFyIGVsID0gZ2UoJ2Vtb2ppX3N0aWNrZXJfaXRlbScgKyByYXdfaWQpOwogIGlmICghZWwpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBpbWcgPSBnZUJ5VGFnMSgnaW1nJywgZWwpOwogIGlmICghaW1nKSB7CiAgICByZXR1cm47CiAgfQoKICBhZGRDbGFzcyhlbCwgJ19fbG9hZGVkJyk7CiAgYXR0cihpbWcsICdzcmMnLCBzcmMpOwogIGRlbGV0ZSBFbW9qaS5vcHRzW29wdElkXS5pbWFnZXNMb2FkaW5nW3NyYyArICc6JyArIHJhd19pZF07CgogIGZvcih2YXIgaSA9IDA7IGkgPCBvcHRzLm5lZWRMb2FkU3RpY2tlcnMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBpdGVtID0gb3B0cy5uZWVkTG9hZFN0aWNrZXJzW2ldOwogICAgaWYgKHJhd19pZCA9PSBpdGVtWzBdKSB7CiAgICAgIG9wdHMubmVlZExvYWRTdGlja2Vycy5zcGxpY2UoaSwgMSk7CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgaWYgKCFPYmplY3Qua2V5cyhFbW9qaS5vcHRzW29wdElkXS5pbWFnZXNMb2FkaW5nKS5sZW5ndGgpIHsKICAgIEVtb2ppLnByZWxvYWRTdGlja2VycyhvcHRJZCk7CiAgfQp9LAoKZW1vamlNb3ZlOiBmdW5jdGlvbihlKSB7CiAgdmFyIG9wdElkID0gRW1vamkuc2hvd25JZDsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGlmIChFbW9qaS5zaG93biAmJiBvcHRzICYmIG9wdHMuZW1vamlGb2N1c2VkICYmIG9wdHMub3BlbmVkQnlUYWJLZXkpIHsKICAgIHZhciBlbCA9IG51bGw7CgogICAgaWYgKCFvcHRzLmVtb2ppT3ZlcmVkKSB7CiAgICAgIGVsID0gRW1vamkuZ2V0Rmlyc3RFbW9qaUVsKG9wdElkKTsKICAgIH0gZWxzZSB7CiAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7CiAgICAgICAgY2FzZSBLRVkuTEVGVDoKICAgICAgICAgIGVsID0gRW1vamkuZ2V0RW1vamlFbChvcHRzLmVtb2ppT3ZlcmVkLCAnbGVmdCcpOwogICAgICAgICAgY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEtFWS5SSUdIVDoKICAgICAgICAgIGVsID0gRW1vamkuZ2V0RW1vamlFbChvcHRzLmVtb2ppT3ZlcmVkLCAncmlnaHQnKTsKICAgICAgICAgIGNhbmNlbEV2ZW50KGUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBLRVkuVVA6CiAgICAgICAgICBlbCA9IEVtb2ppLmdldEVtb2ppRWwob3B0cy5lbW9qaU92ZXJlZCwgJ3VwJyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEtFWS5ET1dOOgogICAgICAgICAgZWwgPSBFbW9qaS5nZXRFbW9qaUVsKG9wdHMuZW1vamlPdmVyZWQsICdkb3duJyk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIEtFWS5FTlRFUjoKICAgICAgICAgIGlmICghRW1vamkuZW1vamlFbnRlcihvcHRJZCwgZSkpIHsKICAgICAgICAgICAgY2FuY2VsRXZlbnQoZSk7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfQogICAgaWYgKGVsKSB7CiAgICAgIEVtb2ppLnByZXZlbnRNb3VzZU92ZXIgPSB0cnVlOwogICAgICBFbW9qaS5lbW9qaU92ZXIob3B0SWQsIGVsKTsKICAgICAgRW1vamkuc2Nyb2xsVG9MaXN0RWwob3B0SWQsIGVsKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfSwKCnNjcm9sbFRvTGlzdEVsOiBmdW5jdGlvbihvcHRJZCwgZWwpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGlmICghb3B0cyB8fCAhb3B0cy5lbW9qaVNjcm9sbCkgewogICAgcmV0dXJuOwogIH0KICB2YXIgY2F0VGl0bGVIZWlnaHQgPSAzMDsKICB2YXIgb2Zmc2V0VG9wID0gZWwub2Zmc2V0VG9wOwogIHZhciBuZXdTdCA9IE1hdGgubWF4KG9mZnNldFRvcCArIGNhdFRpdGxlSGVpZ2h0IC0gb3B0cy5lbW9qaVNjcm9sbC5kYXRhLnZpZXdwb3J0SGVpZ2h0LCBNYXRoLm1pbihvcHRzLmVtb2ppU2Nyb2xsLmRhdGEuc2Nyb2xsVG9wLCBvZmZzZXRUb3AgLSBjYXRUaXRsZUhlaWdodCkpOwogIGlmIChvcHRzLmVtb2ppU2Nyb2xsLmRhdGEuc2Nyb2xsVG9wICE9IG5ld1N0KSB7CiAgICBvcHRzLmVtb2ppU2Nyb2xsLnNjcm9sbFRvcChuZXdTdCk7CiAgfQp9LAoKYW5pbTogZnVuY3Rpb24oZWwsIHRvKSB7CiAgY2xlYXJJbnRlcnZhbChjdXIuX2ltQW5pbSk7CiAgdmFyIGR0ID0gMzAwLCBkU3RlcCA9IDQ1IC8gKGR0IC8gMTMpLCBvU3RlcCA9IDEgLyAoZHQgLyAxMyksIHN0ZXBzID0gTWF0aC5mbG9vcihkdCAvIDEzKSwgaSA9IDA7CiAgdmFyIGVsMSA9IGRvbUxDKGVsKSwgZWwyID0gZG9tRkMoZWwpOwogIHZhciBkRnJvbTEgPSB0byA/IDAgOiA0NSwgZFRvMSA9IHRvID8gNDUgOiAwLCBvRnJvbTEgPSB0byA/IDEgOiAwLCBvVG8xID0gdG8gPyAwIDogMTsKICBjdXIuX2ltQW5pbSA9IHNldEludGVydmFsKGZ1bmN0aW9uKCkgewogICAgKytpOwogICAgdmFyIGQxID0gKGkgPj0gc3RlcHMpID8gZFRvMSA6IChkRnJvbTEgKyBkU3RlcCAqIGkgKiAodG8gPyAxIDogLTEpKSwgZDIgPSBkMSAtIDQ1OwogICAgdmFyIG8xID0gKGkgPj0gc3RlcHMpID8gb1RvMSA6IChvRnJvbTEgKyBvU3RlcCAqIGkgKiAodG8gPyAtMSA6IDEpKSwgbzIgPSAxIC0gbzE7CiAgICBlbDEuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gZWwxLnN0eWxlLk9UcmFuc2Zvcm0gPSBlbDEuc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSgnICsgZDEgKyAnZGVnKSc7CiAgICBlbDIuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gZWwyLnN0eWxlLk9UcmFuc2Zvcm0gPSBlbDIuc3R5bGUudHJhbnNmb3JtID0gJ3JvdGF0ZSgnICsgZDIgKyAnZGVnKSc7CiAgICBlbDEuc3R5bGUub3BhY2l0eSA9IG8xOwogICAgZWwyLnN0eWxlLm9wYWNpdHkgPSBvMjsKICAgIGlmIChpID49IHN0ZXBzKSB7CiAgICAgIGNsZWFySW50ZXJ2YWwoY3VyLl9pbUFuaW0pOwogICAgICAodG8gPyBhZGRDbGFzcyA6IHJlbW92ZUNsYXNzKShlbCwgJ2Vtb2ppX3NtaWxlX29uJyk7CiAgICAgIGVsMS5zdHlsZS5XZWJraXRUcmFuc2Zvcm0gPSBlbDEuc3R5bGUuT1RyYW5zZm9ybSA9IGVsMS5zdHlsZS50cmFuc2Zvcm0gPSBlbDIuc3R5bGUuV2Via2l0VHJhbnNmb3JtID0gZWwyLnN0eWxlLk9UcmFuc2Zvcm0gPSBlbDIuc3R5bGUudHJhbnNmb3JtID0gZWwxLnN0eWxlLm9wYWNpdHkgPSBlbDIuc3R5bGUub3BhY2l0eSA9ICcnOwogICAgfQogIH0sIDEzKTsKfSwKCnRwbFNtaWxlOiBmdW5jdGlvbihwbGFjZWhvbGRlcikgewogIHJldHVybiAnPGRpdiBjbGFzcz0iZW1vamlfc21pbGVfd3JhcCBfZW1vamlfd3JhcCI+XAogIDxkaXYgY2xhc3M9ImVtb2ppX3NtaWxlIF9lbW9qaV9idG4iIHRpdGxlPSInICsgcGxhY2Vob2xkZXIgKyAnIiBvbm1vdXNlb3Zlcj0icmV0dXJuIEVtb2ppLnNob3codGhpcywgZXZlbnQpOyIgb25tb3VzZW91dD0icmV0dXJuIEVtb2ppLmhpZGUodGhpcywgZXZlbnQpOyIgb25jbGljaz0icmV0dXJuIGNhbmNlbEV2ZW50KGV2ZW50KTsiPlwKICAgIDxkaXYgY2xhc3M9ImVtb2ppX3NtaWxlX2ljb24iPjwvZGl2PlwKICA8L2Rpdj5cCjwvZGl2Pic7Cn0sCgplbW9qaVRvSFRNTDogZnVuY3Rpb24oc3RyLCByZXBsYWNlU3ltYm9scywgbm9CcikgewogIGlmIChicm93c2VyLmlwYWQgfHwgYnJvd3Nlci5pcGhvbmUpIHsKICAgIHJldHVybiBzdHI7CiAgfQogIHN0ciA9IChzdHIgKyAnJykucmVwbGFjZSgvJm5ic3A7L2csICcgJykucmVwbGFjZSgvPGJyPi9nLCAiXG4iKTsKICB2YXIgcmVncyA9IHsKICAgICdEODNEREUwNyc6IC8oXHN8XikoWzBPzl06XCkpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUwOSc6IC8oXHN8XikoOy1cKSspKFtcc1wuLF18JCkvZywKICAgICdEODNEREUwNic6IC8oXHN8XikoW1jVePVdLT9EKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMEUnOiAvKFxzfF4pKEItXCkpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUwQyc6IC8oXHN8XikoMy1cKSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTIwJzogLyhcc3xeKSgmZ3Q7XCgpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUzMCc6IC8oXHN8XikoO1tv7k/OXSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTMzJzogLyhcc3xeKSg4XHwpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUzMic6IC8oXHN8XikoOC0/W2/uT85dKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMEQnOiAvKFxzfF4pKDgtXCkpKFtcc1wuLF18JCkvZywKICAgICdEODNEREUzNyc6IC8oXHN8XikoOltY1V0pKFtcc1wuLF18JCkvZywKICAgICdEODNEREUyOCc6IC8oXHN8XikoOltv7k/OXSkoW1xzXC4sXXwkKS9nLAogICAgJzI3NjQnOiAvKFxzfF4pKCZsdDszKShbXHNcLixdfCQpL2cKICB9OwoKICBmb3IgKHZhciBpID0gMDsgaSA8IDI7IGkrKykgewogICAgZm9yICh2YXIgY29kZSBpbiByZWdzKSB7CiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlKHJlZ3NbY29kZV0sIGZ1bmN0aW9uKG1hdGNoLCBwcmUsIHNtaWxlLCBzcGFjZSkgewogICAgICAgIHJldHVybiAocHJlIHx8ICcnKSArIEVtb2ppLmdldEVtb2ppSFRNTChjb2RlKSsoc3BhY2UgfHwgJycpOwogICAgICB9KTsKICAgIH0KICB9CgogIHZhciByZWdzID0gewogICAgJ0Q4M0RERTBBJzogLyg6LVwpKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMDMnOiAvKDotRCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTFDJzogLyg7LVtQ0F0pKFtcc1wuLF18JCkvZywKICAgICdEODNEREUwQic6IC8oOi1bcPBdKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMTInOiAvKDotXCgpKFtcc1wuLF18JCkvZywKICAgICcyNjNBJzogLyg6LT9cXSkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTBGJzogLyg7LVxdKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMTQnOiAvKDMtP1woKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMjInOiAvKDomIzAzOTtcKCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTJEJzogLyg6X1woKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMjknOiAvKDpcKFwoKShbXHNcLixdfCQpL2csCiAgICAvLydEODNEREUxNSc6IC8oOlxcKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMTAnOiAvKDpcfCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTIxJzogLygmZ3Q7XChcKCkoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0RERTFBJzogLyg6LVwqKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERFMDgnOiAvKFx9OlwpKShbXHNcLixdfCQpL2csCiAgICAnRDgzRERDNEQnOiAvKDpsaWtlOikoW1xzXC4sXXwkKS9nLAogICAgJ0Q4M0REQzRFJzogLyg6ZGlzbGlrZTopKFtcc1wuLF18JCkvZywKICAgICcyNjFEJzogLyg6dXA6KShbXHNcLixdfCQpL2csCiAgICAnMjcwQyc6IC8oOnY6KShbXHNcLixdfCQpL2csCiAgICAnRDgzRERDNEMnOiAvKDpvazp8Ou7qOikoW1xzXC4sXXwkKS9nCiAgfTsKICBmb3IgKHZhciBjb2RlIGluIHJlZ3MpIHsKICAgIHN0ciA9IHN0ci5yZXBsYWNlKHJlZ3NbY29kZV0sIGZ1bmN0aW9uKG1hdGNoLCBzbWlsZSwgc3BhY2UpIHsKICAgICAgcmV0dXJuIEVtb2ppLmdldEVtb2ppSFRNTChjb2RlKSsoc3BhY2UgfHwgJycpOwogICAgfSk7CiAgfQoKICBzdHIgPSBzdHIucmVwbGFjZSgvXG4vZywgJzxicj4nKTsKCiAgaWYgKHJlcGxhY2VTeW1ib2xzKSB7CiAgICBzdHIgPSBzdHIucmVwbGFjZShFbW9qaS5lbW9qaVJlZ0V4LCBFbW9qaS5lbW9qaVJlcGxhY2UpOwogIH0KCiAgcmV0dXJuIHN0cjsKfSwKCmVtb2ppUmVwbGFjZTogZnVuY3Rpb24oc3ltYm9sc3RyKSB7CiAgdmFyIGkgPSAwOwogIHZhciBidWZmZXIgPSAnJzsKICB2YXIgYWx0QnVmZmVyID0gJyc7CiAgdmFyIG51bSA9ICcnOwogIHZhciBzeW1ib2xzID0gW107CiAgdmFyIGNvZGVzID0gW107CiAgdmFyIGNvbGxlY3RDb2RlcyA9IHRydWU7CgogIGlmIChzeW1ib2xzdHIubWF0Y2goL1x1RkUwRlx1MjBFMy9nKSkgewogICAgc3ltYm9sc3RyID0gc3ltYm9sc3RyLnJlcGxhY2UoL1x1RkUwRi9nLCAnJyk7CiAgfQoKICBkbyB7CiAgICB2YXIgbnVtID0gc3ltYm9sc3RyLmNoYXJDb2RlQXQoaSsrKTsKCiAgICBpZiAoIW51bSkgewogICAgICBjb2xsZWN0Q29kZXMgPSBmYWxzZTsKICAgICAgY29udGludWU7CiAgICB9CgogICAgdmFyIGNvZGUgPSBudW0udG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCk7CiAgICB2YXIgc3ltYm9sID0gc3ltYm9sc3RyLmNoYXJBdChpIC0gMSk7CgogICAgaWYgKG51bSA9PSA4NDE5KSB7CiAgICAgIHZhciBudW1QcmV2UG9zID0gaSAtIDI7CiAgICAgIHZhciBudW1QcmV2Q2hhciA9IHN5bWJvbHN0ci5jaGFyQXQobnVtUHJldlBvcyk7CgogICAgICBjb2Rlcy5wdXNoKCcwMDMnICsgbnVtUHJldkNoYXIgKyAnMjBFMycpOwogICAgICBzeW1ib2xzLnB1c2gobnVtUHJldkNoYXIpOwoKICAgICAgYnVmZmVyID0gJyc7CiAgICAgIGFsdEJ1ZmZlciA9ICcnOwogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBidWZmZXIgKz0gY29kZTsKICAgIGFsdEJ1ZmZlciArPSBzeW1ib2w7CgogICAgaWYgKCFzeW1ib2wubWF0Y2goRW1vamkuZW1vamlDaGFyU2VxKSkgewogICAgICBjb2Rlcy5wdXNoKGJ1ZmZlcik7CiAgICAgIHN5bWJvbHMucHVzaChhbHRCdWZmZXIpOwogICAgICBidWZmZXIgPSAnJzsKICAgICAgYWx0QnVmZmVyID0gJyc7CiAgICB9CgogIH0gd2hpbGUgKGNvbGxlY3RDb2RlcykKCiAgaWYgKGJ1ZmZlcikgewogICAgY29kZXMucHVzaChidWZmZXIpOwogICAgc3ltYm9scy5wdXNoKGFsdEJ1ZmZlcik7CiAgfQoKICB2YXIgb3V0ID0gJyc7CiAgdmFyIGpvaW5lciA9IGZhbHNlOwogIHZhciBpc0ZsYWcgPSBmYWxzZTsKCiAgYnVmZmVyID0gJyc7CiAgYWx0QnVmZmVyID0gJyc7CgogIGZvciAodmFyIGkgaW4gY29kZXMpIHsKICAgIHZhciBjb2RlID0gY29kZXNbaV07CiAgICB2YXIgc3ltYm9sID0gc3ltYm9sc1tpXTsKCiAgICBpZiAoIWNvZGUgfHwgY29kZSA9PSAnRkUwRicpIHsKICAgICAgY29udGludWU7CiAgICB9CgogICAgaWYgKHN5bWJvbC5tYXRjaCgvXHVEODNDW1x1REZGQi1cdURGRkZdLykpIHsgLy8gY29sb3JzCiAgICAgIGJ1ZmZlciArPSBjb2RlOwogICAgICBhbHRCdWZmZXIgKz0gc3ltYm9sOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChqb2luZXIpIHsKICAgICAgYnVmZmVyICs9IGNvZGU7CiAgICAgIGFsdEJ1ZmZlciArPSBzeW1ib2w7CiAgICAgIGpvaW5lciA9IGZhbHNlOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGlmIChpbkFycmF5KGNvZGUsIEVtb2ppLmVtb2ppSm9pbmVycykpIHsgLy8gam9pbmVycwogICAgICBpZiAoYnVmZmVyKSB7CiAgICAgICAgam9pbmVyID0gdHJ1ZTsKICAgICAgICBidWZmZXIgKz0gY29kZTsKICAgICAgICBhbHRCdWZmZXIgKz0gc3ltYm9sOwogICAgICB9IGVsc2UgewogICAgICAgIG91dCArPSBzeW1ib2w7CiAgICAgIH0KICAgICAgaXNGbGFnID0gZmFsc2U7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKHN5bWJvbC5tYXRjaCgvXHVEODNDW1x1RERFNi1cdURERkZdLykpIHsgLy8gZmxhZ3MKICAgICAgaWYgKGlzRmxhZykgewogICAgICAgIGJ1ZmZlciArPSBjb2RlOwogICAgICAgIGFsdEJ1ZmZlciArPSBzeW1ib2w7CiAgICAgICAgaXNGbGFnID0gZmFsc2U7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaXNGbGFnID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAoaXNGbGFnKSB7CiAgICAgIGlzRmxhZyA9IGZhbHNlOwogICAgfQoKICAgIGlmIChidWZmZXIpIHsKICAgICAgb3V0ICs9IEVtb2ppLmdldEVtb2ppSFRNTChidWZmZXIsIGFsdEJ1ZmZlciwgdHJ1ZSk7CiAgICB9CiAgICBidWZmZXIgPSBjb2RlOwogICAgYWx0QnVmZmVyID0gc3ltYm9sOwogIH0KCiAgaWYgKGJ1ZmZlcikgewogICAgb3V0ICs9IEVtb2ppLmdldEVtb2ppSFRNTChidWZmZXIsIGFsdEJ1ZmZlciwgdHJ1ZSk7CiAgfQoKICByZXR1cm4gb3V0Owp9LAoKZW1vamlDaGFyU2VxOiAvWzAtOVx1RDgzRFx1RDgzQ1x1RDgzRV0vLAoKZW1vamlSZWdFeDogLygoPzpbXHUyMDNDXHUyMDQ5XHUyMTIyXHUyMzI4XHUyNjAxXHUyNjBFXHUyNjFkXHUyNjI2XHUyNjJBXHUyNjM4XHUyNjM5XHUyNjNhXHUyNjdCXHUyNjdGXHUyNzAyXHUyNzA4XXxbXHUyNjAwXHUyNkM0XHUyNkJFXHUyNzA1XHUyNzY0XXxbXHUyMTk0LVx1MjE5OVx1MjFBQVx1MjFBOV18W1x1MjMxQS1cdTIzMUJdfFtcdTIzRTktXHUyM0VGXXxbXHUyM0YwLVx1MjNGNF18W1x1MjNGOC1cdTIzRkFdfFtcdTI0QzJdfFtcdTI1QUEtXHUyNUFCXXxbXHUyNUI2XHUyNUMwXXxbXHUyNUZCLVx1MjVGRV18W1x1MjYwMi1cdTI2MThdfFtcdTI2NDgtXHUyNjUzXXxbXHUyNjYwLVx1MjY2OF18W1x1MjZBMC1cdTI2RkFdfFtcdTI2OTItXHUyNjlDXXxbXHUyNjJFLVx1MjYyRl18W1x1MjYyMi1cdTI2MjNdfFtcdTI3MDktXHUyNzY0XXxbXHUyNzk1LVx1Mjc5N118W1x1MjdBMV18W1x1MjdCRl18W1x1MjkzNC1cdTI5MzVdfFtcdTJCMDUtXHUyQjA3XXxbXHUyQjFCXXxbXHUyQjUwXHUyQjU1XXxbXHUzMDNEXXxbXHUzMjk3XHUzMjk5XXxbXHVFMDAwLVx1RjhGRl18W1x1RDgzRFx1RDgzQ1x1RDgzRV1bXHVEQzAwLVx1REZGRl18WzAtOV1cdTIwRTN8W1x1MDAyMy1cdTAwMzlcdTIwM0MtXHUyMUFBXHUxRjNGM11cdUZFMEZcdTIwRTN8W1x1MjAwQ1x1MjAwRFx1MjY0MFx1MjY0Mlx1RkUwRl0pKykvZywKCmVtb2ppSm9pbmVyczogWycyNjQwJywgJzI2NDInLCAnMjAwRCcsICcyMDBDJ10sCmVtb2ppSm9pbmVyc1JlZ0V4OiAvMjY0MHwyNjQyfDIwMER8MjAwQy9nLAplbW9qaUZsYWdzOiBbJ0Q4M0NEREU4JywgJ0Q4M0NEREYzJywgJ0Q4M0NEREU5JywgJ0Q4M0NEREVBJywgJ0Q4M0NEREVBJywgJ0Q4M0NEREY4JywgJ0Q4M0NEREVCJywgJ0Q4M0NEREY3JywgJ0Q4M0NEREVDJywgJ0Q4M0NEREU3JywgJ0Q4M0NEREVFJywgJ0Q4M0NEREY5JywgJ0Q4M0NEREVGJywgJ0Q4M0NEREY1JywgJ0Q4M0NEREYwJywgJ0Q4M0NEREY3JywgJ0Q4M0NEREY3JywgJ0Q4M0NEREZBJywgJ0Q4M0NEREZBJywgJ0Q4M0NEREY4JywgJ0Q4M0NEREZBJywgJ0Q4M0NEREU2JywgJ0Q4M0NEREYwJywgJ0Q4M0NEREZGJywgJ0Q4M0NEREU3JywgJ0Q4M0NEREZFJywgJ0Q4M0NEREU2JywgJ0Q4M0NEREZBJywgJ0Q4M0NEREU2JywgJ0Q4M0NEREY5JywgJ0Q4M0NEREU3JywgJ0Q4M0NEREVBJywgJ0Q4M0NEREU3JywgJ0Q4M0NEREY3JywgJ0Q4M0NEREZCJywgJ0Q4M0NEREYzJywgJ0Q4M0NEREVEJywgJ0Q4M0NEREYwJywgJ0Q4M0NEREU5JywgJ0Q4M0NEREYwJywgJ0Q4M0NEREVFJywgJ0Q4M0NEREYxJywgJ0Q4M0NEREVFJywgJ0Q4M0NEREYzJywgJ0Q4M0NEREVFJywgJ0Q4M0NEREU5JywgJ0Q4M0NEREVFJywgJ0Q4M0NEREVBJywgJ0Q4M0NEREU4JywgJ0Q4M0NEREU2JywgJ0Q4M0NEREU4JywgJ0Q4M0NEREY0JywgJ0Q4M0NEREYyJywgJ0Q4M0NEREY0JywgJ0Q4M0NEREYyJywgJ0Q4M0NEREZFJywgJ0Q4M0NEREYyJywgJ0Q4M0NEREZEJywgJ0Q4M0NEREYzJywgJ0Q4M0NEREYxJywgJ0Q4M0NEREYzJywgJ0Q4M0NEREZGJywgJ0Q4M0NEREYzJywgJ0Q4M0NEREY0JywgJ0Q4M0NEREU2JywgJ0Q4M0NEREVBJywgJ0Q4M0NEREY1JywgJ0Q4M0NEREYxJywgJ0Q4M0NEREY1JywgJ0Q4M0NEREY5JywgJ0Q4M0NEREY1JywgJ0Q4M0NEREY3JywgJ0Q4M0NEREY4JywgJ0Q4M0NEREU2JywgJ0Q4M0NEREY4JywgJ0Q4M0NEREVDJywgJ0Q4M0NEREY5JywgJ0Q4M0NEREY3JywgJ0Q4M0NEREY1JywgJ0Q4M0NEREVEJywgJ0Q4M0NEREVCJywgJ0Q4M0NEREVFJywgJ0Q4M0NEREU4JywgJ0Q4M0NEREYxJywgJ0Q4M0NEREU4JywgJ0Q4M0NEREVEJywgJ0Q4M0NEREY4JywgJ0Q4M0NEREVBJywgJ0Q4M0NEREZGJywgJ0Q4M0NEREU2JywgJ0Q4M0NERkYzJywgJ0Q4M0NERjA4J10sCgpnZXRDb2RlOiBmdW5jdGlvbihvYmopIHsKICB2YXIgY29kZSA9IGZhbHNlOwogIGlmIChvYmouY2xhc3NOYW1lID09ICdlbW9qaV9jc3MnKSB7CiAgICBjb2RlID0gb2JqLmdldEF0dHJpYnV0ZSgnZW1vamknKTsKICB9IGVsc2UgaWYgKG9iai5jbGFzc05hbWUuaW5kZXhPZignZW1vamknKSAhPSAtMSkgewogICAgdmFyIG0gPSBvYmouc3JjICYmIG9iai5zcmMubWF0Y2goL1wvKFthLXpBLVowLTldKykoXzJ4KT8ucG5nLyk7CiAgICBpZiAobSkgewogICAgICBjb2RlID0gbVsxXTsKICAgIH0gZWxzZSB7CiAgICAgIGNvZGUgPSBvYmouZ2V0QXR0cmlidXRlKCdlbW9qaScpOwogICAgfQogIH0KICByZXR1cm4gY29kZTsKfSwKCmdldFRhYkNvbnQ6IGZ1bmN0aW9uKG9wdElkLCBzZWxJZCkgewogIHZhciBzdGlja2VyU2l6ZSA9ICh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+PSAyKSA/ICcxMjgnIDogJzY0JzsKCiAgdmFyIGh0bWwgPSAnJzsKICBpZiAoc2VsSWQpIHsKICAgIHZhciByZWNlbnRIdG1sID0gJyc7CiAgICB2YXIgZm9yY2VTdGlja2VyUGFjayA9IEVtb2ppLm9wdHNbb3B0SWRdLmZvcmNlU3RpY2tlclBhY2s7CiAgICBmb3IodmFyIGogaW4gd2luZG93LmVtb2ppU3RpY2tlcnMpIHsKICAgICAgdmFyIHBhY2tJZCA9IHdpbmRvdy5lbW9qaVN0aWNrZXJzW2pdWzBdOwogICAgICB2YXIgaXNBY3RpdmUgPSB3aW5kb3cuZW1vamlTdGlja2Vyc1tqXVsxXTsKICAgICAgdmFyIGlzUHJvbW90ZWQgPSB3aW5kb3cuZW1vamlTdGlja2Vyc1tqXVszXTsKICAgICAgdmFyIGlzRm9yY2VkID0gd2luZG93LmVtb2ppU3RpY2tlcnNbal1bNF0gJiYgZm9yY2VTdGlja2VyUGFjayA9PSBwYWNrSWQ7CiAgICAgIGlmICghaXNBY3RpdmUgJiYgIWlzRm9yY2VkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KCiAgICAgIHZhciBwYWNrID0gRW1vamkuc3RpY2tlcnNbcGFja0lkXTsKICAgICAgaWYgKCFwYWNrKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdmFyIHBhY2tIdG1sID0gJzxkaXYgY2xhc3M9ImNsZWFyIGVtb2ppX3N0aWNrZXJzX3NwbGl0ZXIiIGlkPSJlbW9qaV90YWJfY29udF8nK3BhY2tJZCsnXycrb3B0SWQrJyI+PC9kaXY+JzsKICAgICAgaWYgKHBhY2tJZCA9PSBFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTKSB7CiAgICAgICAgcGFja0h0bWwgKz0gJzxkaXYgY2xhc3M9ImVtb2ppX3JlY2VudF9zdGlja2Vyc19jb250IiBpZD0iZW1vamlfcmVjZW50X3N0aWNrZXJzX2NvbnQnICsgb3B0SWQgKyAnIj4nOwogICAgICB9CiAgICAgIHZhciBsaXN0ID0gcGFjay5zdGlja2VyczsKICAgICAgZm9yICh2YXIgaSBpbiBsaXN0KSB7CiAgICAgICAgcGFja0h0bWwgKz0gcnMoRW1vamkuc3RpY2tlckl0ZW0oKSwgewogICAgICAgICAgb3B0SWQ6IG9wdElkLAogICAgICAgICAgc2VsSWQ6IHBhY2tJZCwKICAgICAgICAgIHN0aWNrZXJJZDogbGlzdFtpXVswXSwKICAgICAgICAgIHNpemU6IGxpc3RbaV1bMV0sCiAgICAgICAgICBzdGlja2VyU2l6ZTogc3RpY2tlclNpemUKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAocGFja0lkID09IEVtb2ppLlRBQl9SRUNFTlRfU1RJQ0tFUlMpIHsKICAgICAgICByZWNlbnRIdG1sID0gcGFja0h0bWwgKyAnPC9kaXY+JzsKICAgICAgfSBlbHNlIGlmIChpc0ZvcmNlZCkgewogICAgICAgIGh0bWwgPSBwYWNrSHRtbCArIGh0bWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaHRtbCArPSBwYWNrSHRtbDsKICAgICAgfQogICAgfQogICAgaHRtbCA9IHJlY2VudEh0bWwgKyBodG1sOwogIH0gZWxzZSB7CiAgICBodG1sID0gRW1vamkudHRFbW9qaUxpc3Qob3B0SWQpOwogIH0KICByZXR1cm4gaHRtbDsKfSwKCnVwZGF0ZVN0aWNrZXJzQ29udDogZnVuY3Rpb24ob3B0SWQpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIHZhciBodG1sID0gRW1vamkuZ2V0VGFiQ29udChvcHRJZCwgRW1vamkuVEFCX1JFQ0VOVF9TVElDS0VSUyk7CiAgdmFyIGNvbnQgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc3RpY2tlcnMnLCBvcHRzLnR0KTsKICBjb250LmlubmVySFRNTCA9IGh0bWw7CgogIG9wdHMuaW5pdGVkU3RpY2tlcnMgPSAxOwogIG9wdHMuaW1hZ2VzTG9hZGluZyA9IFtdOwogIGNsZWFyVGltZW91dChvcHRzLnByZWxvYWRTdGlja2Vyc1RpbWVyKTsKCiAgdmFyIHBvc1RyZWUgPSBbXSwgc3BsaXRlcnNQb3MgPSBbXTsKICB2YXIgZWwgPSBjb250LmZpcnN0Q2hpbGQ7CiAgdmFyIHJlY2VudCA9IGZhbHNlOwogIHdoaWxlKGVsKSB7CiAgICBpZiAoIXJlY2VudCAmJiBoYXNDbGFzcyhlbCwgJ2Vtb2ppX3JlY2VudF9zdGlja2Vyc19jb250JykpIHsKICAgICAgZWwgPSBlbC5maXJzdENoaWxkOwogICAgICByZWNlbnQgPSB0cnVlOwogICAgfQogICAgaWYgKGhhc0NsYXNzKGVsLCAnZW1vamlfc3RpY2tlcl9pdGVtJykpIHsKICAgICAgdmFyIGlkID0gZWwuaWQucmVwbGFjZSgnZW1vamlfc3RpY2tlcl9pdGVtJywgJycpOwogICAgICBwb3NUcmVlLnB1c2goW2lkLCBlbC5vZmZzZXRUb3BdKTsKICAgIH0gZWxzZSBpZiAoaGFzQ2xhc3MoZWwsICdlbW9qaV9zdGlja2Vyc19zcGxpdGVyJykpIHsKICAgICAgdmFyIGlkID0gZWwuaWQucmVwbGFjZSgnZW1vamlfdGFiX2NvbnRfJywgJycpLnNwbGl0KCdfJyk7CiAgICAgIHNwbGl0ZXJzUG9zLnB1c2goW2ludHZhbChpZFswXSksIGVsLm9mZnNldFRvcF0pOwogICAgfQogICAgaWYgKCFlbC5uZXh0U2libGluZyAmJiByZWNlbnQpIHsKICAgICAgZWwgPSBlbC5wYXJlbnROb2RlOwogICAgfQogICAgZWwgPSBlbC5uZXh0U2libGluZzsKICB9CiAgb3B0cy5uZWVkTG9hZFN0aWNrZXJzID0gcG9zVHJlZTsKICBvcHRzLnN0aWNrZXJzU3BsaXRlcnNQb3MgPSBzcGxpdGVyc1BvczsKfSwKCnN0aWNrZXJJdGVtOiBmdW5jdGlvbigpIHsKICAvLyA8aW1nIGNsYXNzPSJlbW9qaV9zdGlja2VyX2ltYWdlIGVtb2ppX25lZWRfbG9hZCIgc3JjPSIvaW1hZ2VzL2JsYW5rLmdpZiIgZGF0YS1zcmM9Ii9pbWFnZXMvc3RpY2tlcnMvJXN0aWNrZXJJZCUvJXN0aWNrZXJTaXplJS5wbmciIC8+CiAgcmV0dXJuICc8YSBpZD0iZW1vamlfc3RpY2tlcl9pdGVtJW9wdElkJV8lc2VsSWQlXyVzdGlja2VySWQlIiBkYXRhLXBhY2staWQ9IiVzZWxJZCUiIGRhdGEtc3JjPSIvaW1hZ2VzL3N0aWNrZXJzLyVzdGlja2VySWQlLyVzdGlja2VyU2l6ZSUucG5nIiBjbGFzcz0iZW1vamlfc3RpY2tlcl9pdGVtIiBvbmNsaWNrPSJFbW9qaS5zdGlja2VyQ2xpY2soJW9wdElkJSwgJXN0aWNrZXJJZCUsICVzaXplJSwgdGhpcywgXCdrZXlib2FyZFwnKTsiPjwvYT4nOwp9LApoaW50c1N0aWNrZXJJdGVtOiBmdW5jdGlvbigpIHsKICByZXR1cm4gJzxhIGlkPSJlbW9qaV9zdGlja2VyX2l0ZW0lb3B0SWQlXyVzZWxJZCVfJXN0aWNrZXJJZCUiIGRhdGEtcGFjay1pZD0iJXNlbElkJSIgY2xhc3M9ImVtb2ppX3N0aWNrZXJfaXRlbSAlY2xhc3MlIiBvbmNsaWNrPSIlb25jbGljayUiIG9ubW91c2VvdmVyPSJFbW9qaS5zdGlja2VySGludE92ZXIodGhpcykiIG9ubW91c2VvdXQ9IkVtb2ppLnN0aWNrZXJIaW50T3V0KHRoaXMpIj48aW1nIGNsYXNzPSJlbW9qaV9zdGlja2VyX2ltYWdlIiBzcmM9Ii9pbWFnZXMvc3RpY2tlcnMvJXN0aWNrZXJJZCUvJXN0aWNrZXJTaXplJS5wbmciIC8+PC9hPic7Cn0sCnRhYlN3aXRjaDogZnVuY3Rpb24ob2JqLCBzZWxJZCwgb3B0SWQsIG5vU2Nyb2xsVXBkYXRlKSB7CiAgaWYgKG9iaiA9PSB1bmRlZmluZWQpIHsKICAgIHJldHVybjsKICB9CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXSwgdHQgPSBvcHRzLnR0OwoKICBpZiAodHlwZW9mIG9iaiA9PT0gJ251bWJlcicpIHsKICAgIG9iaiA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYl8nICsgb2JqLCB0dCk7CiAgfQoKICB2YXIgZW1vamlXcmFwID0gZ2VCeUNsYXNzMSgnZW1vamlfc2Nyb2xsX3NtaWxlcycsIHR0KSwKICAgIHN0aWNrZXJzV3JhcCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3Njcm9sbF9zdGlja2VycycsIHR0KTsKCiAgdmFsKGdlQnlDbGFzczEoJ2Vtb2ppX2NhdHNfdGl0bGVfaGVscGVyJywgdHQpLCAnJyk7CiAgb3B0cy5jdXJFbW9qaUNhdElkID0gbnVsbDsKCiAgaWYgKHNlbElkID09IEVtb2ppLlRBQl9FTU9KSSkgewogICAgaGlkZShzdGlja2Vyc1dyYXApOwogICAgc2hvdyhlbW9qaVdyYXApOwoKICAgIGlmICghb3B0cy5lbW9qaUluaXRlZCkgewogICAgICB2YWwoZW1vamlXcmFwLCBFbW9qaS5nZXRJbml0RW1vamlDb250ZW50KG9wdElkKSk7CiAgICAgIG9wdHMuZW1vamlJbml0ZWQgPSB0cnVlOwogICAgfQogICAgaWYgKG9wdHMuaW1hZ2VzTG9hZGVyKSB7CiAgICAgIG9wdHMuaW1hZ2VzTG9hZGVyLnByb2Nlc3NMb2FkKCk7CiAgICB9CgogICAgaWYgKG9wdHMuZW1vamlPdmVyZWQgJiYgb3B0cy5jdXJUYWIgPT09IDApIHsKICAgICAgRW1vamkuZW1vamlPdmVyKG9wdElkLCBFbW9qaS5nZXRGaXJzdEVtb2ppRWwob3B0SWQpKTsKICAgIH0KICAgIGlmIChvcHRzLmN1clRhYiAhPSBFbW9qaS5UQUJfRU1PSkkpIHsKICAgICAgb3B0cy5lbW9qaVNjcm9sbCAmJiBvcHRzLmVtb2ppU2Nyb2xsLnNjcm9sbFRvcCgwKTsKICAgIH0KICAgIEVtb2ppLnVwZGF0ZVJlY2VudEVtb2ppKG9wdElkKTsKICAgIEVtb2ppLnVwZGF0ZUVtb2ppQ2F0VGl0bGUob3B0SWQpOwogIH0gZWxzZSB7CiAgICBoaWRlKGVtb2ppV3JhcCk7CiAgICBzaG93KHN0aWNrZXJzV3JhcCk7CgogICAgdmFyIHN0aWNrZXJzID0gRW1vamkuc3RpY2tlcnMgJiYgY2xvbmUoRW1vamkuc3RpY2tlcnMpOwogICAgaWYgKHN0aWNrZXJzKSB7CiAgICAgIGRlbGV0ZSBzdGlja2Vyc1tFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTXTsKICAgIH0KICAgIGlmICghc3RpY2tlcnMgfHwgaXNFbXB0eShzdGlja2VycykgfHwgIXN0aWNrZXJzW3NlbElkXSAmJiBzZWxJZCAhPSBFbW9qaS5UQUJfUkVDRU5UX1NUSUNLRVJTKSB7CiAgICAgIEVtb2ppLm9uU3RpY2tlcnNMb2FkID0gRW1vamkudGFiU3dpdGNoLnBiaW5kKHNlbElkLCBzZWxJZCwgb3B0SWQsIG5vU2Nyb2xsVXBkYXRlKTsKICAgICAgRW1vamkuc3RpY2tlcnNMb2FkaW5nUHJvZ3Jlc3Mob3B0SWQsIHNlbElkLCBvYmopOwogICAgICBvcHRzLnN0aWNrZXJzSW5pdGVkID0gZmFsc2U7CiAgICAgIG9wdHMuY3VyVGFiID0gbnVsbDsKICAgICAgRW1vamkuZW1vamlMb2FkTW9yZShvcHRJZCk7CiAgICB9IGVsc2UgaWYgKCFvcHRzLnN0aWNrZXJzSW5pdGVkKSB7CiAgICAgIEVtb2ppLnVwZGF0ZVN0aWNrZXJzQ29udChvcHRJZCk7CiAgICAgIG9wdHMuc3RpY2tlcnNJbml0ZWQgPSB0cnVlOwogICAgfQogICAgaWYgKG9wdHMuY3VyVGFiICE9IHNlbElkIHx8IG9wdHMuYWZ0ZXJMb2FkKSB7CiAgICAgIEVtb2ppLnNjcm9sbFRvU3RpY2tlclBhY2sob3B0SWQsIHNlbElkLCBvcHRzLmN1clRhYiA9PSBFbW9qaS5UQUJfRU1PSkkpOwogICAgICBvcHRzLmFmdGVyTG9hZCA9IDA7CiAgICB9CiAgICBFbW9qaS51cGRhdGVTaG93blN0aWNrZXJzKG9wdElkLCB0cnVlKTsKICB9CgogIGlmICghRW1vamkub25TdGlja2Vyc0xvYWQgfHwgc2VsSWQgPT0gRW1vamkuVEFCX0VNT0pJKSB7CiAgICBFbW9qaS5zZWxlY3RUYWIob3B0SWQsIHNlbElkLCBvYmopOwogIH0KfSwKCmdldEZpcnN0RW1vamlFbDogZnVuY3Rpb24gKG9wdElkKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICB2YXIgZWwgPSBnZUJ5Q2xhc3MxKCdlbW9qaV9zY3JvbGxfc21pbGVzJywgb3B0cy50dCkuZmlyc3RDaGlsZDsKCiAgd2hpbGUoZWwpIHsKICAgIGlmIChoYXNDbGFzcyhlbCwgJ2Vtb2ppX3NtaWxlc19yb3cnKSkgewogICAgICByZXR1cm4gZWwuZmlyc3RDaGlsZDsKICAgIH0KICAgIGVsID0gZWwubmV4dFNpYmxpbmc7CiAgfQoKICByZXR1cm4gbnVsbDsKfSwKCmdldEVtb2ppRWw6IGZ1bmN0aW9uIChlbCwgbmF2KSB7CiAgdmFyIGNudCA9IDA7CgogIHZhciByb3cgPSBlbC5wYXJlbnROb2RlLCBwb3MgPSAwLCByZXM7CgogIHZhciBfZWwgPSByb3cuZmlyc3RDaGlsZDsKICB3aGlsZSAoX2VsKSB7CiAgICBwb3MrKzsKICAgIGlmIChfZWwgPT09IGVsKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgX2VsID0gX2VsLm5leHRTaWJsaW5nOwogIH0KCiAgd2hpbGUoZWwgJiYgIXJlcykgewoKICAgIGlmIChuYXYgPT0gJ2xlZnQnIHx8IG5hdiA9PSAncmlnaHQnKSB7CiAgICAgIHJlcyA9IG5hdiA9PSAnbGVmdCcgPyBlbC5wcmV2aW91c1NpYmxpbmcgOiBlbC5uZXh0U2libGluZzsKCiAgICAgIGlmICghcmVzKSB7CiAgICAgICAgaWYgKG5hdiA9PSAnbGVmdCcpIHsKICAgICAgICAgIG5hdiA9ICd1cCc7CiAgICAgICAgICBwb3MgPSAxMDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmF2ID0gJ2Rvd24nOwogICAgICAgICAgcG9zID0gMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobmF2ID09ICd1cCcgfHwgbmF2ID09ICdkb3duJykgewogICAgICB2YXIgX3JvdyA9IHJvdzsKICAgICAgd2hpbGUoX3JvdykgewogICAgICAgIF9yb3cgPSBuYXYgPT0gJ3VwJyA/IF9yb3cucHJldmlvdXNTaWJsaW5nIDogX3Jvdy5uZXh0U2libGluZzsKICAgICAgICBpZiAoIV9yb3cgfHwgaGFzQ2xhc3MoX3JvdywgJ2Vtb2ppX3NtaWxlc19yb3cnKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChfcm93KSB7CiAgICAgICAgaWYgKHBvcyAmJiBfcm93KSB7CiAgICAgICAgICB2YXIgX3BvcyA9IDAsIF9lbCA9IF9yb3cuZmlyc3RDaGlsZDsKICAgICAgICAgIHdoaWxlKF9lbCAmJiBfcG9zIDwgcG9zKSB7CiAgICAgICAgICAgIF9wb3MrKzsKICAgICAgICAgICAgaWYgKF9wb3MgPj0gcG9zKSB7CiAgICAgICAgICAgICAgcmVzID0gX2VsOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIF9lbCA9IF9lbC5uZXh0U2libGluZzsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmICghcmVzICYmIF9yb3cpIHsKICAgICAgICAgIHJlcyA9IChuYXYgPT0gJ3VwJyB8fCBwb3MgJiYgbmF2ID09ICdkb3duJykgPyBfcm93Lmxhc3RDaGlsZCA6IF9yb3cuZmlyc3RDaGlsZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KCiAgICBjbnQrKzsKICAgIGlmIChjbnQgPiAyMCkgewogICAgICBkZWJ1Z0xvZygnRVJSISEnKTsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICByZXR1cm4gcmVzOwp9LAoKc3RpY2tlckNsaWNrOiBmdW5jdGlvbihvcHRJZCwgc3RpY2tlck51bSwgd2lkdGgsIG9iaiwgc3RpY2tlcl9yZWZlcnJlcikgewogIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CgogIGlmICh2a05vdygpIC0gb3B0cy50dFNob3dUIDwgRW1vamkuQ0xJQ0tfREVMQVkpIHsKICAgIHJldHVybgogIH0KCiAgdmFyIHBhY2tJZCA9IHBhcnNlSW50KGF0dHIob2JqLCAnZGF0YS1wYWNrLWlkJykpOwoKICB2YXIgYWRkVG9SZWNlbnQgPSB0cnVlOwogIGlmICh3aW5kb3cuZW1vamlTdGlja2VycykgewogICAgZWFjaCh3aW5kb3cuZW1vamlTdGlja2VycywgZnVuY3Rpb24oaSwgcGFjaykgewogICAgICBpZiAocGFja1swXSA9PSBwYWNrSWQpIHsKICAgICAgICBhZGRUb1JlY2VudCA9ICEhcGFja1sxXTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgaWYgKGFkZFRvUmVjZW50KSB7CiAgICBpZiAoIUVtb2ppLnN0aWNrZXJzWy0xXSkgewogICAgICBFbW9qaS5zdGlja2Vyc1stMV0gPSB7c3RpY2tlcnM6W119OwogICAgfQogICAgZm9yKHZhciBpIGluIEVtb2ppLnN0aWNrZXJzWy0xXS5zdGlja2VycykgewogICAgICBpZiAoRW1vamkuc3RpY2tlcnNbLTFdLnN0aWNrZXJzW2ldWzBdID09IHN0aWNrZXJOdW0pIHsKICAgICAgICBFbW9qaS5zdGlja2Vyc1stMV0uc3RpY2tlcnMuc3BsaWNlKGksIDEpOwogICAgICB9CiAgICB9CiAgICBFbW9qaS5zdGlja2Vyc1stMV0uc3RpY2tlcnMudW5zaGlmdChbc3RpY2tlck51bSwgd2lkdGhdKTsKICAgIGxzLnNldCgncmVjZW50X3N0aWNrZXJzJywgRW1vamkuc3RpY2tlcnNbLTFdKTsKICAgIEVtb2ppLnVwZGF0ZVJlY2VudFN0aWNrZXJzKG9wdElkKTsKICB9CgogIGlmIChvcHRzLm9uU3RpY2tlclNlbmQpIHsKICAgIG9wdHMub25TdGlja2VyU2VuZChzdGlja2VyTnVtLCBzdGlja2VyX3JlZmVycmVyKTsKICB9CgogIEVtb2ppLnR0SGlkZShvcHRJZCwgZmFsc2UsIGZhbHNlLCB0cnVlKTsKICBvcHRzLnJlY2VudFN0aWNrZXIgPSBzdGlja2VyTnVtOwp9LAoKc3RpY2tlck92ZXI6IGZ1bmN0aW9uKHN0aWNrZXJOdW0sIGVsKSB7CiAgdmFyIHBhcmFtcyA9IHthY3Q6ICdhX3N0aWNrZXJzX2hvdmVyJywgc3RpY2tlcl9pZDogc3RpY2tlck51bSwgZnJvbTogY3VyLm1vZHVsZX07CgogIGlmIChpc09iamVjdChlbC50dCkgJiYgZWwuZmlyc3RDaGlsZC5ub2RlTmFtZSA9PT0gJ0lNRycpIHsKICAgIHJldHVybiBlbC50dC5zaG93KCk7CiAgfQoKICB2YXIgb25Eb25lID0gZnVuY3Rpb24gKHRvb2x0aXAsIGNvbnRlbnQpIHsKICAgIHZhciB0dF9pbmRleCA9IChjdXIudG9vbHRpcHMgfHwgW10pLmxlbmd0aDsKICAgIHZhciB0dF9jbGFzc25hbWUgPSBbCiAgICAgICdzdWJzY3JpYmVfcG9zdF90dCcsCiAgICAgICdzdGlja2VyX2V4dHJhX3R0JywKICAgICAgJ3N0aWNrZXJfZXh0cmFfdHQnICsgdHRfaW5kZXgsCiAgICAgICF0b29sdGlwLmltYWdlID8gJ3R0X3RleHRfb25seScgOiAnJwogICAgXTsKCiAgICB0dF9jbGFzc25hbWUgPSB0dF9jbGFzc25hbWUuam9pbignICcpOwoKICAgIGlmICghdG9vbHRpcC5zaG93KSB7CiAgICAgIHJldHVybjsKICAgIH0KCgogICAgdmFyIG9wdCA9IHsKICAgICAgaW5kZXg6IHR0X2luZGV4LAogICAgICBjbGFzc05hbWU6IHR0X2NsYXNzbmFtZSwKICAgICAgY29udGVudDogY29udGVudCwKICAgICAgc2hpZnQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiBbLTEzOCwgMCwgLTIwMF07CiAgICAgIH0sCiAgICAgIGhhc292ZXI6IDEsCiAgICAgIHNsaWRlWDogMTUsCiAgICAgIHNob3dzcDogMTUwLAogICAgICBjYWNoZTogMSwKICAgICAgZm9yY2V0b2Rvd246IHRydWUsCiAgICAgIG5vX3NoYWRvdzogdHJ1ZSwKICAgICAgZGlyOiAnbGVmdCcsCiAgICAgIG9uU2hvd1N0YXJ0OiBmdW5jdGlvbiAodHQpIHsKICAgICAgICB2YXIgZWwgPSB0dC5jb250YWluZXIsCiAgICAgICAgICAgIHNpemUgPSBnZXRTaXplKHR0LmNvbnRhaW5lciksCiAgICAgICAgICAgIGVsX2hlaWdodCA9IHNpemVbMV0sCiAgICAgICAgICAgIGVsX2hlaWdodF9kZWZhdWx0ID0gMjI1LAogICAgICAgICAgICBlbF9oZWlnaHRfZmF1bHQgPSAxMDsKCiAgICAgICAgaWYgKGVsX2hlaWdodCA+PSBlbF9oZWlnaHRfZGVmYXVsdCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgZWxfZGlmZiA9IGludHZhbCgoZWxfaGVpZ2h0X2RlZmF1bHQgLSBlbF9oZWlnaHQpIC8gMikgKyBlbF9oZWlnaHRfZmF1bHQ7CiAgICAgICAgZWxfY3VyX3RvcCA9IGludHZhbChnZXRTdHlsZShlbCwgJ3RvcCcsIHRydWUpKTsKICAgICAgICBlbF90b3AgPSBlbF9jdXJfdG9wICsgZWxfZGlmZjsKICAgICAgICBzZXRTdHlsZShlbCwgJ3RvcCcsIGVsX3RvcCk7CiAgICAgIH0KICAgIH0KCiAgICBpZiAoZ3BlQnlDbGFzcygnX2ltX3BlZXJfaGlzdG9yeV93JywgZWwpKSB7CiAgICAgIG9wdC5hcHBlbmRQYXJlbnRDbHMgPSAnX2ltX3BlZXJfaGlzdG9yeV93JzsKICAgIH0KCiAgICBzaG93VG9vbHRpcChlbCwgb3B0KTsKICB9CgogIGFqYXgucG9zdCgnYWxfaW0ucGhwJywgcGFyYW1zLCB7b25Eb25lOiBvbkRvbmV9KTsKfSwKCnNlbGVjdFBlZXI6IGZ1bmN0aW9uKG9wdElkKSB7CiAgaWYgKG9wdElkICE9PSB1bmRlZmluZWQpIHsKICAgIHZhciBvcHRzID0gRW1vamkub3B0c1tvcHRJZF07CiAgICBpZiAob3B0cy5wZWVyKSB7CiAgICAgIHJldHVybiBvcHRzLnBlZXI7CiAgICB9CiAgfQogIHZhciBwZWVyID0gY3VyLnBlZXIgfHwgKGN1ci5tYlRvID8gY3VyLm1iVG9bMF0gOiAnJyk7CiAgaWYgKHBlZXIgPT0gLTMpIHsKICAgIGlmIChjdXIud2RkWydpbXdfZGQnXSkgewogICAgICB2YXIgY250ID0gMDsKICAgICAgZm9yKHZhciBpIGluIGN1ci53ZGRbJ2ltd19kZCddLnNlbGVjdGVkKXsKICAgICAgICBwZWVyID0gY3VyLndkZFsnaW13X2RkJ10uc2VsZWN0ZWRbaV1bMF07CiAgICAgICAgY250ICs9IDE7CiAgICAgIH0KICAgICAgaWYgKGNudCA+IDEpIHsKICAgICAgICBwZWVyID0gJyc7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIHBlZXI7Cn0sCgpzaG93TXlTdGlja2VyczogZnVuY3Rpb24oKSB7CiAgY3VyLmJveE15U3RpY2tlcnMgPSBzaG93Qm94KCdhbF9pbS5waHAnLCB7YWN0OiAnc3RpY2tlcnNfbXknfSwge2Rhcms6IDEsIHN0YXQ6IFsnaW0uY3NzJywgJ2ltbi5qcycsICdzb3J0ZXIuanMnXX0pOwp9LAoKc2hvd1N0aWNrZXJzU3RvcmU6IGZ1bmN0aW9uKG9wdElkLCBmcm9tKSB7CiAgdmFyIHBlZXIgPSBFbW9qaS5zZWxlY3RQZWVyKG9wdElkICE9PSBmYWxzZSA/IG9wdElkIDogdW5kZWZpbmVkKSwKICAgICAgcGFyYW1zID0ge2FjdDogJ3N0aWNrZXJzX3N0b3JlJywgcGVlcjogcGVlciwgYm94OiAxfTsKICBpZiAoZnJvbSkgcGFyYW1zLmZyb20gPSBmcm9tOwogIGN1ci5ib3hTdGlja2Vyc1N0b3JlID0gc2hvd0JveCgnYWxfaW0ucGhwJywgcGFyYW1zLCB7ZGFyazogMSwgc3RhdDogWydpbS5jc3MnLCAnaW1uLmpzJywgJ3BhZ2VfaGVscC5jc3MnLCAnc29ydGVyLmpzJ119KTsKICBlYWNoKGdlQnlDbGFzcygnZW1vamlfc21pbGVfaWNvbl9wcm9tbycpLCBmdW5jdGlvbihpLCBlbCkgeyBnZUJ5Q2xhc3MxKCdlbW9qaV9zbWlsZV9pY29uJywgZWwucGFyZW50Tm9kZSk7IHJlKGVsKTsgfSk7CiAgZWFjaChnZUJ5Q2xhc3MoJ2Vtb2ppX3Nob3BfaWNvbl9iYWRnZScpLCBmdW5jdGlvbihpLCBlbCkgeyByZShlbCk7IH0pOwogIEVtb2ppLmhhc05ld1N0aWNrZXJzID0gZmFsc2U7Cn0sCgpwcmV2aWV3U3RpY2tlcjogZnVuY3Rpb24ocGFja0lkLCBvYmosIG9wdHMsIGV2KSB7CiAgb3B0cyA9IG9wdHMgfHwge307CiAgaWYgKGV2ICYmIGNoZWNrRXZlbnQoZXYpKSByZXR1cm4gdHJ1ZTsKICB2YXIgcGFyYW1zID0ge2FjdDogJ3N0aWNrZXJfcHJldmlldycsIHBhY2tfaWQ6IHBhY2tJZH07CiAgdmFyIHBlZXIgPSBFbW9qaS5zZWxlY3RQZWVyKCk7CiAgaWYgKG9wdHMucGVlcikgewogICAgcGFyYW1zLnBlZXIgPSBvcHRzLnBlZXI7CiAgfSBlbHNlIGlmIChwZWVyKSB7CiAgICBwYXJhbXMucGVlciA9IHBlZXI7CiAgfQogIGlmIChvcHRzLnByZXZpZXcpIHsKICAgIHBhcmFtcy5wcmV2aWV3ID0gMTsKICB9CiAgaWYgKG9wdHMuc3RpY2tlcklkKSB7CiAgICBwYXJhbXMuc3RpY2tlcl9pZCA9IG9wdHMuc3RpY2tlcklkOwogIH0KICBwYXJhbXMuc3RpY2tlcl9yZWZlcnJlciA9IG9wdHMuc3RpY2tlcl9yZWZlcnJlciB8fCAnc3RvcmUnOwogIGlmIChvcHRzLm5hbWUpIHsKICAgIHZhciBxdWVyeSA9IG5hdi5vYmpMb2NbMF0uc3BsaXQoJy8nKTsKICAgIGlmIChxdWVyeVswXSA9PSAnc3RpY2tlcnMnICYmIHF1ZXJ5WzFdICE9IG9wdHMubmFtZSkgewogICAgICBuYXYuc2V0TG9jKHswOiAnc3RpY2tlcnMvJyArIG9wdHMubmFtZX0pOwogICAgfQogIH0KICBjdXIuYm94U3RpY2tlcnNQcmV2aWV3ID0gc2hvd0JveCgnYWxfaW0ucGhwJywgcGFyYW1zLCB7ZGFyazogMSwgc3RhdDogWydpbS5jc3MnLCAnaW1uLmpzJ10sIG9uRmFpbDogZnVuY3Rpb24oZSkgewogICAgaWYgKCF3aW5kb3cuZW1vamlTdGlja2Vyc0Rpc2FibGVkKSB7CiAgICAgIHdpbmRvdy5lbW9qaVN0aWNrZXJzRGlzYWJsZWQgPSB7fTsKICAgIH0KICAgIGlmIChwYWNrSWQpIHsKICAgICAgd2luZG93LmVtb2ppU3RpY2tlcnNEaXNhYmxlZFtwYWNrSWRdID0gdHJ1ZTsKICAgIH0KICAgIGlmIChlKSByZXR1cm4gdHJ1ZTsKICB9fSk7CiAgY2FuY2VsRXZlbnQoZXYpOwogIHJldHVybiBmYWxzZTsKfSwKCmlzU3RpY2tlclBhY2tFbmFibGVkOiBmdW5jdGlvbihwYWNrSWQsIG9uU3RpY2tlcnNMb2FkKSB7CiAgdmFyIGVuID0gZmFsc2U7CiAgaWYgKCF3aW5kb3cuZW1vamlTdGlja2VycyAmJiBvblN0aWNrZXJzTG9hZCkgewogICAgYWpheC5wb3N0KCdhbF9pbS5waHAnLCB7YWN0OiAnYV9zdGlja2Vyc19saXN0J30sIHsKICAgICAgb25Eb25lOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgd2luZG93LmVtb2ppU3RpY2tlcnMgPSBkYXRhOwogICAgICAgIG9uU3RpY2tlcnNMb2FkKCk7CiAgICAgIH0KICAgIH0pCiAgICByZXR1cm4gMDsKICB9IGVsc2UgaWYgKCF3aW5kb3cuZW1vamlTdGlja2VycykgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBmb3IgKHZhciBpIGluIHdpbmRvdy5lbW9qaVN0aWNrZXJzKSB7CiAgICBpZiAod2luZG93LmVtb2ppU3RpY2tlcnNbaV1bMF0gPT0gcGFja0lkKSB7CiAgICAgIGVuID0gd2luZG93LmVtb2ppU3RpY2tlcnNbaV1bMV0gPyB0cnVlIDogZmFsc2U7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICByZXR1cm4gZW47Cn0sCgpjbGlja1N0aWNrZXI6IGZ1bmN0aW9uKHBhY2tJZCwgb2JqLCBldikgewogIGlmICh3aW5kb3cuZW1vamlTdGlja2Vyc0Rpc2FibGVkICYmIHdpbmRvdy5lbW9qaVN0aWNrZXJzRGlzYWJsZWRbcGFja0lkXSkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGlmIChvYmopIHsKICAgIHZhciBlbiA9IEVtb2ppLmlzU3RpY2tlclBhY2tFbmFibGVkKHBhY2tJZCwgRW1vamkuY2xpY2tTdGlja2VyLnBiaW5kKHBhY2tJZCwgb2JqLCBldikpOwogICAgaWYgKGVuID09PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChlbikgewogICAgICB2YXIgdHh0ID0gZmFsc2U7CiAgICAgIGlmIChvYmouZ2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnKSkgewogICAgICAgIHR4dCA9IG9iajsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YXIgZWwgPSBvYmoucGFyZW50Tm9kZTsKICAgICAgICB2YXIgbWluaSA9IGZhbHNlOwogICAgICAgIHdoaWxlIChlbCA9IGVsLnBhcmVudE5vZGUpIHsKICAgICAgICAgIGlmIChoYXNDbGFzcyhlbCwgJ2pzLWltLXBhZ2UnKSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoYXNDbGFzcyhlbCwgJ2ZjX3RhYicpKSB7CiAgICAgICAgICAgIG1pbmkgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChoYXNDbGFzcyhlbCwgJ212X2NoYXQnKSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFlbCkgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmICghbWluaSkgewogICAgICAgICAgaWYgKGhhc0NsYXNzKGVsLCAnanMtaW0tcGFnZScpKSB7CiAgICAgICAgICAgIHR4dCA9IGdlQnlDbGFzczEoJ19pbV90ZXh0Jyk7CiAgICAgICAgICB9IGVsc2UgaWYgKGhhc0NsYXNzKGVsLCAnbXZfY2hhdCcpKSB7CiAgICAgICAgICAgIHR4dCA9IGRvbUJ5Q2xhc3MoZWwsICdtdl9jaGF0X3JlcGx5X2lucHV0Jyk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHR4dCA9IGdlQnlDbGFzczEoJ2ZjX2VkaXRhYmxlJywgZWwpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHR4dCkgewogICAgICAgIHZhciBvcHRzID0gRW1vamkub3B0c1t0eHQuZW1vamlJZF07CgogICAgICAgIEVtb2ppLnR0Q2xpY2sodHh0LmVtb2ppSWQsIGdlQnlDbGFzczEoJ19lbW9qaV9idG4nLCB0eHQucGFyZW50Tm9kZS5wYXJlbnROb2RlKSwgZmFsc2UsIHRydWUpOwoKICAgICAgICB2YXIgdGFiID0gZ2VCeUNsYXNzMSgnZW1vamlfdGFiXycrcGFja0lkLCBvcHRzLnR0KTsKICAgICAgICB2YXIgc3RpY2tlcnMgPSBFbW9qaS5zdGlja2VycyAmJiBjbG9uZShFbW9qaS5zdGlja2Vycyk7CiAgICAgICAgaWYgKHN0aWNrZXJzKSB7CiAgICAgICAgICBkZWxldGUgc3RpY2tlcnNbLTFdOwogICAgICAgIH0KICAgICAgICBpZiAoIXN0aWNrZXJzIHx8IGlzRW1wdHkoc3RpY2tlcnMpKSB7CiAgICAgICAgICBFbW9qaS5vblN0aWNrZXJzTG9hZCA9IEVtb2ppLnRhYlN3aXRjaC5wYmluZChwYWNrSWQsIHBhY2tJZCwgdHh0LmVtb2ppSWQpOwogICAgICAgICAgRW1vamkuc3RpY2tlcnNMb2FkaW5nUHJvZ3Jlc3ModHh0LmVtb2ppSWQsIHBhY2tJZCwgdGFiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3B0cy5pbml0ZWRTdGlja2VycyA9IDA7CiAgICAgICAgICBFbW9qaS50YWJTd2l0Y2godGFiLCBwYWNrSWQsIHR4dC5lbW9qaUlkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgaWYgKCFvYmogfHwgIWVuKSB7CiAgICBFbW9qaS5wcmV2aWV3U3RpY2tlcihwYWNrSWQsIGZhbHNlLCB7c3RpY2tlcl9yZWZlcnJlcjogJ21lc3NhZ2UnfSk7CiAgfQogIGV2ICYmIGNhbmNlbEV2ZW50KGV2KTsKICByZXR1cm4gZmFsc2U7Cn0sCgpzdGlja2Vyc0xvYWRpbmdQcm9ncmVzczogZnVuY3Rpb24gKG9wdElkLCBzZWxJZCwgb2JqKSB7CiAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW29wdElkXTsKICByZW1vdmVDbGFzcyhnZUJ5Q2xhc3MxKCdlbW9qaV90YWJfc2VsJywgb3B0cy50dCksICdlbW9qaV90YWJfc2VsJyk7CiAgYWRkQ2xhc3Mob2JqLCAnZW1vamlfdGFiX3NlbCcpOwogIGdlQnlDbGFzczEoJ2Vtb2ppX3Njcm9sbF9zdGlja2VycycsIG9wdHMudHQpLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJlbW9qaV9zY3JvbGxfcHJvZ3Jlc3MiPicgKyBycyh2ay5wcl90cGwsIHtpZDogJycsIGNsczogJ3ByX2JpZyd9KSArICc8L2Rpdj4nOwp9LAoKYnV5U3RpY2tlcnM6IGZ1bmN0aW9uKHBhY2tJZCwgZXYsIG9iaiwgaGFzaCwgc3RpY2tlcl9yZWZlcnJlcikgewogIGlmIChvYmopIHsKICAgIHZhciBiYWNrID0gb2JqLmlubmVySFRNTDsKICAgIGlmIChoYXNDbGFzcyhvYmosICdzZWNvbmRhcnknKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CiAgdmFyIHBlZXIgPSBFbW9qaS5zZWxlY3RQZWVyKCk7CiAgYWpheC5wb3N0KCcvYWxfaW0ucGhwJywge2FjdDogJ2Ffc3RpY2tlcnNfYnV5JywgcGFja19pZDogcGFja0lkLCBoYXNoOiBoYXNoLCBwZWVyOiBwZWVyLCBzdGlja2VyX3JlZmVycmVyOiB1bmNsZWFuKHN0aWNrZXJfcmVmZXJyZXIpfSwgewogICAgb25Eb25lOiBmdW5jdGlvbih0ZXh0LCBuZXdTdGlja2Vycywga2V5d29yZHMsIGJ0blRleHQsIGhpZGVCb3gpIHsKICAgICAgZWFjaChnZUJ5Q2xhc3MoJ19zdGlja2VyX2J0bl8nICsgcGFja0lkKSwgZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5pbm5lckhUTUwgPSBidG5UZXh0OwogICAgICAgIHRoaXMub25tb3VzZW92ZXIgPSAnJzsKICAgICAgICB0aGlzLm9uY2xpY2sgPSAnJzsKICAgICAgICBhZGRDbGFzcyh0aGlzLCAnc2Vjb25kYXJ5Jyk7CiAgICAgIH0pOwogICAgICBpZiAoY3VyLmJveFN0aWNrZXJzUHJldmlldykgewogICAgICAgIGN1ci5ib3hTdGlja2Vyc1ByZXZpZXcuaGlkZSgpOwogICAgICB9CiAgICAgIGlmIChoaWRlQm94ICYmIGN1ci5ib3hTdGlja2Vyc1N0b3JlKSB7CiAgICAgICAgY3VyLmJveFN0aWNrZXJzU3RvcmUuaGlkZSgpOwogICAgICB9CiAgICAgIHNob3dEb25lQm94KHRleHQpOwogICAgICBpZiAobmV3U3RpY2tlcnMpIHsKICAgICAgICBFbW9qaS51cGRhdGVUYWJzKG5ld1N0aWNrZXJzLCBrZXl3b3JkcywgdHJ1ZSk7CiAgICAgICAgdHJ5IHt2ay53aWRnZXQgJiYgUnBjLmNhbGxNZXRob2QoJ3Byb3h5JywgJ3VwZGF0ZVN0aWNrZXJzJyk7fSBjYXRjaChlKSB7fSAvLyBmb3Igd2lkZ2V0X2NvbW1lbnRzLmpzCiAgICAgICAgaWYgKHdpbmRvdy5WaWRlb3ZpZXcpIHsKICAgICAgICAgIFZpZGVvdmlldy5vblN0aWNrZXJzUHVyY2hhc2VkKHBhY2tJZCk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHZhciBib3ggPSBjdXIudGFiYmVkU3RpY2tlcnNCb3g7CiAgICAgIGlmIChib3ggJiYgYm94LnRiVXBkYXRlKSB7CiAgICAgICAgZm9yICh2YXIgaSBpbiBib3gudGJVcGRhdGUpIHsKICAgICAgICAgIGJveC50YlVwZGF0ZVtpXSA9IDE7CiAgICAgICAgfQogICAgICB9CgogICAgICB2YXIgb3B0SWQgPSBjdXIuZW1vamlJZCAmJiBjdXIuZW1vamlJZFtjdXIucGVlcl07CiAgICAgIGlmIChvcHRJZCkgewogICAgICAgIHZhciB0YWJFbCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYl8nK3BhY2tJZCwgRW1vamkub3B0c1tvcHRJZF0udHQpOwogICAgICAgIGlmICh0YWJFbCkgewogICAgICAgICAgRW1vamkudGFiU3dpdGNoKHRhYkVsLCBwYWNrSWQsIG9wdElkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sCiAgICBzaG93UHJvZ3Jlc3M6IGxvY2tCdXR0b24ucGJpbmQob2JqKSwKICAgIGhpZGVQcm9ncmVzczogdW5sb2NrQnV0dG9uLnBiaW5kKG9iaiksCiAgICBvbkZhaWw6IGZ1bmN0aW9uKHRleHQpIHsKICAgICAgaWYgKHRleHQpIHsKICAgICAgICBzZXRUaW1lb3V0KHNob3dGYXN0Qm94KGdldExhbmcoJ2dsb2JhbF9lcnJvcicpLCB0ZXh0KS5oaWRlLCAzMDAwKTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9KTsKICByZXR1cm4gY2FuY2VsRXZlbnQoZXYpOwp9LAoKc3RpY2tlckFjdDogZnVuY3Rpb24ob2JqLCBwYWNrSWQsIGhhc2gsIGV2LCBmcm9tQnRuKSB7CiAgaWYgKGZyb21CdG4gJiYgaGFzQ2xhc3Mob2JqLCAnc2Vjb25kYXJ5JykpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICB2YXIgYmFjayA9IG9iai5pbm5lckhUTUw7CiAgdmFyIGFjdCA9IGZyb21CdG4gPyBoYXNDbGFzcyhvYmosICdzZWNvbmRhcnknKSA6IGhhc0NsYXNzKG9iaiwgJ19pbV9zdGlja2VyX2FjdGl2YXRlZCcpOwogIGlmIChhY3QpIHsKICAgIHN0YXRlID0gMTsKICB9IGVsc2UgewogICAgc3RhdGUgPSAwOwogIH0KICB2YXIgYm94ID0gY3VyLnRhYmJlZFN0aWNrZXJzQm94OwogIGlmIChib3gpIHsKICAgIGZvciAodmFyIGkgaW4gYm94LnRiVXBkYXRlKSB7CiAgICAgIGJveC50YlVwZGF0ZVtpXSA9IDE7CiAgICB9CiAgfQogIGFqYXgucG9zdCgnL2FsX2ltLnBocCcsIHthY3Q6ICdhX3N0aWNrZXJzX3N3aXRjaCcsIHBhY2tfaWQ6IHBhY2tJZCwgaGFzaDogaGFzaCwgc3RhdGU6IHN0YXRlLCBmcm9tX2J0bjogZnJvbUJ0biA/IDEgOiAwfSwgewogICAgb25Eb25lOiBmdW5jdGlvbih0ZXh0LCBuZXdTdGlja2Vycywga2V5d29yZHMsIGJ0blRleHQpIHsKICAgICAgaWYgKCFmcm9tQnRuKSB7CiAgICAgICAgb2JqLmlubmVySFRNTCA9IHRleHQ7CiAgICAgICAgb2JqLm9ubW91c2VvdmVyID0gJyc7CiAgICAgICAgc2V0U3R5bGUob2JqLCB7d2lkdGg6ICdhdXRvJ30pOwogICAgICAgIHRvZ2dsZUNsYXNzKG9iaiwgJ19pbV9zdGlja2VyX2FjdGl2YXRlZCcsICFzdGF0ZSk7CiAgICAgIH0KICAgICAgZWFjaChnZUJ5Q2xhc3MoJ19zdGlja2VyX2J0bl8nICsgcGFja0lkKSwgZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5pbm5lckhUTUwgPSBidG5UZXh0OwogICAgICAgIHRoaXMub25tb3VzZW92ZXIgPSAnJzsKICAgICAgICB0b2dnbGVDbGFzcyh0aGlzLCAnc2Vjb25kYXJ5JywgIXN0YXRlKTsKICAgICAgfSk7CiAgICAgIEVtb2ppLnVwZGF0ZVRhYnMobmV3U3RpY2tlcnMsIGtleXdvcmRzLCB0cnVlKTsKICAgICAgdmFyIGVsID0gb2JqLnBhcmVudE5vZGUucGFyZW50Tm9kZTsKICAgICAgaWYgKGZyb21CdG4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY3VyLnN0aWNrZXJzU29ydGVyLmRlc3Ryb3koKTsKICAgICAgaWYgKHN0YXRlKSB7CiAgICAgICAgc2hvdygnaW1fc3RpY2tlcnNfZGVhY3QnKTsKICAgICAgICB2YXIgbmV3Q29udCA9IGdlKCdpbV9zdGlja2Vyc19kZWFjdF93cmFwJyk7CiAgICAgICAgaWYgKG5ld0NvbnQuZmlyc3RDaGlsZCkgewogICAgICAgICAgbmV3Q29udC5pbnNlcnRCZWZvcmUoZWwsIG5ld0NvbnQuZmlyc3RDaGlsZCkKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmV3Q29udC5hcHBlbmRDaGlsZChlbCk7CiAgICAgICAgfQogICAgICAgIHNldFN0eWxlKGVsLCB7Y3Vyc29yOiAnZGVmYXVsdCd9KQogICAgICB9IGVsc2UgewogICAgICAgIHZhciBuZXdDb250ID0gZ2VCeVRhZzEoJ2RpdicsICdpbV9zdGlja2Vyc19teV93cmFwJyk7CiAgICAgICAgbmV3Q29udC5hcHBlbmRDaGlsZChlbCk7CiAgICAgICAgdmFyIG9sZENvbnQgPSBnZSgnaW1fc3RpY2tlcnNfZGVhY3Rfd3JhcCcpOwogICAgICAgIGlmICghb2xkQ29udC5jaGlsZE5vZGVzLmxlbmd0aCkgewogICAgICAgICAgaGlkZSgnaW1fc3RpY2tlcnNfZGVhY3QnKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY3VyLnN0aWNrZXJzU29ydGVySW5pdCgpOwogICAgfSwKICAgIHNob3dQcm9ncmVzczogbG9ja0J1dHRvbi5wYmluZChvYmopLAogICAgaGlkZVByb2dyZXNzOiB1bmxvY2tCdXR0b24ucGJpbmQob2JqKQogIH0pOwogIHJldHVybiBjYW5jZWxFdmVudChldik7Cn0sCgpnZXRUYWJzQ29kZTogZnVuY3Rpb24obmV3U3RpY2tlcnMsIG9wdElkKSB7CiAgdmFyIGh0bWwgPSAnJzsKICAvL3ZhciBzdGlja2VycyA9IFtbMCwgMV1dOwogIHZhciBzdGlja2VycyA9IFtdOwogIGlmIChuZXdTdGlja2VycykgewogICAgc3RpY2tlcnMucHVzaC5hcHBseShzdGlja2VycywgbmV3U3RpY2tlcnMpOwogIH0KICBpZiAoc3RpY2tlcnMubGVuZ3RoID4gMSkgewogICAgRW1vamkuaGFzTmV3U3RpY2tlcnMgPSBmYWxzZTsKICB9CiAgdmFyIGZvcmNlU3RpY2tlclBhY2sgPSBFbW9qaS5vcHRzW29wdElkXS5mb3JjZVN0aWNrZXJQYWNrOwogIHZhciBzeXN0ZW1UYWJzSHRtbCA9ICcnOwogIHZhciBzdGlja2Vyc1RhYnNIdG1sID0gJyc7CgogIGZvciAodmFyIGkgaW4gc3RpY2tlcnMpIHsKICAgIHZhciBzdE51bSA9IHN0aWNrZXJzW2ldWzBdOwogICAgdmFyIGlzQWN0aXZlID0gc3RpY2tlcnNbaV1bMV07CiAgICB2YXIgaXNQcm9tb3RlZCA9IHN0aWNrZXJzW2ldWzNdOwogICAgdmFyIGlzRm9yY2VkID0gc3RpY2tlcnNbaV1bNF0gJiYgc3ROdW0gPT0gZm9yY2VTdGlja2VyUGFjazsKICAgIGlmICghaXNBY3RpdmUgJiYgIWlzUHJvbW90ZWQgJiYgIWlzRm9yY2VkKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGlmIChpc0FjdGl2ZSB8fCBpc0ZvcmNlZCkgewogICAgICB2YXIgYWN0ID0gJ3JldHVybiBFbW9qaS50YWJTd2l0Y2godGhpcywgJytzdE51bSsnLCAnK29wdElkKycpOyc7CiAgICB9IGVsc2UgewogICAgICB2YXIgYWN0ID0gJ3JldHVybiBFbW9qaS5wcmV2aWV3U3RpY2tlcignK3N0TnVtKycsIGZhbHNlLCB7c3RpY2tlcl9yZWZlcnJlcjogXCdrZXlib2FyZFwnfSk7JzsKICAgIH0KICAgIGlmIChzdGlja2Vyc1tpXVsyXSkgewogICAgICBFbW9qaS5oYXNOZXdTdGlja2VycyA9IHN0aWNrZXJzW2ldWzJdOwogICAgfQogICAgaWYgKHN0TnVtID09PSAtMSkgewogICAgICBzeXN0ZW1UYWJzSHRtbCArPSAnPGEgY2xhc3M9ImVtb2ppX3RhYiBlbW9qaV90YWJfaW1nX2NvbnQgZW1vamlfdGFiX3JlY2VudCBlbW9qaV90YWJfJyArIHN0TnVtICsgKGN1ci5zdGlja2Vyc1RhYiA9PSBzdE51bSA/ICcgZW1vamlfdGFiX3NlbCcgOiAnJykrJyIgb25jbGljaz0iJythY3QrJyI+PHNwYW4gY2xhc3M9ImVtb2ppX3RhYl9pY29uIGVtb2ppX3Nwcml0ZSBlbW9qaV90YWJfaWNvbl9yZWNlbnQiPjwvc3Bhbj48L2E+JzsKICAgIH0gZWxzZSBpZiAoc3ROdW0pIHsKICAgICAgdmFyIHRhYkh0bWwgPSAnPGEgY2xhc3M9ImVtb2ppX3RhYiBlbW9qaV90YWJfaW1nX2NvbnQgZW1vamlfdGFiXycgKyBzdE51bSArIChjdXIuc3RpY2tlcnNUYWIgPT0gc3ROdW0gPyAnIGVtb2ppX3RhYl9zZWwnIDogJycpKyhpc0FjdGl2ZSB8fCBpc0ZvcmNlZCA/ICcnIDogJyBlbW9qaV90YWJfcHJvbW8nKSsnIiBvbmNsaWNrPSInK2FjdCsnIj48aW1nIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiIgc3JjPSIvaW1hZ2VzL3N0b3JlL3N0aWNrZXJzLycrc3ROdW0rJy90aHVtYl8nKyh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyA+PSAyID8gJzQ0JyA6ICcyMicpKycucG5nIiBjbGFzcz0iZW1vamlfdGFiX2ltZyIvPjwvYT4nOwogICAgICBpZiAoaXNGb3JjZWQpIHsKICAgICAgICBzdGlja2Vyc1RhYnNIdG1sID0gdGFiSHRtbCArIHN0aWNrZXJzVGFic0h0bWw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgc3RpY2tlcnNUYWJzSHRtbCArPSB0YWJIdG1sOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBzeXN0ZW1UYWJzSHRtbCArPSAnPGEgY2xhc3M9ImVtb2ppX3RhYiBlbW9qaV90YWJfJytzdE51bSsoY3VyLnN0aWNrZXJzVGFiID09IHN0TnVtID8gJyBlbW9qaV90YWJfc2VsJyA6ICcnKSsoaXNBY3RpdmUgPyAnJyA6ICcgZW1vamlfdGFiX3Byb21vJykrJyIgb25jbGljaz0iJythY3QrJyI+PGRpdiBjbGFzcz0iZW1vamlfdGFiX2ljb24gZW1vamlfc3ByaXRlIGVtb2ppX3RhYl9pY29uXycrc3ROdW0rJyI+PC9kaXY+PC9hPic7CiAgICB9CiAgfQogIHJldHVybiBzeXN0ZW1UYWJzSHRtbCArIHN0aWNrZXJzVGFic0h0bWw7Cn0sCgp1cGRhdGVUYWJzOiBmdW5jdGlvbihuZXdTdGlja2Vycywga2V5d29yZHMsIHVwZGF0ZSkgewogIGlmIChuZXdTdGlja2VycyAmJiB1cGRhdGUgJiYgd2luZG93Lk5vdGlmaWVyKSB7CiAgICBOb3RpZmllci5sY1NlbmQoJ2Vtb2ppJywge2FjdDogJ3VwZGF0ZVRhYnMnLCBuZXdTdGlja2VyczogbmV3U3RpY2tlcnMsIGtleXdvcmRzOiBrZXl3b3Jkc30pOwogIH0KCiAgdmFyIG5lZWRLZXl3b3JkcyA9IDA7CiAgaWYgKGtleXdvcmRzID09PSB1bmRlZmluZWQpIHsKICAgIEVtb2ppLmluaXRTdGlja2Vyc0tleXdvcmRzKCk7CiAgICBpZiAoIXdpbmRvdy5zdGlja2Vyc0tleXdvcmRzRGF0YSkgewogICAgICBuZWVkS2V5d29yZHMgPSAxOwogICAgfQogIH0gZWxzZSB7CiAgICB3aW5kb3cuc3RpY2tlcnNLZXl3b3Jkc0RhdGEgPSBrZXl3b3JkczsKICAgIEVtb2ppLnNldFN0aWNrZXJzS2V5d29yZHMod2luZG93LnN0aWNrZXJzS2V5d29yZHNEYXRhLCB1cGRhdGUpOwogIH0KCiAgaWYgKG5ld1N0aWNrZXJzID09PSB1bmRlZmluZWQpIHsKICAgIGlmICghd2luZG93LmVtb2ppU3RpY2tlcnMgfHwgIXdpbmRvdy5zdGlja2Vyc0tleXdvcmRzRGF0YSkgewogICAgICBhamF4LnBvc3QoJ2FsX2ltLnBocCcsIHthY3Q6ICdhX3N0aWNrZXJzX2xpc3QnLCBuZWVkX2tleXdvcmRzOiBuZWVkS2V5d29yZHMsIGNhY2hlX3RpbWU6IEVtb2ppLmNhY2hlZFN0aWNrZXJzS2V5d29yZHNUaW1lKCl9LCB7CiAgICAgICAgb25Eb25lOiBFbW9qaS51cGRhdGVUYWJzCiAgICAgIH0pCiAgICB9CiAgfSBlbHNlIHsKICAgIHdpbmRvdy5lbW9qaVN0aWNrZXJzID0gbmV3U3RpY2tlcnM7CiAgfQogIGZvciAodmFyIGkgaW4gRW1vamkub3B0cykgewogICAgdmFyIG9wdHMgPSBFbW9qaS5vcHRzW2ldOwogICAgaWYgKG9wdHMubm9TdGlja2VycykgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIHZhciBodG1sID0gJyc7CiAgICBodG1sICs9IEVtb2ppLmdldFRhYnNDb2RlKHdpbmRvdy5lbW9qaVN0aWNrZXJzLCBpKTsKICAgIHZhciB0YWJzQ29udCA9IGdlKCdlbW9qaV90YWJzX2NvbnRfJytpKTsKICAgIGlmICh0YWJzQ29udCkgewogICAgICB0YWJzQ29udC5pbm5lckhUTUwgPSBodG1sOwogICAgfQogICAgRW1vamkuY2hlY2tFbW9qaVNsaWRlcihvcHRzKTsKICAgIEVtb2ppLmNoZWNrTmV3U3RpY2tlcnMob3B0cyk7CiAgICBvcHRzLnN0aWNrZXJzSW5pdGVkID0gZmFsc2U7CiAgfQoKICB2YXIgc3RpY2tlcnMgPSBFbW9qaS5zdGlja2VycyAmJiBjbG9uZShFbW9qaS5zdGlja2Vycyk7CiAgaWYgKHN0aWNrZXJzKSB7CiAgICBkZWxldGUgc3RpY2tlcnNbRW1vamkuVEFCX1JFQ0VOVF9TVElDS0VSU107CiAgfQogIGlmIChFbW9qaS5vblN0aWNrZXJzTG9hZCAmJiB3aW5kb3cuZW1vamlTdGlja2VycyAmJiAhaXNFbXB0eShzdGlja2VycykpIHsKICAgIEVtb2ppLm9uU3RpY2tlcnNMb2FkKCk7CiAgICBFbW9qaS5vblN0aWNrZXJzTG9hZCA9IGZhbHNlOwogIH0KfSwKCmNoZWNrTmV3U3RpY2tlcnM6IGZ1bmN0aW9uKG9wdHMpICB7CiAgdmFyIHR4dCA9IG9wdHMudHh0OwogIGlmICghb3B0cy5ub1N0aWNrZXJzICYmICFvcHRzLm5vU3RpY2tlcnNTdG9yZSAmJiB3aW5kb3cuZW1vamlTdGlja2VycyAmJiB0eHQuZ2V0QXR0cmlidXRlKCdjb250ZW50ZWRpdGFibGUnKSkgewoKICAgIGZvciAodmFyIGkgaW4gd2luZG93LmVtb2ppU3RpY2tlcnMpIHsKICAgICAgaWYgKHdpbmRvdy5lbW9qaVN0aWNrZXJzW2ldWzJdKSB7CiAgICAgICAgRW1vamkuaGFzTmV3U3RpY2tlcnMgPSB3aW5kb3cuZW1vamlTdGlja2Vyc1tpXVsyXTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKEVtb2ppLmhhc05ld1N0aWNrZXJzIDwgMCAmJiAhRW1vamkubm9OZXdTdGlja2VycykgewogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGVhY2goZ2VCeUNsYXNzKCdlbW9qaV9zbWlsZV9pY29uJyksIGZ1bmN0aW9uKGksIGVsKSB7CgogICAgICAgICAgdmFyIHByb21vTm9kZSA9IGVsLnBhcmVudE5vZGU7CiAgICAgICAgICBpZiAoIWdlQnlDbGFzczEoJ2Vtb2ppX3NtaWxlX2ljb25fcHJvbW8nLCBwcm9tb05vZGUpKSB7CiAgICAgICAgICAgIHByb21vTm9kZS5hcHBlbmRDaGlsZChjZSgnZGl2Jywge2NsYXNzTmFtZTogJ2Vtb2ppX3NtaWxlX2ljb25fcHJvbW8nfSkpOwogICAgICAgICAgICBhZGRFdmVudChlbCwgJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIHNob3dUb29sdGlwKHRoaXMsIHt0ZXh0OiBnZXRMYW5nKCdnbG9iYWxfc3RvcmVfc3RpY2tlcnNfbmV3X2F2YWlsYWJsZScpLCBzaGlmdDogWzcsMSw0XSwgc2hvd2R0OiAwLCBibGFjazogMX0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSwgaGFzQ2xhc3ModHh0LCAnZmNfZWRpdGFibGUnKSA/IDIwMCA6IDApOwogICAgfQogIH0KfSwKCmNoZWNrRW1vamlTbGlkZXI6IGZ1bmN0aW9uKG9wdHMpIHsKICB2YXIgY29udCA9IGdlQnlDbGFzczEoJ2Vtb2ppX3RhYnNfd3JhcCcsIG9wdHMudHQpOwogIHZhciBzaG91bGRTaG93ID0gZmFsc2U7CiAgaWYgKCFjb250KSB7CiAgICByZXR1cm47CiAgfQogIGlmIChjb250LmZpcnN0Q2hpbGQuY2xpZW50V2lkdGggJiYgKGNvbnQuZmlyc3RDaGlsZC5jbGllbnRXaWR0aCA+IGNvbnQuY2xpZW50V2lkdGggKyBjb250LnNjcm9sbExlZnQpKSB7CiAgICBzaG91bGRTaG93ID0gdHJ1ZTsKICB9IGVsc2UgewogICAgdmFyIGNhdHMgPSBjb250LmZpcnN0Q2hpbGQuY2hpbGROb2RlczsKICAgIGlmIChjYXRzLmxlbmd0aCA+IDYpIHsKICAgICAgaWYgKChvcHRzLnNjcm9sbExlZnQgfHwgMCkgPCAoY2F0cy5sZW5ndGggLSA2KSAqIDM0IC0gMTYpIHsKICAgICAgICBzaG91bGRTaG93ID0gdHJ1ZTsKICAgICAgfQogICAgfQogIH0KCiAgdmFyIHJkaXIgPSB2ay5ydGwgPyAnbCcgOiAncic7CiAgaWYgKHNob3VsZFNob3cpIHsKICAgIG9wdHMuc2xpZGVyU2hvd24gPSB0cnVlOwogICAgRW1vamkuc2Nyb2xsVG9nZ2xlQXJyb3codHJ1ZSwgcmRpciwgb3B0cywgdHJ1ZSk7CiAgfSBlbHNlIGlmIChvcHRzLnNsaWRlclNob3duKSB7CiAgICBvcHRzLnNsaWRlclNob3duID0gZmFsc2U7CiAgICBFbW9qaS5zY3JvbGxUb2dnbGVBcnJvdyhmYWxzZSwgcmRpciwgb3B0cywgdHJ1ZSk7CiAgfQp9LAoKZ2lmdFN0aWNrZXI6IGZ1bmN0aW9uKHBhY2tJZCwgcGVlcnNJZHMsIGV2LCBvcHRzKSB7CiAgb3B0cyA9IG9wdHMgfHwge307CiAgdmFyIHBhcmFtcyA9IHsKICAgIGFjdDogJ3N0aWNrZXJzX2dpZnRfYm94JywKICAgIHBhY2tfaWQ6IHBhY2tJZCwKICAgIHBlZXJzOiBwZWVyc0lkcwogIH07CiAgaWYgKG9wdHMuZnJvbSkgewogICAgcGFyYW1zLmZyb20gPSBvcHRzLmZyb207CiAgfQogIHBhcmFtcy5zdGlja2VyX3JlZmVycmVyID0gb3B0cy5zdGlja2VyX3JlZmVycmVyIHx8ICdzdG9yZSc7CiAgYm94TGF5ZXJXcmFwLnNjcm9sbFRvcCA9IDA7CiAgc2hvd0JveCgnL2FsX2ltLnBocCcsIHBhcmFtcywgewogICAgc3RhdDogWyd3aWRlX2RkLmpzJywgJ3dpZGVfZGQuY3NzJywgJ25vdGlmaWVyLmNzcycsICdub3RpZmllci5qcyddLAogICAgZGFyazogMQogIH0pOwogIHJldHVybiBjYW5jZWxFdmVudChldik7Cn0sCgpzaG93U3RpY2tlclRUOiBmdW5jdGlvbihlbCkgewogIHZhciB0ZXh0ID0gZWwuZ2V0QXR0cmlidXRlKCdkYXRhLXRpdGxlJyk7CiAgaWYgKCF0ZXh0KSByZXR1cm47CiAgc2hvd1Rvb2x0aXAoZWwsIHsKICAgIHRleHQ6IHRleHQsCiAgICBzbGlkZTogMTUsCiAgICBzaGlmdDogWzc0IC0gZ2V0U2l6ZShlbClbMF0gLyAyLCAxMjAsIDVdLAogICAgY2xhc3NOYW1lOiAnc3RpY2tlcl9oaW50X3R0JywKICAgIGhhc292ZXI6IDEKICB9KTsKfSwKCnNjcm9sbFRvU3RpY2tlclBhY2s6IGZ1bmN0aW9uIChvcHRJZCwgc2VsSWQsIGZhc3QpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdLAogICAgc3RpY2tlcnNTdGFydCA9IGdlKCdlbW9qaV90YWJfY29udF8nICsgc2VsSWQgKyAnXycgKyBvcHRJZCksCiAgICBzdCA9IChzdGlja2Vyc1N0YXJ0ICYmIHNlbElkICE9IEVtb2ppLlRBQl9SRUNFTlRfU1RJQ0tFUlMpID8gc3RpY2tlcnNTdGFydC5vZmZzZXRUb3AgKyBnZXRTaXplKHN0aWNrZXJzU3RhcnQpWzFdIDogMDsKCiAgb3B0cy5zY3JvbGxBbmltYXRpb24gPSAxOwogIG9wdHMuZW1vamlTY3JvbGwuc2Nyb2xsVG9wKHN0LCBmYXN0ID8gMCA6IDIwMCwgZnVuY3Rpb24gKCkgewogICAgb3B0cy5zY3JvbGxBbmltYXRpb24gPSAwOwogIH0pOwogIEVtb2ppLnNjcm9sbFRvVGFiKHNlbElkLCBvcHRJZCk7Cn0sCgp0b2dnbGVTdGlja2VyczogZnVuY3Rpb24ob3B0SWQsIG5vU3RpY2tlcnMpIHsKICB2YXIgb3B0cyA9IEVtb2ppLm9wdHNbb3B0SWRdOwogIGlmIChvcHRzICYmIG9wdHMudHQpIHsKICAgIG9wdHMubm9TdGlja2VycyA9IG5vU3RpY2tlcnM7CiAgICB0b2dnbGVDbGFzcyhvcHRzLnR0LCAnZW1vamlfbm9fdGFicycsIG5vU3RpY2tlcnMpOyAvLyB3b3JrcyBpZiBpbml0KCkgd2FzIHdpdGggc3RpY2tlcnMKICAgIGlmIChvcHRzLmN1clRhYikKICAgICAgRW1vamkudGFiU3dpdGNoKDAsIDAsIG9wdElkKTsKICB9IGVsc2UgaWYgKG9wdHMpIHsKICAgIG9wdHMuaGlkZVN0aWNrZXJzSW5pdGlhbCA9IG5vU3RpY2tlcnM7CiAgfQp9LAoKZ2V0U2l6ZUNhY2hlZDogZnVuY3Rpb24gKGVsKSB7CiAgZWwgPSBnZShlbCk7CiAgaWYgKCFlbCkgewogICAgcmV0dXJuIFswLCAwXTsKICB9CgogIGlmIChlbFtFbW9qaS5DQUNIRURfV0lEVEhfUFJPUF0gPT09IHVuZGVmaW5lZCB8fCBlbFtFbW9qaS5DQUNIRURfSEVJR0hUX1BST1BdID09PSB1bmRlZmluZWQpIHsKICAgIGVsW0Vtb2ppLkNBQ0hFRF9XSURUSF9QUk9QXSA9IGVsLm9mZnNldFdpZHRoOwogICAgZWxbRW1vamkuQ0FDSEVEX0hFSUdIVF9QUk9QXSA9IGVsLm9mZnNldEhlaWdodDsKICB9CgogIHJldHVybiBbZWxbRW1vamkuQ0FDSEVEX1dJRFRIX1BST1BdLCBlbFtFbW9qaS5DQUNIRURfSEVJR0hUX1BST1BdXTsKfSwKCl9fZW9mOiAxfX0KdHJ5e3N0TWFuYWdlci5kb25lKCdlbW9qaS5qcycpO31jYXRjaChlKXt9Cg==</ActualData>
            </HTTPData>
          </HTTPDataSet>
          <IsExternalData>false</IsExternalData>
        </HTTPBody>
        <TcpPackets>
          <PacketInfo time="75353546" offset="0" length="461" />
          <PacketInfo time="75353625" offset="461" length="8193" />
          <PacketInfo time="75353765" offset="8654" length="8193" />
          <PacketInfo time="75353765" offset="16847" length="8193" />
          <PacketInfo time="75353765" offset="25040" length="8193" />
          <PacketInfo time="75353781" offset="33233" length="4" />
          <PacketInfo time="75353781" offset="33237" length="3849" />
          <PacketInfo time="75353781" offset="37086" length="5" />
        </TcpPackets>
      </HTTPResponse>
    </HTTPTask>
  </HTTPTask>
</HTTPSnapshot>